<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Randy Jin, Elizabeth Juarez-Colunga">
<title>SWAN AMH project analysis - 8&nbsp; Rate model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09_table1_publication.html" rel="next">
<link href="./07_auc_roc.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SWAN AMH project analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/Goodgolden/tsa" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08_rate_auc.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse tools-wide">
    <a href="https://github.com/Goodgolden/tsa" rel="" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="" rel="" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-share"></i></a>
    <a href="https://coloradosph.cuanschutz.edu/education/departments/biostatistics-informatics" rel="" title="" class="quarto-navigation-tool px-1" aria-label="CU Anschutz"><i class="bi bi-hospital"></i></a>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working log</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_table1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Table1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_jm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">JM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_model_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_jmbayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_jmbayes2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">JMbayes2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_jm_model_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JM Model Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_auc_roc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AUC and ROC</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_rate_auc.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_table1_publication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Table1 (for publication)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Paper Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#goal-of-the-analysis" id="toc-goal-of-the-analysis" class="nav-link active" data-scroll-target="#goal-of-the-analysis"><span class="header-section-number">8.1</span> Goal of the analysis</a></li>
  <li><a href="#fit-the-joint-model" id="toc-fit-the-joint-model" class="nav-link" data-scroll-target="#fit-the-joint-model"><span class="header-section-number">8.2</span> Fit the joint model</a></li>
  <li>
<a href="#checking-jm-package-to-confirme" id="toc-checking-jm-package-to-confirme" class="nav-link" data-scroll-target="#checking-jm-package-to-confirme"><span class="header-section-number">8.3</span> Checking <code>JM</code> package’ to confirme</a>
  <ul class="collapse">
<li><a href="#summary-for-the-jmbayes.fit116.d" id="toc-summary-for-the-jmbayes.fit116.d" class="nav-link" data-scroll-target="#summary-for-the-jmbayes.fit116.d"><span class="header-section-number">8.3.1</span> Summary for the <code>jmbayes.fit116.d</code></a></li>
  </ul>
</li>
  <li>
<a href="#dynamic-prediction" id="toc-dynamic-prediction" class="nav-link" data-scroll-target="#dynamic-prediction"><span class="header-section-number">8.4</span> Dynamic prediction</a>
  <ul class="collapse">
<li><a href="#individual-prediction-plots" id="toc-individual-prediction-plots" class="nav-link" data-scroll-target="#individual-prediction-plots"><span class="header-section-number">8.4.1</span> Individual prediction plots</a></li>
  <li><a href="#auc" id="toc-auc" class="nav-link" data-scroll-target="#auc"><span class="header-section-number">8.4.2</span> AUC</a></li>
  <li><a href="#roc" id="toc-roc" class="nav-link" data-scroll-target="#roc"><span class="header-section-number">8.4.3</span> ROC</a></li>
  <li><a href="#brier-score" id="toc-brier-score" class="nav-link" data-scroll-target="#brier-score"><span class="header-section-number">8.4.4</span> Brier Score</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Goodgolden/tsa/edit/main/08_rate_auc.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="cell" data-hash="08_rate_auc_cache/html/css-setup_54000cc0430e718b78abe48154164b79">
<style type="text/css">
.scroll-100 {
  max-height: 300px;
  max-width: 1000px;
  overflow-y: auto;
  background-color: inherit;
}
</style>
</div>
<section id="goal-of-the-analysis" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="goal-of-the-analysis">
<span class="header-section-number">8.1</span> Goal of the analysis</h2>
<ul class="task-list">
<li><p><input type="checkbox" checked="">Fit the joint model including rate with <code>JMbayes2</code> based on model selection results</p></li>
<li><p><input type="checkbox" checked="">Dynamic prediction for the joint model with plots</p></li>
<li><p><input type="checkbox" checked="">Calculate the AUC and ROC for the joint model</p></li>
</ul></section><section id="fit-the-joint-model" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="fit-the-joint-model">
<span class="header-section-number">8.2</span> Fit the joint model</h2>
<p>Here is the joint model with <code>JMbayes2</code>, the name of the model is set up as <code>package</code> + [fit] + <code>lme_number</code> + <code>surv_number</code> + <code>functional</code></p>
<div class="cell" data-hash="08_rate_auc_cache/html/loading_6f4653fa372f58d582d82371d3c6f116">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data-raw/swan_amh_jmbayes2_fit116.RData"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="08_rate_auc_cache/html/jmbayes2.fit116.d_7547bca681cc49bc2a730e8221403db3">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">jmcontrol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n_iter <span class="op">=</span> <span class="fl">5000</span>, </span>
<span>                  n_burnin <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>                  n_chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  seed <span class="op">=</span> <span class="fl">55555</span>,</span>
<span>                  cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">jmbayes2.fit116.d</span> <span class="op">&lt;-</span> <span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/jm.html">jm</a></span><span class="op">(</span>Surv_object <span class="op">=</span> <span class="va">surv.fit16</span>,</span>
<span>                                  Mixed_objects <span class="op">=</span> <span class="va">lme.fit1</span>, </span>
<span>                                  functional_forms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"lamh"</span> <span class="op">=</span> <span class="op">~</span> <span class="fu">value</span><span class="op">(</span><span class="va">lamh</span><span class="op">)</span> <span class="op">+</span> <span class="fu">slope</span><span class="op">(</span><span class="va">lamh</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                                  control <span class="op">=</span> <span class="va">jmcontrol</span>,</span>
<span>                                  seed <span class="op">=</span> <span class="fl">55555</span><span class="op">)</span> </span>
<span>                         </span>
<span></span>
<span><span class="va">jmbayes2.fit116</span> <span class="op">&lt;-</span> <span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/jm.html">jm</a></span><span class="op">(</span>Surv_object <span class="op">=</span> <span class="va">surv.fit16</span>,</span>
<span>                                  Mixed_objects <span class="op">=</span> <span class="va">lme.fit1</span>, </span>
<span>                                  <span class="co"># functional_forms = list("lamh" = ~ value(lamh) + slope(lamh)),</span></span>
<span>                                  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                                  control <span class="op">=</span> <span class="va">jmcontrol</span>,</span>
<span>                                  seed <span class="op">=</span> <span class="fl">55555</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The model with rate is definitely better than the model without rate.</p>
<div class="cell" data-hash="08_rate_auc_cache/html/compare_jmbayes2_77ad8262136f29818cd7f52a653baf1b">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">compare_jm</span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>, <span class="va">jmbayes2.fit116</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;                         DIC     WAIC      LPML
#&gt;  jmbayes2.fit116.d 14827.79 14888.48 -7504.700
#&gt;    jmbayes2.fit116 14962.45 14972.47 -7499.795
#&gt; 
#&gt; The criteria are calculated based on the marginal log-likelihood.</code></pre>
</div>
</div>
</section><section id="checking-jm-package-to-confirme" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="checking-jm-package-to-confirme">
<span class="header-section-number">8.3</span> Checking <code>JM</code> package’ to confirme</h2>
<p>The results can be replicated with the <code>JM</code> package</p>
<div class="cell" data-hash="08_rate_auc_cache/html/jm_rate_c1c96a6b963879b0175a064e39a1613e">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://jmr.r-forge.r-project.org/">JM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dform.116</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>              <span class="co">## the fixed effects of mi(t) used</span></span>
<span>              indFixed <span class="op">=</span> <span class="fl">2</span>, </span>
<span>              random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>              <span class="co">## the second random effect of mi(t)</span></span>
<span>              indRandom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jm.fit116.d</span> <span class="op">&lt;-</span> <span class="fu">JM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JM/man/jointModel.html">jointModel</a></span><span class="op">(</span><span class="va">lme.fit1</span>,</span>
<span>                       <span class="va">surv.fit16</span>,</span>
<span>                       timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                       parameterization <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>                       derivForm <span class="op">=</span> <span class="va">dform.116</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jm.fit116</span> <span class="op">&lt;-</span> <span class="fu">JM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JM/man/jointModel.html">jointModel</a></span><span class="op">(</span><span class="va">lme.fit1</span>,</span>
<span>                       <span class="va">surv.fit16</span>,</span>
<span>                       timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                       <span class="co"># parameterization = "both",</span></span>
<span>                       method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="08_rate_auc_cache/html/jm_comparison_1fc86f41b5785a7e268d063b2a1c089b">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">jm.fit116</span>, <span class="va">jm.fit116.d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in anova.jointModel(jm.fit116, jm.fit116.d): it seems that
#&gt; 'jm.fit116.d' has not converged.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;                  AIC      BIC  log.Lik   LRT df p.value
#&gt; jm.fit116   14727.88 14868.58 -7331.94                 
#&gt; jm.fit116.d 14715.44 14860.54 -7324.72 14.44  1   1e-04</code></pre>
</div>
</div>
<section id="summary-for-the-jmbayes.fit116.d" class="level3" data-number="8.3.1"><h3 data-number="8.3.1" class="anchored" data-anchor-id="summary-for-the-jmbayes.fit116.d">
<span class="header-section-number">8.3.1</span> Summary for the <code>jmbayes.fit116.d</code>
</h3>
<p>For the <code>lme</code> model:</p>
<div class="cell" data-output.class="scroll-100" data-hash="08_rate_auc_cache/html/jmbayes2.fit116d.lme_71cc069c9784fe233f4818a6e0c63fba">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">$</span><span class="va">Outcome1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["StDev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["2.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["97.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["P"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"7.8009991","2":"0.085667505","3":"7.6390793","4":"7.9778063","5":"0","_rn_":"(Intercept)"},{"1":"-0.5831007","2":"0.007833421","3":"-0.6016161","4":"-0.5718443","5":"0","_rn_":"time"},{"1":"1.3158656","2":"0.018395845","3":"1.2788111","4":"1.3525139","5":"0","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>For the <code>surv</code> model:</p>
<div class="cell" data-output.class="scroll-100" data-hash="08_rate_auc_cache/html/jmbayes2.fit116d.surv_941fa96564a73553667b6c583d6c61d2">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">$</span><span class="va">Survival</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["StDev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["2.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["97.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["P"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.24173048","2":"0.21019765","3":"-0.16554925","4":"0.66521348","5":"0.2330","_rn_":"marriedMarried/Partnered"},{"1":"-0.03942147","2":"0.20066041","3":"-0.45412465","4":"0.35957435","5":"0.8500","_rn_":"bc_pillsEver use BC pills"},{"1":"-0.06077460","2":"0.01560323","3":"-0.09324953","4":"-0.03340832","5":"0.0000","_rn_":"bmi"},{"1":"-0.12960340","2":"0.41371673","3":"-0.88253795","4":"0.77325771","5":"0.7025","_rn_":"site_ethnic_b_black"},{"1":"-0.43455399","2":"0.39579667","3":"-1.22371357","4":"0.41893388","5":"0.2310","_rn_":"site_ethnic_c_black"},{"1":"0.68737073","2":"0.41192506","3":"-0.10195926","4":"1.48183997","5":"0.0905","_rn_":"site_ethnic_c_cauca"},{"1":"0.04187104","2":"0.32307751","3":"-0.54708422","4":"0.75524216","5":"0.9190","_rn_":"site_ethnic_m_black"},{"1":"0.63668665","2":"0.38262803","3":"-0.04153395","4":"1.43319007","5":"0.0560","_rn_":"site_ethnic_m_cauca"},{"1":"1.09902583","2":"0.79558220","3":"-0.23688236","4":"2.76953079","5":"0.1305","_rn_":"site_ethnic_nj_cauca"},{"1":"0.19425954","2":"0.55242061","3":"-1.01044437","4":"1.29607230","5":"0.6885","_rn_":"site_ethnic_nj_hispa"},{"1":"0.48032000","2":"0.48912555","3":"-0.41778025","4":"1.49760003","5":"0.3180","_rn_":"site_ethnic_p_black"},{"1":"0.72719977","2":"0.40696639","3":"0.01460096","4":"1.61706650","5":"0.0440","_rn_":"site_ethnic_p_cauca"},{"1":"0.25393838","2":"0.40546151","3":"-0.55348793","4":"1.05107442","5":"0.5115","_rn_":"site_ethnic_ucd_cauca"},{"1":"0.01262137","2":"0.32599918","3":"-0.54500491","4":"0.72509456","5":"0.9860","_rn_":"site_ethnic_ucd_chine"},{"1":"0.71457773","2":"0.42276951","3":"-0.03280341","4":"1.55743956","5":"0.0615","_rn_":"site_ethnic_ucla_cauca"},{"1":"0.68330809","2":"0.34086925","3":"0.02937660","4":"1.33315232","5":"0.0370","_rn_":"site_ethnic_ucla_japan"},{"1":"-0.09917183","2":"0.21263468","3":"-0.55328379","4":"0.29850793","5":"0.6515","_rn_":"smoke_past_only"},{"1":"0.40435015","2":"0.28904671","3":"-0.10597509","4":"1.00483182","5":"0.1635","_rn_":"smoke_current_smoker"},{"1":"-1.13220093","2":"0.12653452","3":"-1.37177992","4":"-0.89754610","5":"0.0000","_rn_":"value(lamh)"},{"1":"-24.51070062","2":"15.64723103","3":"-50.30952339","4":"-0.20160812","5":"0.0445","_rn_":"slope(lamh)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section></section><section id="dynamic-prediction" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="dynamic-prediction">
<span class="header-section-number">8.4</span> Dynamic prediction</h2>
<section id="individual-prediction-plots" class="level3" data-number="8.4.1"><h3 data-number="8.4.1" class="anchored" data-anchor-id="individual-prediction-plots">
<span class="header-section-number">8.4.1</span> Individual prediction plots</h3>
<div class="cell" data-hash="08_rate_auc_cache/html/plot_function_8225f5f755a6570e621166211f10907e">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Title Dynamic prediction plot for individual</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param id_num individual id number in the list</span></span>
<span><span class="co">#' @param tmin the start time</span></span>
<span><span class="co">#' @param tmax the end time</span></span>
<span><span class="co">#' @param jmfit the joint model objects</span></span>
<span><span class="co">#' @param ... </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return a list of lme and surv predicts</span></span>
<span></span>
<span><span class="va">dpplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id_num</span>,</span>
<span>                   <span class="va">tmin</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   <span class="va">tmax</span> <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                   <span class="va">jmfit</span> <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span>,</span>
<span>                   <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># browser()</span></span>
<span>  <span class="va">nid0</span> <span class="op">&lt;-</span> <span class="va">swan_amh02</span><span class="op">[</span><span class="va">swan_amh02</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">id_num</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">nid</span> <span class="op">&lt;-</span> <span class="va">nid0</span></span>
<span>  <span class="va">nid</span> <span class="op">&lt;-</span> <span class="va">nid</span><span class="op">[</span><span class="va">nid</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;</span> <span class="va">tmin</span>, <span class="op">]</span></span>
<span>  <span class="va">nid</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">nid</span><span class="op">$</span><span class="va">etime</span> <span class="op">&lt;-</span> <span class="va">tmin</span></span>
<span>  </span>
<span>  <span class="va">Lpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">jmfit</span>, </span>
<span>                    newdata <span class="op">=</span> <span class="va">nid</span>,</span>
<span>                   times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">tmin</span>, <span class="va">tmax</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>                    return_newdata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">Spred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">jmfit</span>, </span>
<span>                 newdata <span class="op">=</span> <span class="va">nid</span>,</span>
<span>                 times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">tmin</span>, <span class="va">tmax</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>                 process <span class="op">=</span> <span class="st">"event"</span>,</span>
<span>                 return_newdata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Lpred</span>, <span class="va">Spred</span>, ylab_long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"ID_"</span>, <span class="va">id_num</span>, <span class="st">"  log(amh)"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Lpred <span class="op">=</span> <span class="va">Lpred</span>,</span>
<span>              Spred <span class="op">=</span> <span class="va">Spred</span>,</span>
<span>              nid0 <span class="op">=</span> <span class="va">nid0</span>,</span>
<span>              nid <span class="op">=</span> <span class="va">nid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Some of the very steep trajectory for the risk function: <code>id5</code>, <code>id26</code>, <code>id56</code>, <code>id333</code>, <code>id342</code>;</p>
<div>
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">swan_amh02</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id5</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id26</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">26</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id333</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">333</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-hash="08_rate_auc_cache/html/high_risk_d9f45d56f94e233fdd342119c4e0805b">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/high_risk-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id5_t4</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/high_risk-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id5_t8</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/high_risk-3.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id26_t4</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/high_risk-4.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id26_t8</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/high_risk-5.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id333_t4</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/high_risk-6.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id333_t8</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>The dynamic prediction for high risk individuals</p>
</div>
</div>
</div>
</div>
<p>Some of the smooth trajectory for the risk function: <code>id32</code>, <code>id57</code>, <code>id89</code>, <code>id222</code>,<code>id44</code>, <code>id371</code>;</p>
<div>
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dpplot_id32</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">57</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id371</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">371</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id44</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">44</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116.d</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-hash="08_rate_auc_cache/html/low_risk_29fdab5c4a7232fa5b7b6ac5aa4b409e">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/low_risk-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id32_t4</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/low_risk-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id32_t8</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/low_risk-3.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id371_t4</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/low_risk-4.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id371_t8</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/low_risk-5.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id44_t4</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="08_rate_auc_files/figure-html/low_risk-6.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">id44_t8</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>The dynamic prediction for low risk individuals</p>
</div>
</div>
</div>
</div>
</section><section id="auc" class="level3" data-number="8.4.2"><h3 data-number="8.4.2" class="anchored" data-anchor-id="auc">
<span class="header-section-number">8.4.2</span> AUC</h3>
<p>For <code>JMbayes2</code>, the function <code>tvAUC()</code> is used to estimate the time-dependent AUC only for all the subjects (there is no function for individual AUC).</p>
<div class="cell" data-hash="08_rate_auc_cache/html/auc_summary_364d97da621aeab1fac2d79e8886b0c3">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">AUC2</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUC4</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUC6</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUC8</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is the table for the AUC result, using the same joint model for the dynamic prediction. Each AUC for a different time point and time window as 2.</p>
<p>The AUC score are calculated for the time points 2, 4, 6, and 8. It seems the best AUC score is at time 4, and the AUC score decreases as the time window increases. Based on the plots for individuals, some of the plot are missing, because there is no longitudinal data before the <code>Tstart</code>.</p>
<div class="cell" data-output.class="scroll-100" data-hash="08_rate_auc_cache/html/auc_result_a87a6fa83e69b3c3e2cd51e601a07c5c">
<details><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Tstart <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">AUC2</span>, <span class="va">AUC4</span>, <span class="va">AUC6</span>, <span class="va">AUC8</span><span class="op">)</span>,</span>
<span>                   <span class="st">"Tstart"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      Tend <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">AUC2</span>, <span class="va">AUC4</span>, <span class="va">AUC6</span>, <span class="va">AUC8</span><span class="op">)</span>, </span>
<span>                 <span class="st">"Thoriz"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      AUC <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">AUC2</span>, <span class="va">AUC4</span>, <span class="va">AUC6</span>, <span class="va">AUC8</span><span class="op">)</span>, </span>
<span>                <span class="st">"auc"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Tstart"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Tend"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AUC"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"4","3":"0.6650327"},{"1":"4","2":"6","3":"0.9278662"},{"1":"6","2":"8","3":"0.8263800"},{"1":"8","2":"10","3":"0.8106661"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="roc" class="level3" data-number="8.4.3"><h3 data-number="8.4.3" class="anchored" data-anchor-id="roc">
<span class="header-section-number">8.4.3</span> ROC</h3>
<p>ROC can be calculated based on both individual or all subjects. Here are the results for the ROC for all subject predictions.</p>
<p>The ROC results is consistent with the AUC results, the best ROC is at time 4, and the ROC score decreases as the <code>Tstart</code> increases.</p>
<div class="cell" data-hash="08_rate_auc_cache/html/roc_summary_2f806501bab9b61929dfae73e2ad7f5f">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ROC2</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ROC4</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ROC6</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ROC8</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC2</span>, ylab <span class="op">=</span> <span class="st">"Tstart_2 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="08_rate_auc_files/figure-html/roc_summary-1.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC4</span>, ylab <span class="op">=</span> <span class="st">"Tstart_4 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="08_rate_auc_files/figure-html/roc_summary-2.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC6</span>, ylab <span class="op">=</span> <span class="st">"Tstart_6 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="08_rate_auc_files/figure-html/roc_summary-3.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC8</span>, ylab <span class="op">=</span> <span class="st">"Tstart_8 Sensitivity"</span>, optimal_cutoff <span class="op">=</span> <span class="st">"Youden"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="08_rate_auc_files/figure-html/roc_summary-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="brier-score" class="level3" data-number="8.4.4"><h3 data-number="8.4.4" class="anchored" data-anchor-id="brier-score">
<span class="header-section-number">8.4.4</span> Brier Score</h3>
<p>The Brier score is also working for a whole dataset but not for individual subjects. Here is the Brier score for the time points 2 and 8, with 2 as the prediction window.</p>
<pre><code>a data.frame that contains the longitudinal and covariate information for
the subjects for which prediction of survival probabilities is required.
The names of the variables in this data.frame must be the same as 
in the data.frames that were used to fit the linear mixed effects and 
the event process model that were supplied as the two first argument of jm.</code></pre>
<p><em>Warning: there are fewer than 5 subjects with an event in the interval [4.000001, 12).</em></p>
<p>The Brier score (BS) is calculated using the following formula:</p>
<p><span class="math inline">\(BrierScore = (f_t - o_t)^2\)</span></p>
<p><span class="math inline">\(f_t\)</span> represents the percentage response from the clinician, <span class="math inline">\(o_t\)</span> represents the outcome of the patient (<code>0 = did not occur</code>, <code>1 = did occur</code>).</p>
<p>The Brier score takes in to account the outcome of the event predicted as well as the estimate.</p>
<p>Brier scores range between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>: - A score of 0 represents perfect accuracy - A score of 1 represents perfect inaccuracy.</p>
<p>If a participant predicted a 70% probability of dying within 72 hours, and the patient did in fact die within that timescale, then they would have a Brier score of <span class="math inline">\((0.70-1)^2 = 0.09\)</span>. In this example, the outcome event occurred (coded as 1), and is deducted from the percentage probability; the result is then squared. The low Brier score indicates that this prediction was relatively accurate.</p>
<p>If, in contrast, the participant predicted an 80% probability of dying within 72 hours, and the patient did not in fact die within that timeframe, then they would have scored <span class="math inline">\((0.80-0)^2 = 0.64\)</span>. In this case the outcome event did not occur (coded as 0), and is deducted from the percentage probability; the result is squared. The high Brier score indicates that this prediction was relatively inaccurate.</p>
<p>Finally, if the participant had predicted a 50% probability of dying within 72 hours then regardless of whether or not the patient died, the Brier score would be <span class="math inline">\((0.50-0)^2 = 0.25\)</span> or <span class="math inline">\((0.50-1)^2 = 0.25\)</span>. In each case a Brier score of 0.25 indicates a random guess.</p>
<p>The <strong>integrated Brier score</strong> for a time interval is the average of the score values for the interval, which is the area under a curve that plots the score against the follow-up time divided by the length of the time interval.</p>
<div class="cell" data-hash="08_rate_auc_cache/html/bs_summary_b7e67efcc12676b8de7737784709fae2">
<details><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">BS2</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in br(Thoriz): there are fewer than 5 subjects with an event in the interval [2.000001, 4).</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">BS4</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BS6</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BS8</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116.d</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-output.class="scroll-100" data-hash="08_rate_auc_cache/html/bs_result_e65c88a4ea2304ac9daad46cbf425f26">
<details><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Tstart <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BS2</span>, <span class="va">BS4</span>, <span class="va">BS6</span>, <span class="va">BS8</span><span class="op">)</span>,</span>
<span>                   <span class="st">"Tstart"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      Tend <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BS2</span>, <span class="va">BS4</span>, <span class="va">BS6</span>, <span class="va">BS8</span><span class="op">)</span>, </span>
<span>                 <span class="st">"Thoriz"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      BS <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BS2</span>, <span class="va">BS4</span>, <span class="va">BS6</span>, <span class="va">BS8</span><span class="op">)</span>, </span>
<span>                <span class="st">"Brier"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Tstart"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Tend"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BS"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"4","3":"0.01278094"},{"1":"4","2":"6","3":"0.02552186"},{"1":"6","2":"8","3":"0.08968181"},{"1":"8","2":"10","3":"0.15755707"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./07_auc_roc.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AUC and ROC</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09_table1_publication.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Table1 (for publication)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Rate model"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warnings =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#results = "hide",</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">error =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ## clean the R environment</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># graphics.off()</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls())</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># freshr::freshr()</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="do">## load packages</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JMbayes2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="do">## check the directory for the file</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co"># here::dr_here()</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">set_here</span>()</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="do">## the figure or results should be saved </span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co"># paste0("foldername/Sfilename_workingresult_", </span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co">#      Sys.Date(), ".filetype")</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, "css-setup", echo=FALSE}</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">scroll</span><span class="dv">-100</span> <span class="op">{</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>height<span class="op">:</span> 300px<span class="op">;</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>width<span class="op">:</span> 1000px<span class="op">;</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  overflow<span class="op">-</span>y<span class="op">:</span> auto<span class="op">;</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>color<span class="op">:</span> inherit<span class="op">;</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goal of the analysis</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Fit the joint model including rate with <span class="in">`JMbayes2`</span> based on model selection results</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Dynamic prediction for the joint model with plots</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Calculate the AUC and ROC for the joint model</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit the joint model</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>Here is the joint model with <span class="in">`JMbayes2`</span>, the name of the model is set up as <span class="in">`package`</span> + <span class="sc">\[</span>fit<span class="sc">\]</span> + <span class="in">`lme_number`</span> + <span class="in">`surv_number`</span> + <span class="in">`functional`</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "loading"</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data-raw/swan_amh_jmbayes2_fit116.RData"</span>)</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "jmbayes2.fit116.d"</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>jmcontrol <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n_iter =</span> <span class="dv">5000</span>, </span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_burnin =</span> <span class="dv">1000</span>, </span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_chains =</span> <span class="dv">1</span>,</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">55555</span>,</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cores =</span> <span class="dv">1</span>)</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>jmbayes2.fit116.d <span class="ot">&lt;-</span> JMbayes2<span class="sc">::</span><span class="fu">jm</span>(<span class="at">Surv_object =</span> surv.fit16,</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Mixed_objects =</span> lme.fit1, </span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">functional_forms =</span> <span class="fu">list</span>(<span class="st">"lamh"</span> <span class="ot">=</span> <span class="er">~</span> <span class="fu">value</span>(lamh) <span class="sc">+</span> <span class="fu">slope</span>(lamh)),</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">time_var =</span> <span class="st">"time"</span>,</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">control =</span> jmcontrol,</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">seed =</span> <span class="dv">55555</span>) </span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>jmbayes2.fit116 <span class="ot">&lt;-</span> JMbayes2<span class="sc">::</span><span class="fu">jm</span>(<span class="at">Surv_object =</span> surv.fit16,</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Mixed_objects =</span> lme.fit1, </span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># functional_forms = list("lamh" = ~ value(lamh) + slope(lamh)),</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">time_var =</span> <span class="st">"time"</span>,</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">control =</span> jmcontrol,</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">seed =</span> <span class="dv">55555</span>) </span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>The model with rate is definitely better than the model without rate.</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "compare_jmbayes2"</span></span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_jm</span>(jmbayes2.fit116.d, jmbayes2.fit116)</span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking `JM` package' to confirme</span></span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>The results can be replicated with the <span class="in">`JM`</span> package</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "jm_rate"</span></span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JM)</span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>dform<span class="fl">.116</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the fixed effects of mi(t) used</span></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>              <span class="at">indFixed =</span> <span class="dv">2</span>, </span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a>              <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the second random effect of mi(t)</span></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>              <span class="at">indRandom =</span> <span class="dv">2</span>)</span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a>jm.fit116.d <span class="ot">&lt;-</span> JM<span class="sc">::</span><span class="fu">jointModel</span>(lme.fit1,</span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>                       surv.fit16,</span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>                       <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>                       <span class="at">parameterization =</span> <span class="st">"both"</span>,</span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>                       <span class="at">derivForm =</span> dform<span class="fl">.116</span>,</span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>jm.fit116 <span class="ot">&lt;-</span> JM<span class="sc">::</span><span class="fu">jointModel</span>(lme.fit1,</span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>                       surv.fit16,</span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>                       <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># parameterization = "both",</span></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "jm_comparison"</span></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(jm.fit116, jm.fit116.d)</span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary for the `jmbayes.fit116.d`</span></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>For the <span class="in">`lme`</span> model:</span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "jmbayes2.fit116d.lme"</span></span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes2.fit116.d)<span class="sc">$</span>Outcome1 </span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a>For the <span class="in">`surv`</span> model:</span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "jmbayes2.fit116d.surv"</span></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes2.fit116.d)<span class="sc">$</span>Survival</span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dynamic prediction</span></span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual prediction plots</span></span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "plot_function"</span></span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a><span class="co">#' Title Dynamic prediction plot for individual</span></span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param id_num individual id number in the list</span></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param tmin the start time</span></span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param tmax the end time</span></span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param jmfit the joint model objects</span></span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ... </span></span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return a list of lme and surv predicts</span></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a>dpplot <span class="ot">&lt;-</span> <span class="cf">function</span>(id_num,</span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tmin =</span> <span class="dv">0</span>,</span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tmax =</span> <span class="dv">12</span>,</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a>                   <span class="at">jmfit =</span> jmbayes2.fit116.d,</span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>                   ...){</span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a>  <span class="co"># browser()</span></span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>  nid0 <span class="ot">&lt;-</span> swan_amh02[swan_amh02<span class="sc">$</span>id <span class="sc">==</span> ids[id_num], ]</span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>  nid <span class="ot">&lt;-</span> nid0</span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>  nid <span class="ot">&lt;-</span> nid[nid<span class="sc">$</span>time <span class="sc">&lt;</span> tmin, ]</span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a>  nid<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>  nid<span class="sc">$</span>etime <span class="ot">&lt;-</span> tmin</span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>  Lpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmfit, </span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> nid,</span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a>                   <span class="at">times =</span> <span class="fu">seq</span>(tmin, tmax, <span class="at">length.out =</span> <span class="dv">11</span>),</span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>                    <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>  Spred <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmfit, </span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata =</span> nid,</span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>                 <span class="at">times =</span> <span class="fu">seq</span>(tmin, tmax, <span class="at">length.out =</span> <span class="dv">11</span>),</span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a>                 <span class="at">process =</span> <span class="st">"event"</span>,</span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a>                 <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(Lpred, Spred, <span class="at">ylab_long =</span> <span class="fu">paste0</span>(<span class="st">"ID_"</span>, id_num, <span class="st">"  log(amh)"</span>))</span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Lpred =</span> Lpred,</span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a>              <span class="at">Spred =</span> Spred,</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>              <span class="at">nid0 =</span> nid0,</span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a>              <span class="at">nid =</span> nid))</span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a>Some of the very steep trajectory for the risk function: <span class="in">`id5`</span>, <span class="in">`id26`</span>, <span class="in">`id56`</span>, <span class="in">`id333`</span>, <span class="in">`id342`</span>;</span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "high_risk"</span></span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The dynamic prediction for high risk individuals"</span></span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id5_t4"</span></span>
<span id="cb25-226"><a href="#cb25-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id5_t8"</span></span>
<span id="cb25-227"><a href="#cb25-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id26_t4"</span></span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id26_t8"</span></span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id333_t4"</span></span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id333_t8"</span></span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(swan_amh02<span class="sc">$</span>id)</span>
<span id="cb25-233"><a href="#cb25-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-234"><a href="#cb25-234" aria-hidden="true" tabindex="-1"></a>dpplot_id5 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">5</span>,</span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb25-238"><a href="#cb25-238" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116.d))</span>
<span id="cb25-239"><a href="#cb25-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a>dpplot_id26 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">26</span>,</span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb25-243"><a href="#cb25-243" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb25-244"><a href="#cb25-244" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116.d))</span>
<span id="cb25-245"><a href="#cb25-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-246"><a href="#cb25-246" aria-hidden="true" tabindex="-1"></a>dpplot_id333 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>),</span>
<span id="cb25-247"><a href="#cb25-247" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">333</span>,</span>
<span id="cb25-248"><a href="#cb25-248" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x,</span>
<span id="cb25-249"><a href="#cb25-249" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>,</span>
<span id="cb25-250"><a href="#cb25-250" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116.d))</span>
<span id="cb25-251"><a href="#cb25-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-252"><a href="#cb25-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-253"><a href="#cb25-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-254"><a href="#cb25-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-255"><a href="#cb25-255" aria-hidden="true" tabindex="-1"></a>Some of the smooth trajectory for the risk function: <span class="in">`id32`</span>, <span class="in">`id57`</span>, <span class="in">`id89`</span>, <span class="in">`id222`</span>,<span class="in">`id44`</span>, <span class="in">`id371`</span>;</span>
<span id="cb25-256"><a href="#cb25-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-259"><a href="#cb25-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-260"><a href="#cb25-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "low_risk"</span></span>
<span id="cb25-261"><a href="#cb25-261" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The dynamic prediction for low risk individuals"</span></span>
<span id="cb25-262"><a href="#cb25-262" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb25-263"><a href="#cb25-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb25-264"><a href="#cb25-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id32_t4"</span></span>
<span id="cb25-265"><a href="#cb25-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id32_t8"</span></span>
<span id="cb25-266"><a href="#cb25-266" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id371_t4"</span></span>
<span id="cb25-267"><a href="#cb25-267" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id371_t8"</span></span>
<span id="cb25-268"><a href="#cb25-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id44_t4"</span></span>
<span id="cb25-269"><a href="#cb25-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id44_t8"</span></span>
<span id="cb25-270"><a href="#cb25-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-271"><a href="#cb25-271" aria-hidden="true" tabindex="-1"></a>dpplot_id32 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb25-272"><a href="#cb25-272" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">57</span>,</span>
<span id="cb25-273"><a href="#cb25-273" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb25-274"><a href="#cb25-274" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb25-275"><a href="#cb25-275" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116.d))</span>
<span id="cb25-276"><a href="#cb25-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-277"><a href="#cb25-277" aria-hidden="true" tabindex="-1"></a>dpplot_id371 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb25-278"><a href="#cb25-278" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">371</span>,</span>
<span id="cb25-279"><a href="#cb25-279" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb25-280"><a href="#cb25-280" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb25-281"><a href="#cb25-281" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116.d))</span>
<span id="cb25-282"><a href="#cb25-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-283"><a href="#cb25-283" aria-hidden="true" tabindex="-1"></a>dpplot_id44 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>),</span>
<span id="cb25-284"><a href="#cb25-284" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">44</span>,</span>
<span id="cb25-285"><a href="#cb25-285" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x,</span>
<span id="cb25-286"><a href="#cb25-286" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>,</span>
<span id="cb25-287"><a href="#cb25-287" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116.d))</span>
<span id="cb25-288"><a href="#cb25-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-289"><a href="#cb25-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-290"><a href="#cb25-290" aria-hidden="true" tabindex="-1"></a><span class="fu">### AUC</span></span>
<span id="cb25-291"><a href="#cb25-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-292"><a href="#cb25-292" aria-hidden="true" tabindex="-1"></a>For <span class="in">`JMbayes2`</span>, the function <span class="in">`tvAUC()`</span> is used to estimate the time-dependent AUC only for all the subjects (there is no function for individual AUC).</span>
<span id="cb25-293"><a href="#cb25-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-296"><a href="#cb25-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-297"><a href="#cb25-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "auc_summary"</span></span>
<span id="cb25-298"><a href="#cb25-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-299"><a href="#cb25-299" aria-hidden="true" tabindex="-1"></a>AUC2  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-300"><a href="#cb25-300" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-301"><a href="#cb25-301" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">2</span>,</span>
<span id="cb25-302"><a href="#cb25-302" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-303"><a href="#cb25-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-304"><a href="#cb25-304" aria-hidden="true" tabindex="-1"></a>AUC4  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-305"><a href="#cb25-305" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-306"><a href="#cb25-306" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">4</span>,</span>
<span id="cb25-307"><a href="#cb25-307" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-308"><a href="#cb25-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-309"><a href="#cb25-309" aria-hidden="true" tabindex="-1"></a>AUC6  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-310"><a href="#cb25-310" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-311"><a href="#cb25-311" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">6</span>,</span>
<span id="cb25-312"><a href="#cb25-312" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-313"><a href="#cb25-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-314"><a href="#cb25-314" aria-hidden="true" tabindex="-1"></a>AUC8  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-315"><a href="#cb25-315" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-316"><a href="#cb25-316" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">8</span>,</span>
<span id="cb25-317"><a href="#cb25-317" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-318"><a href="#cb25-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-319"><a href="#cb25-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-320"><a href="#cb25-320" aria-hidden="true" tabindex="-1"></a>Here is the table for the AUC result, using the same joint model for the dynamic prediction. Each AUC for a different time point and time window as 2.</span>
<span id="cb25-321"><a href="#cb25-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-322"><a href="#cb25-322" aria-hidden="true" tabindex="-1"></a>The AUC score are calculated for the time points 2, 4, 6, and 8. It seems the best AUC score is at time 4, and the AUC score decreases as the time window increases. Based on the plots for individuals, some of the plot are missing, because there is no longitudinal data before the <span class="in">`Tstart`</span>.</span>
<span id="cb25-323"><a href="#cb25-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-324"><a href="#cb25-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb25-325"><a href="#cb25-325" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "auc_result"</span></span>
<span id="cb25-326"><a href="#cb25-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-327"><a href="#cb25-327" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">Tstart =</span> <span class="fu">map</span>(<span class="fu">list</span>(AUC2, AUC4, AUC6, AUC8),</span>
<span id="cb25-328"><a href="#cb25-328" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Tstart"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(),</span>
<span id="cb25-329"><a href="#cb25-329" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tend =</span> <span class="fu">map</span>(<span class="fu">list</span>(AUC2, AUC4, AUC6, AUC8), </span>
<span id="cb25-330"><a href="#cb25-330" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Thoriz"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb25-331"><a href="#cb25-331" aria-hidden="true" tabindex="-1"></a>      <span class="at">AUC =</span> <span class="fu">map</span>(<span class="fu">list</span>(AUC2, AUC4, AUC6, AUC8), </span>
<span id="cb25-332"><a href="#cb25-332" aria-hidden="true" tabindex="-1"></a>                <span class="st">"auc"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-333"><a href="#cb25-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb25-334"><a href="#cb25-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-335"><a href="#cb25-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-336"><a href="#cb25-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### ROC</span></span>
<span id="cb25-337"><a href="#cb25-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-338"><a href="#cb25-338" aria-hidden="true" tabindex="-1"></a>ROC can be calculated based on both individual or all subjects. Here are the results for the ROC for all subject predictions.</span>
<span id="cb25-339"><a href="#cb25-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-340"><a href="#cb25-340" aria-hidden="true" tabindex="-1"></a>The ROC results is consistent with the AUC results, the best ROC is at time 4, and the ROC score decreases as the <span class="in">`Tstart`</span> increases.</span>
<span id="cb25-341"><a href="#cb25-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-344"><a href="#cb25-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-345"><a href="#cb25-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "roc_summary"</span></span>
<span id="cb25-346"><a href="#cb25-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-347"><a href="#cb25-347" aria-hidden="true" tabindex="-1"></a>ROC2 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-348"><a href="#cb25-348" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-349"><a href="#cb25-349" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">2</span>,</span>
<span id="cb25-350"><a href="#cb25-350" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-351"><a href="#cb25-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-352"><a href="#cb25-352" aria-hidden="true" tabindex="-1"></a>ROC4 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-353"><a href="#cb25-353" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-354"><a href="#cb25-354" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">4</span>,</span>
<span id="cb25-355"><a href="#cb25-355" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-356"><a href="#cb25-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-357"><a href="#cb25-357" aria-hidden="true" tabindex="-1"></a>ROC6 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-358"><a href="#cb25-358" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-359"><a href="#cb25-359" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">6</span>,</span>
<span id="cb25-360"><a href="#cb25-360" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-361"><a href="#cb25-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-362"><a href="#cb25-362" aria-hidden="true" tabindex="-1"></a>ROC8 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116.d,</span>
<span id="cb25-363"><a href="#cb25-363" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb25-364"><a href="#cb25-364" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">8</span>,</span>
<span id="cb25-365"><a href="#cb25-365" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-366"><a href="#cb25-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-367"><a href="#cb25-367" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC2, <span class="at">ylab =</span> <span class="st">"Tstart_2 Sensitivity"</span>)</span>
<span id="cb25-368"><a href="#cb25-368" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC4, <span class="at">ylab =</span> <span class="st">"Tstart_4 Sensitivity"</span>)</span>
<span id="cb25-369"><a href="#cb25-369" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC6, <span class="at">ylab =</span> <span class="st">"Tstart_6 Sensitivity"</span>)</span>
<span id="cb25-370"><a href="#cb25-370" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC8, <span class="at">ylab =</span> <span class="st">"Tstart_8 Sensitivity"</span>, <span class="at">optimal_cutoff =</span> <span class="st">"Youden"</span>)</span>
<span id="cb25-371"><a href="#cb25-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-372"><a href="#cb25-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-373"><a href="#cb25-373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brier Score</span></span>
<span id="cb25-374"><a href="#cb25-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-375"><a href="#cb25-375" aria-hidden="true" tabindex="-1"></a>The Brier score is also working for a whole dataset but not for individual subjects. Here is the Brier score for the time points 2 and 8, with 2 as the prediction window.</span>
<span id="cb25-376"><a href="#cb25-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-377"><a href="#cb25-377" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb25-378"><a href="#cb25-378" aria-hidden="true" tabindex="-1"></a><span class="in">a data.frame that contains the longitudinal and covariate information for</span></span>
<span id="cb25-379"><a href="#cb25-379" aria-hidden="true" tabindex="-1"></a><span class="in">the subjects for which prediction of survival probabilities is required.</span></span>
<span id="cb25-380"><a href="#cb25-380" aria-hidden="true" tabindex="-1"></a><span class="in">The names of the variables in this data.frame must be the same as </span></span>
<span id="cb25-381"><a href="#cb25-381" aria-hidden="true" tabindex="-1"></a><span class="in">in the data.frames that were used to fit the linear mixed effects and </span></span>
<span id="cb25-382"><a href="#cb25-382" aria-hidden="true" tabindex="-1"></a><span class="in">the event process model that were supplied as the two first argument of jm.</span></span>
<span id="cb25-383"><a href="#cb25-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-384"><a href="#cb25-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-385"><a href="#cb25-385" aria-hidden="true" tabindex="-1"></a>*Warning: there are fewer than 5 subjects with an event in the interval \[4.000001, 12).*</span>
<span id="cb25-386"><a href="#cb25-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-387"><a href="#cb25-387" aria-hidden="true" tabindex="-1"></a>The Brier score (BS) is calculated using the following formula:</span>
<span id="cb25-388"><a href="#cb25-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-389"><a href="#cb25-389" aria-hidden="true" tabindex="-1"></a>$BrierScore = (f_t - o_t)^2$</span>
<span id="cb25-390"><a href="#cb25-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-391"><a href="#cb25-391" aria-hidden="true" tabindex="-1"></a>$f_t$ represents the percentage response from the clinician, $o_t$ represents the outcome of the patient (<span class="in">`0 = did not occur`</span>, <span class="in">`1 = did occur`</span>).</span>
<span id="cb25-392"><a href="#cb25-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-393"><a href="#cb25-393" aria-hidden="true" tabindex="-1"></a>The Brier score takes in to account the outcome of the event predicted as well as the estimate.</span>
<span id="cb25-394"><a href="#cb25-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-395"><a href="#cb25-395" aria-hidden="true" tabindex="-1"></a>Brier scores range between $0$ and $1$: - A score of 0 represents perfect accuracy - A score of 1 represents perfect inaccuracy.</span>
<span id="cb25-396"><a href="#cb25-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-397"><a href="#cb25-397" aria-hidden="true" tabindex="-1"></a>If a participant predicted a 70% probability of dying within 72 hours, and the patient did in fact die within that timescale, then they would have a Brier score of $(0.70-1)^2 = 0.09$. In this example, the outcome event occurred (coded as 1), and is deducted from the percentage probability; the result is then squared. The low Brier score indicates that this prediction was relatively accurate.</span>
<span id="cb25-398"><a href="#cb25-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-399"><a href="#cb25-399" aria-hidden="true" tabindex="-1"></a>If, in contrast, the participant predicted an 80% probability of dying within 72 hours, and the patient did not in fact die within that timeframe, then they would have scored $(0.80-0)^2 = 0.64$. In this case the outcome event did not occur (coded as 0), and is deducted from the percentage probability; the result is squared. The high Brier score indicates that this prediction was relatively inaccurate.</span>
<span id="cb25-400"><a href="#cb25-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-401"><a href="#cb25-401" aria-hidden="true" tabindex="-1"></a>Finally, if the participant had predicted a 50% probability of dying within 72 hours then regardless of whether or not the patient died, the Brier score would be $(0.50-0)^2 = 0.25$ or $(0.50-1)^2 = 0.25$. In each case a Brier score of 0.25 indicates a random guess.</span>
<span id="cb25-402"><a href="#cb25-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-403"><a href="#cb25-403" aria-hidden="true" tabindex="-1"></a>The **integrated Brier score** for a time interval is the average of the score values for the interval, which is the area under a curve that plots the score against the follow-up time divided by the length of the time interval.</span>
<span id="cb25-404"><a href="#cb25-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-407"><a href="#cb25-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-408"><a href="#cb25-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "bs_summary"</span></span>
<span id="cb25-409"><a href="#cb25-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-410"><a href="#cb25-410" aria-hidden="true" tabindex="-1"></a>BS2 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116.d,</span>
<span id="cb25-411"><a href="#cb25-411" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb25-412"><a href="#cb25-412" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">2</span>,</span>
<span id="cb25-413"><a href="#cb25-413" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-414"><a href="#cb25-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-415"><a href="#cb25-415" aria-hidden="true" tabindex="-1"></a>BS4 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116.d,</span>
<span id="cb25-416"><a href="#cb25-416" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb25-417"><a href="#cb25-417" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">4</span>,</span>
<span id="cb25-418"><a href="#cb25-418" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-419"><a href="#cb25-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-420"><a href="#cb25-420" aria-hidden="true" tabindex="-1"></a>BS6 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116.d,</span>
<span id="cb25-421"><a href="#cb25-421" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb25-422"><a href="#cb25-422" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">6</span>,</span>
<span id="cb25-423"><a href="#cb25-423" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-424"><a href="#cb25-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-425"><a href="#cb25-425" aria-hidden="true" tabindex="-1"></a>BS8 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116.d,</span>
<span id="cb25-426"><a href="#cb25-426" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb25-427"><a href="#cb25-427" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">8</span>,</span>
<span id="cb25-428"><a href="#cb25-428" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb25-429"><a href="#cb25-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-430"><a href="#cb25-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-431"><a href="#cb25-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-432"><a href="#cb25-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-433"><a href="#cb25-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb25-434"><a href="#cb25-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "bs_result"</span></span>
<span id="cb25-435"><a href="#cb25-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-436"><a href="#cb25-436" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">Tstart =</span> <span class="fu">map</span>(<span class="fu">list</span>(BS2, BS4, BS6, BS8),</span>
<span id="cb25-437"><a href="#cb25-437" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Tstart"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb25-438"><a href="#cb25-438" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tend =</span> <span class="fu">map</span>(<span class="fu">list</span>(BS2, BS4, BS6, BS8), </span>
<span id="cb25-439"><a href="#cb25-439" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Thoriz"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb25-440"><a href="#cb25-440" aria-hidden="true" tabindex="-1"></a>      <span class="at">BS =</span> <span class="fu">map</span>(<span class="fu">list</span>(BS2, BS4, BS6, BS8), </span>
<span id="cb25-441"><a href="#cb25-441" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Brier"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb25-442"><a href="#cb25-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb25-443"><a href="#cb25-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>