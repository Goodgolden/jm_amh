[
  {
    "objectID": "06_jm_model_selection.html#goal-for-this-chapter",
    "href": "06_jm_model_selection.html#goal-for-this-chapter",
    "title": "\n6  JM Model Selection\n",
    "section": "\n6.1 Goal for this chapter",
    "text": "6.1 Goal for this chapter\n\nMerging site and ethnicity variables\nSaving into new datasets swan_amh00 and swan_amh11\nModel selection with the joint models with JMbayes2 package\nModel comparison similar to the earlier results, suggesting removing bc_pills"
  },
  {
    "objectID": "06_jm_model_selection.html#merge-site-and-ethnicity-variables",
    "href": "06_jm_model_selection.html#merge-site-and-ethnicity-variables",
    "title": "\n6  JM Model Selection\n",
    "section": "\n6.2 Merge site and ethnicity variables",
    "text": "6.2 Merge site and ethnicity variables\nChanging the Site:Ethnicity into a 14-level factor variable.\n\nCodeswan_amh00 &lt;- swan_amh0 %&gt;%\n  mutate(site = case_when(site == 11 ~ \"M\",\n                          site == 12 ~ \"B\",\n                          site == 13 ~ \"C\",\n                          site == 14 ~ \"UCD\",\n                          site == 15 ~ \"UCLA\",\n                          site == 16 ~ \"NJ\",\n                          site == 17 ~ \"P\")) %&gt;%\n  tidyr::unite(\"site_ethnic\", \"site\",\n               \"ethnic\", sep = \"_\",\n               remove = TRUE) %&gt;%\n  mutate(site_ethinic = factor(site_ethnic))\n\n\nswan_amh11 &lt;- swan_amh1 %&gt;%\n  # mutate(site = case_when(site == 11 ~ \"M\",\n  #                         site == 12 ~ \"B\",\n  #                         site == 13 ~ \"C\",\n  #                         site == 14 ~ \"UCD\",\n  #                         site == 15 ~ \"UCLA\",\n  #                         site == 16 ~ \"NJ\",\n  #                         site == 17 ~ \"P\")) %&gt;%\n  tidyr::unite(\"site_ethnic\", \"site\", \n               \"ethnic\", sep = \"_\", \n               remove = TRUE) %&gt;%\n  mutate(site_ethinic = factor(site_ethnic))\n\ntable(swan_amh11$site_ethnic)\n\n#&gt; \n#&gt;    B_BLACK    B_CAUCA    C_BLACK    C_CAUCA    M_BLACK    M_CAUCA   NJ_CAUCA \n#&gt;         39         57         41         35         64         39          9 \n#&gt;   NJ_HISPA    P_BLACK    P_CAUCA  UCD_CAUCA  UCD_CHINE UCLA_CAUCA UCLA_JAPAN \n#&gt;         18         26         48         40         62         37         85"
  },
  {
    "objectID": "06_jm_model_selection.html#model-selection",
    "href": "06_jm_model_selection.html#model-selection",
    "title": "\n6  JM Model Selection\n",
    "section": "\n6.3 Model Selection",
    "text": "6.3 Model Selection\n\nCodecontrol = lmeControl(opt = \"optim\")\nlme.fit1 &lt;- lme(lamh ~ time,\n                data = swan_amh00,\n                control = control,\n                random = ~ time| id)\n\nlme.fit2 &lt;- lme(lamh ~ time + I(time^2),\n                data = swan_amh00,\n                control = control,\n                random = ~ time| id)\n\nlme.fit3 &lt;- lme(lamh ~ time + I(time^2),\n                data = swan_amh00,\n                control = control,\n                random = ~ time + I(time^2) | id)\n\n### Need to keep site + ethnic + smoke + bmi\n## testing for physical activity (taking out phys.act)\nsurv.fit11 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + children + bmi +\n                      factor(site_ethnic) + factor(smoke) +\n                      factor(edu) + factor(alcohol) + \n                      factor(employed) + factor(health),\n                    data = swan_amh11, \n                    x = TRUE, \n                    model = TRUE)\n\n## testing for employed\nsurv.fit12 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + children + bmi +\n                      factor(site_ethnic) + factor(smoke) +\n                      factor(edu) + factor(alcohol) + factor(health),\n                    data = swan_amh11, x = TRUE, model = TRUE)\n\n## testing for children\nsurv.fit13 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site_ethnic) + factor(smoke) +\n                      factor(edu) + factor(alcohol) + factor(health),\n                    data = swan_amh11, x = TRUE, model = TRUE)\n\n\n## testing for edu (education)\nsurv.fit14 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site_ethnic) + factor(smoke) +\n                      factor(alcohol) + factor(health),\n                    data = swan_amh11, \n                    x = TRUE,\n                    model = TRUE)\n\n\n## testing for alcohol\nsurv.fit15 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site_ethnic) + factor(smoke) +\n                      factor(health),\n                    data = swan_amh11, \n                    x = TRUE,\n                    model = TRUE)\n\n\n## testing for health\nsurv.fit16 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site_ethnic) + factor(smoke),\n                    data = swan_amh11, \n                    x = TRUE,\n                    model = TRUE)\n\n\n## testing for bc_pills\nsurv.fit17 &lt;- coxph(Surv(etime, event) ~ married + bmi +\n                      factor(site_ethnic) + factor(smoke),\n                    data = swan_amh11, \n                    x = TRUE, \n                    model = TRUE)"
  },
  {
    "objectID": "06_jm_model_selection.html#using-jmbayes-to-fit-the-models",
    "href": "06_jm_model_selection.html#using-jmbayes-to-fit-the-models",
    "title": "\n6  JM Model Selection\n",
    "section": "\n6.4 Using JMbayes to fit the models",
    "text": "6.4 Using JMbayes to fit the models\nModel selection suggested \\(surv.fit17 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\) OR \\(surv.fit15 \\sim coxph(Surv(etime, event) \\sim married + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodejmcontrol &lt;- list(n.iter = 5000,\n                  n.burnin = 1000, \n                  seed = 55555)\njmbayes.fit111 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit11,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          # time_var = \"time\",\n                                          seed = 55555)\njmbayes.fit112 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit12,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          seed = 55555)\njmbayes.fit113 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit13,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          seed = 55555)\njmbayes.fit114 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit14,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          seed = 55555)\njmbayes.fit115 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit15,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          seed = 55555)\njmbayes.fit116 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit16,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          seed = 55555)\njmbayes.fit117 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit17,\n                                          timeVar = \"time\",\n                                          control = jmcontrol,\n                                          seed = 55555)\n\n\n\nCodeanova(jmbayes.fit111, \n      jmbayes.fit112,\n      jmbayes.fit113, \n      jmbayes.fit114,\n      jmbayes.fit115,\n      jmbayes.fit116,\n      jmbayes.fit117)"
  },
  {
    "objectID": "07_auc_roc.html#goal-of-the-analysis",
    "href": "07_auc_roc.html#goal-of-the-analysis",
    "title": "\n7  AUC and ROC\n",
    "section": "\n7.1 Goal of the analysis",
    "text": "7.1 Goal of the analysis\n\nCreating dummy variables for the factor variables\nSaving the datasets as swan_amh11 and swan_amh12\nFit the joint model with JMbayes2 based on model selection results\nDynamic prediction for the joint model with plots\nCalculate the AUC and ROC for the joint model"
  },
  {
    "objectID": "07_auc_roc.html#fit-the-joint-model",
    "href": "07_auc_roc.html#fit-the-joint-model",
    "title": "\n7  AUC and ROC\n",
    "section": "\n7.2 Fit the joint model",
    "text": "7.2 Fit the joint model\nHere is the joint model with JMbayes2, the name of the model is set up as package + [fit] + lme_number + surv_number\n\\(lme.fit1 \\sim (fixed = lamh \\sim time, \\ random = \\sim time| id)\\)\n\\(surv.fit16 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\nThe predict.jm() function cannot take the factor variables, so we need to convert them to numeric variables.\nSo here is the dummy variables for the factor variables site_ethnic and smoke. It is weird, just like including the interaction terms without the main effects for the site and ethnicity; talk with EJC to see whether we change the main factor effects back.\n\nCodeswan_amh12 &lt;- swan_amh11 %&gt;%\n  cbind(model.matrix(~ 0 + site_ethnic + smoke, \n                                    data = .)) %&gt;%\n  janitor::clean_names() %&gt;% \n  dplyr::select(order(colnames(.)))\n\nswan_amh02 &lt;- swan_amh00 %&gt;%\n  mutate(smoke = case_when(smoke == 1 ~ \"Past Only\",\n                           smoke == 2 ~ \"Current Smoker\",\n                           smoke == 3 ~ \"Never Smoked\"),\n         smoke = factor(smoke, levels = c(\"Never Smoked\" , \"Past Only\", \"Current Smoker\"))) %&gt;%\n  cbind(model.matrix(~ 0 + site_ethnic + smoke, \n                                    data = .)) %&gt;%\n  janitor::clean_names() %&gt;% \n  dplyr::select(order(colnames(.)))\n\nnames(swan_amh12)\n\n#&gt;  [1] \"age\"                    \"age0\"                   \"alcohol\"               \n#&gt;  [4] \"amh\"                    \"bc_pills\"               \"bmi\"                   \n#&gt;  [7] \"bmi_cat\"                \"children\"               \"edu\"                   \n#&gt; [10] \"employed\"               \"etime\"                  \"event\"                 \n#&gt; [13] \"fmp_age\"                \"health\"                 \"id\"                    \n#&gt; [16] \"lamh\"                   \"married\"                \"parity\"                \n#&gt; [19] \"phys_act\"               \"site_ethnic\"            \"site_ethnic_b_black\"   \n#&gt; [22] \"site_ethnic_b_cauca\"    \"site_ethnic_c_black\"    \"site_ethnic_c_cauca\"   \n#&gt; [25] \"site_ethnic_m_black\"    \"site_ethnic_m_cauca\"    \"site_ethnic_nj_cauca\"  \n#&gt; [28] \"site_ethnic_nj_hispa\"   \"site_ethnic_p_black\"    \"site_ethnic_p_cauca\"   \n#&gt; [31] \"site_ethnic_ucd_cauca\"  \"site_ethnic_ucd_chine\"  \"site_ethnic_ucla_cauca\"\n#&gt; [34] \"site_ethnic_ucla_japan\" \"smoke\"                  \"smoke_current_smoker\"  \n#&gt; [37] \"smoke_past_only\"        \"start_time\"             \"time\"                  \n#&gt; [40] \"train\"                  \"visit\"\n\nCode# names(swan_amh02)\n# \"site_ethnic_b_black\"    \"site_ethnic_b_cauca\"\n# \"site_ethnic_c_black\"    \"site_ethnic_c_cauca\"    \"site_ethnic_m_black\"\n# \"site_ethnic_m_cauca\"    \"site_ethnic_nj_cauca\"   \"site_ethnic_nj_hispa\"\n# \"site_ethnic_p_black\"    \"site_ethnic_p_cauca\"    \"site_ethnic_ucd_cauca\"\n# \"site_ethnic_ucd_chine\"  \"site_ethnic_ucla_cauca\" \"site_ethnic_ucla_japan\"\n# \"smoke_past_only\"        \"smoke_current_smoker\"\n\n\n\nCodecontrol = lmeControl(opt = \"optim\")\nlme.fit1 &lt;- lme(lamh ~ time,\n                data = swan_amh00,\n                control = control,\n                random = ~ time| id)\n\n## testing for health\n## site_ethnic_b_cauca as the reference group \nsurv.fit16 &lt;- coxph(Surv(etime, event) ~ 0 + married + bc_pills + bmi +\n                      site_ethnic_b_black + # site_ethnic_b_cauca + \n                      site_ethnic_c_black + site_ethnic_c_cauca + \n                      site_ethnic_m_black + site_ethnic_m_cauca +\n                      site_ethnic_nj_cauca + site_ethnic_nj_hispa +\n                      site_ethnic_p_black + site_ethnic_p_cauca + \n                      site_ethnic_ucd_cauca + site_ethnic_ucd_chine +\n                      site_ethnic_ucla_cauca + site_ethnic_ucla_japan +\n                      smoke_past_only + smoke_current_smoker,\n                    data = swan_amh12, \n                    x = TRUE,\n                    model = TRUE)\n\njmcontrol &lt;- list(n_iter = 5000, \n                  n_burnin = 1000, \n                  n_chains = 1,\n                  seed = 55555,\n                  cores = 1)\n\njmbayes2.fit116 &lt;- JMbayes2::jm(Surv_object = surv.fit16,\n                               Mixed_objects = lme.fit1, \n                               time_var = \"time\",\n                               control = jmcontrol) \n\n\n\n7.2.1 Summary for the jmbayes.fit116\n\nFor the lme model:\n\nCodesummary(jmbayes2.fit116)$Outcome1 \n\n\n\n  \n\n\nCode#             Mean        StDev       2.5%        97.5%.      P\n# (Intercept)   7.9174517     0.1088784   7.6937029   8.1155217   0\n# time        -0.5961157    0.0129068     -0.6186083    -0.5691261  0\n# sigma       1.3059261   0.0186472   1.2692610   1.3428203     0\n\n\nFor the surv model:\n\nCodesummary(jmbayes2.fit116)$Survival\n\n\n\n  \n\n\n\n\n7.2.2 Traceplots\nLonger chains and more number of chains are better for convergence in real analysis\n\nCodeJMbayes2::traceplot(jmbayes2.fit116)"
  },
  {
    "objectID": "07_auc_roc.html#dynamic-prediction",
    "href": "07_auc_roc.html#dynamic-prediction",
    "title": "\n7  AUC and ROC\n",
    "section": "\n7.3 Dynamic prediction",
    "text": "7.3 Dynamic prediction\nIndividualized predictions of survival probabilities are computed by function predict(), this is different from JMbayes and JM.\n\n7.3.1 Individual dynamic prediction with plot\nHere are some exploratory plots for the dynamic prediction for the joint model.\nThe left part of the plot is the longitudinal outcome, and the right part is the cumulative risk function. With the decrease of the longitudinal outcome log(amh), the cumulative risk function increases, the probability of event increases too.\nThe hazard function is the derivative of the cumulative risk function, the steepness (slope) of the cumulative risk function is the hazard function.\n\nCode#' Title Dynamic prediction plot for individual\n#'\n#' @param id_num individual id number in the list\n#' @param tmin the start time\n#' @param tmax the end time\n#' @param jmfit the joint model objects\n#' @param ... \n#'\n#' @return a list of lme and surv predicts\n\ndpplot &lt;- function(id_num,\n                   tmin = 0,\n                   tmax = 12,\n                   jmfit = jmbayes2.fit116,\n                   ...){\n\n  # browser()\n  nid0 &lt;- swan_amh02[swan_amh02$id == ids[id_num], ]\n  \n  nid &lt;- nid0\n  nid &lt;- nid[nid$time &lt; tmin, ]\n  nid$event &lt;- 0\n  nid$etime &lt;- tmin\n  \n  Lpred &lt;- predict(jmfit, \n                    newdata = nid,\n                   times = seq(tmin, tmax, length.out = 11),\n                    return_newdata = TRUE)\n  Spred &lt;- predict(jmfit, \n                 newdata = nid,\n                 times = seq(tmin, tmax, length.out = 11),\n                 process = \"event\",\n                 return_newdata = TRUE)\n  \n  # tAUC &lt;- try(JMbayes2::tvAUC(jmfit, \n  #                         nid0, \n  #                         Tstart = tmin,\n  #                         Dt = 10))\n  # \n  # tROC &lt;- try(JMbayes2::tvROC(jmfit, \n  #                         nid0, \n  #                         Tstart = tmin,\n  #                         Dt = 10))\n  # \n  # brier &lt;- try(JMbayes2::tvBrier(jmfit, \n  #                            nid0, \n  #                            Tstart = tmin,\n  #                            Dt = 10))\n  \n  plot(Lpred, Spred, ylab_long = paste0(\"ID_\", id_num, \"  log(amh)\"))\n  \n  return(list(Lpred = Lpred,\n              Spred = Spred,\n              nid0 = nid0,\n              nid = nid))\n}\n\n\nSome of the very steep trajectory for the risk function: id5, id26, id56, id333, id342;\n\nCodedpplot_id5 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 5,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116))\n\ndpplot_id26 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 26,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116))\n\ndpplot_id333 &lt;- map(c(4, 8),\n               ~dpplot(id_num = 333,\n                       tmin = .x,\n                       tmax = 12,\n                       jmfit = jmbayes2.fit116))\n\n# plot(Lpred1)\n# \n# plot(Lpred2)\n# \n# # prediction for the event outcome\n# plot(Spred)\n\n# combined into one plot, \n# the first longitudinal outcome and cumulative risk\n# the first two longitudinal outcomes\n\n\n\n\n\nid5_t4\n\n\n\n\n\nid5_t8\n\n\n\n\n\n\n\nid26_t4\n\n\n\n\n\nid26_t8\n\n\n\n\n\n\n\nid333_t4\n\n\n\n\n\nid333_t8\n\n\n\n\n\nThe dynamic prediction for high risk individuals\n\n\n\n\nSome of the smooth trajectory for the risk function: id32, id57, id89, id222,id44, id371;\n\nCodedpplot_id32 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 57,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116))\n\ndpplot_id371 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 371,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116))\n\ndpplot_id44 &lt;- map(c(4, 8),\n               ~dpplot(id_num = 44,\n                       tmin = .x,\n                       tmax = 12,\n                       jmfit = jmbayes2.fit116))\n\n\n\n\n\nid32_t4\n\n\n\n\n\nid32_t8\n\n\n\n\n\n\n\nid371_t4\n\n\n\n\n\nid371_t8\n\n\n\n\n\n\n\nid44_t4\n\n\n\n\n\nid44_t8\n\n\n\n\n\nThe dynamic prediction for low risk individuals\n\n\n\n\n\n7.3.2 Predictive accuracy measures\nThe materials are directly from Dimitris Rizopoulos & Grigorios Papageorg (details seen JMwithR notes 6.3)\n\nDiscrimination: sensitivity, specificity, ROC and AUC\nCalibration: comparison between predicted and observed probabilities\nOverall: combination of discrimination and calibration\n\nSidenotes: we do not have right censor (possessively considering the left censor)\nTo estimate the sensitivity, specificity and the AUC, we need to account for censoring. Two main approaches:\n\n\nmodel-based weights\n\nAdvantage: it allows censoring to depend on the longitudinal history (in any possible manner)\nDisadvantage: it requires that the model is well calibrated\n\n\n\ninverse probability of censoring weighting (IPCW) (using Kaplan-Meier or other non-parametric estimators)\n\nAdvantage: it provides unbiased estimates even when the model is misspecified\nDisadvantage: it requires that the model for the weights is correct\nin settings where joint models are used, challenging because censoring may depend on the longitudinal outcomes in a complex manner\n\n\n\n7.3.3 AUC\nFor JMbayes2, the function tvAUC() is used to estimate the time-dependent AUC only for all the subjects (there is no function for individual AUC).\n\nCodeAUC2  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 2,\n                          Dt = 2))\n\nAUC4  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 4,\n                          Dt = 2))\n\nAUC6  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 6,\n                          Dt = 2))\n\nAUC8  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 8,\n                          Dt = 2))\n\n\nHere is the table for the AUC result, using the same joint model for the dynamic prediction. Each AUC for a different time point and time window as 2.\nThe AUC score are calculated for the time points 2, 4, 6, and 8. It seems the best AUC score is at time 4, and the AUC score decreases as the time window increases. Based on the plots for individuals, some of the plot are missing, because there is no longitudinal data before the Tstart.\n\nCodecbind(Tstart = map(list(AUC2, AUC4, AUC6, AUC8), \"Tstart\") %&gt;% unlist(),\n      Tend = map(list(AUC2, AUC4, AUC6, AUC8), \"Thoriz\") %&gt;% unlist() %&gt;% round(0),\n      AUC = map(list(AUC2, AUC4, AUC6, AUC8), \"auc\") %&gt;% unlist()) %&gt;% \n  as.data.frame()\n\n#&gt;   Tstart Tend       AUC\n#&gt; 1      2    4 0.6650327\n#&gt; 2      4    6 0.9262739\n#&gt; 3      6    8 0.8246470\n#&gt; 4      8   10 0.8096253\n\n\n\n7.3.4 ROC\nROC can be calculated based on both individual or all subjects. Here are the results for the ROC for all subject predictions.\nThe ROC results is consistent with the AUC results, the best ROC is at time 4, and the ROC score decreases as the Tstart increases.\n\nCodeROC2 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 2,\n                          Dt = 2))\n\nROC4 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 4,\n                          Dt = 2))\n\nROC6 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 6,\n                          Dt = 2))\n\nROC8 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116,\n                          swan_amh02,\n                          Tstart = 8,\n                          Dt = 2))\n\nplot(ROC2, ylab = \"Tstart_2 Sensitivity\")\n\n\n\nCodeplot(ROC4, ylab = \"Tstart_4 Sensitivity\")\n\n\n\nCodeplot(ROC6, ylab = \"Tstart_6 Sensitivity\")\n\n\n\nCodeplot(ROC8, ylab = \"Tstart_8 Sensitivity\")"
  },
  {
    "objectID": "05_review.html#paper-dynamic-predictions-and-prospective-accuracy-in-joint-models-for-longitudinal-and-time-to-event-data",
    "href": "05_review.html#paper-dynamic-predictions-and-prospective-accuracy-in-joint-models-for-longitudinal-and-time-to-event-data",
    "title": "9  Paper Review",
    "section": "9.1 Paper: Dynamic Predictions and Prospective Accuracy in Joint Models for Longitudinal and Time-to-Event Data",
    "text": "9.1 Paper: Dynamic Predictions and Prospective Accuracy in Joint Models for Longitudinal and Time-to-Event Data\nAuthors: Dimitris Rizopoulos Journal: Biometrics 67, 819–829, September 2011\nFramework: Explores the joint modeling of longitudinal and time-to-event data, focuses on assessing the predictive power of longitudinal markers for future event occurrences.\nMotivating Example: Used real data on HIV infected patients’ CD4 cell count measurements.\nIdea in new approach: In this paper, the authors have pursued a dual objective: firstly, to describe the methodology for estimating survival probabilities while considering the endogenous nature of longitudinal markers, and secondly, to evaluate the predictive accuracy of these markers in joint models. To estimate conditional survival probabilities, the authors introduced two estimators: one directly based on empirical Bayes estimates and maximum likelihood estimates, and another using a Monte Carlo approach. For assessing predictive accuracy, the estimates of sensitivity and specificity measures are derived under the joint modeling framework. Time-dependent ROC curves and AUCs are used to illustrate how the accuracy of the longitudinal marker changes over time. A discrimination index is proposed which offers a weighted average of AUCs to summarize information over the entire follow-up period.\nEstimation: Focuses on estimating the effect of unobserved longitudinal covariates on the risk of an event. The survival model is defined using a relative risk model, and the reconstruction of the longitudinal history depends on a linear mixed-effects model to describe the subject-specific longitudinal evolutions. A maximum likelihood approach is used to estimate the joint models’ parameters. The log-likelihood function is maximized using standard numerical integration techniques such as Monte Carlo and Gaussian quadrature because of the computational difficulty of the log-likelihood function.\nThe expected survival probabilities for new subjects are conditioned on survival up to a specific time point. An asymptotic Bayesian formulation is introduced to derive the posterior expectation of these conditional survival probabilities which considers the variability of both maximum likelihood and empirical Bayes estimates. A Monte Carlo simulation method is proposed to estimate the conditional survival probabilities. The estimated survival probabilities are then used to calculate standard errors and confidence intervals. This method offers an accurate approach for estimating conditional survival probabilities while properly addressing the endogenous nature of the longitudinal measurements.\nAn ROC (Receiver Operating Characteristic) approach is introduced to assess the predictive ability of longitudinal biomarkers. Longitudinal marker values are used to create prediction rules to differentiate between high and low-risk patients. The choice of these rules is flexible and evaluated within the joint modeling framework. Sensitivity and specificity are calculated based on the defined prediction rules. ROC curves, area under the ROC curve (AUC), and dynamic AUC are used as metrics to assess the overall discrimination power of the longitudinal markers. A Monte Carlo simulation approach is used to estimate sensitivity and its standard error. Estimations of sensitivity and specificity are then used to construct ROC curves and to calculate AUC. This approach provides a robust method to assess the predictive performance of longitudinal biomarkers in dynamic studies.\nResults: The AIDS dataset (focusing on the CD4 cell count measurements of patients) is used to estimate expected survival probabilities and evaluate the ability to distinguish between patients at high and low risk of death.\nA joint model is fitted to incorporate both survival and longitudinal sub models. The regression coefficients are estimated using R (JM package). The analysis has estimated survival probabilities and confidence intervals for these probabilities for individual patients which showed how CD4 cell count changes affect survival estimates.\nThe ability of CD4 cell count to discriminate between patients using ROC curves is also explored and it is found that CD4 cell count has moderate discrimination power and there are minimal differences between the different time windows.\nDiscussions: Model misspecification could affect accuracy estimates, but the joint models tend to be robust against certain types of misspecifications. Further flexibility in model components, like the baseline risk function and error distribution, could enhance robustness. Models can be overfitted due to complexity of the models. Bootstrap approaches can be used to correct the overfitting. While the paper has focused on discrimination primarily, the authors acknowledged the importance of calibration in joint models."
  },
  {
    "objectID": "05_review.html#paper-the-r-package-jmbayes-for-fitting-joint-models-for-longitudinal-and-time-to-event-data-using-mcmc",
    "href": "05_review.html#paper-the-r-package-jmbayes-for-fitting-joint-models-for-longitudinal-and-time-to-event-data-using-mcmc",
    "title": "9  Paper Review",
    "section": "9.2 Paper: The R Package JMbayes for Fitting Joint Models for Longitudinal and Time-to-Event Data Using MCMC",
    "text": "9.2 Paper: The R Package JMbayes for Fitting Joint Models for Longitudinal and Time-to-Event Data Using MCMC\nAuthors: Dimitris Rizopoulos Journal: Journal of Statistical Software, August 2016, Volume 72, Issue 7\nFramework: The paper introduces the R package JMbayes for fitting joint models for longitudinal and time-to-event data under a Bayesian approach using Markov chain Monte Carlo algorithms.\nIdea in new approach: The paper introduces several features that distinguish JMbayes from other software implementations for joint models. The package can handle different types of longitudinal outcomes, such as continuous, categorical, or censored, and provides various options for modeling the association between the longitudinal and survival processes. The package also offers tools for deriving and validating dynamic predictions for both outcomes. The paper discusses how to use JMbayes to derive individualized predictions for both the longitudinal and the event time outcomes and discusses about the techniques to combine predictions from different models using Bayesian model averaging.\nEstimation: The paper presents the formulation of joint models, which consists of a generalized linear mixed effects model for the longitudinal outcome and a relative risk model for the time-to-event outcome. The baseline hazard function is approximated by B-splines, and the association between the two outcomes is calculated by a function of the subject-specific linear predictor of the longitudinal model. The paper also describes the prior distributions and the posterior distribution of the model parameters, and the numerical integration methods for the survival function. The paper discusses two methods for calculating dynamic predictions: the Bayesian method, which uses the posterior distribution of the parameters and the random effects, and the Monte Carlo simulation method, which uses the joint model to simulate future trajectories and event times.\nDesign and Implementation: The paper explains the design and implementation of the package JMbayes, which is similar to the package JM for fitting joint models under maximum likelihood. The main function of the package is jointModelBayes(), which accepts as arguments a linear mixed effects object and a Cox model object. The function uses an MCMC algorithm to sample from the posterior distribution of the parameters and the random effects and provides several tools to check convergence and summarize the results. The function also allows for specifying different types of longitudinal outcomes, association structures, and baseline hazard functions. The paper also compares the speed and flexibility of JMbayes with other software implementations of joint models. The paper introduces a web interface that allows users to obtain dynamic predictions for new or existing patients, based on the joint model and the available data. The paper provides tools to assess the predictive performance of models in terms of discrimination and calibration, using measures such as the time-dependent AUC and expected prediction error. The paper also shows how to perform validation using cross-validation technique.\nMotivating Example: The paper illustrates the use of JMbayes with the PBC data, a dataset on patients with primary biliary cirrhosis, a chronic liver disease. The paper shows how to fit different types of joint models for the longitudinal serum bilirubin level and the time to transplantation or death, and how to compare and validate the fitted models. The results suggest that serum bilirubin is strongly associated with the risk of the event and that the joint models provide better predictions than the separate models for the longitudinal and survival outcomes.\nFuture Directions: The paper discusses some of the current limitations and challenges of JMbayes and some possible directions for future development. For example, the paper mentions the need for more efficient MCMC algorithms, the possibility of incorporating other types of longitudinal outcomes and the extension of joint models to handle multiple longitudinal outcomes and recurrent events."
  },
  {
    "objectID": "01_table1.html#goal-for-this-chapter",
    "href": "01_table1.html#goal-for-this-chapter",
    "title": "\n1  Table1\n",
    "section": "\n1.1 Goal for this chapter",
    "text": "1.1 Goal for this chapter\n\nLoading and Checking the data (has been cleaned by EJC removing all the id with NA)\nData Cleaning (further cleaning, save into package internal sysdata.rda)\nWriting the data description, and save it in the R folder\nEntire data cleaning process is saved in the data-raw folder\nBuilding Table1 (Specifically looking at the site variable)\nStyling Table1 (using gtsummary package)\nSaving Table1 (as a .tex file)"
  },
  {
    "objectID": "01_table1.html#data-cleaning",
    "href": "01_table1.html#data-cleaning",
    "title": "\n1  Table1\n",
    "section": "\n1.2 Data Cleaning",
    "text": "1.2 Data Cleaning\nThe data cleaning process codes are saved in the data-raw folder swan_amh.R file. The data cleaning process is done in the for both numeric swan_amh0 and categorical swan_amh1 data files. The data description is saved in the R folder as 00_data files.\nThe cleaned data .rda is saved in the data folder as a part of the package which do not need to extra loading, if installed as a package. The extra copy of .csv files are saved in the data-raw folder for the reference.\n\nCodeload(here(\"data\", \"swan_amh1.rda\"))\n\n\nHere is the final clean dataset swan_amh1 with 600 individuals and 16 variables.\n\nCodeswan_amh1"
  },
  {
    "objectID": "01_table1.html#building-table1",
    "href": "01_table1.html#building-table1",
    "title": "\n1  Table1\n",
    "section": "\n1.3 Building Table1",
    "text": "1.3 Building Table1\n\nCodetable1 &lt;- swan_amh1 %&gt;%\n  ungroup() %&gt;%\n  mutate(children = as.numeric(children),\n         parity = case_when(parity == 0 ~ \"None\",\n                            parity == 1 ~ \"One\",\n                            parity == 2 ~ \"Two\",\n                            parity == 3 ~ \"Three\",\n                            parity == 4 ~ \"More than three\"),\n         parity = factor(parity, levels = c(\"None\", \"One\",\n                                               \"Two\", \"Three\",\n                                               \"More than three\"))) %&gt;%\n  dplyr::select(age, ethnic, married,\n                alcohol, smoke, bc_pills,\n                bmi, health, phys_act, amh,\n                parity, children, \n                employed, edu, site)  %&gt;%\n  tbl_summary(by = site,\n              missing = \"ifany\",\n              label = list(c(\"age\") ~ \"Age (years)\",\n                           c(\"ethnic\") ~ \"Ethnicity / Race\",\n                           c(\"married\") ~ \"Marital Status\",\n                           c(\"alcohol\") ~ \"Alcohol Use\",\n                           c(\"smoke\") ~ \"Smoking History\",\n                           c(\"bc_pills\") ~ \"Ever use of BC Pills\",\n                           c(\"bmi\") ~ \"BMI\",\n                           c(\"health\") ~ \"Overall Health\",\n                           c(\"phys_act\") ~ \"Physical Activity Score\",\n                           c(\"amh\") ~ \"AMH\",\n                           c(\"parity\") ~ \"Parity\",\n                           c(\"children\") ~ \"Children\",\n                           c(\"employed\") ~ \"Employment Status\",\n                           c(\"edu\") ~ \"Educational Attainment\"),\n              type = list(all_continuous() ~ \"continuous2\",\n                          c(\"children\") ~ \"continuous2\"),\n              statistic = list(all_continuous() ~ c(\"{mean} ({sd})\",\n                                                    \"{median}\",\n                                                    \"[{min}, {max}]\"),\n                               all_categorical() ~ \"{n} / {N} ({p}%)\")) %&gt;%\n  modify_header(label = \"**Characteristics**\") %&gt;%\n  # update the column header\n  bold_labels() %&gt;%\n  # add_overall() %&gt;%\n  italicize_labels()\n\n\nCurrent Table1 is created, grouped by the site variable.\nNeed to be changed and updated with future requirements.\n\nCodeset_flextable_defaults(font.size = 8, \n                       # text.align = \"left\",\n                       theme_fun = theme_zebra,\n                       padding = 2)\ntable1 %&gt;% \n  as_flex_table() %&gt;%\n  fontsize(i = 1, size = 8, part = \"header\")\n\n\n\n\n\nDescriptive Statistics for SWAN AMH Data\n\nCharacteristics\nB, N = 961\nC, N = 761\nM, N = 1031\nNJ, N = 271\nP, N = 741\nUCD, N = 1021\nUCLA, N = 1221\n\n\n\nAge (years)\n\n\n\n\n\n\n\n\n\nMean (SD)\n46.75 (2.44)\n46.42 (2.31)\n46.33 (2.55)\n46.22 (2.26)\n46.20 (2.13)\n46.50 (2.55)\n46.34 (2.42)\n\n\nMedian\n47.00\n46.00\n46.00\n46.00\n46.00\n46.00\n46.00\n\n\n[Range]\n[42.00, 52.00]\n[43.00, 53.00]\n[42.00, 53.00]\n[43.00, 52.00]\n[43.00, 51.00]\n[43.00, 53.00]\n[43.00, 53.00]\n\n\nEthnicity / Race\n\n\n\n\n\n\n\n\n\nCAUCA\n57 / 96 (59%)\n35 / 76 (46%)\n39 / 103 (38%)\n9 / 27 (33%)\n48 / 74 (65%)\n40 / 102 (39%)\n37 / 122 (30%)\n\n\nBLACK\n39 / 96 (41%)\n41 / 76 (54%)\n64 / 103 (62%)\n0 / 27 (0%)\n26 / 74 (35%)\n0 / 102 (0%)\n0 / 122 (0%)\n\n\nCHINE\n0 / 96 (0%)\n0 / 76 (0%)\n0 / 103 (0%)\n0 / 27 (0%)\n0 / 74 (0%)\n62 / 102 (61%)\n0 / 122 (0%)\n\n\nHISPA\n0 / 96 (0%)\n0 / 76 (0%)\n0 / 103 (0%)\n18 / 27 (67%)\n0 / 74 (0%)\n0 / 102 (0%)\n0 / 122 (0%)\n\n\nJAPAN\n0 / 96 (0%)\n0 / 76 (0%)\n0 / 103 (0%)\n0 / 27 (0%)\n0 / 74 (0%)\n0 / 102 (0%)\n85 / 122 (70%)\n\n\nMarital Status\n\n\n\n\n\n\n\n\n\nNot Married/Partnered\n38 / 96 (40%)\n24 / 76 (32%)\n46 / 103 (45%)\n8 / 27 (30%)\n29 / 74 (39%)\n20 / 102 (20%)\n26 / 122 (21%)\n\n\nMarried/Partnered\n58 / 96 (60%)\n52 / 76 (68%)\n57 / 103 (55%)\n19 / 27 (70%)\n45 / 74 (61%)\n82 / 102 (80%)\n96 / 122 (79%)\n\n\nAlcohol Use\n\n\n\n\n\n\n\n\n\nNone\n33 / 96 (34%)\n33 / 76 (43%)\n67 / 103 (65%)\n9 / 27 (33%)\n36 / 74 (49%)\n67 / 102 (66%)\n63 / 122 (52%)\n\n\n&lt;1/wk\n10 / 96 (10%)\n10 / 76 (13%)\n7 / 103 (6.8%)\n7 / 27 (26%)\n12 / 74 (16%)\n6 / 102 (5.9%)\n19 / 122 (16%)\n\n\n1-7/wk\n38 / 96 (40%)\n23 / 76 (30%)\n23 / 103 (22%)\n10 / 27 (37%)\n23 / 74 (31%)\n14 / 102 (14%)\n30 / 122 (25%)\n\n\n&gt;7/wk\n15 / 96 (16%)\n10 / 76 (13%)\n6 / 103 (5.8%)\n1 / 27 (3.7%)\n3 / 74 (4.1%)\n15 / 102 (15%)\n10 / 122 (8.2%)\n\n\nSmoking History\n\n\n\n\n\n\n\n\n\nNever Smoked\n52 / 96 (54%)\n50 / 76 (66%)\n60 / 103 (58%)\n18 / 27 (67%)\n34 / 74 (46%)\n78 / 102 (76%)\n81 / 122 (66%)\n\n\nPast Only\n37 / 96 (39%)\n15 / 76 (20%)\n19 / 103 (18%)\n4 / 27 (15%)\n24 / 74 (32%)\n20 / 102 (20%)\n30 / 122 (25%)\n\n\nCurrent Smoker\n7 / 96 (7.3%)\n11 / 76 (14%)\n24 / 103 (23%)\n5 / 27 (19%)\n16 / 74 (22%)\n4 / 102 (3.9%)\n11 / 122 (9.0%)\n\n\nEver use of BC Pills\n\n\n\n\n\n\n\n\n\nNever\n26 / 96 (27%)\n11 / 76 (14%)\n22 / 103 (21%)\n8 / 27 (30%)\n18 / 74 (24%)\n28 / 102 (27%)\n42 / 122 (34%)\n\n\nEver use BC pills\n70 / 96 (73%)\n65 / 76 (86%)\n81 / 103 (79%)\n19 / 27 (70%)\n56 / 74 (76%)\n74 / 102 (73%)\n80 / 122 (66%)\n\n\nBMI\n\n\n\n\n\n\n\n\n\nMean (SD)\n28 (7)\n30 (6)\n32 (9)\n29 (9)\n29 (8)\n24 (6)\n24 (5)\n\n\nMedian\n26\n28\n31\n28\n28\n23\n23\n\n\n[Range]\n[20, 50]\n[19, 50]\n[16, 56]\n[18, 56]\n[16, 50]\n[18, 54]\n[17, 42]\n\n\nOverall Health\n\n\n\n\n\n\n\n\n\nExcellent\n33 / 96 (34%)\n17 / 76 (22%)\n14 / 103 (14%)\n4 / 27 (15%)\n13 / 74 (18%)\n26 / 102 (25%)\n40 / 122 (33%)\n\n\nVery Good\n38 / 96 (40%)\n29 / 76 (38%)\n34 / 103 (33%)\n12 / 27 (44%)\n36 / 74 (49%)\n39 / 102 (38%)\n45 / 122 (37%)\n\n\nGood\n16 / 96 (17%)\n23 / 76 (30%)\n39 / 103 (38%)\n6 / 27 (22%)\n20 / 74 (27%)\n23 / 102 (23%)\n24 / 122 (20%)\n\n\nFair/Poor\n9 / 96 (9.4%)\n7 / 76 (9.2%)\n16 / 103 (16%)\n5 / 27 (19%)\n5 / 74 (6.8%)\n14 / 102 (14%)\n13 / 122 (11%)\n\n\nPhysical Activity Score\n\n\n\n\n\n\n\n\n\nMean (SD)\n8.04 (1.78)\n7.88 (1.57)\n7.35 (1.76)\n7.40 (1.79)\n7.88 (1.94)\n7.48 (1.72)\n7.99 (1.75)\n\n\nMedian\n7.95\n7.75\n7.25\n7.15\n7.70\n7.43\n7.70\n\n\n[Range]\n[3.40, 12.20]\n[4.75, 11.85]\n[4.60, 12.45]\n[3.40, 11.10]\n[4.00, 12.05]\n[4.15, 11.85]\n[4.70, 12.80]\n\n\nAMH\n\n\n\n\n\n\n\n\n\nMean (SD)\n570 (658)\n548 (700)\n472 (665)\n522 (622)\n420 (502)\n446 (661)\n724 (875)\n\n\nMedian\n326\n277\n230\n321\n216\n177\n412\n\n\n[Range]\n[1, 3,652]\n[1, 3,124]\n[1, 3,270]\n[1, 2,470]\n[1, 2,128]\n[1, 3,249]\n[1, 4,652]\n\n\nParity\n\n\n\n\n\n\n\n\n\nNone\n26 / 96 (27%)\n8 / 76 (11%)\n12 / 103 (12%)\n5 / 27 (19%)\n13 / 74 (18%)\n21 / 102 (21%)\n26 / 122 (21%)\n\n\nOne\n22 / 96 (23%)\n6 / 76 (7.9%)\n12 / 103 (12%)\n4 / 27 (15%)\n14 / 74 (19%)\n14 / 102 (14%)\n16 / 122 (13%)\n\n\nTwo\n27 / 96 (28%)\n27 / 76 (36%)\n30 / 103 (29%)\n9 / 27 (33%)\n25 / 74 (34%)\n44 / 102 (43%)\n48 / 122 (39%)\n\n\nThree\n13 / 96 (14%)\n17 / 76 (22%)\n24 / 103 (23%)\n4 / 27 (15%)\n15 / 74 (20%)\n19 / 102 (19%)\n24 / 122 (20%)\n\n\nMore than three\n8 / 96 (8.3%)\n18 / 76 (24%)\n25 / 103 (24%)\n5 / 27 (19%)\n7 / 74 (9.5%)\n4 / 102 (3.9%)\n8 / 122 (6.6%)\n\n\nChildren\n\n\n\n\n\n\n\n\n\nMean (SD)\n1.55 (1.30)\n2.54 (1.68)\n2.48 (1.54)\n2.22 (1.78)\n1.85 (1.21)\n1.73 (1.14)\n1.79 (1.22)\n\n\nMedian\n1.50\n2.00\n2.00\n2.00\n2.00\n2.00\n2.00\n\n\n[Range]\n[0.00, 5.00]\n[0.00, 12.00]\n[0.00, 9.00]\n[0.00, 7.00]\n[0.00, 4.00]\n[0.00, 5.00]\n[0.00, 5.00]\n\n\nEmployment Status\n\n\n\n\n\n\n\n\n\nUnemployed\n13 / 96 (14%)\n10 / 76 (13%)\n27 / 103 (26%)\n6 / 27 (22%)\n10 / 74 (14%)\n7 / 102 (6.9%)\n31 / 122 (25%)\n\n\nEmployed\n83 / 96 (86%)\n66 / 76 (87%)\n76 / 103 (74%)\n21 / 27 (78%)\n64 / 74 (86%)\n95 / 102 (93%)\n91 / 122 (75%)\n\n\nEducational Attainment\n\n\n\n\n\n\n\n\n\nHigh School or Less\n13 / 96 (14%)\n9 / 76 (12%)\n28 / 103 (27%)\n15 / 27 (56%)\n17 / 74 (23%)\n27 / 102 (26%)\n16 / 122 (13%)\n\n\nSome College\n28 / 96 (29%)\n21 / 76 (28%)\n46 / 103 (45%)\n6 / 27 (22%)\n29 / 74 (39%)\n14 / 102 (14%)\n46 / 122 (38%)\n\n\nCollege degree or higher\n55 / 96 (57%)\n46 / 76 (61%)\n29 / 103 (28%)\n6 / 27 (22%)\n28 / 74 (38%)\n61 / 102 (60%)\n60 / 122 (49%)\n\n\n1n / N (%)"
  },
  {
    "objectID": "01_table1.html#saving-table1",
    "href": "01_table1.html#saving-table1",
    "title": "\n1  Table1\n",
    "section": "\n1.4 Saving Table1",
    "text": "1.4 Saving Table1\n\nCodelibrary(xtable)\nxtable(as.data.frame(table1), type = \"latex\",\n      file = paste0(\"figure/swan_amh_01_table1_\", Sys.Date(), \".tex\"))"
  },
  {
    "objectID": "01_table1.html#notes",
    "href": "01_table1.html#notes",
    "title": "\n1  Table1\n",
    "section": "\n1.5 Notes",
    "text": "1.5 Notes\nThe only problem is the location Sites with the Ethnicity groups.\nMissing values are removed from 631 to 600 through data cleaning process.\nSee data-raw/swan_amh.R for the data cleaning process line-375 removed 31 individuals 31/631 = 4.9%."
  },
  {
    "objectID": "04_jmbayes.html#goal-for-this-chapter",
    "href": "04_jmbayes.html#goal-for-this-chapter",
    "title": "\n4  JMBayes\n",
    "section": "\n4.1 Goal for this chapter",
    "text": "4.1 Goal for this chapter\n\nFitting the models with JMbayes package\nJMbayes does not support nested random effects design\nModel comparison for the linear mixed models, and survival model with rate\nDynamic predictions for the survival outcomes (does not work with the individual data)\nJMbayes cannot calculate the Brier Score"
  },
  {
    "objectID": "04_jmbayes.html#setting-up-for-linear-mixed-model",
    "href": "04_jmbayes.html#setting-up-for-linear-mixed-model",
    "title": "\n4  JMBayes\n",
    "section": "\n4.2 Setting up for linear mixed model",
    "text": "4.2 Setting up for linear mixed model\nBecause we are gonna use the JMbayes package and include the slope terms for the joint model, we need to fit the linear mixed model with the non-linear terms terms: including both the fixed and random terms.\nThe survival sub-models are directly from early work in R/03_model_selection.qmd. The survival sub-models used either factorized or stratified variables.\n\nCodeload(\"data/swan_amh0.rda\")\nload(\"data/swan_amh1.rda\")\n\n\n\ncontrol = lmeControl(opt = \"optim\")\nlme.fit1 &lt;- lme(lamh ~ time,\n                data = swan_amh0,\n                control = control,\n                random = ~ time| id)\n\nlme.fit2 &lt;- lme(lamh ~ time + I(time^2),\n                data = swan_amh0,\n                control = control,\n                random = ~ time| id)\n\nlme.fit3 &lt;- lme(lamh ~ time + I(time^2),\n                data = swan_amh0,\n                control = control,\n                random = ~ time + I(time^2) | id)\n\nsurv.fit1 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke),\n                    data = swan_amh1,\n                    x = TRUE,\n                    model = TRUE)\n\nsurv.fit2 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                     strata(site) + strata(ethnic) + strata(smoke),\n                   data = swan_amh1,\n                   x = TRUE,\n                   model = TRUE)"
  },
  {
    "objectID": "04_jmbayes.html#using-jmbayesjointmodel",
    "href": "04_jmbayes.html#using-jmbayesjointmodel",
    "title": "\n4  JMBayes\n",
    "section": "\n4.3 Using JMBayes::jointModel()\n",
    "text": "4.3 Using JMBayes::jointModel()\n\nJMbayes is more flexible (in some respects):\n\ndirectly implements the MCMC\nallows for categorical longitudinal data as well\nallows for general transformation functions\npenalized B-splines for the baseline hazard function\n\nBoth package give options to define the aforementioned association structures\n\nin JM via arguments parameterization & derivForm\nin JMbayes via arguments param & extraForm\n\nHow did we name the models, package used + .fit + lmm model number + surv model number + extensions"
  },
  {
    "objectID": "04_jmbayes.html#jmbayes1-models",
    "href": "04_jmbayes.html#jmbayes1-models",
    "title": "\n4  JMBayes\n",
    "section": "\n4.4 JMbayes1 models",
    "text": "4.4 JMbayes1 models\nThe parameters in JMbayes and JMbayes2 are different, The dform also need to be chanaged accordingly.\nJMbayes::jointModelBayes(lmeObject, \n                         survObject, \n                         timeVar,  \n                         param = c(\"td-value\", \"td-extra\", \n                                   \"td-both\", \"shared-betasRE\",\n                                   \"shared-RE\"), \n                         extraForm = NULL,\n                         baseHaz = c(\"P-splines\", \"regression-splines\"),\n                         ...)\n\nJMbayes2::jm(Surv_object,\n             Mixed_objects,\n             time_var, \n             recurrent = FALSE,\n             functional_forms = NULL, \n             data_Surv = NULL, \n             id_var = NULL, \n             control = NULL,\n             ...)\n\nCodejmbayes.fit11 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit1,\n                                          timeVar = \"time\",\n                                          # time_var = \"time\",\n                                          seed = 55555)\njmbayes.fit12 &lt;- JMbayes::jointModelBayes(lme.fit1,\n                                          surv.fit2,\n                                          timeVar = \"time\",\n                                          seed = 55555)\njmbayes.fit31 &lt;- JMbayes::jointModelBayes(lme.fit3,\n                                          surv.fit1,\n                                          timeVar = \"time\",\n                                          seed = 55555)\n\njm1.dform3 &lt;- list(fixed = ~ 0 + dns(time, 2),\n              ## the 2nd and 3rd fixed effects of mi(t) used\n              indFixed = 2:3,\n              random = ~ 0 + dns(time, 2),\n              ## the second and third random effect of mi(t)\n              indRandom = 2:3)\n\njmbayes.fit31.d &lt;- update(jmbayes.fit31,\n                         param = \"td-both\",\n                         extraForm = jm1.dform3,\n                         seed = 55555,\n                         n.iter = 35000)"
  },
  {
    "objectID": "04_jmbayes.html#summary-of-the-models",
    "href": "04_jmbayes.html#summary-of-the-models",
    "title": "\n4  JMBayes\n",
    "section": "\n4.5 Summary of the models",
    "text": "4.5 Summary of the models\n\n4.5.1 jmbayes.fit11\n\\(lme.fit1 \\sim (fixed = lamh \\sim time, \\ random = \\sim time| id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jmbayes.fit11)\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit1, survObject = surv.fit1, \n#&gt;     timeVar = \"time\", seed = 55555)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of subjects: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with penalized-spline-approximated \n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent value \n#&gt; \n#&gt;  LPML      DIC       pD\n#&gt;  -Inf 17823.75 1326.662\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr\n#&gt; (Intercept)  1.7539  (Intr)\n#&gt; time         0.6806 -0.2079\n#&gt; Residual     1.2987        \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err Std.Dev    2.5%   97.5%      P\n#&gt; (Intercept)  7.8910  0.0081  0.0981  7.7072  8.0852 &lt;0.001\n#&gt; time        -0.6334  0.0009  0.0295 -0.6905 -0.5751 &lt;0.001\n#&gt; \n#&gt; Event Process\n#&gt;                               Value Std.Err Std.Dev    2.5%   97.5%      P\n#&gt; marriedMarried/Partnered     0.1238  0.0110  0.1227 -0.1087  0.3678  0.318\n#&gt; bc_pillsEver use BC pills   -0.0410  0.0133  0.1412 -0.3243  0.2282  0.781\n#&gt; bmi                         -0.0350  0.0010  0.0078 -0.0516 -0.0205 &lt;0.001\n#&gt; factor(site)C                0.1837  0.0187  0.2128 -0.2418  0.6079  0.379\n#&gt; factor(site)M                0.3097  0.0199  0.2062 -0.1229  0.6951  0.157\n#&gt; factor(site)NJ               0.5245  0.0529  0.5369 -0.5228  1.5449  0.324\n#&gt; factor(site)P                0.4799  0.0208  0.2272  0.0451  0.9387  0.027\n#&gt; factor(site)UCD              0.1726  0.0203  0.2454 -0.3383  0.6187  0.474\n#&gt; factor(site)UCLA             0.5117  0.0278  0.2866 -0.0701  1.0699  0.081\n#&gt; factor(ethnic)BLACK         -0.2400  0.0116  0.1487 -0.5338  0.0623  0.112\n#&gt; factor(ethnic)CHINE         -0.0335  0.0244  0.2788 -0.5485  0.5568  0.886\n#&gt; factor(ethnic)HISPA         -0.2989  0.0731  0.6988 -1.6001  1.0534  0.670\n#&gt; factor(ethnic)JAPAN         -0.1291  0.0231  0.2620 -0.6075  0.3688  0.621\n#&gt; factor(smoke)Past Only       0.0317  0.0164  0.1616 -0.2952  0.3457  0.852\n#&gt; factor(smoke)Current Smoker  0.2369  0.0196  0.1935 -0.1427  0.6204  0.192\n#&gt; Assoct                      -0.6268  0.0021  0.0497 -0.7240 -0.5278 &lt;0.001\n#&gt; tauBs                        4.8146  1.7435  6.0547  0.7956 22.9612     NA\n#&gt; \n#&gt; MCMC summary:\n#&gt; iterations: 20000 \n#&gt; adapt: 3000 \n#&gt; burn-in: 3000 \n#&gt; thinning: 10 \n#&gt; time: 1.6 min\n\n\n\n4.5.2 jmbayes.fit21\n\\(lme.fit2 \\sim (fixed = lamh \\sim time + I(time^2), \\ random = \\sim time| id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jmbayes.fit12)\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit1, survObject = surv.fit2, \n#&gt;     timeVar = \"time\", seed = 55555)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of subjects: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with penalized-spline-approximated \n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent value \n#&gt; \n#&gt;  LPML     DIC       pD\n#&gt;  -Inf 17861.1 1329.203\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr\n#&gt; (Intercept)  1.7724  (Intr)\n#&gt; time         0.6820 -0.2154\n#&gt; Residual     1.2975        \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err Std.Dev    2.5%   97.5%      P\n#&gt; (Intercept)  7.9053  0.0091  0.1029  7.7142  8.1058 &lt;0.001\n#&gt; time        -0.6353  0.0011  0.0296 -0.6930 -0.5779 &lt;0.001\n#&gt; \n#&gt; Event Process\n#&gt;                             Value Std.Err Std.Dev    2.5%    97.5%      P\n#&gt; marriedMarried/Partnered   0.1584  0.0108  0.1305 -0.1015   0.4009  0.246\n#&gt; bc_pillsEver use BC pills -0.0260  0.0078  0.1258 -0.2709   0.2263  0.824\n#&gt; bmi                       -0.0404  0.0014  0.0087 -0.0584  -0.0246 &lt;0.001\n#&gt; Assoct                    -0.6269  0.0021  0.0495 -0.7254  -0.5307 &lt;0.001\n#&gt; tauBs                     35.4798  8.8402 45.3903  5.3019 165.7564     NA\n#&gt; \n#&gt; MCMC summary:\n#&gt; iterations: 20000 \n#&gt; adapt: 3000 \n#&gt; burn-in: 3000 \n#&gt; thinning: 10 \n#&gt; time: 1.6 min\n\n\n\n4.5.3 jmbayes.fit31\n\\(lme.fit3 \\sim (fixed = lamh \\sim time + I(time^2), \\ random = \\sim time + I(time^2) | id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jmbayes.fit31)\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit3, survObject = surv.fit1, \n#&gt;     timeVar = \"time\", seed = 55555)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of subjects: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with penalized-spline-approximated \n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent value \n#&gt; \n#&gt;  LPML          DIC           pD\n#&gt;  -Inf 2.500633e+46 1.250317e+46\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr        \n#&gt; (Intercept)  2.6988  (Intr)    time\n#&gt; time         1.6955 -0.5082        \n#&gt; I(time^2)    9.7013  0.0168  0.1373\n#&gt; Residual     1.3745                \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err Std.Dev    2.5%  97.5%      P\n#&gt; (Intercept)  6.3006  0.0098  0.1243  6.0628 6.5500 &lt;0.001\n#&gt; time         0.1093  0.0067  0.0873 -0.0516 0.2915  0.197\n#&gt; I(time^2)   -0.0891  0.0085  0.3974 -0.8420 0.6889  0.795\n#&gt; \n#&gt; Event Process\n#&gt;                               Value Std.Err Std.Dev    2.5%   97.5%      P\n#&gt; marriedMarried/Partnered     0.2543  0.0241  0.2431 -0.2502  0.7396  0.247\n#&gt; bc_pillsEver use BC pills   -0.1457  0.0244  0.2497 -0.6583  0.3538  0.496\n#&gt; bmi                          0.0040  0.0037  0.0209 -0.0377  0.0460  0.842\n#&gt; factor(site)C                0.2822  0.0420  0.4165 -0.5213  1.2297  0.444\n#&gt; factor(site)M                0.4022  0.0442  0.4228 -0.5628  1.2518  0.250\n#&gt; factor(site)NJ              -0.0470  0.1333  1.0991 -2.3788  2.0264  0.983\n#&gt; factor(site)P                0.5111  0.0516  0.4295 -0.3729  1.2928  0.208\n#&gt; factor(site)UCD              0.3317  0.0619  0.5006 -0.7142  1.3445  0.476\n#&gt; factor(site)UCLA             0.5128  0.0605  0.5311 -0.6173  1.5697  0.280\n#&gt; factor(ethnic)BLACK         -0.1436  0.0290  0.2907 -0.6715  0.5330  0.502\n#&gt; factor(ethnic)CHINE          0.1077  0.0422  0.4536 -0.7567  1.0956  0.816\n#&gt; factor(ethnic)HISPA         -1.1568  0.1954  1.4755 -4.2141  1.6407  0.354\n#&gt; factor(ethnic)JAPAN         -0.1257  0.0516  0.5052 -1.1879  0.8293  0.782\n#&gt; factor(smoke)Past Only       0.0861  0.0325  0.2766 -0.4473  0.6337  0.727\n#&gt; factor(smoke)Current Smoker  0.5389  0.0293  0.3146 -0.0902  1.1649  0.088\n#&gt; Assoct                      -0.1399  0.0042  0.0787 -0.3056 -0.0281 &lt;0.001\n#&gt; tauBs                        0.9066  0.1698  0.5279  0.2784  2.2966     NA\n#&gt; \n#&gt; MCMC summary:\n#&gt; iterations: 20000 \n#&gt; adapt: 3000 \n#&gt; burn-in: 3000 \n#&gt; thinning: 10 \n#&gt; time: 1.7 min\n\n\n\n4.5.4 jmbayes.fit31.d\n\\(lme.fit3 \\sim (fixed = lamh \\sim time + I(time^2), \\ random = \\sim time + I(time^2) | id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jmbayes.fit31.d)\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit3, survObject = surv.fit1, \n#&gt;     timeVar = \"time\", param = \"td-both\", extraForm = jm1.dform3, \n#&gt;     seed = 55555, n.iter = 35000)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of subjects: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with penalized-spline-approximated \n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent value + time-dependent extra term \n#&gt; \n#&gt;  LPML          DIC           pD\n#&gt;  -Inf 3.667135e+38 1.833568e+38\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr        \n#&gt; (Intercept)  3.0513  (Intr)    time\n#&gt; time         1.7750 -0.5610        \n#&gt; I(time^2)    9.6936  0.0203  0.1280\n#&gt; Residual     1.4196                \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err Std.Dev    2.5%  97.5%      P\n#&gt; (Intercept)  6.6989  0.0577  0.2037  6.2092 7.0213 &lt;0.001\n#&gt; time        -0.0152  0.0171  0.0980 -0.1958 0.1941 0.8383\n#&gt; I(time^2)   -0.0763  0.0086  0.3896 -0.8358 0.6999 0.8431\n#&gt; \n#&gt; Event Process\n#&gt;                               Value Std.Err Std.Dev    2.5%   97.5%      P\n#&gt; marriedMarried/Partnered     0.1622  0.0223  0.2418 -0.3557  0.6060 0.4536\n#&gt; bc_pillsEver use BC pills   -0.0882  0.0231  0.2471 -0.6002  0.4376 0.6683\n#&gt; bmi                         -0.0064  0.0027  0.0204 -0.0527  0.0288 0.7800\n#&gt; factor(site)C                0.1884  0.0339  0.4042 -0.7562  0.9011 0.5187\n#&gt; factor(site)M                0.3531  0.0372  0.4180 -0.5114  1.1810 0.3273\n#&gt; factor(site)NJ               0.0610  0.0925  0.9741 -2.1261  1.7333 0.8169\n#&gt; factor(site)P                0.4613  0.0473  0.4438 -0.5033  1.3523 0.2496\n#&gt; factor(site)UCD              0.2257  0.0377  0.4433 -0.6991  1.0430 0.5566\n#&gt; factor(site)UCLA             0.5056  0.0406  0.4893 -0.4411  1.5114 0.2623\n#&gt; factor(ethnic)BLACK         -0.2085  0.0205  0.2663 -0.7656  0.3051 0.3895\n#&gt; factor(ethnic)CHINE          0.1058  0.0396  0.4686 -0.7910  1.0492 0.8198\n#&gt; factor(ethnic)HISPA         -1.3701  0.1275  1.2556 -4.0169  1.1049 0.2496\n#&gt; factor(ethnic)JAPAN         -0.2247  0.0320  0.4602 -1.1602  0.6744 0.5945\n#&gt; factor(smoke)Past Only       0.1279  0.0189  0.2420 -0.4083  0.5625 0.4934\n#&gt; factor(smoke)Current Smoker  0.4670  0.0282  0.3394 -0.3074  1.0426 0.1787\n#&gt; Assoct                      -0.1613  0.0030  0.0724 -0.3225 -0.0578 &lt;0.001\n#&gt; AssoctE                     10.9666  0.4279  4.3556  4.1155 22.8660 0.0019\n#&gt; tauBs                        0.2734  0.0353  0.1407  0.0837  0.6226     NA\n#&gt; \n#&gt; MCMC summary:\n#&gt; iterations: 35000 \n#&gt; adapt: 3000 \n#&gt; burn-in: 3000 \n#&gt; thinning: 17 \n#&gt; time: 3 min"
  },
  {
    "objectID": "04_jmbayes.html#predictions-fails",
    "href": "04_jmbayes.html#predictions-fails",
    "title": "\n4  JMBayes\n",
    "section": "\n4.6 Predictions Fails",
    "text": "4.6 Predictions Fails\nBecause there is no individual who is not in the event group, we cannot predict the survival outcomes.\nThere is also possiblity that all the factorized variables are the problems.\n\nCodeids &lt;- unique(swan_amh0$id)\n## length(ids)\n## Prediction for the survival outcomes\nND &lt;- swan_amh0[swan_amh0$id == ids[12], ] ## 4, 5, 7 (not so good)\n# pbc2[pbc2$id == 2, ]\n\nsfit &lt;- survfitJM(jmbayes.fit11, newdata = ND)\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\nCodesapply(lapply(swan_amh0, unique), length)\n\n#&gt;         id        age       age0    alcohol        amh   bc_pills        bmi \n#&gt;        600         24         11          4       2638          2        599 \n#&gt;    bmi_cat   children        edu   employed     ethnic      etime      event \n#&gt;          3          9          3          2          5        547          1 \n#&gt;    fmp_age     health    married     parity   phys_act       site      smoke \n#&gt;        547          4          2          5        149          7          3 \n#&gt; start_time       time      train      visit       lamh \n#&gt;         11         24          1         12       2638\n\nCodesurvPreds &lt;- vector(\"list\", nrow(ND))\nfor (i in 1:nrow(ND)) {\n    survPreds[[i]] &lt;- try(survfitJM(jmbayes.fit11, newdata = ND[1:i, ]))\n}\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n#&gt;   contrasts can be applied only to factors with 2 or more levels\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n#&gt;   contrasts can be applied only to factors with 2 or more levels\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n#&gt;   contrasts can be applied only to factors with 2 or more levels\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n#&gt;   contrasts can be applied only to factors with 2 or more levels\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n#&gt;   contrasts can be applied only to factors with 2 or more levels\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n#&gt;   contrasts can be applied only to factors with 2 or more levels"
  },
  {
    "objectID": "04_jmbayes.html#auc-and-roc",
    "href": "04_jmbayes.html#auc-and-roc",
    "title": "\n4  JMBayes\n",
    "section": "\n4.7 AUC and ROC",
    "text": "4.7 AUC and ROC\nThe AUC and ROC does not improve with the complexity of the model. So far the simplest linear mixed model has the best AUC and ROC lme.fit1. The joint model for stratified survival model surv.fit2 do not provide reasonable standard errors and confidence intervals.\nThe prediction of the survival outcomes from year 5 to year 8.\n\nCodeJMbayes::aucJM(jmbayes.fit11, \n      swan_amh0, \n      Tstart = 5,\n      Thoriz = 8)\n\n#&gt; \n#&gt;  Time-dependent AUC for the Joint Model jmbayes.fit11\n#&gt; \n#&gt; Estimated AUC: 0.8506\n#&gt; At time: 8\n#&gt; Using information up to time: 5 (407 subjects still at risk)\n\nCoderoc11 &lt;- rocJM(jmbayes.fit11, \n           swan_amh0, \n           Tstart = 5,\n           Thoriz = 8)\nJMbayes::aucJM(jmbayes.fit31, \n      swan_amh0, \n      Tstart = 5,\n      Thoriz = 8)\n\n#&gt; \n#&gt;  Time-dependent AUC for the Joint Model jmbayes.fit31\n#&gt; \n#&gt; Estimated AUC: 0.705\n#&gt; At time: 8\n#&gt; Using information up to time: 5 (407 subjects still at risk)\n\nCoderoc31 &lt;- rocJM(jmbayes.fit31, \n           swan_amh0, \n           Tstart = 5,\n           Thoriz = 8) \naucJM(jmbayes.fit31.d,\n      swan_amh0,\n      Tstart = 5,\n      Thoriz = 8)\n\n#&gt; \n#&gt;  Time-dependent AUC for the Joint Model jmbayes.fit31.d\n#&gt; \n#&gt; Estimated AUC: 0.6847\n#&gt; At time: 8\n#&gt; Using information up to time: 5 (407 subjects still at risk)\n\nCoderoc31.d &lt;- rocJM(jmbayes.fit31.d, \n           swan_amh0, \n           Tstart = 5,\n           Thoriz = 8)\n\n\nSeeming like the model with only linear time term has the best AUC and ROC.\n\nCodeplot(roc11)\nplot(roc31)\nplot(roc31.d)\n\n\n\nROC curve for linear-term model\n\n\n\n\n\nROC curve for quardratic-term model\n\n\n\n\n\nROC curve for quardratic-term and slope model\n\n\nROC curves"
  },
  {
    "objectID": "04_jmbayes.html#brier-score",
    "href": "04_jmbayes.html#brier-score",
    "title": "\n4  JMBayes\n",
    "section": "\n4.8 Brier Score",
    "text": "4.8 Brier Score\nThere is no function to calculate the Brier Score in JMbayes, has to migrate into JMbayes2 package. However there are several functions in both packages interfering with each other, the JMbayes2::tvBrier() will be tested in next chapter R/05_jmbayes2.qmd files.\n\nCodeids &lt;- unique(swan_amh0$id)\n## length(ids)\n## Prediction for the survival outcomes\nND1 &lt;- swan_amh0[swan_amh0$id == ids[5], ] ## 4, 5, 7 (not so good)\nbrier.fit11 &lt;- JMbayes2::tvBrier(jmbayes.fit11, \n                               newdata = ND1, \n                               Tstart = 3, \n                               Dt = 6)\n\n#&gt; Error in JMbayes2::tvBrier(jmbayes.fit11, newdata = ND1, Tstart = 3, Dt = 6): Use only with 'jm' objects.\n\nCodeJMbayes2::tvAUC(jmbayes.fit11, \n      swan_amh0, \n      Tstart = 5,\n      Thoriz = 8)\n\n#&gt; Error in UseMethod(\"tvAUC\"): no applicable method for 'tvAUC' applied to an object of class \"JMbayes\""
  },
  {
    "objectID": "05_jmbayes2.html#goal-for-this-chapter",
    "href": "05_jmbayes2.html#goal-for-this-chapter",
    "title": "\n5  JMbayes2\n",
    "section": "\n5.1 Goal for this chapter",
    "text": "5.1 Goal for this chapter\n\nFitting the models with JMbayes2 package\nRemoving the site from the survival model, might be the issue!!\nNested linear model with id and site failed\nDynamic predictions for the survival outcomes worked\nJM, JMbayes, and JMbayes2 packages does not support factorized covariates\nJMbayes2 for AUC, ROC, calibration plots, and the Brier Score"
  },
  {
    "objectID": "05_jmbayes2.html#no-sites-in-the-survival-model",
    "href": "05_jmbayes2.html#no-sites-in-the-survival-model",
    "title": "\n5  JMbayes2\n",
    "section": "\n5.2 No sites in the survival model",
    "text": "5.2 No sites in the survival model\nHere we are working with survival model without site. I also include the site into the nested design random effect in the longitudinal model lme.fit4.\n\nCodeload(\"data/swan_amh0.rda\")\nload(\"data/swan_amh1.rda\")\n\nswan_amh0 &lt;- swan_amh0 %&gt;% \n  mutate(site = case_when(site == \"11\" ~ \"M\",\n                          site == \"12\" ~ \"B\",\n                          site == \"13\" ~ \"C\",\n                          site == \"14\" ~ \"UCD\",\n                          site == \"15\" ~ \"UCLA\",\n                          site == \"16\" ~ \"NJ\",\n                          site == \"17\" ~ \"P\"))\n\n\n\n5.2.1 lme models and surv models\n\nCodecontrol = lmeControl(opt = \"optim\")\nlme.fit1 &lt;- lme(lamh ~ time,\n                data = swan_amh0,\n                control = control,\n                random = ~ time| id)\n\nlme.fit2 &lt;- lme(lamh ~ time + I(time^2),\n                data = swan_amh0,\n                control = control,\n                random = ~ time| id)\n\nlme.fit3 &lt;- lme(lamh ~ time + I(time^2),\n                data = swan_amh0,\n                control = control,\n                random = ~ time + I(time^2) | id)\n\nlme.fit4 &lt;- lme(lamh ~ time,\n                data = swan_amh0,\n                control = control,\n                random = ~ time| site / id)\n\nsurv.fit1 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + \n                        factor(site) + \n                        bmi + factor(ethnic) + factor(smoke),\n                    data = swan_amh1,\n                    x = TRUE,\n                    model = TRUE)\n\n\nsurv.fit1.nosite &lt;- coxph(Surv(etime, event) ~ married + bc_pills + \n                        # factor(site) + \n                        bmi + factor(ethnic) + factor(smoke),\n                    data = swan_amh1,\n                    x = TRUE,\n                    model = TRUE)\n\nsurv.fit2.nosite &lt;- coxph(Surv(etime, event) ~ married + bc_pills +\n                            # strata(site) + \n                            bmi + strata(ethnic) + strata(smoke),\n                   data = swan_amh1,\n                   x = TRUE,\n                   model = TRUE)\n\n\nHere is the predictive results of joint model from JMbayes2 package. We only remove the site from the survival model.\n\nCodejmcontrol &lt;- list(n_iter = 5000, \n                  n_burnin = 1000, \n                  n_chains = 3,\n                  seed = 55555,\n                  cores = 3)\n\njmbayes2.fit11 &lt;- JMbayes2::jm(Surv_object = surv.fit1,\n                               Mixed_objects = lme.fit1, \n                               time_var = \"time\",\n                               control = jmcontrol) \n\njmbayes2.fit11.nosite &lt;- JMbayes2::jm(Surv_object = surv.fit1.nosite,\n                                      Mixed_objects = lme.fit1, \n                                      time_var = \"time\",\n                                      control = jmcontrol) \n# functional_forms = NULL,\n\n\njmbayes2.fit31.nosite &lt;- JMbayes2::jm(Surv_object = surv.fit1.nosite,\n                                      Mixed_objects = lme.fit3, \n                                      time_var = \"time\",\n                                      control = jmcontrol) \n\n\n\n5.2.2 Joint models summarization\nHere is the summary for the joint models\n\\(lme.fit1 \\sim (fixed = lamh \\sim time, \\ random = \\sim time| id)\\)\n\\(surv.fit1.nosite \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jmbayes2.fit11.nosite)\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes2::jm(Surv_object = surv.fit1.nosite, Mixed_objects = lme.fit1, \n#&gt;     time_var = \"time\", control = jmcontrol)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Number of Groups: 600        Number of events: 600 (100%)\n#&gt; Number of Observations:\n#&gt;   lamh: 3326\n#&gt; \n#&gt;                  DIC     WAIC      LPML\n#&gt; marginal    14864.91 14947.39 -7493.383\n#&gt; conditional 15529.92 15309.70 -8097.687\n#&gt; \n#&gt; Random-effects covariance matrix:\n#&gt;                      \n#&gt;        StdDev   Corr \n#&gt; (Intr) 1.6695 (Intr) \n#&gt; time   0.0981 -0.2189\n#&gt; \n#&gt; Survival Outcome:\n#&gt;                                Mean  StDev    2.5%   97.5%      P   Rhat\n#&gt; marriedMarried/Partnered     0.1370 0.1487 -0.1499  0.4318 0.3620 1.0082\n#&gt; bc_pillsEver use BC pills   -0.0123 0.1284 -0.2609  0.2445 0.9371 1.0062\n#&gt; bmi                         -0.0470 0.0088 -0.0642 -0.0294 0.0000 1.0443\n#&gt; factor(ethnic)BLACK         -0.3768 0.1366 -0.6477 -0.1193 0.0020 1.0082\n#&gt; factor(ethnic)CHINE         -0.3621 0.1904 -0.7400  0.0139 0.0613 1.0104\n#&gt; factor(ethnic)HISPA         -0.2688 0.3638 -0.9652  0.4357 0.4527 1.0980\n#&gt; factor(ethnic)JAPAN          0.0949 0.1592 -0.2151  0.4157 0.5393 1.0473\n#&gt; factor(smoke)Past Only      -0.0927 0.1301 -0.3378  0.1780 0.4838 1.0019\n#&gt; factor(smoke)Current Smoker  0.2262 0.1772 -0.1205  0.5635 0.2100 1.0034\n#&gt; value(lamh)                 -0.9795 0.0839 -1.1938 -0.8381 0.0000 1.9560\n#&gt; \n#&gt; Longitudinal Outcome: lamh (family = gaussian, link = identity)\n#&gt;                Mean  StDev    2.5%   97.5% P   Rhat\n#&gt; (Intercept)  7.8964 0.1069  7.6786  8.1089 0 1.1336\n#&gt; time        -0.5932 0.0122 -0.6167 -0.5662 0 1.1840\n#&gt; sigma        1.3087 0.0196  1.2711  1.3464 0 1.0983\n#&gt; \n#&gt; MCMC summary:\n#&gt; chains: 3 \n#&gt; iterations per chain: 3500 \n#&gt; burn-in per chain: 500 \n#&gt; thinning: 1 \n#&gt; time: 13 sec\n\n\n\\(lme.fit3 \\sim (fixed = lamh \\sim time + I(time^2), \\ random = \\sim time + I(time^2) | id)\\)\n\\(surv.fit1.nosite \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jmbayes2.fit31.nosite)\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes2::jm(Surv_object = surv.fit1.nosite, Mixed_objects = lme.fit3, \n#&gt;     time_var = \"time\", control = jmcontrol)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Number of Groups: 600        Number of events: 600 (100%)\n#&gt; Number of Observations:\n#&gt;   lamh: 3326\n#&gt; \n#&gt;                  DIC     WAIC      LPML\n#&gt; marginal    14586.06 14791.78 -7404.593\n#&gt; conditional 11610.39 11463.52 -6301.342\n#&gt; \n#&gt; Random-effects covariance matrix:\n#&gt;                              \n#&gt;        StdDev   Corr         \n#&gt; (Intr) 1.1012 (Intr)  00time \n#&gt; time   0.1835 0.5630         \n#&gt; I(t^2) 0.0140 -0.4625 -0.6009\n#&gt; \n#&gt; Survival Outcome:\n#&gt;                                Mean  StDev    2.5%   97.5%      P   Rhat\n#&gt; marriedMarried/Partnered     0.1327 0.1603 -0.1777  0.4485 0.4193 1.0004\n#&gt; bc_pillsEver use BC pills    0.0183 0.1352 -0.2344  0.2874 0.8967 1.0027\n#&gt; bmi                         -0.0493 0.0096 -0.0685 -0.0305 0.0000 1.0178\n#&gt; factor(ethnic)BLACK         -0.3812 0.1496 -0.6774 -0.0909 0.0082 1.0081\n#&gt; factor(ethnic)CHINE         -0.3529 0.2088 -0.7704  0.0489 0.0849 1.0285\n#&gt; factor(ethnic)HISPA         -0.1895 0.4395 -1.0725  0.6252 0.6971 1.0028\n#&gt; factor(ethnic)JAPAN          0.1717 0.1749 -0.1743  0.5089 0.3247 1.0011\n#&gt; factor(smoke)Past Only      -0.1407 0.1448 -0.4373  0.1322 0.3280 1.0080\n#&gt; factor(smoke)Current Smoker  0.2021 0.1977 -0.1781  0.5721 0.3244 1.0080\n#&gt; value(lamh)                 -1.0303 0.0701 -1.1732 -0.9045 0.0000 1.0633\n#&gt; \n#&gt; Longitudinal Outcome: lamh (family = gaussian, link = identity)\n#&gt;                Mean  StDev    2.5%   97.5%     P   Rhat\n#&gt; (Intercept)  6.4251 0.1224  6.1925  6.6934 0e+00 1.3366\n#&gt; time        -0.0846 0.0359 -0.1839 -0.0295 7e-04 1.5178\n#&gt; I(time^2)   -0.0392 0.0030 -0.0437 -0.0315 0e+00 1.2946\n#&gt; sigma        1.2631 0.0182  1.2278  1.2998 0e+00 1.0050\n#&gt; \n#&gt; MCMC summary:\n#&gt; chains: 3 \n#&gt; iterations per chain: 3500 \n#&gt; burn-in per chain: 500 \n#&gt; thinning: 1 \n#&gt; time: 15 sec\n\n\nThere is no anova() for JMbayes2 package, However, there is the compare_jm function in the package.\nneed to talk with EJC whether we need to include the slope terms\n\nCode## there is no anova function in JMbayes2\nanova(jmbayes2.fit11.nosite, jmbayes2.fit31.nosite)\n\n#&gt; Error in UseMethod(\"anova\"): no applicable method for 'anova' applied to an object of class \"jm\"\n\nCodecompare_jm(jmbayes2.fit11.nosite,\n           jmbayes2.fit31.nosite)\n\n#&gt; \n#&gt;                             DIC     WAIC      LPML\n#&gt;  jmbayes2.fit31.nosite 14586.06 14791.78 -7404.593\n#&gt;  jmbayes2.fit11.nosite 14864.91 14947.39 -7493.383\n#&gt; \n#&gt; The criteria are calculated based on the marginal log-likelihood.\n\n\nTraceplots with base R, convergence is not so well.\n\nCodetraceplot(jmbayes2.fit11.nosite)\n\n\n\n\nTraceplot for the joint model with ggplot\n\nCodeggtraceplot(jmbayes2.fit31.nosite,\n            ## \"betas\", \"sigmas\", \n            ## \"D\", \"bs_gammas\",\n            ## \"tau_bs_gammas\", \"gammas\", \"alphas\"\n            parm = \"betas\",\n            size = 0.3, \n            alpha = 0.8,\n            ## c('standard', 'catalog', 'metro',\n            ##   'pastel', 'beach', 'moonlight', \n            ##   'goo', 'sunset', 'custom')\n            theme = \"moonlight\",\n            grid = FALSE, \n            gridcols = 2)\n\n\nggtraceplot(jmbayes2.fit31.nosite,\n            ## \"betas\", \"sigmas\", \n            ## \"D\", \"bs_gammas\",\n            ## \"tau_bs_gammas\", \"gammas\", \"alphas\"\n            parm = \"gammas\",\n            size = 0.3, \n            alpha = 0.8,\n            ## c('standard', 'catalog', 'metro',\n            ##   'pastel', 'beach', 'moonlight', \n            ##   'goo', 'sunset', 'custom')\n            theme = \"moonlight\",\n            grid = FALSE, \n            gridcols = 2)"
  },
  {
    "objectID": "05_jmbayes2.html#nested-linear-mixed-model",
    "href": "05_jmbayes2.html#nested-linear-mixed-model",
    "title": "\n5  JMbayes2\n",
    "section": "\n5.3 Nested linear mixed model",
    "text": "5.3 Nested linear mixed model\nThe site is not in the longitudinal dataset swan_amh0, but it is in the survival dataset swan_amh1?\nThere is some problem for the nested linear mixed model:\n“Indeed, nested random-effects structures are not yet supported in JMbayes2.” by Dimitris Rizopoulos.\n\\(lme.fit4 \\sim lme(lamh \\sim time, random = \\sim time| site / id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc_pills + bmi + factor(ethnic) + factor(smoke)\\)\n\nCodesummary(lme.fit4)\n\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: swan_amh0 \n#&gt;        AIC      BIC    logLik\n#&gt;   12570.79 12625.77 -6276.396\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~time | site\n#&gt;  Structure: General positive-definite, Log-Cholesky parametrization\n#&gt;             StdDev    Corr  \n#&gt; (Intercept) 0.4503209 (Intr)\n#&gt; time        0.0550350 -0.759\n#&gt; \n#&gt;  Formula: ~time | id %in% site\n#&gt;  Structure: General positive-definite, Log-Cholesky parametrization\n#&gt;             StdDev     Corr  \n#&gt; (Intercept) 1.61987662 (Intr)\n#&gt; time        0.08386827 -0.295\n#&gt; Residual    1.30160865       \n#&gt; \n#&gt; Fixed effects:  lamh ~ time \n#&gt;                 Value  Std.Error   DF   t-value p-value\n#&gt; (Intercept)  7.503743 0.20297720 2725  36.96840       0\n#&gt; time        -0.528080 0.02444278 2725 -21.60476       0\n#&gt;  Correlation: \n#&gt;      (Intr)\n#&gt; time -0.757\n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;        Min         Q1        Med         Q3        Max \n#&gt; -5.2245239 -0.4833631  0.1091414  0.6053437  2.9140076 \n#&gt; \n#&gt; Number of Observations: 3326\n#&gt; Number of Groups: \n#&gt;         site id %in% site \n#&gt;            7          600\n\nCodejmbayes2.fit41.nosite &lt;- JMbayes2::jm(Surv_object = surv.fit1.nosite,\n                                      Mixed_objects = lme.fit4, \n                                      time_var = \"time\") \n\n#&gt; Error in mat[id, ] &lt;- b: number of items to replace is not a multiple of replacement length\n\n\nAlso trying different ways of adding nested or crossed random effects. None of these works with the JMbayes2 package. So including the random site:ethnicity effects does not work through the linear mixed models.\n\nCodelme.fit5 &lt;- lme(lamh ~ time,\n                data = swan_amh0,\n                control = control,\n                ## does not work for the jm model\n                # random = list(site = pdSymm(~ time),\n                #               id = pdDiag(~ time)),\n                # random = list(site = ~ time,\n                #                id = ~ time),\n                # random = list(~1 | site,\n                #               ~time | id),\n                random = ~ time| site / id,\n                ## does not work for the jm model\n                )\n\nsummary(lme.fit5)\n\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: swan_amh0 \n#&gt;        AIC      BIC    logLik\n#&gt;   12570.79 12625.77 -6276.396\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~time | site\n#&gt;  Structure: General positive-definite, Log-Cholesky parametrization\n#&gt;             StdDev    Corr  \n#&gt; (Intercept) 0.4503209 (Intr)\n#&gt; time        0.0550350 -0.759\n#&gt; \n#&gt;  Formula: ~time | id %in% site\n#&gt;  Structure: General positive-definite, Log-Cholesky parametrization\n#&gt;             StdDev     Corr  \n#&gt; (Intercept) 1.61987662 (Intr)\n#&gt; time        0.08386827 -0.295\n#&gt; Residual    1.30160865       \n#&gt; \n#&gt; Fixed effects:  lamh ~ time \n#&gt;                 Value  Std.Error   DF   t-value p-value\n#&gt; (Intercept)  7.503743 0.20297720 2725  36.96840       0\n#&gt; time        -0.528080 0.02444278 2725 -21.60476       0\n#&gt;  Correlation: \n#&gt;      (Intr)\n#&gt; time -0.757\n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;        Min         Q1        Med         Q3        Max \n#&gt; -5.2245239 -0.4833631  0.1091414  0.6053437  2.9140076 \n#&gt; \n#&gt; Number of Observations: 3326\n#&gt; Number of Groups: \n#&gt;         site id %in% site \n#&gt;            7          600\n\nCodejmbayes2.fit51.nosite &lt;- JMbayes2::jm(Surv_object = surv.fit1.nosite,\n                                      Mixed_objects = lme.fit5, \n                                      time_var = \"time\") \n\n#&gt; Error in mat[id, ] &lt;- b: number of items to replace is not a multiple of replacement length"
  },
  {
    "objectID": "05_jmbayes2.html#prediction-accuracy",
    "href": "05_jmbayes2.html#prediction-accuracy",
    "title": "\n5  JMbayes2\n",
    "section": "\n5.4 Prediction Accuracy",
    "text": "5.4 Prediction Accuracy\n\nCodet0 &lt;- 3\nids &lt;- unique(swan_amh0$id)\n## length(ids)\n## Prediction for the survival outcomes\nND1 &lt;- swan_amh0 %&gt;%\n  filter(id %in% c(ids[5], id[6]),\n         time &lt; t0)\n## 4, 5, 7 (not so good)\n\nND1$event &lt;- 0\nND1$etime &lt;- t0\n\n\n\n5.4.1 Dynamic prediction\nNotes: we select the subject for whom we want to calculate predictions, we use measurements up to follow-up year 3; we also set that the patients were alive up to this time point.\n\nCodepredLong &lt;- predict(jmbayes2.fit11.nosite, \n                    newdata = ND1,\n                    times = seq(3, 8, by = 0.5),\n                    return_newdata = TRUE)\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\nCodepredLong_all &lt;- predict(jmbayes2.fit11.nosite, \n                        newdata = swan_amh1,\n                        return_newdata = TRUE)\n\npredSurv_all &lt;- predict(jmbayes2.fit11.nosite, \n                        newdata = ND1,\n                        times = 1:2,\n                        process = \"event\",\n                        return_newdata = TRUE)\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\n\n\n5.4.2 AUC\nIt seems like the AUC, ROC, and Brier Score only works for the prediction for the whole dataset, not for the single individual. I do not know why this keep happening.\n\nCodeJMbayes2::tvAUC(jmbayes2.fit11.nosite, \n                swan_amh0, \n                Tstart = 5,\n                Thoriz = 8)\n\n#&gt; \n#&gt;  Time-dependent AUC for the Joint Model jmbayes2.fit11.nosite\n#&gt; \n#&gt; Estimated AUC: 0.8293\n#&gt; At time: 8\n#&gt; Using information up to time: 5 (407 subjects still at risk)\n\nCodeJMbayes2::tvAUC(jmbayes2.fit11.nosite, \n                ND1, \n                Tstart = 5,\n                Thoriz = 8)\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\n\n\n5.4.3 Calibration Plot\n\nCodeJMbayes2::calibration_plot(jmbayes2.fit11.nosite, \n                           newdata = ND1, \n                           Tstart = 5,\n                           Thoriz = 8)\n\n#&gt; Error in JMbayes2::calibration_plot(jmbayes2.fit11.nosite, newdata = ND1, : there are no data on subjects who had an observed event time after Tstart and longitudinal measurements before Tstart.\n\nCodeJMbayes2::calibration_plot(jmbayes2.fit11.nosite, \n                           swan_amh0, \n                           Tstart = 5,\n                           Thoriz = 8)\n\n\n\nCode# View(swan_amh0) the left truncation\n\n\n\n5.4.4 ROC\n\nCodeJMbayes2::tvROC(jmbayes2.fit11.nosite, \n                ND1, \n                Tstart = 5,\n                Thoriz = 8)\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\nCoderoc.fit11.nosite &lt;- JMbayes2::tvROC(jmbayes2.fit11.nosite, \n                                    swan_amh0, \n                                    Tstart = 5,\n                                    Thoriz = 8)\n\nplot(roc.fit11.nosite)\n\n\n\n\n\n5.4.5 Brier Score\nHowever there are several functions in both packages interfering with each other, the JMbayes2::tvBrier().\nUsing the available longitudinal information up to a starting time point, these functions compute estimates of the ROC curve and the AUC, the Brier score and expected predictive cross-entropy at a horizon time point based on joint models.\nI can calculate the Brier score for a group of people or the whole dataset, but not for single individual.\n\nCode## I cannot predict for single person \n## but I can predict for the whole dataset\nJMbayes2::tvBrier(jmbayes2.fit11.nosite, \n                  newdata = ND1, \n                  Tstart = 5, \n                  Dt = 8)\n\n#&gt; Warning in br(Thoriz): there are fewer than 5 subjects with an event in the interval [5.000001, 13).\n\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\nCodeJMbayes2::tvBrier(jmbayes2.fit11, \n                  newdata = ND1, \n                  Tstart = 5, \n                  Dt = 8)\n\n#&gt; Warning in br(Thoriz): there are fewer than 5 subjects with an event in the interval [5.000001, 13).\n\n\n#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels\n\nCodeJMbayes2::tvBrier(jmbayes2.fit11, \n                  swan_amh0, \n                  integrated = TRUE,\n                  # integrated logical; \n                  # if TRUE the integrated Brier score is calculated\n                  Tstart = 5,\n                  Thoriz = 8)\n\n#&gt; \n#&gt; Prediction Error for the Joint Model 'jmbayes2.fit11'\n#&gt; \n#&gt; Estimated Integrated Brier score: 0.0359\n#&gt; In the time interval: [5, 8)\n#&gt; For the 407 subjects at risk at time 5\n#&gt; Number of subjects with an event in [5, 8): 63\n#&gt; Number of subjects with a censored time in [5, 8): 0\n#&gt; Accounting for censoring using model-based weights\n\nCodeJMbayes2::tvBrier(jmbayes2.fit11, \n                  swan_amh0, \n                  integrated = FALSE,\n                  # integrated logical; \n                  # if TRUE the integrated Brier score is calculated\n                  Tstart = 5,\n                  Thoriz = 8)\n\n#&gt; \n#&gt; Prediction Error for the Joint Model 'jmbayes2.fit11'\n#&gt; \n#&gt; Estimated Brier score: 0.108\n#&gt; At time: 8\n#&gt; For the 407 subjects at risk at time 5\n#&gt; Number of subjects with an event in [5, 8): 63\n#&gt; Number of subjects with a censored time in [5, 8): 0\n#&gt; Accounting for censoring using model-based weights\n\nCodeJMbayes2::tvBrier(jmbayes2.fit11.nosite, \n                  swan_amh0, \n                  integrated = TRUE,\n                  Tstart = 5,\n                  Thoriz = 8)\n\n#&gt; \n#&gt; Prediction Error for the Joint Model 'jmbayes2.fit11.nosite'\n#&gt; \n#&gt; Estimated Integrated Brier score: 0.0356\n#&gt; In the time interval: [5, 8)\n#&gt; For the 407 subjects at risk at time 5\n#&gt; Number of subjects with an event in [5, 8): 63\n#&gt; Number of subjects with a censored time in [5, 8): 0\n#&gt; Accounting for censoring using model-based weights\n\nCodeJMbayes2::tvBrier(jmbayes2.fit11.nosite, \n                  swan_amh0, \n                  integrated = FALSE,\n                  Tstart = 5,\n                  Thoriz = 8)\n\n#&gt; \n#&gt; Prediction Error for the Joint Model 'jmbayes2.fit11.nosite'\n#&gt; \n#&gt; Estimated Brier score: 0.106\n#&gt; At time: 8\n#&gt; For the 407 subjects at risk at time 5\n#&gt; Number of subjects with an event in [5, 8): 63\n#&gt; Number of subjects with a censored time in [5, 8): 0\n#&gt; Accounting for censoring using model-based weights"
  },
  {
    "objectID": "02_jm.html#goal-for-this-chapter",
    "href": "02_jm.html#goal-for-this-chapter",
    "title": "\n2  JM\n",
    "section": "\n2.1 Goal for this chapter",
    "text": "2.1 Goal for this chapter\n\nEDA for Longitudinal sub-model lme (Achohol usage and AMH levels by EJC)\nEDA for survival sub-model (Kaplan-Meier plots for different variables by EJC)\nTransformation required for the AMH levels - log transformation lamh = log(amh)\nFit the longitudinal model with lme(), with random slope and random intercept (by EJC)\nFit the survival model with coxph() (by EJC)\nFit the joint model with JM package (by EJC)\nswan_amh0 is the longitudinal dataset\nswan_amh1 is the id dataset\n\n\nCodeload(\"data/swan_amh0.rda\")\nload(\"data/swan_amh1.rda\")"
  },
  {
    "objectID": "02_jm.html#longitudinal-eda",
    "href": "02_jm.html#longitudinal-eda",
    "title": "\n2  JM\n",
    "section": "\n2.2 Longitudinal EDA",
    "text": "2.2 Longitudinal EDA\nThe spaghetti plots for alcohol usage and the amh levels. Linear trend seems reasonable for the AMH levels over time.\nThe longitudinal model will only include time.\n\nswan_amh0 is the longitudinal dataset\nswan_amh1 is the id dataset\n\n\nCode## exploring AMH over time\nplot1 &lt;- ggplot(swan_amh0, \n                aes(x = time, \n                    y = log(amh),\n                    group = as.character(id))) +\n  geom_line(aes(color = alcohol),\n            alpha = 0.5) +\n  geom_smooth(aes(group = 1),\n              method = \"loess\",\n              color = \"black\",\n              se = FALSE) +\n  theme_classic() +\n  theme(legend.position = \"none\") +\n  ylab(\"AMH\")\n\n\n\nCodeplot1\nplot1 + facet_wrap(~alcohol)\n\n\n\n\n\nAMH over time and by alcohol use\n\n\n\n\n\nAMH over time and by alcohol use"
  },
  {
    "objectID": "02_jm.html#survival-eda",
    "href": "02_jm.html#survival-eda",
    "title": "\n2  JM\n",
    "section": "\n2.3 Survival EDA",
    "text": "2.3 Survival EDA\n\nCodekm.plot &lt;- function(var, \n                    vard) {\n  vard &lt;- as.factor(vard)\n  surv1 &lt;- paste(\"Surv(start_time, etime, event) ~\", \n                 var, sep = \" \")\n  sfit &lt;- survfit(formula(surv1),\n                  data = swan_amh1)\n  lev &lt;- levels(vard)\n  str(vard)\n  nlev &lt;- nlevels(vard)\n  plot(sfit, \n       lty = 1:nlev,\n       lwd = 2, \n       col = 1:nlev,\n       main = var)\n  legend(\"topright\", lev, \n         lty = 1:nlev, \n         col = 1:nlev, \n         lwd = 2,\n         bty = \"n\")\n}\n\n# table(swan_amh1$alcohol)\n# names(swan_amh1)\n# table(swan_amh1$bmi_cat)\n\nnamelist &lt;- c(\"ethnic\", \"edu\", \"alcohol\", \n              \"employed\", \"health\", \"smoke\",\n              \"married\", \"bc_pills\", \n              \"children\", \"bmi\", \"phys_act\")\n\nop &lt;- par(mfrow = c(6, 2))\nkm.plot(var = \"site\", vard = swan_amh1$site)\nkm.plot(var = \"ethnic\", vard = swan_amh1$ethnic)\nkm.plot(var = \"alcohol\", vard = swan_amh1$alcohol)\n\nkm.plot(var = \"edu\", vard = swan_amh1$edu)\nkm.plot(var = \"employed\", vard = swan_amh1$employed)\nkm.plot(var = \"health\", vard = swan_amh1$health)\n\nkm.plot(var = \"smoke\", vard = swan_amh1$smoke)\nkm.plot(var = \"married\", vard = swan_amh1$married)\nkm.plot(var = \"bc_pills\", vard = swan_amh1$bc_pills)\n\nkm.plot(var = \"parity\", vard = swan_amh1$parity)\nkm.plot(var = \"bmi_cat\", vard = swan_amh1$bmi_cat)\n\n## continous variables: bmi, phys.act, children\n# summary(swan_amh1$bmi)\n# table(swan_amh1$children) ## maybe use 0, 1, 2, 3, 4, 5+\n\n\n\nKaplan-Meier plots for different variables"
  },
  {
    "objectID": "02_jm.html#longitudinal-submodel-on-logamh",
    "href": "02_jm.html#longitudinal-submodel-on-logamh",
    "title": "\n2  JM\n",
    "section": "\n2.4 Longitudinal submodel on log(AMH)",
    "text": "2.4 Longitudinal submodel on log(AMH)\nThe linear mixed model will only include the time variable, with random slope and random intercept.\n\nCodeswan_amh0$lamh &lt;- log(swan_amh0$amh)\n\n## linear mixed model fit (longitudinal outcome)\nlme.fit0 &lt;- lme(lamh ~ time, \n                data = swan_amh0,\n                random = ~ 1|id)\nlme.fit1 &lt;- lme(lamh ~ time,\n                data = swan_amh0, \n                random = ~ time|id)\n\n\nComparison between the two models. The first model has a random intercept, while the second model has a random slope.\nThe fixed effects are almost the same.\n\nCodetidy(lme.fit0)\n\n\n\n  \n\n\nCodetidy(lme.fit1)\n\n\n\n  \n\n\n\n\nCoderbind(fit0 = glance(lme.fit0),\n      fit1 = glance(lme.fit1))\n\n\n\n  \n\n\n\nThere is a significant difference between the two models. We will use the second model for the joint model.\n\nCodeanova(lme.fit0, lme.fit1)"
  },
  {
    "objectID": "02_jm.html#survivial-submodel",
    "href": "02_jm.html#survivial-submodel",
    "title": "\n2  JM\n",
    "section": "\n2.5 Survivial submodel",
    "text": "2.5 Survivial submodel\n\nCode## get predicted random slopes and plot them against \n## (get the correlation)\n## with time to FMP (before even you fit JM)\n## cox model fit (survival outcome) with left truncation \n## (need to fit model without left truncation)\nsurv.fit0 &lt;- coxph(Surv(start_time, etime, event) ~ ethnic + edu + \n                    alcohol + employed + health +\n                    smoke + married + bc_pills + \n                    children + bmi + \n                    phys_act + cluster(id),\n                  data = swan_amh1, \n                  x = TRUE, \n                  model = TRUE)\n\n## assuming individuals are observed from time 0 - \n## WE WILL USE this model\n## (and do a sensitivity analysis with left trunc)\nsurv.fit1 &lt;- coxph(Surv(etime, event) ~ married + bc_pills +\n                    children + bmi + phys_act +\n                    factor(site) + factor(ethnic) +\n                    factor(smoke) + factor(edu) +\n                    factor(alcohol) + factor(employed) +\n                    factor(health),\n                  data = swan_amh1,\n                  x = TRUE, \n                  model = TRUE)\n\n\n## with only continuous predictors\nsurv.fit2 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + \n                    children + bmi + phys_act, \n                  data = swan_amh1, \n                  x = TRUE,\n                  model = TRUE)\n\n\nHere are the summary statistics for the three models.\n\nCoderbind(fit0 = glance(surv.fit0), \n      fit1 = glance(surv.fit1), \n      fit2 = glance(surv.fit2)) %&gt;%\n  mutate(formula = c(surv.fit0$formula, \n                     surv.fit1$formula, \n                     surv.fit2$formula),\n         formula = as.character(formula)) %&gt;%\n  dplyr::select(logLik, AIC, BIC, formula,\n                r.squared, concordance) \n\n\n\n  \n\n\n\nThis is the final survival model that we will use for the joint model.\n\nCodetidy(surv.fit1)"
  },
  {
    "objectID": "02_jm.html#joint-model",
    "href": "02_jm.html#joint-model",
    "title": "\n2  JM\n",
    "section": "\n2.6 Joint model",
    "text": "2.6 Joint model\nHere is the simplest joint model with the exploratory analysis.\n\nCode## joint model fit\njoint.fit1 &lt;- jointModel(lme.fit1,\n                        surv.fit1, \n                        timeVar = \"time\", \n                        method = \"piecewise-PH-aGH\")\n\n# \"weibull-PH-aGH\"\n# joint.fit.laplace &lt;- jointModel(lme.fit1,\n#                             surv.fit1, \n#                             timeVar = \"time\", \n#                             method = \"ch-Laplace\")\n\n\nThe summaries of the joint model.\n\nCodesummary(joint.fit1)[[1]]\n\n#&gt;                  Value    Std.Err   z-value p-value\n#&gt; (Intercept)  7.8622487 0.09790235  80.30705       0\n#&gt; time        -0.5754795 0.01019830 -56.42895       0\n\nCodesummary(joint.fit1)[[2]]\n\n#&gt;                                           Value     Std.Err     z-value\n#&gt; marriedMarried/Partnered             0.08500617 0.114288096   0.7437885\n#&gt; bc_pillsEver use BC pills            0.01416071 0.121381667   0.1166627\n#&gt; children                             0.04127406 0.041453456   0.9956723\n#&gt; bmi                                 -0.04618990 0.008902736  -5.1882812\n#&gt; phys_act                            -0.02390457 0.031646769  -0.7553558\n#&gt; factor(site)C                        0.28793318 0.191534397   1.5032975\n#&gt; factor(site)M                        0.24565765 0.182353084   1.3471538\n#&gt; factor(site)NJ                       0.50811192 0.413409657   1.2290761\n#&gt; factor(site)P                        0.47082720 0.194236304   2.4239918\n#&gt; factor(site)UCD                      0.15967019 0.237212326   0.6731109\n#&gt; factor(site)UCLA                     0.30512524 0.241330294   1.2643470\n#&gt; factor(ethnic)BLACK                 -0.37129333 0.144865054  -2.5630290\n#&gt; factor(ethnic)CHINE                 -0.23664675 0.267794363  -0.8836883\n#&gt; factor(ethnic)HISPA                 -1.09147761 0.503731229  -2.1667857\n#&gt; factor(ethnic)JAPAN                 -0.06351346 0.239310601  -0.2654018\n#&gt; factor(smoke)Past Only              -0.09355733 0.123965313  -0.7547057\n#&gt; factor(smoke)Current Smoker         -0.07744957 0.162115759  -0.4777424\n#&gt; factor(edu)Some College              0.28279048 0.149149159   1.8960246\n#&gt; factor(edu)College degree or higher -0.02441751 0.146499443  -0.1666731\n#&gt; factor(alcohol)&lt;1/wk                 0.09482211 0.162431371   0.5837672\n#&gt; factor(alcohol)1-7/wk                0.22221906 0.128025279   1.7357436\n#&gt; factor(alcohol)&gt;7/wk                 0.12459859 0.180614069   0.6898609\n#&gt; factor(employed)Employed             0.01369358 0.136271876   0.1004872\n#&gt; factor(health)Very Good             -0.04941036 0.131233116  -0.3765083\n#&gt; factor(health)Good                  -0.05990930 0.155479382  -0.3853199\n#&gt; factor(health)Fair/Poor             -0.10761417 0.202429102  -0.5316141\n#&gt; Assoct                              -0.93144986 0.052866692 -17.6188413\n#&gt; log(xi.1)                            0.60238627 0.518788894   1.1611395\n#&gt; log(xi.2)                            1.34776023 0.504954758   2.6690713\n#&gt; log(xi.3)                            1.62735769 0.502168303   3.2406619\n#&gt; log(xi.4)                            1.78525209 0.500324993   3.5681849\n#&gt; log(xi.5)                            1.97299001 0.500290051   3.9436923\n#&gt; log(xi.6)                            2.13719246 0.495818142   4.3104362\n#&gt; log(xi.7)                            2.23055592 0.497029334   4.4877752\n#&gt;                                          p-value\n#&gt; marriedMarried/Partnered            4.570045e-01\n#&gt; bc_pillsEver use BC pills           9.071274e-01\n#&gt; children                            3.194094e-01\n#&gt; bmi                                 2.122439e-07\n#&gt; phys_act                            4.500355e-01\n#&gt; factor(site)C                       1.327623e-01\n#&gt; factor(site)M                       1.779307e-01\n#&gt; factor(site)NJ                      2.190433e-01\n#&gt; factor(site)P                       1.535095e-02\n#&gt; factor(site)UCD                     5.008768e-01\n#&gt; factor(site)UCLA                    2.061055e-01\n#&gt; factor(ethnic)BLACK                 1.037634e-02\n#&gt; factor(ethnic)CHINE                 3.768645e-01\n#&gt; factor(ethnic)HISPA                 3.025120e-02\n#&gt; factor(ethnic)JAPAN                 7.907000e-01\n#&gt; factor(smoke)Past Only              4.504256e-01\n#&gt; factor(smoke)Current Smoker         6.328336e-01\n#&gt; factor(edu)Some College             5.795679e-02\n#&gt; factor(edu)College degree or higher 8.676273e-01\n#&gt; factor(alcohol)&lt;1/wk                5.593769e-01\n#&gt; factor(alcohol)1-7/wk               8.260917e-02\n#&gt; factor(alcohol)&gt;7/wk                4.902816e-01\n#&gt; factor(employed)Employed            9.199575e-01\n#&gt; factor(health)Very Good             7.065390e-01\n#&gt; factor(health)Good                  7.000004e-01\n#&gt; factor(health)Fair/Poor             5.949933e-01\n#&gt; Assoct                              1.765848e-69\n#&gt; log(xi.1)                           2.455852e-01\n#&gt; log(xi.2)                           7.606131e-03\n#&gt; log(xi.3)                           1.192525e-03\n#&gt; log(xi.4)                           3.594628e-04\n#&gt; log(xi.5)                           8.023661e-05\n#&gt; log(xi.6)                           1.629328e-05\n#&gt; log(xi.7)                           7.197081e-06\n\nCode# summary(joint.fit.wei)"
  },
  {
    "objectID": "03_model_selection.html#goal-for-this-chapter",
    "href": "03_model_selection.html#goal-for-this-chapter",
    "title": "\n3  Model selection\n",
    "section": "\n3.1 Goal for this chapter",
    "text": "3.1 Goal for this chapter\n\nList of all the variables in the clean dataset\nModel selection for the survival sub-model (backward selection by EJC)\nModel selection for the survival sub-model with step\nTwo methods are consistent with each other\nJoint model with the selected survival sub-model (by EJC)\nJoint model factorization v.s. stratification (by EJC)\nFit the joint model with JM package and get ROC and AUC failed (by EJC)\nDynamic predictions for the joint model failed ( by EJC)\nExploring include the Rate (Time-Dependent Slopes) in the JM model\nSummary of model comparisons\nJM package cannot calculate individual AUC and ROC, and Brier Score."
  },
  {
    "objectID": "03_model_selection.html#model-selelction",
    "href": "03_model_selection.html#model-selelction",
    "title": "\n3  Model selection\n",
    "section": "\n3.2 Model selelction",
    "text": "3.2 Model selelction\n\nswan_amh0 is the longitudinal dataset\nswan_amh1 is the id dataset\n\n\nCodeload(\"data/swan_amh0.rda\")\nload(\"data/swan_amh1.rda\")"
  },
  {
    "objectID": "03_model_selection.html#backward-selection-of-vars",
    "href": "03_model_selection.html#backward-selection-of-vars",
    "title": "\n3  Model selection\n",
    "section": "\n3.3 Backward selection of vars",
    "text": "3.3 Backward selection of vars\nThe fitted model surv.fit16 from this 03_model_selection is the same as the surv.fit1 from `02_jm.qmd. Need to keep \\(site + ethnic + smoke + bmi\\).\nAll the variables:\n- surv outcomes: “etime” “event”. - lme outcomes: “log(amh)”\n\nlongitudinal vars:\n\n“id”\n“time”\n\n\nNot included into models:\n\n“age”\n“age0”\n“bmi_cat”\n“fmp_age”\n“parity”\n“phys_act”\n“start_time”\n“train”\n“visit”\n\n\nsurvival vars:\n\n\n“alcohol”,\n\n“bc_pills”,\n\n“bmi”,\n\n“children”,\n\n“edu”,\n\n“employed”,\n\n“ethnic”,\n\n“health”,\n\n“married”,\n\n“site”,\n“smoke”\n\n\n\n\nCode### Need to keep site + ethnic + smoke + bmi\n## testing for physical activity (taking out phys.act)\nsurv.fit11 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + children + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke) +\n                      factor(edu) + factor(alcohol) + factor(employed) + factor(health),\n                    data = swan_amh1, \n                    x = TRUE, \n                    model = TRUE)\n\n## testing for employed\nsurv.fit12 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + children + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke) +\n                      factor(edu) + factor(alcohol) + factor(health),\n                    data = swan_amh1, x = TRUE, model = TRUE)\n\n## testing for children\nsurv.fit13 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke) +\n                      factor(edu) + factor(alcohol) + factor(health),\n                    data = swan_amh1, x = TRUE, model = TRUE)\n\n\n## testing for edu (education)\nsurv.fit14 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke) +\n                      factor(alcohol) + factor(health),\n                    data = swan_amh1, \n                    x = TRUE,\n                    model = TRUE)\n\n\n## testing for alcohol\nsurv.fit15 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke) +\n                      factor(health),\n                    data = swan_amh1, \n                    x = TRUE,\n                    model = TRUE)\n\n\n## testing for health\nsurv.fit16 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke),\n                    data = swan_amh1, \n                    x = TRUE,\n                    model = TRUE)\n\n\n## testing for bc_pills\nsurv.fit17 &lt;- coxph(Surv(etime, event) ~ married + bmi +\n                      factor(site) + factor(ethnic) + factor(smoke),\n                    data = swan_amh1, \n                    x = TRUE, \n                    model = TRUE)\n\n\n\nCodeoptions(digits = 4)\nrbind(fit11 = glance(surv.fit11), \n      fit12 = glance(surv.fit12), \n      fit13 = glance(surv.fit13),\n      fit14 = glance(surv.fit14),\n      fit15 = glance(surv.fit15),\n      fit16 = glance(surv.fit16),\n      fit17 = glance(surv.fit17)) %&gt;%\n  mutate(name = c(\"fit11\", \"fit12\", \"fit13\",\n                  \"fit14\", \"fit15\", \"fit16\",\n                  \"fit17\"),\n         formula = c(surv.fit11$formula,\n                     surv.fit12$formula,\n                     surv.fit13$formula,\n                     surv.fit14$formula,\n                     surv.fit15$formula,\n                     surv.fit16$formula,\n                     surv.fit17$formula),\n         formula = as.character(formula)) %&gt;%\n  dplyr::select(name, logLik, AIC, \n                BIC, r.squared, concordance, formula) \n\n\n\n  \n\n\n\nHere is the final survival sub-model.\n\nCodetidy(surv.fit16)\n\n\n\n  \n\n\n\nThe comparison is not exactly make sense to me, so need to talk with EJC for further works on the model. Backward model selection is not my favorite 😞 at all."
  },
  {
    "objectID": "03_model_selection.html#using-step-function",
    "href": "03_model_selection.html#using-step-function",
    "title": "\n3  Model selection\n",
    "section": "\n3.4 Using step function",
    "text": "3.4 Using step function\nThe results show there are extra variables we can include, if necessary. Here are the results using step function.\nThe selection with upper of the full model including all the variables, the lower of the null model with only the intercept.\n\nCodesurv.fit1 &lt;- surv.fit16\nsurv.step &lt;- step(surv.fit1, \n                  scope = list(upper = ~age + married + bc_pills + children + bmi +\n                                 factor(site) + factor(ethnic) + factor(smoke) +\n                                 factor(edu) + factor(alcohol) + factor(employed) +\n                                 factor(health),\n                               lower = ~ 1))\n\n#&gt; Start:  AIC=6467.46\n#&gt; Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + \n#&gt;     factor(ethnic) + factor(smoke)\n#&gt; \n#&gt;                    Df    AIC\n#&gt; + age               1 6396.3\n#&gt; - factor(ethnic)    4 6462.8\n#&gt; - bmi               1 6465.7\n#&gt; &lt;none&gt;                6467.5\n#&gt; + factor(health)    3 6467.6\n#&gt; - factor(site)      6 6468.6\n#&gt; + children          1 6469.1\n#&gt; + factor(employed)  1 6469.4\n#&gt; + factor(edu)       2 6469.5\n#&gt; - bc_pills          1 6470.6\n#&gt; + factor(alcohol)   3 6470.6\n#&gt; - married           1 6470.8\n#&gt; - factor(smoke)     2 6480.8\n#&gt; \n#&gt; Step:  AIC=6396.32\n#&gt; Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + \n#&gt;     factor(ethnic) + factor(smoke) + age\n#&gt; \n#&gt;                    Df    AIC\n#&gt; - factor(ethnic)    4 6393.3\n#&gt; + factor(health)    3 6393.4\n#&gt; - bmi               1 6394.5\n#&gt; &lt;none&gt;                6396.3\n#&gt; - bc_pills          1 6397.9\n#&gt; + factor(employed)  1 6398.0\n#&gt; - factor(site)      6 6398.1\n#&gt; + factor(edu)       2 6398.3\n#&gt; + children          1 6398.3\n#&gt; - married           1 6399.1\n#&gt; + factor(alcohol)   3 6400.0\n#&gt; - factor(smoke)     2 6408.6\n#&gt; - age               1 6467.5\n#&gt; \n#&gt; Step:  AIC=6393.28\n#&gt; Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + \n#&gt;     factor(smoke) + age\n#&gt; \n#&gt;                    Df    AIC\n#&gt; - bmi               1 6391.8\n#&gt; &lt;none&gt;                6393.3\n#&gt; + factor(health)    3 6393.6\n#&gt; - bc_pills          1 6394.9\n#&gt; + children          1 6395.0\n#&gt; + factor(employed)  1 6395.1\n#&gt; + factor(edu)       2 6396.3\n#&gt; + factor(ethnic)    4 6396.3\n#&gt; - factor(site)      6 6396.5\n#&gt; + factor(alcohol)   3 6396.5\n#&gt; - married           1 6396.8\n#&gt; - factor(smoke)     2 6403.7\n#&gt; - age               1 6462.8\n#&gt; \n#&gt; Step:  AIC=6391.81\n#&gt; Surv(etime, event) ~ married + bc_pills + factor(site) + factor(smoke) + \n#&gt;     age\n#&gt; \n#&gt;                    Df    AIC\n#&gt; &lt;none&gt;                6391.8\n#&gt; + factor(health)    3 6392.8\n#&gt; + bmi               1 6393.3\n#&gt; + children          1 6393.4\n#&gt; - bc_pills          1 6393.5\n#&gt; + factor(employed)  1 6393.5\n#&gt; + factor(ethnic)    4 6394.5\n#&gt; + factor(alcohol)   3 6394.9\n#&gt; + factor(edu)       2 6395.0\n#&gt; - factor(site)      6 6395.2\n#&gt; - married           1 6396.3\n#&gt; - factor(smoke)     2 6402.4\n#&gt; - age               1 6461.4\n\n\n\n3.4.1 step() selected “best” model\nHere are the final model from step() function, which is does not including the bmi and ethnic variables. However the age is included in the model.\nNeed to talk with EJC, I was not sure why do not include age into the survival model.\n\nCodeprint(surv.step$formula)\n\n#&gt; Surv(etime, event) ~ married + bc_pills + factor(site) + factor(smoke) + \n#&gt;     age\n\nCodetidy(surv.step)"
  },
  {
    "objectID": "03_model_selection.html#joint-model-with-jmsurvfitjm",
    "href": "03_model_selection.html#joint-model-with-jmsurvfitjm",
    "title": "\n3  Model selection\n",
    "section": "\n3.5 Joint model with JM::survfitJM()\n",
    "text": "3.5 Joint model with JM::survfitJM()\n\nHere is the joint model with\n\\(lme.fit1 \\sim (fixed = lamh \\sim time, \\ random = \\sim time| id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\nThis is the most basic form, no slope, on interaction, on integral functions. Also the original model, included in EJC’s notes (the model with only factor(ethnic) + factor(smoke), STILL does not allow for calc of AUC.)\n\nCode### the model with only factor(ethnic) + factor(smoke) \n### STILL does not allow for calc of AUC\nlme.fit1 &lt;- lme(lamh ~ time, \n                data = swan_amh0, \n                random = ~ time|id)\n\n## joint model fit\njoint.fit1 &lt;- jointModel(lme.fit1,\n                         surv.fit1,\n                         timeVar = \"time\", \n                         method = \"piecewise-PH-aGH\")\nsummary(joint.fit1)\n\n#&gt; \n#&gt; Call:\n#&gt; jointModel(lmeObject = lme.fit1, survObject = surv.fit1, timeVar = \"time\", \n#&gt;     method = \"piecewise-PH-aGH\")\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of Groups: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with piecewise-constant\n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent \n#&gt; \n#&gt;    log.Lik      AIC      BIC\n#&gt;  -7332.592 14723.18 14850.69\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr\n#&gt; (Intercept)  1.6032  (Intr)\n#&gt; time         0.0343 -0.0856\n#&gt; Residual     1.3030        \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err  z-value p-value\n#&gt; (Intercept)  7.8648  0.0983  80.0274 &lt;0.0001\n#&gt; time        -0.5750  0.0102 -56.4857 &lt;0.0001\n#&gt; \n#&gt; Event Process\n#&gt;                               Value Std.Err  z-value p-value\n#&gt; marriedMarried/Partnered     0.1046  0.1086   0.9635  0.3353\n#&gt; bc_pillsEver use BC pills    0.0461  0.1182   0.3900  0.6966\n#&gt; bmi                         -0.0461  0.0083  -5.5319 &lt;0.0001\n#&gt; factor(site)C                0.2484  0.1853   1.3404  0.1801\n#&gt; factor(site)M                0.2076  0.1751   1.1858  0.2357\n#&gt; factor(site)NJ               0.4929  0.4129   1.1938  0.2326\n#&gt; factor(site)P                0.4339  0.1873   2.3163  0.0205\n#&gt; factor(site)UCD              0.0377  0.2312   0.1629  0.8706\n#&gt; factor(site)UCLA             0.2987  0.2376   1.2575  0.2086\n#&gt; factor(ethnic)BLACK         -0.3622  0.1378  -2.6279  0.0086\n#&gt; factor(ethnic)CHINE         -0.2540  0.2529  -1.0044  0.3152\n#&gt; factor(ethnic)HISPA         -1.0355  0.4859  -2.1310  0.0331\n#&gt; factor(ethnic)JAPAN         -0.0771  0.2338  -0.3299  0.7414\n#&gt; factor(smoke)Past Only      -0.0536  0.1211  -0.4424  0.6582\n#&gt; factor(smoke)Current Smoker  0.0182  0.1574   0.1157  0.9079\n#&gt; Assoct                      -0.9124  0.0507 -17.9923 &lt;0.0001\n#&gt; log(xi.1)                    0.5680  0.3779   1.5029        \n#&gt; log(xi.2)                    1.3103  0.3592   3.6477        \n#&gt; log(xi.3)                    1.5893  0.3560   4.4643        \n#&gt; log(xi.4)                    1.7405  0.3513   4.9541        \n#&gt; log(xi.5)                    1.9391  0.3522   5.5054        \n#&gt; log(xi.6)                    2.1029  0.3511   5.9899        \n#&gt; log(xi.7)                    2.1715  0.3459   6.2779        \n#&gt; \n#&gt; Integration:\n#&gt; method: (pseudo) adaptive Gauss-Hermite\n#&gt; quadrature points: 3 \n#&gt; \n#&gt; Optimization:\n#&gt; Convergence: 0"
  },
  {
    "objectID": "03_model_selection.html#trying-stratified-baseline-hazard",
    "href": "03_model_selection.html#trying-stratified-baseline-hazard",
    "title": "\n3  Model selection\n",
    "section": "\n3.6 Trying stratified baseline hazard",
    "text": "3.6 Trying stratified baseline hazard\n\nOne is to include the other covariates (or multiple covariates) as regression terms for the hazard function.\nAlternatively, if the covariates we are adjusting for is categorical with a small number of levels \\(G\\), we may construct a stratified log-rank test.\n\nIf we stratify on event with strata() we get estimates of the effect of the covariates on events under the assumption that they affect both groups equally.\n\nCode# surv.fit1 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n#                       factor(site) + factor(ethnic) + factor(smoke),\n#                     data = swan_amh1, \n#                     x = TRUE,\n#                     model = TRUE)\n\nsurv.fit2 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +\n                     strata(site) + strata(ethnic) + strata(smoke),\n                   data = swan_amh1,\n                   x = TRUE,\n                   model = TRUE)\n\n# anova(surv.fit1, surv.fit2)\n\n## joint model fit\njoint.fit2 &lt;- jointModel(lme.fit1,\n                         surv.fit2,\n                         timeVar = \"time\",\n                         method = \"piecewise-PH-aGH\")\n# summary(joint.fit2)\n\n\n### only smoke as a strata\nsurv.fit3 &lt;- coxph(Surv(etime, event) ~ married + bc_pills  + bmi  +\n                     strata(smoke) ,\n                  data = swan_amh1,\n                  x = TRUE,\n                  model = TRUE)\n# summary(surv.fit3)\n\n## joint model fit\njoint.fit3 &lt;- jointModel(lme.fit1, \n                         surv.fit3,\n                         timeVar = \"time\",\n                         method = \"piecewise-PH-aGH\")\n\n\n\n3.6.1 Summary for Survival sub-models\n\nCodesurv.fit2\n\n#&gt; Call:\n#&gt; coxph(formula = Surv(etime, event) ~ married + bc_pills + bmi + \n#&gt;     strata(site) + strata(ethnic) + strata(smoke), data = swan_amh1, \n#&gt;     model = TRUE, x = TRUE)\n#&gt; \n#&gt;                                coef exp(coef)  se(coef)      z      p\n#&gt; marriedMarried/Partnered   0.193505  1.213495  0.105891  1.827 0.0676\n#&gt; bc_pillsEver use BC pills -0.263812  0.768118  0.108311 -2.436 0.0149\n#&gt; bmi                       -0.009317  0.990726  0.007385 -1.262 0.2071\n#&gt; \n#&gt; Likelihood ratio test=11.22  on 3 df, p=0.01058\n#&gt; n= 600, number of events= 600\n\nCodesummary(joint.fit2)[[2]]\n\n#&gt;                                 Value     Std.Err     z-value      p-value\n#&gt; marriedMarried/Partnered   0.10653622 0.106343402   1.0018132 3.164338e-01\n#&gt; bc_pillsEver use BC pills  0.03254861 0.110711120   0.2939958 7.687611e-01\n#&gt; bmi                       -0.05699208 0.007519614  -7.5791230 3.478986e-14\n#&gt; Assoct                    -0.90227544 0.048728325 -18.5164470 1.521530e-76\n#&gt; log(xi.1)                  0.90947411 0.325786841   2.7916232 5.244439e-03\n#&gt; log(xi.2)                  1.64843965 0.308169879   5.3491264 8.837978e-08\n#&gt; log(xi.3)                  1.91466278 0.305316339   6.2710787 3.585554e-10\n#&gt; log(xi.4)                  2.06507118 0.302787502   6.8201995 9.091415e-12\n#&gt; log(xi.5)                  2.24995839 0.306371473   7.3438900 2.074737e-13\n#&gt; log(xi.6)                  2.40716838 0.304598942   7.9027470 2.728229e-15\n#&gt; log(xi.7)                  2.45377514 0.307136142   7.9892100 1.358062e-15\n\n\n\nCodesurv.fit3\n\n#&gt; Call:\n#&gt; coxph(formula = Surv(etime, event) ~ married + bc_pills + bmi + \n#&gt;     strata(smoke), data = swan_amh1, model = TRUE, x = TRUE)\n#&gt; \n#&gt;                                coef exp(coef)  se(coef)      z      p\n#&gt; marriedMarried/Partnered   0.211912  1.236039  0.093244  2.273 0.0230\n#&gt; bc_pillsEver use BC pills -0.236141  0.789670  0.095720 -2.467 0.0136\n#&gt; bmi                       -0.005804  0.994212  0.006085 -0.954 0.3401\n#&gt; \n#&gt; Likelihood ratio test=13.45  on 3 df, p=0.003752\n#&gt; n= 600, number of events= 600\n\nCodesummary(joint.fit3)[[2]]\n\n#&gt;                                 Value     Std.Err     z-value      p-value\n#&gt; marriedMarried/Partnered   0.10653622 0.106343402   1.0018132 3.164338e-01\n#&gt; bc_pillsEver use BC pills  0.03254861 0.110711120   0.2939958 7.687611e-01\n#&gt; bmi                       -0.05699208 0.007519614  -7.5791230 3.478986e-14\n#&gt; Assoct                    -0.90227544 0.048728325 -18.5164470 1.521530e-76\n#&gt; log(xi.1)                  0.90947411 0.325786841   2.7916232 5.244439e-03\n#&gt; log(xi.2)                  1.64843965 0.308169879   5.3491264 8.837978e-08\n#&gt; log(xi.3)                  1.91466278 0.305316339   6.2710787 3.585554e-10\n#&gt; log(xi.4)                  2.06507118 0.302787502   6.8201995 9.091415e-12\n#&gt; log(xi.5)                  2.24995839 0.306371473   7.3438900 2.074737e-13\n#&gt; log(xi.6)                  2.40716838 0.304598942   7.9027470 2.728229e-15\n#&gt; log(xi.7)                  2.45377514 0.307136142   7.9892100 1.358062e-15\n\n\n\n3.6.2 Checking Stratification\n\nCodesurvdiff(Surv(etime, event) ~ bc_pills, data = swan_amh1)\n\n#&gt; Call:\n#&gt; survdiff(formula = Surv(etime, event) ~ bc_pills, data = swan_amh1)\n#&gt; \n#&gt;                              N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; bc_pills=Never             155      155      137     2.361      3.09\n#&gt; bc_pills=Ever use BC pills 445      445      463     0.699      3.09\n#&gt; \n#&gt;  Chisq= 3.1  on 1 degrees of freedom, p= 0.08\n\nCodesurvdiff(Surv(etime, event) ~ bc_pills + strata(site) + strata(ethnic) + strata(smoke),\n         data = swan_amh1)\n\n#&gt; Call:\n#&gt; survdiff(formula = Surv(etime, event) ~ bc_pills + strata(site) + \n#&gt;     strata(ethnic) + strata(smoke), data = swan_amh1)\n#&gt; \n#&gt;                              N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; bc_pills=Never             155      155      134     3.165      5.33\n#&gt; bc_pills=Ever use BC pills 445      445      466     0.913      5.33\n#&gt; \n#&gt;  Chisq= 5.3  on 1 degrees of freedom, p= 0.02\n\nCodesurvdiff(Surv(etime, event) ~ married, data = swan_amh1)\n\n#&gt; Call:\n#&gt; survdiff(formula = Surv(etime, event) ~ married, data = swan_amh1)\n#&gt; \n#&gt;                                 N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; married=Not Married/Partnered 191      191      218      3.29       5.3\n#&gt; married=Married/Partnered     409      409      382      1.87       5.3\n#&gt; \n#&gt;  Chisq= 5.3  on 1 degrees of freedom, p= 0.02\n\nCodesurvdiff(Surv(etime, event) ~ married + strata(site) + strata(ethnic) + strata(smoke),\n         data = swan_amh1)\n\n#&gt; Call:\n#&gt; survdiff(formula = Surv(etime, event) ~ married + strata(site) + \n#&gt;     strata(ethnic) + strata(smoke), data = swan_amh1)\n#&gt; \n#&gt;                                 N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; married=Not Married/Partnered 191      191      211      1.85      4.03\n#&gt; married=Married/Partnered     409      409      389      1.00      4.03\n#&gt; \n#&gt;  Chisq= 4  on 1 degrees of freedom, p= 0.04\n\n\n\nCodetidy(surv.fit1) \n\n\n\n  \n\n\nCodetidy(surv.fit2) \n\n\n\n  \n\n\nCodetidy(surv.fit3)"
  },
  {
    "objectID": "03_model_selection.html#obtaining-dynamic-predictions",
    "href": "03_model_selection.html#obtaining-dynamic-predictions",
    "title": "\n3  Model selection\n",
    "section": "\n3.7 Obtaining dynamic predictions",
    "text": "3.7 Obtaining dynamic predictions\nThis function accepts as main arguments a fitted joint model and a data frame that contains the longitudinal and covariate information for the subjects for which we wish to calculate the predicted survival probabilities.\n\nCodeids &lt;- unique(swan_amh0$id)\n## length(ids)\n## Prediction for the survival outcomes\nND1 &lt;- swan_amh0[swan_amh0$id == ids[8], ] ## 4, 5, 7 (not so good)\nsfit &lt;- JM::survfitJM(joint.fit3,\n                      newdata = ND1, \n                      idVar = \"id\") \n\n\n\nCodeND1\n\n\n\n  \n\n\nCode# subset(ND1, \n#        select = c('id', 'age0', 'time', \n#                   'start_time', \n#                   'etime', 'amh'))\n#                   \n\nsfit$summaries$`1100390` %&gt;% as.data.frame()\n\n\n\n  \n\n\nCodeid1100390 &lt;- filter(swan_amh0, id == ids[5]) %&gt;%\n  dplyr::select(etime, lamh)\n\n\n\nCodeplot(sfit, estimator = \"mean\", \n     include.y = TRUE, \n     conf.int = TRUE, \n     fill.area = TRUE,\n     col.area = \"lightgrey\")\n\n\n\n\n\n3.7.1 AUC and ROC\nI can only pullout the AUC for certain models, not all of them. The ROC function gets problems too. There is also on function for Brier Score in JM package.\n\nCode## Tstart is the time up which long measurements are used in the predictions\n## Dt = is the window of time that will be considered for predictions;\n## discrimination is calculated based on this window\nauc2.t3 &lt;- try(JM::aucJM(joint.fit2,\n                     newdata = swan_amh0,\n                     idVar = \"id\",\n                     Tstart = 5,\n                     Dt = 3))\n\n#&gt; Error in eval(attr(TermsT, \"variables\"), data.id)[[kk]] : \n#&gt;   recursive indexing failed at level 2\n\nCodeauc2.t3\n\n#&gt; [1] \"Error in eval(attr(TermsT, \\\"variables\\\"), data.id)[[kk]] : \\n  recursive indexing failed at level 2\\n\\n\"\n#&gt; attr(,\"class\")\n#&gt; [1] \"try-error\"\n#&gt; attr(,\"condition\")\n#&gt; &lt;simpleError in eval(attr(TermsT, \"variables\"), data.id)[[kk]]: recursive indexing failed at level 2\n#&gt; &gt;\n\nCodeauc1 &lt;- JM::aucJM(joint.fit3,\n                  newdata = swan_amh0,\n                  idVar = \"id\",\n                  Tstart = 5,\n                  Dt = 3) ##\n\nauc2 &lt;- try(JM::aucJM(joint.fit3, \n                  newdata = swan_amh0,\n                  idVar = \"id\",\n                  Tstart = 5,\n                  Dt = 3)) \nauc2\n\n#&gt; \n#&gt;  Time-dependent AUC for the Cox Model joint.fit3\n#&gt; \n#&gt; Estimated AUC: 0.8774\n#&gt; At time: 8\n#&gt; Using information up to time: 5 (407 subjects still at risk)"
  },
  {
    "objectID": "03_model_selection.html#time-dependent-slopes-parameterization",
    "href": "03_model_selection.html#time-dependent-slopes-parameterization",
    "title": "\n3  Model selection\n",
    "section": "\n3.8 Time-Dependent Slopes Parameterization",
    "text": "3.8 Time-Dependent Slopes Parameterization\nHowever, since for each patient the marker follows a trajectory in time, it is also reasonable to consider parameterizations that allow the risk for an event to also depend on other features of this trajectory. A parameterization of this type has been considered by Ye et al. (2008b) who postulated a joint model in which the risk depends on both the current true value of the trajectory and the slope of the true trajectory at time t.\n\\[\n\\begin{split}\n  h_i(t) & = h_0(t) \\exp\\{\\gamma^{\\top}w_i + \\alpha_1 m_i(t) + \\alpha_2 m'_i(t)\\}\\\\\n  m'_i(t) & = \\frac {d} {dt} m_i(t) = \\frac {d} {dt} \\{ x^{\\top}_i (t) \\beta + z_i^{\\top} (t) b_i \\}\\\\\n  m'_i(t) & = [x_i^{slope}(t)]^{\\top} \\beta^{slope} + [z_i^{slope}(t)]^{\\top} b_i^{slope}\n\\end{split}\n\\]\n\nIncluding the interaction term in the cox-model for \\(m_i\\)\n\nThe time variable needs to be nonlinear for the longitudinal data\n\nso I included the I(time^2) term in the lme model\n\n\n\n\nCodecontrol &lt;- lmeControl(opt = \"optim\")\n\nlme.fit2 &lt;- lme(lamh ~ time + I(time^2), \n                data = swan_amh0, \n                control = control,\n                random = ~ time| id)\n\nlme.fit3 &lt;- lme(lamh ~ time + I(time^2), \n                data = swan_amh0, \n                control = control,\n                random = ~ time + I(time^2) | id)\n\nrbind(glance(lme.fit1), \n      glance(lme.fit2), \n      glance(lme.fit3))\n\n\n\n  \n\n\n\n\nCodejm.fit21 &lt;- jointModel(lme.fit2,\n                       surv.fit1,\n                       timeVar = \"time\",\n                       method = \"piecewise-PH-aGH\")\n\njm.fit31 &lt;- jointModel(lme.fit3,\n                       surv.fit1,\n                       timeVar = \"time\",\n                       method = \"piecewise-PH-aGH\")\n\n# jm.fit22 &lt;- jointModel(lme.fit2,\n#                        surv.fit2,\n#                        timeVar = \"time\",\n#                        # interFact = list(value = ~ age,\n#                        #                  ##  a named list with a component named value\n#                        #                  ##  that provides an R formula specifying the\n#                        #                  ##  form of the W2 design matrix\n#                        #                  data = swan_amh1),\n#                        method = \"piecewise-PH-aGH\")\n\n# jm.fit32 &lt;- jointModel(lme.fit3,\n#                        surv.fit2,\n#                        timeVar = \"time\",\n#                        method = \"piecewise-PH-aGH\")\n\n\n\nCode# model.matrix(lamh ~ time + I(time^2), \n#                 data = swan_amh0)\ndform2 &lt;- list(fixed = ~ I(2 * time),\n              ## the 2nd and 3rd fixed effects of mi(t) used\n              indFixed = 2:3, \n              random = ~ 1, \n              ## the second random effect of mi(t)\n              indRandom = 2)\ndform3 &lt;- list(fixed = ~ I(2 * time),\n              ## the 2nd and 3rd fixed effects of mi(t) used\n              indFixed = 2:3, \n              random = ~ I(2 * time), \n              ## the second and third random effect of mi(t)\n              indRandom = 2:3)\n\n\nWarning: Stop time must be &gt; start time, NA created\n\nCodejm.fit21d &lt;- update(jm.fit21,\n                    parameterization = \"both\",\n                    derivForm = dform2)\n\njm.fit31d &lt;- update(jm.fit31,\n                    parameterization = \"both\",\n                    derivForm = dform3)\n\n\n\n3.8.1 Here is the summarization of the models\n\\(lme.fit2 \\sim (fixed = lamh \\sim time + I(time^2), \\ random = \\sim time| id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jm.fit21d)\n\n#&gt; Warning in sqrt(diag(VarCov[indY, indY])): NaNs produced\n\n\n#&gt; Warning in sqrt(diag(VarCov[indT, indT])): NaNs produced\n\n\n#&gt; \n#&gt; Call:\n#&gt; jointModel(lmeObject = lme.fit2, survObject = surv.fit1, timeVar = \"time\", \n#&gt;     parameterization = \"both\", method = \"piecewise-PH-aGH\", derivForm = dform2)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of Groups: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with piecewise-constant\n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent + time-dependent slope \n#&gt; \n#&gt;    log.Lik      AIC      BIC\n#&gt;  -7313.277 14688.55 14824.86\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr\n#&gt; (Intercept)  1.2758  (Intr)\n#&gt; time         0.0612  0.8267\n#&gt; Residual     1.2815        \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err z-value p-value\n#&gt; (Intercept)  7.5380     NaN     NaN     NaN\n#&gt; time        -0.4435     NaN     NaN     NaN\n#&gt; I(time^2)   -0.0110     NaN     NaN     NaN\n#&gt; \n#&gt; Event Process\n#&gt;                               Value Std.Err z-value p-value\n#&gt; marriedMarried/Partnered     0.0748  0.1117  0.6693  0.5033\n#&gt; bc_pillsEver use BC pills    0.0672  0.1223  0.5494  0.5827\n#&gt; bmi                         -0.0495  0.0084 -5.8599 &lt;0.0001\n#&gt; factor(site)C                0.2083  0.1960  1.0630  0.2878\n#&gt; factor(site)M                0.1350  0.1828  0.7384  0.4603\n#&gt; factor(site)NJ               0.7308  0.4293  1.7024  0.0887\n#&gt; factor(site)P                0.4094  0.1985  2.0622  0.0392\n#&gt; factor(site)UCD             -0.0522  0.2344 -0.2227  0.8238\n#&gt; factor(site)UCLA             0.1448  0.2507  0.5775  0.5636\n#&gt; factor(ethnic)BLACK         -0.3604  0.1445 -2.4933  0.0127\n#&gt; factor(ethnic)CHINE         -0.2401  0.2495 -0.9625  0.3358\n#&gt; factor(ethnic)HISPA         -1.6574  0.5114 -3.2410  0.0012\n#&gt; factor(ethnic)JAPAN          0.0151  0.2420  0.0624  0.9502\n#&gt; factor(smoke)Past Only      -0.1135  0.1261 -0.9001  0.3681\n#&gt; factor(smoke)Current Smoker -0.0519  0.1623 -0.3199  0.7490\n#&gt; Assoct                      -1.2355     NaN     NaN     NaN\n#&gt; Assoct.s                    12.8634     NaN     NaN     NaN\n#&gt; log(xi.1)                    9.7435     NaN     NaN        \n#&gt; log(xi.2)                   10.5641     NaN     NaN        \n#&gt; log(xi.3)                   10.8616     NaN     NaN        \n#&gt; log(xi.4)                   11.0145     NaN     NaN        \n#&gt; log(xi.5)                   11.2383     NaN     NaN        \n#&gt; log(xi.6)                   11.4215     NaN     NaN        \n#&gt; log(xi.7)                   11.4962     NaN     NaN        \n#&gt; \n#&gt; Integration:\n#&gt; method: (pseudo) adaptive Gauss-Hermite\n#&gt; quadrature points: 3 \n#&gt; \n#&gt; Optimization:\n#&gt; Convergence: 0\n\n\n\\(lme.fit3 \\sim (fixed = lamh \\sim time + I(time^2), \\ random = \\sim time + I(time^2)| id)\\)\n\\(surv.fit1 \\sim coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\n\nCodesummary(jm.fit31d)\n\n#&gt; \n#&gt; Call:\n#&gt; jointModel(lmeObject = lme.fit3, survObject = surv.fit1, timeVar = \"time\", \n#&gt;     parameterization = \"both\", method = \"piecewise-PH-aGH\", derivForm = dform3)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Longitudinal Process     Event Process\n#&gt; Number of Observations: 3326 Number of Events: 600 (100%)\n#&gt; Number of Groups: 600\n#&gt; \n#&gt; Joint Model Summary:\n#&gt; Longitudinal Process: Linear mixed-effects model\n#&gt; Event Process: Relative risk model with piecewise-constant\n#&gt;      baseline risk function\n#&gt; Parameterization: Time-dependent + time-dependent slope \n#&gt; \n#&gt;   log.Lik      AIC      BIC\n#&gt;  -6783.88 13635.76 13785.26\n#&gt; \n#&gt; Variance Components:\n#&gt;              StdDev    Corr        \n#&gt; (Intercept)  1.1617  (Intr)    time\n#&gt; time         0.1238  0.9994        \n#&gt; I(time^2)    0.0130 -0.7498 -0.7416\n#&gt; Residual     1.1466                \n#&gt; \n#&gt; Coefficients:\n#&gt; Longitudinal Process\n#&gt;               Value Std.Err  z-value p-value\n#&gt; (Intercept)  6.6209  0.0963  68.7421 &lt;0.0001\n#&gt; time        -0.2108  0.0283  -7.4516 &lt;0.0001\n#&gt; I(time^2)   -0.0246  0.0019 -12.6315 &lt;0.0001\n#&gt; \n#&gt; Event Process\n#&gt;                               Value Std.Err  z-value p-value\n#&gt; marriedMarried/Partnered     0.0270  0.1014   0.2666  0.7898\n#&gt; bc_pillsEver use BC pills   -0.0006  0.1089  -0.0054  0.9957\n#&gt; bmi                         -0.0366  0.0077  -4.7461 &lt;0.0001\n#&gt; factor(site)C                0.2269  0.1648   1.3763  0.1687\n#&gt; factor(site)M                0.2557  0.1561   1.6379  0.1014\n#&gt; factor(site)NJ               0.7520  0.5967   1.2604  0.2075\n#&gt; factor(site)P                0.4415  0.1709   2.5829  0.0098\n#&gt; factor(site)UCD              0.0548  0.2054   0.2668  0.7896\n#&gt; factor(site)UCLA             0.4208  0.2106   1.9977  0.0458\n#&gt; factor(ethnic)BLACK         -0.3204  0.1236  -2.5912  0.0096\n#&gt; factor(ethnic)CHINE         -0.0400  0.2277  -0.1756  0.8606\n#&gt; factor(ethnic)HISPA         -0.7663  0.6588  -1.1633  0.2447\n#&gt; factor(ethnic)JAPAN         -0.0896  0.2092  -0.4281  0.6686\n#&gt; factor(smoke)Past Only      -0.0870  0.1110  -0.7839  0.4331\n#&gt; factor(smoke)Current Smoker  0.1030  0.1460   0.7056  0.4804\n#&gt; Assoct                      -0.7625  0.0384 -19.8831 &lt;0.0001\n#&gt; Assoct.s                     0.0229  0.2824   0.0813  0.9352\n#&gt; log(xi.1)                   -0.0747  0.3832  -0.1950        \n#&gt; log(xi.2)                    0.7755  0.3914   1.9815        \n#&gt; log(xi.3)                    0.9411  0.4012   2.3455        \n#&gt; log(xi.4)                    0.9791  0.4057   2.4136        \n#&gt; log(xi.5)                    1.0988  0.4138   2.6554        \n#&gt; log(xi.6)                    1.2005  0.4169   2.8797        \n#&gt; log(xi.7)                    1.2286  0.4203   2.9232        \n#&gt; \n#&gt; Integration:\n#&gt; method: (pseudo) adaptive Gauss-Hermite\n#&gt; quadrature points: 3 \n#&gt; \n#&gt; Optimization:\n#&gt; Convergence: 0\n\n\nThe model with slope term is better than the model without slope term\n\n3.8.2 Comparision for jm.fit21 and jm.fit21d\n\nCodeanova(jm.fit21, jm.fit21d, process = \"Event\")\n\n#&gt; \n#&gt;                AIC      BIC  log.Lik    LRT df p.value\n#&gt; jm.fit21  14865.88 14997.78 -7402.94                  \n#&gt; jm.fit21d 14688.55 14824.86 -7313.28 179.32  1 &lt;0.0001\n\n\n\n3.8.3 Comparision for jm.fit31 and jm.fit31d\n\nCodeanova(jm.fit31, jm.fit31d, process = \"Event\")\n\n#&gt; \n#&gt;                AIC      BIC  log.Lik  LRT df p.value\n#&gt; jm.fit31  13636.58 13781.68 -6785.29                \n#&gt; jm.fit31d 13635.76 13785.26 -6783.88 2.82  1  0.0929\n\n\n\n3.8.4 Comparision for jm.fit21d and jm.fit31d\n\nCodeanova(jm.fit21d, jm.fit31d)\n\n#&gt; \n#&gt;                AIC      BIC  log.Lik     LRT df p.value\n#&gt; jm.fit21d 14688.55 14824.86 -7313.28                   \n#&gt; jm.fit31d 13635.76 13785.26 -6783.88 1058.79  3 &lt;0.0001"
  },
  {
    "objectID": "08_rate_auc.html#goal-of-the-analysis",
    "href": "08_rate_auc.html#goal-of-the-analysis",
    "title": "\n8  Rate model\n",
    "section": "\n8.1 Goal of the analysis",
    "text": "8.1 Goal of the analysis\n\nFit the joint model including rate with JMbayes2 based on model selection results\nDynamic prediction for the joint model with plots\nCalculate the AUC and ROC for the joint model"
  },
  {
    "objectID": "08_rate_auc.html#fit-the-joint-model",
    "href": "08_rate_auc.html#fit-the-joint-model",
    "title": "\n8  Rate model\n",
    "section": "\n8.2 Fit the joint model",
    "text": "8.2 Fit the joint model\nHere is the joint model with JMbayes2, the name of the model is set up as package + [fit] + lme_number + surv_number + functional\n\nCodeload(\"data-raw/swan_amh_jmbayes2_fit116.RData\")\n\n\n\nCodejmcontrol &lt;- list(n_iter = 5000, \n                  n_burnin = 1000, \n                  n_chains = 1,\n                  seed = 55555,\n                  cores = 1)\n\n\njmbayes2.fit116.d &lt;- JMbayes2::jm(Surv_object = surv.fit16,\n                                  Mixed_objects = lme.fit1, \n                                  functional_forms = list(\"lamh\" = ~ value(lamh) + slope(lamh)),\n                                  time_var = \"time\",\n                                  control = jmcontrol,\n                                  seed = 55555) \n                         \n\njmbayes2.fit116 &lt;- JMbayes2::jm(Surv_object = surv.fit16,\n                                  Mixed_objects = lme.fit1, \n                                  # functional_forms = list(\"lamh\" = ~ value(lamh) + slope(lamh)),\n                                  time_var = \"time\",\n                                  control = jmcontrol,\n                                  seed = 55555) \n\n\nThe model with rate is definitely better than the model without rate.\n\nCodecompare_jm(jmbayes2.fit116.d, jmbayes2.fit116)\n\n#&gt; \n#&gt;                         DIC     WAIC      LPML\n#&gt;  jmbayes2.fit116.d 14827.79 14888.48 -7504.700\n#&gt;    jmbayes2.fit116 14962.45 14972.47 -7499.795\n#&gt; \n#&gt; The criteria are calculated based on the marginal log-likelihood."
  },
  {
    "objectID": "08_rate_auc.html#checking-jm-package-to-confirme",
    "href": "08_rate_auc.html#checking-jm-package-to-confirme",
    "title": "\n8  Rate model\n",
    "section": "\n8.3 Checking JM package’ to confirme",
    "text": "8.3 Checking JM package’ to confirme\nThe results can be replicated with the JM package\n\nCodelibrary(JM)\n\ndform.116 &lt;- list(fixed = ~ 1,\n              ## the fixed effects of mi(t) used\n              indFixed = 2, \n              random = ~ 1, \n              ## the second random effect of mi(t)\n              indRandom = 2)\n\njm.fit116.d &lt;- JM::jointModel(lme.fit1,\n                       surv.fit16,\n                       timeVar = \"time\",\n                       parameterization = \"both\",\n                       derivForm = dform.116,\n                       method = \"piecewise-PH-aGH\")\n\njm.fit116 &lt;- JM::jointModel(lme.fit1,\n                       surv.fit16,\n                       timeVar = \"time\",\n                       # parameterization = \"both\",\n                       method = \"piecewise-PH-aGH\")\n\n\n\nCodeanova(jm.fit116, jm.fit116.d)\n\n#&gt; Warning in anova.jointModel(jm.fit116, jm.fit116.d): it seems that\n#&gt; 'jm.fit116.d' has not converged.\n\n\n#&gt; \n#&gt;                  AIC      BIC  log.Lik   LRT df p.value\n#&gt; jm.fit116   14727.88 14868.58 -7331.94                 \n#&gt; jm.fit116.d 14715.44 14860.54 -7324.72 14.44  1   1e-04\n\n\n\n8.3.1 Summary for the jmbayes.fit116.d\n\nFor the lme model:\n\nCodesummary(jmbayes2.fit116.d)$Outcome1 \n\n\n\n  \n\n\n\nFor the surv model:\n\nCodesummary(jmbayes2.fit116.d)$Survival"
  },
  {
    "objectID": "08_rate_auc.html#dynamic-prediction",
    "href": "08_rate_auc.html#dynamic-prediction",
    "title": "\n8  Rate model\n",
    "section": "\n8.4 Dynamic prediction",
    "text": "8.4 Dynamic prediction\n\n8.4.1 Individual prediction plots\n\nCode#' Title Dynamic prediction plot for individual\n#'\n#' @param id_num individual id number in the list\n#' @param tmin the start time\n#' @param tmax the end time\n#' @param jmfit the joint model objects\n#' @param ... \n#'\n#' @return a list of lme and surv predicts\n\ndpplot &lt;- function(id_num,\n                   tmin = 0,\n                   tmax = 12,\n                   jmfit = jmbayes2.fit116.d,\n                   ...){\n\n  # browser()\n  nid0 &lt;- swan_amh02[swan_amh02$id == ids[id_num], ]\n  \n  nid &lt;- nid0\n  nid &lt;- nid[nid$time &lt; tmin, ]\n  nid$event &lt;- 0\n  nid$etime &lt;- tmin\n  \n  Lpred &lt;- predict(jmfit, \n                    newdata = nid,\n                   times = seq(tmin, tmax, length.out = 11),\n                    return_newdata = TRUE)\n  Spred &lt;- predict(jmfit, \n                 newdata = nid,\n                 times = seq(tmin, tmax, length.out = 11),\n                 process = \"event\",\n                 return_newdata = TRUE)\n  \n  plot(Lpred, Spred, ylab_long = paste0(\"ID_\", id_num, \"  log(amh)\"))\n  \n  return(list(Lpred = Lpred,\n              Spred = Spred,\n              nid0 = nid0,\n              nid = nid))\n}\n\n\nSome of the very steep trajectory for the risk function: id5, id26, id56, id333, id342;\n\nCodeids &lt;- unique(swan_amh02$id)\n\ndpplot_id5 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 5,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116.d))\n\ndpplot_id26 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 26,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116.d))\n\ndpplot_id333 &lt;- map(c(4, 8),\n               ~dpplot(id_num = 333,\n                       tmin = .x,\n                       tmax = 12,\n                       jmfit = jmbayes2.fit116.d))\n\n\n\n\n\nid5_t4\n\n\n\n\n\nid5_t8\n\n\n\n\n\n\n\nid26_t4\n\n\n\n\n\nid26_t8\n\n\n\n\n\n\n\nid333_t4\n\n\n\n\n\nid333_t8\n\n\n\n\n\nThe dynamic prediction for high risk individuals\n\n\n\n\nSome of the smooth trajectory for the risk function: id32, id57, id89, id222,id44, id371;\n\nCodedpplot_id32 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 57,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116.d))\n\ndpplot_id371 &lt;- map(c(4, 8), \n               ~dpplot(id_num = 371,\n                       tmin = .x, \n                       tmax = 12, \n                       jmfit = jmbayes2.fit116.d))\n\ndpplot_id44 &lt;- map(c(4, 8),\n               ~dpplot(id_num = 44,\n                       tmin = .x,\n                       tmax = 12,\n                       jmfit = jmbayes2.fit116.d))\n\n\n\n\n\nid32_t4\n\n\n\n\n\nid32_t8\n\n\n\n\n\n\n\nid371_t4\n\n\n\n\n\nid371_t8\n\n\n\n\n\n\n\nid44_t4\n\n\n\n\n\nid44_t8\n\n\n\n\n\nThe dynamic prediction for low risk individuals\n\n\n\n\n\n8.4.2 AUC\nFor JMbayes2, the function tvAUC() is used to estimate the time-dependent AUC only for all the subjects (there is no function for individual AUC).\n\nCodeAUC2  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 2,\n                          Dt = 2))\n\nAUC4  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 4,\n                          Dt = 2))\n\nAUC6  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 6,\n                          Dt = 2))\n\nAUC8  &lt;- try(JMbayes2::tvAUC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 8,\n                          Dt = 2))\n\n\nHere is the table for the AUC result, using the same joint model for the dynamic prediction. Each AUC for a different time point and time window as 2.\nThe AUC score are calculated for the time points 2, 4, 6, and 8. It seems the best AUC score is at time 4, and the AUC score decreases as the time window increases. Based on the plots for individuals, some of the plot are missing, because there is no longitudinal data before the Tstart.\n\nCodecbind(Tstart = map(list(AUC2, AUC4, AUC6, AUC8),\n                   \"Tstart\") %&gt;% unlist(),\n      Tend = map(list(AUC2, AUC4, AUC6, AUC8), \n                 \"Thoriz\") %&gt;% unlist() %&gt;% round(0),\n      AUC = map(list(AUC2, AUC4, AUC6, AUC8), \n                \"auc\") %&gt;% unlist()) %&gt;% \n  as.data.frame()\n\n\n\n  \n\n\n\n\n8.4.3 ROC\nROC can be calculated based on both individual or all subjects. Here are the results for the ROC for all subject predictions.\nThe ROC results is consistent with the AUC results, the best ROC is at time 4, and the ROC score decreases as the Tstart increases.\n\nCodeROC2 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 2,\n                          Dt = 2))\n\nROC4 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 4,\n                          Dt = 2))\n\nROC6 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 6,\n                          Dt = 2))\n\nROC8 &lt;- try(JMbayes2::tvROC(jmbayes2.fit116.d,\n                          swan_amh02,\n                          Tstart = 8,\n                          Dt = 2))\n\nplot(ROC2, ylab = \"Tstart_2 Sensitivity\")\n\n\n\nCodeplot(ROC4, ylab = \"Tstart_4 Sensitivity\")\n\n\n\nCodeplot(ROC6, ylab = \"Tstart_6 Sensitivity\")\n\n\n\nCodeplot(ROC8, ylab = \"Tstart_8 Sensitivity\", optimal_cutoff = \"Youden\")\n\n\n\n\n\n8.4.4 Brier Score\nThe Brier score is also working for a whole dataset but not for individual subjects. Here is the Brier score for the time points 2 and 8, with 2 as the prediction window.\na data.frame that contains the longitudinal and covariate information for\nthe subjects for which prediction of survival probabilities is required.\nThe names of the variables in this data.frame must be the same as \nin the data.frames that were used to fit the linear mixed effects and \nthe event process model that were supplied as the two first argument of jm.\nWarning: there are fewer than 5 subjects with an event in the interval [4.000001, 12).\nThe Brier score (BS) is calculated using the following formula:\n\\(BrierScore = (f_t - o_t)^2\\)\n\\(f_t\\) represents the percentage response from the clinician, \\(o_t\\) represents the outcome of the patient (0 = did not occur, 1 = did occur).\nThe Brier score takes in to account the outcome of the event predicted as well as the estimate.\nBrier scores range between \\(0\\) and \\(1\\): - A score of 0 represents perfect accuracy - A score of 1 represents perfect inaccuracy.\nIf a participant predicted a 70% probability of dying within 72 hours, and the patient did in fact die within that timescale, then they would have a Brier score of \\((0.70-1)^2 = 0.09\\). In this example, the outcome event occurred (coded as 1), and is deducted from the percentage probability; the result is then squared. The low Brier score indicates that this prediction was relatively accurate.\nIf, in contrast, the participant predicted an 80% probability of dying within 72 hours, and the patient did not in fact die within that timeframe, then they would have scored \\((0.80-0)^2 = 0.64\\). In this case the outcome event did not occur (coded as 0), and is deducted from the percentage probability; the result is squared. The high Brier score indicates that this prediction was relatively inaccurate.\nFinally, if the participant had predicted a 50% probability of dying within 72 hours then regardless of whether or not the patient died, the Brier score would be \\((0.50-0)^2 = 0.25\\) or \\((0.50-1)^2 = 0.25\\). In each case a Brier score of 0.25 indicates a random guess.\nThe integrated Brier score for a time interval is the average of the score values for the interval, which is the area under a curve that plots the score against the follow-up time divided by the length of the time interval.\n\nCodeBS2 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116.d,\n                          newdata = swan_amh02,\n                          Tstart = 2,\n                          Dt = 2))\n\n#&gt; Warning in br(Thoriz): there are fewer than 5 subjects with an event in the interval [2.000001, 4).\n\nCodeBS4 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116.d,\n                          newdata = swan_amh02,\n                          Tstart = 4,\n                          Dt = 2))\n\nBS6 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116.d,\n                          newdata = swan_amh02,\n                          Tstart = 6,\n                          Dt = 2))\n\nBS8 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116.d,\n                          newdata = swan_amh02,\n                          Tstart = 8,\n                          Dt = 2))\n\n\n\nCodecbind(Tstart = map(list(BS2, BS4, BS6, BS8),\n                   \"Tstart\") %&gt;% unlist() %&gt;% round(0),\n      Tend = map(list(BS2, BS4, BS6, BS8), \n                 \"Thoriz\") %&gt;% unlist() %&gt;% round(0),\n      BS = map(list(BS2, BS4, BS6, BS8), \n                \"Brier\") %&gt;% unlist()) %&gt;% \n  as.data.frame()"
  },
  {
    "objectID": "07_auc_roc.html#brier-score",
    "href": "07_auc_roc.html#brier-score",
    "title": "\n7  AUC and ROC\n",
    "section": "\n7.4 Brier Score",
    "text": "7.4 Brier Score\n\nCodeBS2 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116,\n                          newdata = swan_amh02,\n                          Tstart = 2,\n                          Dt = 2))\n\n#&gt; Warning in br(Thoriz): there are fewer than 5 subjects with an event in the interval [2.000001, 4).\n\nCodeBS4 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116,\n                          newdata = swan_amh02,\n                          Tstart = 4,\n                          Dt = 2))\n\nBS6 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116,\n                          newdata = swan_amh02,\n                          Tstart = 6,\n                          Dt = 2))\n\nBS8 &lt;- try(JMbayes2::tvBrier(jmbayes2.fit116,\n                          newdata = swan_amh02,\n                          Tstart = 8,\n                          Dt = 2))\n\n\n\nCodecbind(Tstart = map(list(BS2, BS4, BS6, BS8),\n                   \"Tstart\") %&gt;% unlist() %&gt;% round(0),\n      Tend = map(list(BS2, BS4, BS6, BS8), \n                 \"Thoriz\") %&gt;% unlist() %&gt;% round(0),\n      BS = map(list(BS2, BS4, BS6, BS8), \n                \"Brier\") %&gt;% unlist()) %&gt;% \n  as.data.frame()"
  },
  {
    "objectID": "09_table1_publication.html#to-do-list",
    "href": "09_table1_publication.html#to-do-list",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.1 To-do-list",
    "text": "9.1 To-do-list\n\n\nrun table 1 for the total sample size as 1 group\n\nKeeping table1 for one group (n = 600)\nBaseline levels of AMH (untransformed)\nalso include the min and max of AMH\nHow many repeated measures per woman\n\n\nall the survival parameters summary\nall the longitudinal parameters summary\n\njoint model summary\n\nwith rate\nwithout rate"
  },
  {
    "objectID": "09_table1_publication.html#table1-descriptive-summaries",
    "href": "09_table1_publication.html#table1-descriptive-summaries",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.2 Table1: descriptive summaries",
    "text": "9.2 Table1: descriptive summaries\nHere is the Table1 for publication.\n\n\n\n\n\n\nDescriptive Statistics for SWAN AMH Data\n\nCharacteristics\nN = 6001\n\n\n\nAge (years)\n\n\n\nMean (SD)\n46.42 (2.41)\n\n\nMedian [Range]\n46.00 [42.00, 53.00]\n\n\nEthnicity / Race\n\n\n\nCAUCA\n265 / 600 (44%)\n\n\nBLACK\n170 / 600 (28%)\n\n\nCHINE\n62 / 600 (10%)\n\n\nHISPA\n18 / 600 (3.0%)\n\n\nJAPAN\n85 / 600 (14%)\n\n\nMarital Status\n\n\n\nNot Married/Partnered\n191 / 600 (32%)\n\n\nMarried/Partnered\n409 / 600 (68%)\n\n\nAlcohol Use\n\n\n\nNone\n308 / 600 (51%)\n\n\n&lt;1/wk\n71 / 600 (12%)\n\n\n1-7/wk\n161 / 600 (27%)\n\n\n&gt;7/wk\n60 / 600 (10%)\n\n\nSmoking History\n\n\n\nNever Smoked\n373 / 600 (62%)\n\n\nPast Only\n149 / 600 (25%)\n\n\nCurrent Smoker\n78 / 600 (13%)\n\n\nEver use of BC Pills\n\n\n\nNever\n155 / 600 (26%)\n\n\nEver use BC pills\n445 / 600 (74%)\n\n\nBMI\n\n\n\nMean (SD)\n28 (7)\n\n\nMedian [Range]\n26 [16, 56]\n\n\nOverall Health\n\n\n\nExcellent\n147 / 600 (25%)\n\n\nVery Good\n233 / 600 (39%)\n\n\nGood\n151 / 600 (25%)\n\n\nFair/Poor\n69 / 600 (12%)\n\n\nPhysical Activity Score\n\n\n\nMean (SD)\n7.75 (1.77)\n\n\nMedian [Range]\n7.60 [3.40, 12.80]\n\n\nBaseline AMH\n\n\n\nMean (SD)\n540 (702)\n\n\nMedian [Range]\n273 [1, 4,652]\n\n\nNumber of Visits\n\n\n\nMean (SD)\n5.54 (2.14)\n\n\nMedian [Range]\n5.00 [3.00, 11.00]\n\n\nParity\n\n\n\nNone\n111 / 600 (19%)\n\n\nOne\n88 / 600 (15%)\n\n\nTwo\n210 / 600 (35%)\n\n\nThree\n116 / 600 (19%)\n\n\nMore than three\n75 / 600 (13%)\n\n\nChildren\n\n\n\nMean (SD)\n1.98 (1.41)\n\n\nMedian [Range]\n2.00 [0.00, 12.00]\n\n\nEmployment Status\n\n\n\nUnemployed\n104 / 600 (17%)\n\n\nEmployed\n496 / 600 (83%)\n\n\nEducational Attainment\n\n\n\nHigh School or Less\n125 / 600 (21%)\n\n\nSome College\n190 / 600 (32%)\n\n\nCollege degree or higher\n285 / 600 (48%)\n\n\nSite\n\n\n\nB\n96 / 600 (16%)\n\n\nC\n76 / 600 (13%)\n\n\nM\n103 / 600 (17%)\n\n\nNJ\n27 / 600 (4.5%)\n\n\nP\n74 / 600 (12%)\n\n\nUCD\n102 / 600 (17%)\n\n\nUCLA\n122 / 600 (20%)\n\n\n1n / N (%)\n\n\n\n\nHere is the LaTeX code for the table1.\n% latex table generated in R 4.2.2 by xtable 1.8-4 package\n% Tue Apr  9 11:44:18 2024\n\\begin{table}[ht]\n\\centering\n\\begin{tabular}{rll}\n  \\hline\n & **Characteristics** & **N = 600** \\\\ \n  \\hline\n1 & \\_\\_\\_Age (years)\\_\\_\\_ &  \\\\ \n  2 & Mean (SD) & 46.42 (2.41) \\\\ \n  3 & Median & 46.00 \\\\ \n  4 & [Range] & [42.00, 53.00] \\\\ \n  5 & \\_\\_\\_Ethnicity / Race\\_\\_\\_ &  \\\\ \n  6 & CAUCA & 265 / 600 (44\\%) \\\\ \n  7 & BLACK & 170 / 600 (28\\%) \\\\ \n  8 & CHINE & 62 / 600 (10\\%) \\\\ \n  9 & HISPA & 18 / 600 (3.0\\%) \\\\ \n  10 & JAPAN & 85 / 600 (14\\%) \\\\ \n  11 & \\_\\_\\_Marital Status\\_\\_\\_ &  \\\\ \n  12 & Not Married/Partnered & 191 / 600 (32\\%) \\\\ \n  13 & Married/Partnered & 409 / 600 (68\\%) \\\\ \n  14 & \\_\\_\\_Alcohol Use\\_\\_\\_ &  \\\\ \n  15 & None & 308 / 600 (51\\%) \\\\ \n  16 & $&lt;$1/wk & 71 / 600 (12\\%) \\\\ \n  17 & 1-7/wk & 161 / 600 (27\\%) \\\\ \n  18 & $&gt;$7/wk & 60 / 600 (10\\%) \\\\ \n  19 & \\_\\_\\_Smoking History\\_\\_\\_ &  \\\\ \n  20 & Never Smoked & 373 / 600 (62\\%) \\\\ \n  21 & Past Only & 149 / 600 (25\\%) \\\\ \n  22 & Current Smoker & 78 / 600 (13\\%) \\\\ \n  23 & \\_\\_\\_Ever use of BC Pills\\_\\_\\_ &  \\\\ \n  24 & Never & 155 / 600 (26\\%) \\\\ \n  25 & Ever use BC pills & 445 / 600 (74\\%) \\\\ \n  26 & \\_\\_\\_BMI\\_\\_\\_ &  \\\\ \n  27 & Mean (SD) & 28 (7) \\\\ \n  28 & Median & 26 \\\\ \n  29 & [Range] & [16, 56] \\\\ \n  30 & \\_\\_\\_Overall Health\\_\\_\\_ &  \\\\ \n  31 & Excellent & 147 / 600 (25\\%) \\\\ \n  32 & Very Good & 233 / 600 (39\\%) \\\\ \n  33 & Good & 151 / 600 (25\\%) \\\\ \n  34 & Fair/Poor & 69 / 600 (12\\%) \\\\ \n  35 & \\_\\_\\_Physical Activity Score\\_\\_\\_ &  \\\\ \n  36 & Mean (SD) & 7.75 (1.77) \\\\ \n  37 & Median & 7.60 \\\\ \n  38 & [Range] & [3.40, 12.80] \\\\ \n  39 & \\_\\_\\_Baseline AMH\\_\\_\\_ &  \\\\ \n  40 & Mean (SD) & 540 (702) \\\\ \n  41 & Median & 273 \\\\ \n  42 & [Range] & [1, 4,652] \\\\ \n  43 & \\_\\_\\_Number of Visits\\_\\_\\_ &  \\\\ \n  44 & Mean (SD) & 5.54 (2.14) \\\\ \n  45 & Median & 5.00 \\\\ \n  46 & [Range] & [3.00, 11.00] \\\\ \n  47 & \\_\\_\\_Parity\\_\\_\\_ &  \\\\ \n  48 & None & 111 / 600 (19\\%) \\\\ \n  49 & One & 88 / 600 (15\\%) \\\\ \n  50 & Two & 210 / 600 (35\\%) \\\\ \n  51 & Three & 116 / 600 (19\\%) \\\\ \n  52 & More than three & 75 / 600 (13\\%) \\\\ \n  53 & \\_\\_\\_Children\\_\\_\\_ &  \\\\ \n  54 & Mean (SD) & 1.98 (1.41) \\\\ \n  55 & Median & 2.00 \\\\ \n  56 & [Range] & [0.00, 12.00] \\\\ \n  57 & \\_\\_\\_Employment Status\\_\\_\\_ &  \\\\ \n  58 & Unemployed & 104 / 600 (17\\%) \\\\ \n  59 & Employed & 496 / 600 (83\\%) \\\\ \n  60 & \\_\\_\\_Educational Attainment\\_\\_\\_ &  \\\\ \n  61 & High School or Less & 125 / 600 (21\\%) \\\\ \n  62 & Some College & 190 / 600 (32\\%) \\\\ \n  63 & College degree or higher & 285 / 600 (48\\%) \\\\ \n  64 & \\_\\_\\_Site\\_\\_\\_ &  \\\\ \n  65 & B & 96 / 600 (16\\%) \\\\ \n  66 & C & 76 / 600 (13\\%) \\\\ \n  67 & M & 103 / 600 (17\\%) \\\\ \n  68 & NJ & 27 / 600 (4.5\\%) \\\\ \n  69 & P & 74 / 600 (12\\%) \\\\ \n  70 & UCD & 102 / 600 (17\\%) \\\\ \n  71 & UCLA & 122 / 600 (20\\%) \\\\ \n   \\hline\n\\end{tabular}\n\\end{table}"
  },
  {
    "objectID": "09_table1_publication.html#table2-summary-for-amh-and-visits",
    "href": "09_table1_publication.html#table2-summary-for-amh-and-visits",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.3 Table2: summary for AMH and visits",
    "text": "9.3 Table2: summary for AMH and visits\n\n\n\n\n\n\nDescriptive Statistics for SWAN AMH Data\n\nCharacteristics\nN = 600\n\n\n\nBaseline AMH\n\n\n\nMean (SD)\n540 (702)\n\n\nMedian [IQR]\n273 [71, 672]\n\n\nMedian [5%, 95%]\n273 [1, 2,095]\n\n\nMedian [Range]\n273 [1, 4,652]\n\n\nMinimum AMH\n\n\n\nMean (SD)\n28 (78)\n\n\nMedian [IQR]\n2 [1, 18]\n\n\nMedian [5%, 95%]\n2 [1, 133]\n\n\nMedian [Range]\n2 [1, 772]\n\n\nMaximum AMH\n\n\n\nMean (SD)\n628 (730)\n\n\nMedian [IQR]\n341 [132, 836]\n\n\nMedian [5%, 95%]\n341 [23, 2,174]\n\n\nMedian [Range]\n341 [1, 4,681]\n\n\nNumber of Visits\n\n\n\nMean (SD)\n5.54 (2.14)\n\n\nMedian [IQR]\n5.00 [4.00, 7.00]\n\n\nMedian [5%, 95%]\n5.00 [3.00, 10.00]\n\n\nMedian [Range]\n5.00 [3.00, 11.00]\n\n\n\n\n\n\nHere is the latex code for Table2:\n% latex table generated in R 4.2.2 by xtable 1.8-4 package\n% Tue Apr  9 14:00:42 2024\n\\begin{table}[ht]\n\\centering\n\\begin{tabular}{rll}\n  \\hline\n & **Characteristics** & **N = 600** \\\\ \n  \\hline\n1 & \\_\\_\\_Baseline AMH\\_\\_\\_ &  \\\\ \n  2 & Mean (SD) & 540 (702) \\\\ \n  3 & Median [IQR] & 273 [71, 672] \\\\ \n  4 & Median [5\\%, 95\\%] & 273 [1, 2,095] \\\\ \n  5 & Median [Range] & 273 [1, 4,652] \\\\ \n  6 & \\_\\_\\_Minimum AMH\\_\\_\\_ &  \\\\ \n  7 & Mean (SD) & 28 (78) \\\\ \n  8 & Median [IQR] & 2 [1, 18] \\\\ \n  9 & Median [5\\%, 95\\%] & 2 [1, 133] \\\\ \n  10 & Median [Range] & 2 [1, 772] \\\\ \n  11 & \\_\\_\\_Maximum AMH\\_\\_\\_ &  \\\\ \n  12 & Mean (SD) & 628 (730) \\\\ \n  13 & Median [IQR] & 341 [132, 836] \\\\ \n  14 & Median [5\\%, 95\\%] & 341 [23, 2,174] \\\\ \n  15 & Median [Range] & 341 [1, 4,681] \\\\ \n  16 & \\_\\_\\_Number of Visits\\_\\_\\_ &  \\\\ \n  17 & Mean (SD) & 5.54 (2.14) \\\\ \n  18 & Median [IQR] & 5.00 [4.00, 7.00] \\\\ \n  19 & Median [5\\%, 95\\%] & 5.00 [3.00, 10.00] \\\\ \n  20 & Median [Range] & 5.00 [3.00, 11.00] \\\\ \n   \\hline\n\\end{tabular}\n\\end{table}"
  },
  {
    "objectID": "09_table1_publication.html#longitudinal-model",
    "href": "09_table1_publication.html#longitudinal-model",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.4 Longitudinal model",
    "text": "9.4 Longitudinal model\n\\(lme.fit1: \\ \\ \\  (fixed = lamh \\sim time, \\ random = \\sim time| id)\\)\nHere is the summary for longitudinal sub-model, based on model selection\nHere is the table for the longitudinal model:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\neffect\ngroup\nterm\nestimate\nstd.error\ndf\nstatistic\np.value\n\n\n\nfixed\nNA\n(Intercept)\n7.5166321\n0.1042432\n2725\n72.10669\n0\n\n\nfixed\nNA\ntime\n-0.5304830\n0.0116235\n2725\n-45.63885\n0\n\n\nran_pars\nid\nsd_(Intercept)\n1.6842278\nNA\nNA\nNA\nNA\n\n\nran_pars\nid\ncor_time.(Intercept)\n-0.3595600\nNA\nNA\nNA\nNA\n\n\nran_pars\nid\nsd_time\n0.1039758\nNA\nNA\nNA\nNA\n\n\nran_pars\nResidual\nsd_Observation\n1.2991322\nNA\nNA\nNA\nNA\n\n\n\n\n\nThe full summary for the longitudinal model is as follows:\n\n\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: swan_amh00 \n#&gt;       AIC      BIC    logLik\n#&gt;   12583.7 12620.36 -6285.852\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~time | id\n#&gt;  Structure: General positive-definite, Log-Cholesky parametrization\n#&gt;             StdDev    Corr  \n#&gt; (Intercept) 1.6842278 (Intr)\n#&gt; time        0.1039758 -0.36 \n#&gt; Residual    1.2991322       \n#&gt; \n#&gt; Fixed effects:  lamh ~ time \n#&gt;                 Value Std.Error   DF   t-value p-value\n#&gt; (Intercept)  7.516632 0.1042432 2725  72.10669       0\n#&gt; time        -0.530483 0.0116235 2725 -45.63885       0\n#&gt;  Correlation: \n#&gt;      (Intr)\n#&gt; time -0.748\n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;        Min         Q1        Med         Q3        Max \n#&gt; -4.9581436 -0.4749003  0.1009506  0.5917255  2.8944856 \n#&gt; \n#&gt; Number of Observations: 3326\n#&gt; Number of Groups: 600"
  },
  {
    "objectID": "09_table1_publication.html#survival-model",
    "href": "09_table1_publication.html#survival-model",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.5 Survival model",
    "text": "9.5 Survival model\nNotes: is it necessary to include a model with observed AMH as covariate in survival model?\n\\(surv.fit16: \\ \\ \\  coxph(Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\\)\nHere is the table for survival model, based on model selection:\n\n\n\n\n\n\n\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\n\n\n\nmarriedMarried/Partnered\n0.2009837\n0.0963057\n2.0869349\n0.0368940\n\n\nbc_pillsEver use BC pills\n-0.2237786\n0.0993733\n-2.2518989\n0.0243287\n\n\nbmi\n-0.0035685\n0.0067598\n-0.5279079\n0.5975633\n\n\nsite_ethnic_b_black\n0.0058217\n0.2136773\n0.0272453\n0.9782641\n\n\nsite_ethnic_c_black\n-0.0224055\n0.2183077\n-0.1026328\n0.9182544\n\n\nsite_ethnic_c_cauca\n0.2142089\n0.2217840\n0.9658448\n0.3341219\n\n\nsite_ethnic_m_black\n0.1646291\n0.1995273\n0.8250954\n0.4093174\n\n\nsite_ethnic_m_cauca\n0.3423318\n0.2155704\n1.5880274\n0.1122801\n\n\nsite_ethnic_nj_cauca\n0.2682986\n0.3604395\n0.7443652\n0.4566556\n\n\nsite_ethnic_nj_hispa\n0.0658811\n0.2772944\n0.2375853\n0.8122028\n\n\nsite_ethnic_p_black\n0.3511122\n0.2466007\n1.4238086\n0.1545019\n\n\nsite_ethnic_p_cauca\n0.7013580\n0.2008652\n3.4916843\n0.0004800\n\n\nsite_ethnic_ucd_cauca\n0.3055980\n0.2124732\n1.4382898\n0.1503518\n\n\nsite_ethnic_ucd_chine\n0.2584626\n0.1959062\n1.3193179\n0.1870628\n\n\nsite_ethnic_ucla_cauca\n0.3373483\n0.2201958\n1.5320374\n0.1255132\n\n\nsite_ethnic_ucla_japan\n0.1564432\n0.1787153\n0.8753768\n0.3813689\n\n\nsmoke_past_only\n0.0755806\n0.1047054\n0.7218408\n0.4703924\n\n\nsmoke_current_smoker\n0.6000705\n0.1365294\n4.3951736\n0.0000111\n\n\n\n\n\nHere is the summary for the survival model\n\n\n#&gt; Call:\n#&gt; coxph(formula = Surv(etime, event) ~ 0 + married + bc_pills + \n#&gt;     bmi + site_ethnic_b_black + site_ethnic_c_black + site_ethnic_c_cauca + \n#&gt;     site_ethnic_m_black + site_ethnic_m_cauca + site_ethnic_nj_cauca + \n#&gt;     site_ethnic_nj_hispa + site_ethnic_p_black + site_ethnic_p_cauca + \n#&gt;     site_ethnic_ucd_cauca + site_ethnic_ucd_chine + site_ethnic_ucla_cauca + \n#&gt;     site_ethnic_ucla_japan + smoke_past_only + smoke_current_smoker, \n#&gt;     data = swan_amh12, model = TRUE, x = TRUE)\n#&gt; \n#&gt;   n= 600, number of events= 600 \n#&gt; \n#&gt;                                coef exp(coef)  se(coef)      z Pr(&gt;|z|)    \n#&gt; marriedMarried/Partnered   0.200984  1.222605  0.096306  2.087  0.03689 *  \n#&gt; bc_pillsEver use BC pills -0.223779  0.799492  0.099373 -2.252  0.02433 *  \n#&gt; bmi                       -0.003569  0.996438  0.006760 -0.528  0.59756    \n#&gt; site_ethnic_b_black        0.005822  1.005839  0.213677  0.027  0.97826    \n#&gt; site_ethnic_c_black       -0.022406  0.977844  0.218308 -0.103  0.91825    \n#&gt; site_ethnic_c_cauca        0.214209  1.238881  0.221784  0.966  0.33412    \n#&gt; site_ethnic_m_black        0.164629  1.178956  0.199527  0.825  0.40932    \n#&gt; site_ethnic_m_cauca        0.342332  1.408227  0.215570  1.588  0.11228    \n#&gt; site_ethnic_nj_cauca       0.268299  1.307738  0.360439  0.744  0.45666    \n#&gt; site_ethnic_nj_hispa       0.065881  1.068100  0.277294  0.238  0.81220    \n#&gt; site_ethnic_p_black        0.351112  1.420647  0.246601  1.424  0.15450    \n#&gt; site_ethnic_p_cauca        0.701358  2.016489  0.200865  3.492  0.00048 ***\n#&gt; site_ethnic_ucd_cauca      0.305598  1.357436  0.212473  1.438  0.15035    \n#&gt; site_ethnic_ucd_chine      0.258463  1.294938  0.195906  1.319  0.18706    \n#&gt; site_ethnic_ucla_cauca     0.337348  1.401227  0.220196  1.532  0.12551    \n#&gt; site_ethnic_ucla_japan     0.156443  1.169344  0.178715  0.875  0.38137    \n#&gt; smoke_past_only            0.075581  1.078510  0.104705  0.722  0.47039    \n#&gt; smoke_current_smoker       0.600070  1.822247  0.136529  4.395 1.11e-05 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt;                           exp(coef) exp(-coef) lower .95 upper .95\n#&gt; marriedMarried/Partnered     1.2226     0.8179    1.0123    1.4766\n#&gt; bc_pillsEver use BC pills    0.7995     1.2508    0.6580    0.9714\n#&gt; bmi                          0.9964     1.0036    0.9833    1.0097\n#&gt; site_ethnic_b_black          1.0058     0.9942    0.6617    1.5290\n#&gt; site_ethnic_c_black          0.9778     1.0227    0.6374    1.5000\n#&gt; site_ethnic_c_cauca          1.2389     0.8072    0.8021    1.9134\n#&gt; site_ethnic_m_black          1.1790     0.8482    0.7974    1.7432\n#&gt; site_ethnic_m_cauca          1.4082     0.7101    0.9230    2.1487\n#&gt; site_ethnic_nj_cauca         1.3077     0.7647    0.6452    2.6505\n#&gt; site_ethnic_nj_hispa         1.0681     0.9362    0.6203    1.8393\n#&gt; site_ethnic_p_black          1.4206     0.7039    0.8762    2.3035\n#&gt; site_ethnic_p_cauca          2.0165     0.4959    1.3603    2.9893\n#&gt; site_ethnic_ucd_cauca        1.3574     0.7367    0.8951    2.0586\n#&gt; site_ethnic_ucd_chine        1.2949     0.7722    0.8820    1.9011\n#&gt; site_ethnic_ucla_cauca       1.4012     0.7137    0.9101    2.1574\n#&gt; site_ethnic_ucla_japan       1.1693     0.8552    0.8238    1.6598\n#&gt; smoke_past_only              1.0785     0.9272    0.8784    1.3242\n#&gt; smoke_current_smoker         1.8222     0.5488    1.3944    2.3813\n#&gt; \n#&gt; Concordance= 0.589  (se = 0.014 )\n#&gt; Likelihood ratio test= 48.39  on 18 df,   p=1e-04\n#&gt; Wald test            = 51.8  on 18 df,   p=4e-05\n#&gt; Score (logrank) test = 52.77  on 18 df,   p=3e-05"
  },
  {
    "objectID": "09_table1_publication.html#joint-model-without-rate-only-value-term-of-longitudinal-submodel",
    "href": "09_table1_publication.html#joint-model-without-rate-only-value-term-of-longitudinal-submodel",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.6 Joint model without Rate (only value term of longitudinal submodel)",
    "text": "9.6 Joint model without Rate (only value term of longitudinal submodel)\n\\[\n\\begin{split}\n  jmbayes2.fit116: & \\\\\n  lme.fit1: \\ \\ \\  & \\pmb m(time) = (fixed = lamh \\sim time, \\ random = \\sim time| id) \\\\\n  surv.fit16: \\ \\ \\ & Surv(etime, event) \\sim married + bc\\_pills + bmi + factor(site) + \\\\\n  & factor(ethnic) + factor(smoke) + \\pmb m(time)\n\\end{split}\n\\]\n\n9.6.1 Longitudinal submodel\nHere is the summary for longitudinal submodel:\n\n\n\n\n\nMean\nStDev\n2.5%\n97.5%\nP\n\n\n\n(Intercept)\n7.9150045\n0.1167373\n7.6776408\n8.1358265\n0\n\n\ntime\n-0.5959353\n0.0140724\n-0.6213314\n-0.5676174\n0\n\n\nsigma\n1.3069148\n0.0194243\n1.2706265\n1.3462695\n0\n\n\n\n\n\n\n9.6.2 Survival submodel\nHere is the summary for survival submodel:\n\n\n\n\n\n\n\n\n\n\n\n\n\nMean\nStDev\n2.5%\n97.5%\nP\n\n\n\nmarriedMarried/Partnered\n0.1230590\n0.1477155\n-0.1906037\n0.4031406\n0.4120\n\n\nbc_pillsEver use BC pills\n-0.0036234\n0.1326284\n-0.2647300\n0.2585364\n0.9980\n\n\nbmi\n-0.0482207\n0.0086565\n-0.0647940\n-0.0318024\n0.0000\n\n\nsite_ethnic_b_black\n-0.0986269\n0.2891925\n-0.6935329\n0.4537392\n0.7355\n\n\nsite_ethnic_c_black\n-0.1950361\n0.2906667\n-0.7415467\n0.4028777\n0.5255\n\n\nsite_ethnic_c_cauca\n0.5810621\n0.2760849\n0.0379913\n1.1042824\n0.0335\n\n\nsite_ethnic_m_black\n0.0391006\n0.2629483\n-0.4670179\n0.5915743\n0.8955\n\n\nsite_ethnic_m_cauca\n0.4916273\n0.2811987\n-0.0499484\n1.0285136\n0.0755\n\n\nsite_ethnic_nj_cauca\n0.8146601\n0.4858047\n-0.1865071\n1.7537388\n0.1010\n\n\nsite_ethnic_nj_hispa\n0.2268313\n0.3938292\n-0.5491844\n0.9797106\n0.5680\n\n\nsite_ethnic_p_black\n0.4207852\n0.3254313\n-0.2412357\n1.0394935\n0.2050\n\n\nsite_ethnic_p_cauca\n0.5639798\n0.2603183\n0.0745456\n1.0690264\n0.0235\n\n\nsite_ethnic_ucd_cauca\n0.2741064\n0.2712475\n-0.2325808\n0.8399108\n0.3015\n\n\nsite_ethnic_ucd_chine\n0.0442592\n0.2599432\n-0.4668763\n0.5731107\n0.8865\n\n\nsite_ethnic_ucla_cauca\n0.5793384\n0.2698834\n0.0789994\n1.1293692\n0.0230\n\n\nsite_ethnic_ucla_japan\n0.5281033\n0.2249767\n0.0973573\n0.9701987\n0.0095\n\n\nsmoke_past_only\n-0.0616137\n0.1362120\n-0.3183663\n0.2200914\n0.6120\n\n\nsmoke_current_smoker\n0.2021982\n0.1794691\n-0.1540481\n0.5404030\n0.2485\n\n\nvalue(lamh)\n-1.0162608\n0.0650950\n-1.1742875\n-0.9079182\n0.0000\n\n\n\n\n\n\n9.6.3 Joint model\nHere are the full summary for the joint model without rate:\n\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes2::jm(Surv_object = surv.fit16, Mixed_objects = lme.fit1, \n#&gt;     time_var = \"time\", control = jmcontrol)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Number of Groups: 600        Number of events: 600 (100%)\n#&gt; Number of Observations:\n#&gt;   lamh: 3326\n#&gt; \n#&gt;                  DIC     WAIC      LPML\n#&gt; marginal    14962.45 14972.47 -7499.795\n#&gt; conditional 15739.73 15419.67 -8085.768\n#&gt; \n#&gt; Random-effects covariance matrix:\n#&gt;                      \n#&gt;        StdDev   Corr \n#&gt; (Intr) 1.6798 (Intr) \n#&gt; time   0.1070 -0.2562\n#&gt; \n#&gt; Survival Outcome:\n#&gt;                              Mean  StDev    2.5%   97.5%      P\n#&gt; marriedMarried/Partnered   0.1231 0.1477 -0.1906  0.4031 0.4120\n#&gt; bc_pillsEver use BC pills -0.0036 0.1326 -0.2647  0.2585 0.9980\n#&gt; bmi                       -0.0482 0.0087 -0.0648 -0.0318 0.0000\n#&gt; site_ethnic_b_black       -0.0986 0.2892 -0.6935  0.4537 0.7355\n#&gt; site_ethnic_c_black       -0.1950 0.2907 -0.7415  0.4029 0.5255\n#&gt; site_ethnic_c_cauca        0.5811 0.2761  0.0380  1.1043 0.0335\n#&gt; site_ethnic_m_black        0.0391 0.2629 -0.4670  0.5916 0.8955\n#&gt; site_ethnic_m_cauca        0.4916 0.2812 -0.0499  1.0285 0.0755\n#&gt; site_ethnic_nj_cauca       0.8147 0.4858 -0.1865  1.7537 0.1010\n#&gt; site_ethnic_nj_hispa       0.2268 0.3938 -0.5492  0.9797 0.5680\n#&gt; site_ethnic_p_black        0.4208 0.3254 -0.2412  1.0395 0.2050\n#&gt; site_ethnic_p_cauca        0.5640 0.2603  0.0745  1.0690 0.0235\n#&gt; site_ethnic_ucd_cauca      0.2741 0.2712 -0.2326  0.8399 0.3015\n#&gt; site_ethnic_ucd_chine      0.0443 0.2599 -0.4669  0.5731 0.8865\n#&gt; site_ethnic_ucla_cauca     0.5793 0.2699  0.0790  1.1294 0.0230\n#&gt; site_ethnic_ucla_japan     0.5281 0.2250  0.0974  0.9702 0.0095\n#&gt; smoke_past_only           -0.0616 0.1362 -0.3184  0.2201 0.6120\n#&gt; smoke_current_smoker       0.2022 0.1795 -0.1540  0.5404 0.2485\n#&gt; value(lamh)               -1.0163 0.0651 -1.1743 -0.9079 0.0000\n#&gt; \n#&gt; Longitudinal Outcome: lamh (family = gaussian, link = identity)\n#&gt;                Mean  StDev    2.5%   97.5% P\n#&gt; (Intercept)  7.9150 0.1167  7.6776  8.1358 0\n#&gt; time        -0.5959 0.0141 -0.6213 -0.5676 0\n#&gt; sigma        1.3069 0.0194  1.2706  1.3463 0\n#&gt; \n#&gt; MCMC summary:\n#&gt; chains: 1 \n#&gt; iterations per chain: 5000 \n#&gt; burn-in per chain: 1000 \n#&gt; thinning: 1 \n#&gt; time: 28 sec"
  },
  {
    "objectID": "09_table1_publication.html#joint-model-with-rate-value-and-rate-terms-of-longitudinal-submodel",
    "href": "09_table1_publication.html#joint-model-with-rate-value-and-rate-terms-of-longitudinal-submodel",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.7 Joint model with rate (value and rate terms of longitudinal submodel)",
    "text": "9.7 Joint model with rate (value and rate terms of longitudinal submodel)\n\\[\n\\begin{split}\n  jmbayes2.fit116.d: & \\\\\n  lme.fit1: \\ \\ \\  & \\pmb m(time) = (fixed = lamh \\sim time, \\ random = \\sim time| id) \\\\\n  surv.fit16: \\ \\ \\ & Surv(etime, event) \\sim married + bc\\_pills + bmi + \\\\\n  & factor(site) + factor(ethnic) + factor(smoke) + \\pmb m(time) + \\pmb m'(time)\n\\end{split}\n\\]\n\n9.7.1 Longitudinal submodel\nHere is the summary for longitudinal submodel:\n\n\n\n\n\nMean\nStDev\n2.5%\n97.5%\nP\n\n\n\n(Intercept)\n7.8009991\n0.0856675\n7.6390793\n7.9778063\n0\n\n\ntime\n-0.5831007\n0.0078334\n-0.6016161\n-0.5718443\n0\n\n\nsigma\n1.3158656\n0.0183958\n1.2788111\n1.3525139\n0\n\n\n\n\n\n\n9.7.2 Survival submodel\nHere is the summary for survival submodel:\n\n\n\n\n\n\n\n\n\n\n\n\n\nMean\nStDev\n2.5%\n97.5%\nP\n\n\n\nmarriedMarried/Partnered\n0.2417305\n0.2101977\n-0.1655492\n0.6652135\n0.2330\n\n\nbc_pillsEver use BC pills\n-0.0394215\n0.2006604\n-0.4541247\n0.3595743\n0.8500\n\n\nbmi\n-0.0607746\n0.0156032\n-0.0932495\n-0.0334083\n0.0000\n\n\nsite_ethnic_b_black\n-0.1296034\n0.4137167\n-0.8825379\n0.7732577\n0.7025\n\n\nsite_ethnic_c_black\n-0.4345540\n0.3957967\n-1.2237136\n0.4189339\n0.2310\n\n\nsite_ethnic_c_cauca\n0.6873707\n0.4119251\n-0.1019593\n1.4818400\n0.0905\n\n\nsite_ethnic_m_black\n0.0418710\n0.3230775\n-0.5470842\n0.7552422\n0.9190\n\n\nsite_ethnic_m_cauca\n0.6366866\n0.3826280\n-0.0415340\n1.4331901\n0.0560\n\n\nsite_ethnic_nj_cauca\n1.0990258\n0.7955822\n-0.2368824\n2.7695308\n0.1305\n\n\nsite_ethnic_nj_hispa\n0.1942595\n0.5524206\n-1.0104444\n1.2960723\n0.6885\n\n\nsite_ethnic_p_black\n0.4803200\n0.4891255\n-0.4177802\n1.4976000\n0.3180\n\n\nsite_ethnic_p_cauca\n0.7271998\n0.4069664\n0.0146010\n1.6170665\n0.0440\n\n\nsite_ethnic_ucd_cauca\n0.2539384\n0.4054615\n-0.5534879\n1.0510744\n0.5115\n\n\nsite_ethnic_ucd_chine\n0.0126214\n0.3259992\n-0.5450049\n0.7250946\n0.9860\n\n\nsite_ethnic_ucla_cauca\n0.7145777\n0.4227695\n-0.0328034\n1.5574396\n0.0615\n\n\nsite_ethnic_ucla_japan\n0.6833081\n0.3408692\n0.0293766\n1.3331523\n0.0370\n\n\nsmoke_past_only\n-0.0991718\n0.2126347\n-0.5532838\n0.2985079\n0.6515\n\n\nsmoke_current_smoker\n0.4043501\n0.2890467\n-0.1059751\n1.0048318\n0.1635\n\n\nvalue(lamh)\n-1.1322009\n0.1265345\n-1.3717799\n-0.8975461\n0.0000\n\n\nslope(lamh)\n-24.5107006\n15.6472310\n-50.3095234\n-0.2016081\n0.0445\n\n\n\n\n\n\n9.7.3 Joint model\nHere are the full summary for the joint model with rate:\n\n\n#&gt; \n#&gt; Call:\n#&gt; JMbayes2::jm(Surv_object = surv.fit16, Mixed_objects = lme.fit1, \n#&gt;     time_var = \"time\", functional_forms = list(lamh = ~value(lamh) + \n#&gt;         slope(lamh)), control = jmcontrol, seed = 55555)\n#&gt; \n#&gt; Data Descriptives:\n#&gt; Number of Groups: 600        Number of events: 600 (100%)\n#&gt; Number of Observations:\n#&gt;   lamh: 3326\n#&gt; \n#&gt;                  DIC     WAIC      LPML\n#&gt; marginal    14827.79 14888.48 -7504.700\n#&gt; conditional 14538.29 14379.46 -7573.724\n#&gt; \n#&gt; Random-effects covariance matrix:\n#&gt;                     \n#&gt;        StdDev   Corr\n#&gt; (Intr) 1.5620 (Intr)\n#&gt; time   0.0605 0.1060\n#&gt; \n#&gt; Survival Outcome:\n#&gt;                               Mean   StDev     2.5%   97.5%      P\n#&gt; marriedMarried/Partnered    0.2417  0.2102  -0.1655  0.6652 0.2330\n#&gt; bc_pillsEver use BC pills  -0.0394  0.2007  -0.4541  0.3596 0.8500\n#&gt; bmi                        -0.0608  0.0156  -0.0932 -0.0334 0.0000\n#&gt; site_ethnic_b_black        -0.1296  0.4137  -0.8825  0.7733 0.7025\n#&gt; site_ethnic_c_black        -0.4346  0.3958  -1.2237  0.4189 0.2310\n#&gt; site_ethnic_c_cauca         0.6874  0.4119  -0.1020  1.4818 0.0905\n#&gt; site_ethnic_m_black         0.0419  0.3231  -0.5471  0.7552 0.9190\n#&gt; site_ethnic_m_cauca         0.6367  0.3826  -0.0415  1.4332 0.0560\n#&gt; site_ethnic_nj_cauca        1.0990  0.7956  -0.2369  2.7695 0.1305\n#&gt; site_ethnic_nj_hispa        0.1943  0.5524  -1.0104  1.2961 0.6885\n#&gt; site_ethnic_p_black         0.4803  0.4891  -0.4178  1.4976 0.3180\n#&gt; site_ethnic_p_cauca         0.7272  0.4070   0.0146  1.6171 0.0440\n#&gt; site_ethnic_ucd_cauca       0.2539  0.4055  -0.5535  1.0511 0.5115\n#&gt; site_ethnic_ucd_chine       0.0126  0.3260  -0.5450  0.7251 0.9860\n#&gt; site_ethnic_ucla_cauca      0.7146  0.4228  -0.0328  1.5574 0.0615\n#&gt; site_ethnic_ucla_japan      0.6833  0.3409   0.0294  1.3332 0.0370\n#&gt; smoke_past_only            -0.0992  0.2126  -0.5533  0.2985 0.6515\n#&gt; smoke_current_smoker        0.4044  0.2890  -0.1060  1.0048 0.1635\n#&gt; value(lamh)                -1.1322  0.1265  -1.3718 -0.8975 0.0000\n#&gt; slope(lamh)               -24.5107 15.6472 -50.3095 -0.2016 0.0445\n#&gt; \n#&gt; Longitudinal Outcome: lamh (family = gaussian, link = identity)\n#&gt;                Mean  StDev    2.5%   97.5% P\n#&gt; (Intercept)  7.8010 0.0857  7.6391  7.9778 0\n#&gt; time        -0.5831 0.0078 -0.6016 -0.5718 0\n#&gt; sigma        1.3159 0.0184  1.2788  1.3525 0\n#&gt; \n#&gt; MCMC summary:\n#&gt; chains: 1 \n#&gt; iterations per chain: 5000 \n#&gt; burn-in per chain: 1000 \n#&gt; thinning: 1 \n#&gt; time: 30 sec"
  },
  {
    "objectID": "09_table1_publication.html#comparison-for-model-with-and-without-rate",
    "href": "09_table1_publication.html#comparison-for-model-with-and-without-rate",
    "title": "\n9  Table1 (for publication)\n",
    "section": "\n9.8 Comparison for model with and without rate",
    "text": "9.8 Comparison for model with and without rate\n\n\n#&gt; \n#&gt;                         DIC     WAIC      LPML\n#&gt;  jmbayes2.fit116.d 14827.79 14888.48 -7504.700\n#&gt;    jmbayes2.fit116 14962.45 14972.47 -7499.795\n#&gt; \n#&gt; The criteria are calculated based on the marginal log-likelihood."
  }
]