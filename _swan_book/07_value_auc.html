<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Randy Jin, Elizabeth Juarez-Colunga">
<title>SWAN AMH project analysis - 7&nbsp; Value model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08_rate_auc.html" rel="next">
<link href="./06_jm_model_selection.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SWAN AMH project analysis</span>
  </a>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Value model</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        <div class="sidebar-tools-collapse tools-wide">
    <a href="https://github.com/Goodgolden/jm_amh" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="" class="sidebar-tool px-1"><i class="bi bi-share"></i></a>
    <a href="https://coloradosph.cuanschutz.edu/education/departments/biostatistics-informatics" title="" class="sidebar-tool px-1"><i class="bi bi-hospital"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Working log</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_table1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Table1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_jm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">JM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_jmbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_jmbayes2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">JMbayes2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_jm_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JM Model Selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_value_auc.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Value model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_rate_auc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_table1_publication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Table1 (for publication)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_final_model.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final model (for publication)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_convergence.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Convergence</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Selection I - Dummy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_model_selection_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Model Selection II - Factor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_rate_value_baseline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Rate Value Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_auc_ci.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">AUC CI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_auc_plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">AUC Plot</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_rate_estimate.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Slope Estimate</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_review.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Paper Review</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#goal-of-the-analysis" id="toc-goal-of-the-analysis" class="nav-link active" data-scroll-target="#goal-of-the-analysis"> <span class="header-section-number">7.1</span> Goal of the analysis</a></li>
  <li>
<a href="#fit-the-joint-model" id="toc-fit-the-joint-model" class="nav-link" data-scroll-target="#fit-the-joint-model"> <span class="header-section-number">7.2</span> Fit the joint model</a>
  <ul class="collapse">
<li><a href="#summary-for-the-jmbayes.fit116" id="toc-summary-for-the-jmbayes.fit116" class="nav-link" data-scroll-target="#summary-for-the-jmbayes.fit116"> <span class="header-section-number">7.2.1</span> Summary for the <code>jmbayes.fit116</code></a></li>
  <li><a href="#traceplots" id="toc-traceplots" class="nav-link" data-scroll-target="#traceplots"> <span class="header-section-number">7.2.2</span> Traceplots</a></li>
  </ul>
</li>
  <li>
<a href="#dynamic-prediction" id="toc-dynamic-prediction" class="nav-link" data-scroll-target="#dynamic-prediction"> <span class="header-section-number">7.3</span> Dynamic prediction</a>
  <ul class="collapse">
<li><a href="#individual-dynamic-prediction-with-plot" id="toc-individual-dynamic-prediction-with-plot" class="nav-link" data-scroll-target="#individual-dynamic-prediction-with-plot"> <span class="header-section-number">7.3.1</span> Individual dynamic prediction with plot</a></li>
  <li><a href="#predictive-accuracy-measures" id="toc-predictive-accuracy-measures" class="nav-link" data-scroll-target="#predictive-accuracy-measures"> <span class="header-section-number">7.3.2</span> Predictive accuracy measures</a></li>
  <li><a href="#auc" id="toc-auc" class="nav-link" data-scroll-target="#auc"> <span class="header-section-number">7.3.3</span> AUC</a></li>
  <li><a href="#roc" id="toc-roc" class="nav-link" data-scroll-target="#roc"> <span class="header-section-number">7.3.4</span> ROC</a></li>
  </ul>
</li>
  <li><a href="#brier-score" id="toc-brier-score" class="nav-link" data-scroll-target="#brier-score"> <span class="header-section-number">7.4</span> Brier Score</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Goodgolden/jm_amh/edit/main/07_value_auc.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Value model</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="cell" data-hash="07_value_auc_cache/html/css-setup_a3fb9449e86df5a0b61809e74e90b9a0">
<style type="text/css">
.scroll-100 {
  max-height: 300px;
  max-width: 1000px;
  overflow-y: auto;
  background-color: inherit;
}
</style>
</div>
<section id="goal-of-the-analysis" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="goal-of-the-analysis">
<span class="header-section-number">7.1</span> Goal of the analysis</h2>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked="">
Creating dummy variables for the factor variables</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Saving the datasets as <code>swan_amh11</code> and <code>swan_amh12</code></p></li>
<li><p><input type="checkbox" disabled="" checked="">
Fit the joint model with <code>JMbayes2</code> based on model selection results</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Dynamic prediction for the joint model with plots</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Calculate the AUC and ROC for the joint model</p></li>
<li><p><input type="checkbox" disabled="" checked="">
You are super-duper!</p></li>
</ul></section><section id="fit-the-joint-model" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="fit-the-joint-model">
<span class="header-section-number">7.2</span> Fit the joint model</h2>
<p>Here is the joint model with <code>JMbayes2</code>, the name of the model is set up as <code>package</code> + [fit] + <code>lme_number</code> + <code>surv_number</code></p>
<p><span class="math inline">\(lme.fit1 \sim (fixed = lamh \sim time, \ random = \sim time| id)\)</span></p>
<p><span class="math inline">\(surv.fit16 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<p>The <code>predict.jm()</code> function cannot take the factor variables, so we need to convert them to numeric variables.</p>
<p>So here is the dummy variables for the factor variables <code>site_ethnic</code> and <code>smoke</code>. It is weird, just like including the interaction terms without the main effects for the <code>site</code> and <code>ethnicity</code>; <strong>talk with EJC to see whether we change the main factor effects back.</strong></p>
<div class="cell" data-hash="07_value_auc_cache/html/dummy_variables_44868dc6b3ff15378f0b334441409952">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">swan_amh12</span> <span class="op">&lt;-</span> <span class="va">swan_amh11</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">site_ethnic</span> <span class="op">+</span> <span class="va">smoke</span>, </span>
<span>                                    data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swan_amh02</span> <span class="op">&lt;-</span> <span class="va">swan_amh00</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>smoke <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">smoke</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Past Only"</span>,</span>
<span>                           <span class="va">smoke</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Current Smoker"</span>,</span>
<span>                           <span class="va">smoke</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Never Smoked"</span><span class="op">)</span>,</span>
<span>         smoke <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never Smoked"</span> , <span class="st">"Past Only"</span>, <span class="st">"Current Smoker"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">site_ethnic</span> <span class="op">+</span> <span class="va">smoke</span>, </span>
<span>                                    data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">swan_amh12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "age"                    "age0"                   "alcohol"               
#&gt;  [4] "amh"                    "bc_pills"               "bmi"                   
#&gt;  [7] "bmi_cat"                "children"               "edu"                   
#&gt; [10] "employed"               "etime"                  "event"                 
#&gt; [13] "fmp_age"                "health"                 "id"                    
#&gt; [16] "lamh"                   "married"                "parity"                
#&gt; [19] "phys_act"               "site_ethnic"            "site_ethnic_b_black"   
#&gt; [22] "site_ethnic_b_cauca"    "site_ethnic_c_black"    "site_ethnic_c_cauca"   
#&gt; [25] "site_ethnic_m_black"    "site_ethnic_m_cauca"    "site_ethnic_nj_cauca"  
#&gt; [28] "site_ethnic_nj_hispa"   "site_ethnic_p_black"    "site_ethnic_p_cauca"   
#&gt; [31] "site_ethnic_ucd_cauca"  "site_ethnic_ucd_chine"  "site_ethnic_ucla_cauca"
#&gt; [34] "site_ethnic_ucla_japan" "smoke"                  "smoke_current_smoker"  
#&gt; [37] "smoke_past_only"        "start_time"             "time"                  
#&gt; [40] "train"                  "visit"</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># names(swan_amh02)</span></span>
<span><span class="co"># "site_ethnic_b_black"    "site_ethnic_b_cauca"</span></span>
<span><span class="co"># "site_ethnic_c_black"    "site_ethnic_c_cauca"    "site_ethnic_m_black"</span></span>
<span><span class="co"># "site_ethnic_m_cauca"    "site_ethnic_nj_cauca"   "site_ethnic_nj_hispa"</span></span>
<span><span class="co"># "site_ethnic_p_black"    "site_ethnic_p_cauca"    "site_ethnic_ucd_cauca"</span></span>
<span><span class="co"># "site_ethnic_ucd_chine"  "site_ethnic_ucla_cauca" "site_ethnic_ucla_japan"</span></span>
<span><span class="co"># "smoke_past_only"        "smoke_current_smoker"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="07_value_auc_cache/html/fit_joint_model_a5104103e6403918f32cba73a395266a">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">control</span> <span class="op">=</span> <span class="fu">lmeControl</span><span class="op">(</span>opt <span class="op">=</span> <span class="st">"optim"</span><span class="op">)</span></span>
<span><span class="va">lme.fit1</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span>,</span>
<span>                data <span class="op">=</span> <span class="va">swan_amh00</span>,</span>
<span>                control <span class="op">=</span> <span class="va">control</span>,</span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span><span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## testing for health</span></span>
<span><span class="co">## site_ethnic_b_cauca as the reference group </span></span>
<span><span class="va">surv.fit16</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="va">site_ethnic_b_black</span> <span class="op">+</span> <span class="co"># site_ethnic_b_cauca + </span></span>
<span>                      <span class="va">site_ethnic_c_black</span> <span class="op">+</span> <span class="va">site_ethnic_c_cauca</span> <span class="op">+</span> </span>
<span>                      <span class="va">site_ethnic_m_black</span> <span class="op">+</span> <span class="va">site_ethnic_m_cauca</span> <span class="op">+</span></span>
<span>                      <span class="va">site_ethnic_nj_cauca</span> <span class="op">+</span> <span class="va">site_ethnic_nj_hispa</span> <span class="op">+</span></span>
<span>                      <span class="va">site_ethnic_p_black</span> <span class="op">+</span> <span class="va">site_ethnic_p_cauca</span> <span class="op">+</span> </span>
<span>                      <span class="va">site_ethnic_ucd_cauca</span> <span class="op">+</span> <span class="va">site_ethnic_ucd_chine</span> <span class="op">+</span></span>
<span>                      <span class="va">site_ethnic_ucla_cauca</span> <span class="op">+</span> <span class="va">site_ethnic_ucla_japan</span> <span class="op">+</span></span>
<span>                      <span class="va">smoke_past_only</span> <span class="op">+</span> <span class="va">smoke_current_smoker</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh12</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jmcontrol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n_iter <span class="op">=</span> <span class="fl">5000</span>, </span>
<span>                  n_burnin <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>                  n_chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  seed <span class="op">=</span> <span class="fl">55555</span>,</span>
<span>                  cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jmbayes2.fit116</span> <span class="op">&lt;-</span> <span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/jm.html">jm</a></span><span class="op">(</span>Surv_object <span class="op">=</span> <span class="va">surv.fit16</span>,</span>
<span>                               Mixed_objects <span class="op">=</span> <span class="va">lme.fit1</span>, </span>
<span>                               time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                               control <span class="op">=</span> <span class="va">jmcontrol</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="summary-for-the-jmbayes.fit116" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="summary-for-the-jmbayes.fit116">
<span class="header-section-number">7.2.1</span> Summary for the <code>jmbayes.fit116</code>
</h3>
<p>For the <code>lme</code> model:</p>
<div class="cell" data-output.class="scroll-100" data-hash="07_value_auc_cache/html/unnamed-chunk-4_04fc09177a94acf1f61c92528c1c2a02">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">$</span><span class="va">Outcome1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["StDev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["2.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["97.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["P"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"7.9150045","2":"0.11673726","3":"7.6776408","4":"8.1358265","5":"0","_rn_":"(Intercept)"},{"1":"-0.5959353","2":"0.01407240","3":"-0.6213314","4":"-0.5676174","5":"0","_rn_":"time"},{"1":"1.3069148","2":"0.01942432","3":"1.2706265","4":"1.3462695","5":"0","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#             Mean        StDev       2.5%        97.5%.      P</span></span>
<span><span class="co"># (Intercept)   7.9174517     0.1088784   7.6937029   8.1155217   0</span></span>
<span><span class="co"># time        -0.5961157    0.0129068     -0.6186083    -0.5691261  0</span></span>
<span><span class="co"># sigma       1.3059261   0.0186472   1.2692610   1.3428203     0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For the <code>surv</code> model:</p>
<div class="cell" data-output.class="scroll-100" data-hash="07_value_auc_cache/html/unnamed-chunk-5_6cd95dd98e7bd2f09ceda9d37b98dab0">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">$</span><span class="va">Survival</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["StDev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["2.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["97.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["P"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.123059035","2":"0.147715475","3":"-0.19060365","4":"0.40314057","5":"0.4120","_rn_":"marriedMarried/Partnered"},{"1":"-0.003623414","2":"0.132628378","3":"-0.26473005","4":"0.25853640","5":"0.9980","_rn_":"bc_pillsEver use BC pills"},{"1":"-0.048220671","2":"0.008656504","3":"-0.06479402","4":"-0.03180243","5":"0.0000","_rn_":"bmi"},{"1":"-0.098626881","2":"0.289192528","3":"-0.69353291","4":"0.45373922","5":"0.7355","_rn_":"site_ethnic_b_black"},{"1":"-0.195036061","2":"0.290666728","3":"-0.74154669","4":"0.40287769","5":"0.5255","_rn_":"site_ethnic_c_black"},{"1":"0.581062068","2":"0.276084862","3":"0.03799135","4":"1.10428245","5":"0.0335","_rn_":"site_ethnic_c_cauca"},{"1":"0.039100606","2":"0.262948306","3":"-0.46701787","4":"0.59157426","5":"0.8955","_rn_":"site_ethnic_m_black"},{"1":"0.491627260","2":"0.281198730","3":"-0.04994842","4":"1.02851357","5":"0.0755","_rn_":"site_ethnic_m_cauca"},{"1":"0.814660136","2":"0.485804669","3":"-0.18650705","4":"1.75373883","5":"0.1010","_rn_":"site_ethnic_nj_cauca"},{"1":"0.226831297","2":"0.393829191","3":"-0.54918438","4":"0.97971056","5":"0.5680","_rn_":"site_ethnic_nj_hispa"},{"1":"0.420785196","2":"0.325431342","3":"-0.24123567","4":"1.03949346","5":"0.2050","_rn_":"site_ethnic_p_black"},{"1":"0.563979771","2":"0.260318292","3":"0.07454562","4":"1.06902639","5":"0.0235","_rn_":"site_ethnic_p_cauca"},{"1":"0.274106428","2":"0.271247455","3":"-0.23258076","4":"0.83991081","5":"0.3015","_rn_":"site_ethnic_ucd_cauca"},{"1":"0.044259196","2":"0.259943170","3":"-0.46687629","4":"0.57311070","5":"0.8865","_rn_":"site_ethnic_ucd_chine"},{"1":"0.579338422","2":"0.269883439","3":"0.07899941","4":"1.12936921","5":"0.0230","_rn_":"site_ethnic_ucla_cauca"},{"1":"0.528103293","2":"0.224976696","3":"0.09735731","4":"0.97019867","5":"0.0095","_rn_":"site_ethnic_ucla_japan"},{"1":"-0.061613658","2":"0.136211987","3":"-0.31836633","4":"0.22009139","5":"0.6120","_rn_":"smoke_past_only"},{"1":"0.202198221","2":"0.179469140","3":"-0.15404811","4":"0.54040299","5":"0.2485","_rn_":"smoke_current_smoker"},{"1":"-1.016260765","2":"0.065095047","3":"-1.17428746","4":"-0.90791823","5":"0.0000","_rn_":"value(lamh)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="traceplots" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="traceplots">
<span class="header-section-number">7.2.2</span> Traceplots</h3>
<p>Longer chains and more number of chains are better for convergence in real analysis</p>
<div>
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu">traceplot</span><span class="op">(</span><span class="va">jmbayes2.fit116</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-hash="07_value_auc_cache/html/trace_joint_model_de653e33202438d532c2d2da8f2c7ebb">

</div>
</div>
</section></section><section id="dynamic-prediction" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="dynamic-prediction">
<span class="header-section-number">7.3</span> Dynamic prediction</h2>
<p>Individualized predictions of survival probabilities are computed by function <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>, this is different from <code>JMbayes</code> and <code>JM</code>.</p>
<section id="individual-dynamic-prediction-with-plot" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="individual-dynamic-prediction-with-plot">
<span class="header-section-number">7.3.1</span> Individual dynamic prediction with plot</h3>
<p>Here are some exploratory plots for the dynamic prediction for the joint model.</p>
<p>The left part of the plot is the longitudinal outcome, and the right part is the cumulative risk function. With the decrease of the longitudinal outcome <code>log(amh)</code>, the cumulative risk function increases, the probability of event increases too.</p>
<p>The hazard function is the derivative of the cumulative risk function, the steepness (slope) of the cumulative risk function is the hazard function.</p>
<div class="cell" data-hash="07_value_auc_cache/html/plot_function_9ca742494968dc131298852611ecea63">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Title Dynamic prediction plot for individual</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param id_num individual id number in the list</span></span>
<span><span class="co">#' @param tmin the start time</span></span>
<span><span class="co">#' @param tmax the end time</span></span>
<span><span class="co">#' @param jmfit the joint model objects</span></span>
<span><span class="co">#' @param ... </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return a list of lme and surv predicts</span></span>
<span></span>
<span><span class="va">dpplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id_num</span>,</span>
<span>                   <span class="va">tmin</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   <span class="va">tmax</span> <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                   <span class="va">jmfit</span> <span class="op">=</span> <span class="va">jmbayes2.fit116</span>,</span>
<span>                   <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># browser()</span></span>
<span>  <span class="va">nid0</span> <span class="op">&lt;-</span> <span class="va">swan_amh02</span><span class="op">[</span><span class="va">swan_amh02</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">id_num</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">nid</span> <span class="op">&lt;-</span> <span class="va">nid0</span></span>
<span>  <span class="va">nid</span> <span class="op">&lt;-</span> <span class="va">nid</span><span class="op">[</span><span class="va">nid</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;</span> <span class="va">tmin</span>, <span class="op">]</span></span>
<span>  <span class="va">nid</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">nid</span><span class="op">$</span><span class="va">etime</span> <span class="op">&lt;-</span> <span class="va">tmin</span></span>
<span>  </span>
<span>  <span class="va">Lpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">jmfit</span>, </span>
<span>                    newdata <span class="op">=</span> <span class="va">nid</span>,</span>
<span>                   times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">tmin</span>, <span class="va">tmax</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>                    return_newdata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">Spred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">jmfit</span>, </span>
<span>                 newdata <span class="op">=</span> <span class="va">nid</span>,</span>
<span>                 times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">tmin</span>, <span class="va">tmax</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>                 process <span class="op">=</span> <span class="st">"event"</span>,</span>
<span>                 return_newdata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># tAUC &lt;- try(JMbayes2::tvAUC(jmfit, </span></span>
<span>  <span class="co">#                         nid0, </span></span>
<span>  <span class="co">#                         Tstart = tmin,</span></span>
<span>  <span class="co">#                         Dt = 10))</span></span>
<span>  <span class="co"># </span></span>
<span>  <span class="co"># tROC &lt;- try(JMbayes2::tvROC(jmfit, </span></span>
<span>  <span class="co">#                         nid0, </span></span>
<span>  <span class="co">#                         Tstart = tmin,</span></span>
<span>  <span class="co">#                         Dt = 10))</span></span>
<span>  <span class="co"># </span></span>
<span>  <span class="co"># brier &lt;- try(JMbayes2::tvBrier(jmfit, </span></span>
<span>  <span class="co">#                            nid0, </span></span>
<span>  <span class="co">#                            Tstart = tmin,</span></span>
<span>  <span class="co">#                            Dt = 10))</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Lpred</span>, <span class="va">Spred</span>, ylab_long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"ID_"</span>, <span class="va">id_num</span>, <span class="st">"  log(amh)"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Lpred <span class="op">=</span> <span class="va">Lpred</span>,</span>
<span>              Spred <span class="op">=</span> <span class="va">Spred</span>,</span>
<span>              nid0 <span class="op">=</span> <span class="va">nid0</span>,</span>
<span>              nid <span class="op">=</span> <span class="va">nid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Some of the very steep trajectory for the risk function: <code>id5</code>, <code>id26</code>, <code>id56</code>, <code>id333</code>, <code>id342</code>;</p>
<div>
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dpplot_id5</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id26</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">26</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id333</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">333</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot(Lpred1)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># plot(Lpred2)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # prediction for the event outcome</span></span>
<span><span class="co"># plot(Spred)</span></span>
<span></span>
<span><span class="co"># combined into one plot, </span></span>
<span><span class="co"># the first longitudinal outcome and cumulative risk</span></span>
<span><span class="co"># the first two longitudinal outcomes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-hash="07_value_auc_cache/html/high_risk_0291160e710d958320c8f78895e0cc29">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/high_risk-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id5_t4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/high_risk-2.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id5_t8</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/high_risk-3.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id26_t4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/high_risk-4.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id26_t8</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/high_risk-5.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id333_t4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/high_risk-6.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id333_t8</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>The dynamic prediction for high risk individuals</p>
</div>
</div>
</div>
</div>
<p>Some of the smooth trajectory for the risk function: <code>id32</code>, <code>id57</code>, <code>id89</code>, <code>id222</code>,<code>id44</code>, <code>id371</code>;</p>
<div>
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dpplot_id32</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">57</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id371</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">371</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dpplot_id44</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>               <span class="op">~</span><span class="fu">dpplot</span><span class="op">(</span>id_num <span class="op">=</span> <span class="fl">44</span>,</span>
<span>                       tmin <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                       tmax <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                       jmfit <span class="op">=</span> <span class="va">jmbayes2.fit116</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-hash="07_value_auc_cache/html/low_risk_9f84d12b4f45a0638793fc6d43f7bfce">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/low_risk-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id32_t4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/low_risk-2.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id32_t8</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/low_risk-3.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id371_t4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/low_risk-4.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id371_t8</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/low_risk-5.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id44_t4</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="07_value_auc_files/figure-html/low_risk-6.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">id44_t8</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>The dynamic prediction for low risk individuals</p>
</div>
</div>
</div>
</div>
</section><section id="predictive-accuracy-measures" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="predictive-accuracy-measures">
<span class="header-section-number">7.3.2</span> Predictive accuracy measures</h3>
<p>The materials are directly from <strong>Dimitris Rizopoulos &amp; Grigorios Papageorg</strong> (details seen JMwithR notes 6.3)</p>
<ul>
<li>Discrimination: sensitivity, specificity, ROC and AUC</li>
<li>Calibration: comparison between predicted and observed probabilities</li>
<li>Overall: combination of discrimination and calibration</li>
</ul>
<p>Sidenotes: we do not have right censor (possessively considering the left censor)</p>
<p>To estimate the sensitivity, specificity and the AUC, we need to account for censoring. Two main approaches:</p>
<ul>
<li>
<p>model-based weights</p>
<ul>
<li>Advantage: it allows censoring to depend on the longitudinal history (in any possible manner)</li>
<li>Disadvantage: it requires that the model is well calibrated</li>
</ul>
</li>
<li>
<p>inverse probability of censoring weighting (IPCW) (using Kaplan-Meier or other non-parametric estimators)</p>
<ul>
<li>Advantage: it provides unbiased estimates even when the model is misspecified</li>
<li>Disadvantage: it requires that the model for the weights is correct</li>
<li><strong>in settings where joint models are used, challenging because censoring may depend on the longitudinal outcomes in a complex manner</strong></li>
</ul>
</li>
</ul></section><section id="auc" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="auc">
<span class="header-section-number">7.3.3</span> AUC</h3>
<p>For <code>JMbayes2</code>, the function <code>tvAUC()</code> is used to estimate the time-dependent AUC only for all the subjects (there is no function for individual AUC).</p>
<div class="cell" data-hash="07_value_auc_cache/html/auc_summary_76172136d0134e269ec9935e1f016fe7">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">AUC2</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUC4</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUC6</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AUC8</span>  <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is the table for the AUC result, using the same joint model for the dynamic prediction. Each AUC for a different time point and time window as 2.</p>
<p>The AUC score are calculated for the time points 2, 4, 6, and 8. It seems the best AUC score is at time 4, and the AUC score decreases as the time window increases. Based on the plots for individuals, some of the plot are missing, because there is no longitudinal data before the <code>Tstart</code>.</p>
<div class="cell" data-output.class="scroll-100" data-hash="07_value_auc_cache/html/auc_result_c764cc6cab8aeeedca9e9c3e644d61a3">
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Tstart <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">AUC2</span>, <span class="va">AUC4</span>, <span class="va">AUC6</span>, <span class="va">AUC8</span><span class="op">)</span>, <span class="st">"Tstart"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      Tend <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">AUC2</span>, <span class="va">AUC4</span>, <span class="va">AUC6</span>, <span class="va">AUC8</span><span class="op">)</span>, <span class="st">"Thoriz"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      AUC <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">AUC2</span>, <span class="va">AUC4</span>, <span class="va">AUC6</span>, <span class="va">AUC8</span><span class="op">)</span>, <span class="st">"auc"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Tstart"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Tend"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AUC"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"3","2":"4","3":"0.8910256"},{"1":"3","2":"5","3":"0.9047101"},{"1":"3","2":"6","3":"0.8630952"},{"1":"3","2":"7","3":"0.8143753"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="roc" class="level3" data-number="7.3.4"><h3 data-number="7.3.4" class="anchored" data-anchor-id="roc">
<span class="header-section-number">7.3.4</span> ROC</h3>
<p>ROC can be calculated based on both individual or all subjects. Here are the results for the ROC for all subject predictions.</p>
<p>The ROC results is consistent with the AUC results, the best ROC is at time 4, and the ROC score decreases as the <code>Tstart</code> increases.</p>
<div class="cell" data-hash="07_value_auc_cache/html/roc_summary_9692d4147fa15f8caff9b4a67de8cd5e">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ROC2</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ROC4</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ROC6</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ROC8</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvROC</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC2</span>, ylab <span class="op">=</span> <span class="st">"Tstart_2 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="07_value_auc_files/figure-html/roc_summary-1.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC4</span>, ylab <span class="op">=</span> <span class="st">"Tstart_4 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="07_value_auc_files/figure-html/roc_summary-2.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC6</span>, ylab <span class="op">=</span> <span class="st">"Tstart_6 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="07_value_auc_files/figure-html/roc_summary-3.png" class="img-fluid" width="672"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ROC8</span>, ylab <span class="op">=</span> <span class="st">"Tstart_8 Sensitivity"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="07_value_auc_files/figure-html/roc_summary-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="brier-score" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="brier-score">
<span class="header-section-number">7.4</span> Brier Score</h2>
<div class="cell" data-hash="07_value_auc_cache/html/bs_summary_d28408759638658d7f329c5c0bac50ea">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">BS2</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BS4</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BS6</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BS8</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes2.fit116</span>,</span>
<span>                          newdata <span class="op">=</span> <span class="va">swan_amh02</span>,</span>
<span>                          Tstart <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                          Dt <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-output.class="scroll-100" data-hash="07_value_auc_cache/html/bs_result_9e8d7c08d3db103f509bfa8c0f8431e3">
<details><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Tstart <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BS2</span>, <span class="va">BS4</span>, <span class="va">BS6</span>, <span class="va">BS8</span><span class="op">)</span>,</span>
<span>                   <span class="st">"Tstart"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      Tend <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BS2</span>, <span class="va">BS4</span>, <span class="va">BS6</span>, <span class="va">BS8</span><span class="op">)</span>, </span>
<span>                 <span class="st">"Thoriz"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      BS <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BS2</span>, <span class="va">BS4</span>, <span class="va">BS6</span>, <span class="va">BS8</span><span class="op">)</span>, </span>
<span>                <span class="st">"Brier"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Tstart"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Tend"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BS"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"3","2":"5","3":"0.02412108"},{"1":"3","2":"6","3":"0.04671427"},{"1":"3","2":"7","3":"0.11279915"},{"1":"3","2":"8","3":"0.15145862"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul class="task-list">
<li>
<input type="checkbox" disabled="" checked="">
You are super-duper!</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06_jm_model_selection.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JM Model Selection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08_rate_auc.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Value model"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warnings =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#results = "hide",</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">error =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ## clean the R environment</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># graphics.off()</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls())</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># freshr::freshr()</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="do">## load packages</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JMbayes, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="do">## check the directory for the file</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co"># here::dr_here()</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">set_here</span>()</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="do">## the figure or results should be saved </span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># paste0("foldername/Sfilename_workingresult_", </span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#      Sys.Date(), ".filetype")</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, "css-setup", echo=FALSE}</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">scroll</span><span class="dv">-100</span> <span class="op">{</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>height<span class="op">:</span> 300px<span class="op">;</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>width<span class="op">:</span> 1000px<span class="op">;</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  overflow<span class="op">-</span>y<span class="op">:</span> auto<span class="op">;</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>color<span class="op">:</span> inherit<span class="op">;</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goal of the analysis</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Creating dummy variables for the factor variables</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Saving the datasets as <span class="in">`swan_amh11`</span> and <span class="in">`swan_amh12`</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Fit the joint model with <span class="in">`JMbayes2`</span> based on model selection results</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Dynamic prediction for the joint model with plots</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Calculate the AUC and ROC for the joint model</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`r praise::praise()`</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit the joint model</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>Here is the joint model with <span class="in">`JMbayes2`</span>, the name of the model is set up as <span class="in">`package`</span> + <span class="sc">\[</span>fit<span class="sc">\]</span> + <span class="in">`lme_number`</span> + <span class="in">`surv_number`</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>$lme.fit1 \sim (fixed = lamh \sim time, \ random = \sim time| id)$</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>$surv.fit16 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>The <span class="in">`predict.jm()`</span> function cannot take the factor variables, so we need to convert them to numeric variables.</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>So here is the dummy variables for the factor variables <span class="in">`site_ethnic`</span> and <span class="in">`smoke`</span>. It is weird, just like including the interaction terms without the main effects for the <span class="in">`site`</span> and <span class="in">`ethnicity`</span>; **talk with EJC to see whether we change the main factor effects back.**</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "dummy_variables"</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>swan_amh12 <span class="ot">&lt;-</span> swan_amh11 <span class="sc">%&gt;%</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> site_ethnic <span class="sc">+</span> smoke, </span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> .)) <span class="sc">%&gt;%</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.)))</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>swan_amh02 <span class="ot">&lt;-</span> swan_amh00 <span class="sc">%&gt;%</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smoke =</span> <span class="fu">case_when</span>(smoke <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Past Only"</span>,</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>                           smoke <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Current Smoker"</span>,</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>                           smoke <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Never Smoked"</span>),</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">smoke =</span> <span class="fu">factor</span>(smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never Smoked"</span> , <span class="st">"Past Only"</span>, <span class="st">"Current Smoker"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> site_ethnic <span class="sc">+</span> smoke, </span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> .)) <span class="sc">%&gt;%</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.)))</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(swan_amh12)</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a><span class="co"># names(swan_amh02)</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="co"># "site_ethnic_b_black"    "site_ethnic_b_cauca"</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="co"># "site_ethnic_c_black"    "site_ethnic_c_cauca"    "site_ethnic_m_black"</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a><span class="co"># "site_ethnic_m_cauca"    "site_ethnic_nj_cauca"   "site_ethnic_nj_hispa"</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a><span class="co"># "site_ethnic_p_black"    "site_ethnic_p_cauca"    "site_ethnic_ucd_cauca"</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a><span class="co"># "site_ethnic_ucd_chine"  "site_ethnic_ucla_cauca" "site_ethnic_ucla_japan"</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a><span class="co"># "smoke_past_only"        "smoke_current_smoker"</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fit_joint_model"</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>)</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>lme.fit1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time,</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh00,</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> control,</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time<span class="sc">|</span> id)</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for health</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a><span class="do">## site_ethnic_b_cauca as the reference group </span></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>surv.fit16 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_b_black <span class="sc">+</span> <span class="co"># site_ethnic_b_cauca + </span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_c_black <span class="sc">+</span> site_ethnic_c_cauca <span class="sc">+</span> </span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_m_black <span class="sc">+</span> site_ethnic_m_cauca <span class="sc">+</span></span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_nj_cauca <span class="sc">+</span> site_ethnic_nj_hispa <span class="sc">+</span></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_p_black <span class="sc">+</span> site_ethnic_p_cauca <span class="sc">+</span> </span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_ucd_cauca <span class="sc">+</span> site_ethnic_ucd_chine <span class="sc">+</span></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>                      site_ethnic_ucla_cauca <span class="sc">+</span> site_ethnic_ucla_japan <span class="sc">+</span></span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>                      smoke_past_only <span class="sc">+</span> smoke_current_smoker,</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh12, </span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>jmcontrol <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n_iter =</span> <span class="dv">5000</span>, </span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_burnin =</span> <span class="dv">1000</span>, </span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_chains =</span> <span class="dv">1</span>,</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">55555</span>,</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cores =</span> <span class="dv">1</span>)</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>jmbayes2.fit116 <span class="ot">&lt;-</span> JMbayes2<span class="sc">::</span><span class="fu">jm</span>(<span class="at">Surv_object =</span> surv.fit16,</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Mixed_objects =</span> lme.fit1, </span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>                               <span class="at">time_var =</span> <span class="st">"time"</span>,</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a>                               <span class="at">control =</span> jmcontrol) </span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "save_datasets"</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(swan_amh02, swan_amh12, </span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>     lme.fit1, surv.fit16, </span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>     jmbayes2.fit116,</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="st">"data-raw/swan_amh_jmbayes2_fit116.RData"</span>)</span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary for the `jmbayes.fit116`</span></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>For the <span class="in">`lme`</span> model:</span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes2.fit116)<span class="sc">$</span>Outcome1 </span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a><span class="co">#             Mean        StDev       2.5%        97.5%.      P</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a><span class="co"># (Intercept)   7.9174517     0.1088784   7.6937029   8.1155217   0</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a><span class="co"># time        -0.5961157    0.0129068     -0.6186083    -0.5691261  0</span></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a><span class="co"># sigma       1.3059261   0.0186472   1.2692610   1.3428203     0</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>For the <span class="in">`surv`</span> model:</span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes2.fit116)<span class="sc">$</span>Survival</span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a><span class="fu">### Traceplots</span></span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a>Longer chains and more number of chains are better for convergence in real analysis</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "trace_joint_model"</span></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>JMbayes2<span class="sc">::</span><span class="fu">traceplot</span>(jmbayes2.fit116)</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dynamic prediction</span></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a>Individualized predictions of survival probabilities are computed by function <span class="in">`predict()`</span>, this is different from <span class="in">`JMbayes`</span> and <span class="in">`JM`</span>.</span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual dynamic prediction with plot</span></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a>Here are some exploratory plots for the dynamic prediction for the joint model.</span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a>The left part of the plot is the longitudinal outcome, and the right part is the cumulative risk function. With the decrease of the longitudinal outcome <span class="in">`log(amh)`</span>, the cumulative risk function increases, the probability of event increases too.</span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a>The hazard function is the derivative of the cumulative risk function, the steepness (slope) of the cumulative risk function is the hazard function.</span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "predict_joint_model"</span></span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(swan_amh02<span class="sc">$</span>id)</span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a><span class="do">## length(ids)</span></span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction for the survival outcomes</span></span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a><span class="do">## This is the dataset with longitudinal outcomes</span></span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a>nid <span class="ot">&lt;-</span> swan_amh02[swan_amh02<span class="sc">$</span>id <span class="sc">==</span> ids[<span class="dv">8</span>], ]</span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a>nid <span class="ot">&lt;-</span> nid[nid<span class="sc">$</span>time <span class="sc">&lt;</span> t0, ]</span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a>nid<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a>nid<span class="sc">$</span>etime <span class="ot">&lt;-</span> t0</span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for the longitudinal outcomes using newdata</span></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a>Lpred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmbayes2.fit116, </span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> nid,</span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a>                    <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for the longitudinal outcomes at future time points</span></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a><span class="co"># from year 6 to 10</span></span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>Lpred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmbayes2.fit116, </span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> nid,</span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>                   <span class="at">times =</span> <span class="fu">seq</span>(t0, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">51</span>),</span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>                    <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>Spred <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmbayes2.fit116, </span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata =</span> nid,</span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a>                 <span class="at">times =</span> <span class="fu">seq</span>(t0, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">11</span>),</span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a>                 <span class="at">process =</span> <span class="st">"event"</span>,</span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a>                 <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "plot_function"</span></span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a><span class="co">#' Title Dynamic prediction plot for individual</span></span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param id_num individual id number in the list</span></span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param tmin the start time</span></span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param tmax the end time</span></span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param jmfit the joint model objects</span></span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ... </span></span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return a list of lme and surv predicts</span></span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a>dpplot <span class="ot">&lt;-</span> <span class="cf">function</span>(id_num,</span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tmin =</span> <span class="dv">0</span>,</span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tmax =</span> <span class="dv">12</span>,</span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a>                   <span class="at">jmfit =</span> jmbayes2.fit116,</span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a>                   ...){</span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># browser()</span></span>
<span id="cb20-253"><a href="#cb20-253" aria-hidden="true" tabindex="-1"></a>  nid0 <span class="ot">&lt;-</span> swan_amh02[swan_amh02<span class="sc">$</span>id <span class="sc">==</span> ids[id_num], ]</span>
<span id="cb20-254"><a href="#cb20-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a>  nid <span class="ot">&lt;-</span> nid0</span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a>  nid <span class="ot">&lt;-</span> nid[nid<span class="sc">$</span>time <span class="sc">&lt;</span> tmin, ]</span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a>  nid<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a>  nid<span class="sc">$</span>etime <span class="ot">&lt;-</span> tmin</span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a>  Lpred <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmfit, </span>
<span id="cb20-261"><a href="#cb20-261" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> nid,</span>
<span id="cb20-262"><a href="#cb20-262" aria-hidden="true" tabindex="-1"></a>                   <span class="at">times =</span> <span class="fu">seq</span>(tmin, tmax, <span class="at">length.out =</span> <span class="dv">11</span>),</span>
<span id="cb20-263"><a href="#cb20-263" aria-hidden="true" tabindex="-1"></a>                    <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-264"><a href="#cb20-264" aria-hidden="true" tabindex="-1"></a>  Spred <span class="ot">&lt;-</span> <span class="fu">predict</span>(jmfit, </span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata =</span> nid,</span>
<span id="cb20-266"><a href="#cb20-266" aria-hidden="true" tabindex="-1"></a>                 <span class="at">times =</span> <span class="fu">seq</span>(tmin, tmax, <span class="at">length.out =</span> <span class="dv">11</span>),</span>
<span id="cb20-267"><a href="#cb20-267" aria-hidden="true" tabindex="-1"></a>                 <span class="at">process =</span> <span class="st">"event"</span>,</span>
<span id="cb20-268"><a href="#cb20-268" aria-hidden="true" tabindex="-1"></a>                 <span class="at">return_newdata =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-269"><a href="#cb20-269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-270"><a href="#cb20-270" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tAUC &lt;- try(JMbayes2::tvAUC(jmfit, </span></span>
<span id="cb20-271"><a href="#cb20-271" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         nid0, </span></span>
<span id="cb20-272"><a href="#cb20-272" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         Tstart = tmin,</span></span>
<span id="cb20-273"><a href="#cb20-273" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         Dt = 10))</span></span>
<span id="cb20-274"><a href="#cb20-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb20-275"><a href="#cb20-275" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tROC &lt;- try(JMbayes2::tvROC(jmfit, </span></span>
<span id="cb20-276"><a href="#cb20-276" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         nid0, </span></span>
<span id="cb20-277"><a href="#cb20-277" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         Tstart = tmin,</span></span>
<span id="cb20-278"><a href="#cb20-278" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         Dt = 10))</span></span>
<span id="cb20-279"><a href="#cb20-279" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb20-280"><a href="#cb20-280" aria-hidden="true" tabindex="-1"></a>  <span class="co"># brier &lt;- try(JMbayes2::tvBrier(jmfit, </span></span>
<span id="cb20-281"><a href="#cb20-281" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                            nid0, </span></span>
<span id="cb20-282"><a href="#cb20-282" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                            Tstart = tmin,</span></span>
<span id="cb20-283"><a href="#cb20-283" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                            Dt = 10))</span></span>
<span id="cb20-284"><a href="#cb20-284" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-285"><a href="#cb20-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(Lpred, Spred, <span class="at">ylab_long =</span> <span class="fu">paste0</span>(<span class="st">"ID_"</span>, id_num, <span class="st">"  log(amh)"</span>))</span>
<span id="cb20-286"><a href="#cb20-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-287"><a href="#cb20-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Lpred =</span> Lpred,</span>
<span id="cb20-288"><a href="#cb20-288" aria-hidden="true" tabindex="-1"></a>              <span class="at">Spred =</span> Spred,</span>
<span id="cb20-289"><a href="#cb20-289" aria-hidden="true" tabindex="-1"></a>              <span class="at">nid0 =</span> nid0,</span>
<span id="cb20-290"><a href="#cb20-290" aria-hidden="true" tabindex="-1"></a>              <span class="at">nid =</span> nid))</span>
<span id="cb20-291"><a href="#cb20-291" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-292"><a href="#cb20-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-293"><a href="#cb20-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-294"><a href="#cb20-294" aria-hidden="true" tabindex="-1"></a>Some of the very steep trajectory for the risk function: <span class="in">`id5`</span>, <span class="in">`id26`</span>, <span class="in">`id56`</span>, <span class="in">`id333`</span>, <span class="in">`id342`</span>;</span>
<span id="cb20-295"><a href="#cb20-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-298"><a href="#cb20-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-299"><a href="#cb20-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "high_risk"</span></span>
<span id="cb20-300"><a href="#cb20-300" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The dynamic prediction for high risk individuals"</span></span>
<span id="cb20-301"><a href="#cb20-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb20-302"><a href="#cb20-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb20-303"><a href="#cb20-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id5_t4"</span></span>
<span id="cb20-304"><a href="#cb20-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id5_t8"</span></span>
<span id="cb20-305"><a href="#cb20-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id26_t4"</span></span>
<span id="cb20-306"><a href="#cb20-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id26_t8"</span></span>
<span id="cb20-307"><a href="#cb20-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id333_t4"</span></span>
<span id="cb20-308"><a href="#cb20-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id333_t8"</span></span>
<span id="cb20-309"><a href="#cb20-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-310"><a href="#cb20-310" aria-hidden="true" tabindex="-1"></a>dpplot_id5 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb20-311"><a href="#cb20-311" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">5</span>,</span>
<span id="cb20-312"><a href="#cb20-312" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb20-313"><a href="#cb20-313" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb20-314"><a href="#cb20-314" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116))</span>
<span id="cb20-315"><a href="#cb20-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-316"><a href="#cb20-316" aria-hidden="true" tabindex="-1"></a>dpplot_id26 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb20-317"><a href="#cb20-317" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">26</span>,</span>
<span id="cb20-318"><a href="#cb20-318" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb20-319"><a href="#cb20-319" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb20-320"><a href="#cb20-320" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116))</span>
<span id="cb20-321"><a href="#cb20-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-322"><a href="#cb20-322" aria-hidden="true" tabindex="-1"></a>dpplot_id333 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>),</span>
<span id="cb20-323"><a href="#cb20-323" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">333</span>,</span>
<span id="cb20-324"><a href="#cb20-324" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x,</span>
<span id="cb20-325"><a href="#cb20-325" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>,</span>
<span id="cb20-326"><a href="#cb20-326" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116))</span>
<span id="cb20-327"><a href="#cb20-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-328"><a href="#cb20-328" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(Lpred1)</span></span>
<span id="cb20-329"><a href="#cb20-329" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-330"><a href="#cb20-330" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(Lpred2)</span></span>
<span id="cb20-331"><a href="#cb20-331" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-332"><a href="#cb20-332" aria-hidden="true" tabindex="-1"></a><span class="co"># # prediction for the event outcome</span></span>
<span id="cb20-333"><a href="#cb20-333" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(Spred)</span></span>
<span id="cb20-334"><a href="#cb20-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-335"><a href="#cb20-335" aria-hidden="true" tabindex="-1"></a><span class="co"># combined into one plot, </span></span>
<span id="cb20-336"><a href="#cb20-336" aria-hidden="true" tabindex="-1"></a><span class="co"># the first longitudinal outcome and cumulative risk</span></span>
<span id="cb20-337"><a href="#cb20-337" aria-hidden="true" tabindex="-1"></a><span class="co"># the first two longitudinal outcomes</span></span>
<span id="cb20-338"><a href="#cb20-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-339"><a href="#cb20-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-340"><a href="#cb20-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-341"><a href="#cb20-341" aria-hidden="true" tabindex="-1"></a>Some of the smooth trajectory for the risk function: <span class="in">`id32`</span>, <span class="in">`id57`</span>, <span class="in">`id89`</span>, <span class="in">`id222`</span>,<span class="in">`id44`</span>, <span class="in">`id371`</span>;</span>
<span id="cb20-342"><a href="#cb20-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-345"><a href="#cb20-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-346"><a href="#cb20-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "low_risk"</span></span>
<span id="cb20-347"><a href="#cb20-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The dynamic prediction for low risk individuals"</span></span>
<span id="cb20-348"><a href="#cb20-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb20-349"><a href="#cb20-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb20-350"><a href="#cb20-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id32_t4"</span></span>
<span id="cb20-351"><a href="#cb20-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id32_t8"</span></span>
<span id="cb20-352"><a href="#cb20-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id371_t4"</span></span>
<span id="cb20-353"><a href="#cb20-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id371_t8"</span></span>
<span id="cb20-354"><a href="#cb20-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id44_t4"</span></span>
<span id="cb20-355"><a href="#cb20-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "id44_t8"</span></span>
<span id="cb20-356"><a href="#cb20-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-357"><a href="#cb20-357" aria-hidden="true" tabindex="-1"></a>dpplot_id32 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb20-358"><a href="#cb20-358" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">57</span>,</span>
<span id="cb20-359"><a href="#cb20-359" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb20-360"><a href="#cb20-360" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb20-361"><a href="#cb20-361" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116))</span>
<span id="cb20-362"><a href="#cb20-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-363"><a href="#cb20-363" aria-hidden="true" tabindex="-1"></a>dpplot_id371 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), </span>
<span id="cb20-364"><a href="#cb20-364" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">371</span>,</span>
<span id="cb20-365"><a href="#cb20-365" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x, </span>
<span id="cb20-366"><a href="#cb20-366" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb20-367"><a href="#cb20-367" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116))</span>
<span id="cb20-368"><a href="#cb20-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-369"><a href="#cb20-369" aria-hidden="true" tabindex="-1"></a>dpplot_id44 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>),</span>
<span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">dpplot</span>(<span class="at">id_num =</span> <span class="dv">44</span>,</span>
<span id="cb20-371"><a href="#cb20-371" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> .x,</span>
<span id="cb20-372"><a href="#cb20-372" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>,</span>
<span id="cb20-373"><a href="#cb20-373" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116))</span>
<span id="cb20-374"><a href="#cb20-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-375"><a href="#cb20-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-376"><a href="#cb20-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predictive accuracy measures</span></span>
<span id="cb20-377"><a href="#cb20-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-378"><a href="#cb20-378" aria-hidden="true" tabindex="-1"></a>The materials are directly from **Dimitris Rizopoulos &amp; Grigorios Papageorg** (details seen JMwithR notes 6.3)</span>
<span id="cb20-379"><a href="#cb20-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-380"><a href="#cb20-380" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Discrimination: sensitivity, specificity, ROC and AUC</span>
<span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calibration: comparison between predicted and observed probabilities</span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Overall: combination of discrimination and calibration</span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a>Sidenotes: we do not have right censor (possessively considering the left censor)</span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a>To estimate the sensitivity, specificity and the AUC, we need to account for censoring. Two main approaches:</span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>model-based weights</span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Advantage: it allows censoring to depend on the longitudinal history (in any possible manner)</span>
<span id="cb20-391"><a href="#cb20-391" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Disadvantage: it requires that the model is well calibrated</span>
<span id="cb20-392"><a href="#cb20-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-393"><a href="#cb20-393" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>inverse probability of censoring weighting (IPCW) (using Kaplan-Meier or other non-parametric estimators)</span>
<span id="cb20-394"><a href="#cb20-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-395"><a href="#cb20-395" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Advantage: it provides unbiased estimates even when the model is misspecified</span>
<span id="cb20-396"><a href="#cb20-396" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Disadvantage: it requires that the model for the weights is correct</span>
<span id="cb20-397"><a href="#cb20-397" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**in settings where joint models are used, challenging because censoring may depend on the longitudinal outcomes in a complex manner**</span>
<span id="cb20-398"><a href="#cb20-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-399"><a href="#cb20-399" aria-hidden="true" tabindex="-1"></a><span class="fu">### AUC</span></span>
<span id="cb20-400"><a href="#cb20-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-401"><a href="#cb20-401" aria-hidden="true" tabindex="-1"></a>For <span class="in">`JMbayes2`</span>, the function <span class="in">`tvAUC()`</span> is used to estimate the time-dependent AUC only for all the subjects (there is no function for individual AUC).</span>
<span id="cb20-402"><a href="#cb20-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-405"><a href="#cb20-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-406"><a href="#cb20-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "auc_summary"</span></span>
<span id="cb20-407"><a href="#cb20-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-408"><a href="#cb20-408" aria-hidden="true" tabindex="-1"></a>AUC2  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116,</span>
<span id="cb20-409"><a href="#cb20-409" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-410"><a href="#cb20-410" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-411"><a href="#cb20-411" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">1</span>))</span>
<span id="cb20-412"><a href="#cb20-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-413"><a href="#cb20-413" aria-hidden="true" tabindex="-1"></a>AUC4  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116,</span>
<span id="cb20-414"><a href="#cb20-414" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-415"><a href="#cb20-415" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-416"><a href="#cb20-416" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb20-417"><a href="#cb20-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-418"><a href="#cb20-418" aria-hidden="true" tabindex="-1"></a>AUC6  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116,</span>
<span id="cb20-419"><a href="#cb20-419" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-420"><a href="#cb20-420" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-421"><a href="#cb20-421" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">3</span>))</span>
<span id="cb20-422"><a href="#cb20-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a>AUC8  <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes2.fit116,</span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">4</span>))</span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-428"><a href="#cb20-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-429"><a href="#cb20-429" aria-hidden="true" tabindex="-1"></a>Here is the table for the AUC result, using the same joint model for the dynamic prediction. Each AUC for a different time point and time window as 2.</span>
<span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a>The AUC score are calculated for the time points 2, 4, 6, and 8. It seems the best AUC score is at time 4, and the AUC score decreases as the time window increases. Based on the plots for individuals, some of the plot are missing, because there is no longitudinal data before the <span class="in">`Tstart`</span>.</span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "auc_result"</span></span>
<span id="cb20-435"><a href="#cb20-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-436"><a href="#cb20-436" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">Tstart =</span> <span class="fu">map</span>(<span class="fu">list</span>(AUC2, AUC4, AUC6, AUC8), <span class="st">"Tstart"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(),</span>
<span id="cb20-437"><a href="#cb20-437" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tend =</span> <span class="fu">map</span>(<span class="fu">list</span>(AUC2, AUC4, AUC6, AUC8), <span class="st">"Thoriz"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb20-438"><a href="#cb20-438" aria-hidden="true" tabindex="-1"></a>      <span class="at">AUC =</span> <span class="fu">map</span>(<span class="fu">list</span>(AUC2, AUC4, AUC6, AUC8), <span class="st">"auc"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb20-439"><a href="#cb20-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb20-440"><a href="#cb20-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-441"><a href="#cb20-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-442"><a href="#cb20-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### ROC</span></span>
<span id="cb20-443"><a href="#cb20-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a>ROC can be calculated based on both individual or all subjects. Here are the results for the ROC for all subject predictions.</span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a>The ROC results is consistent with the AUC results, the best ROC is at time 4, and the ROC score decreases as the <span class="in">`Tstart`</span> increases.</span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "roc_summary"</span></span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a>ROC2 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116,</span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a>ROC4 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116,</span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">3</span>))</span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a>ROC6 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116,</span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">4</span>))</span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a>ROC8 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvROC</span>(jmbayes2.fit116,</span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>                          swan_amh02,</span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-471"><a href="#cb20-471" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">5</span>))</span>
<span id="cb20-472"><a href="#cb20-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC2, <span class="at">ylab =</span> <span class="st">"Tstart_2 Sensitivity"</span>)</span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC4, <span class="at">ylab =</span> <span class="st">"Tstart_4 Sensitivity"</span>)</span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC6, <span class="at">ylab =</span> <span class="st">"Tstart_6 Sensitivity"</span>)</span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ROC8, <span class="at">ylab =</span> <span class="st">"Tstart_8 Sensitivity"</span>)</span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a><span class="fu">## Brier Score</span></span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-484"><a href="#cb20-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "bs_summary"</span></span>
<span id="cb20-485"><a href="#cb20-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a>BS2 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116,</span>
<span id="cb20-487"><a href="#cb20-487" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb20-488"><a href="#cb20-488" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-489"><a href="#cb20-489" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">2</span>))</span>
<span id="cb20-490"><a href="#cb20-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a>BS4 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116,</span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">3</span>))</span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a>BS6 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116,</span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">4</span>))</span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a>BS8 <span class="ot">&lt;-</span> <span class="fu">try</span>(JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes2.fit116,</span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> swan_amh02,</span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tstart =</span> <span class="dv">3</span>,</span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dt =</span> <span class="dv">5</span>))</span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r output.class = "scroll-100"}</span></span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "bs_result"</span></span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">Tstart =</span> <span class="fu">map</span>(<span class="fu">list</span>(BS2, BS4, BS6, BS8),</span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Tstart"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tend =</span> <span class="fu">map</span>(<span class="fu">list</span>(BS2, BS4, BS6, BS8), </span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Thoriz"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a>      <span class="at">BS =</span> <span class="fu">map</span>(<span class="fu">list</span>(BS2, BS4, BS6, BS8), </span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Brier"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "pdf"</span></span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"swan_amh_dynamic_prediction_tmin4_20240408.pdf"</span>)</span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a>dpplot_t4 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">600</span>, </span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">try</span>(<span class="fu">dpplot</span>(<span class="at">id_num =</span> .x,</span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> <span class="dv">4</span>, </span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116)))</span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"swan_amh_dynamic_prediction_tmin8_20240408.pdf"</span>)</span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a>dpplot_t8 <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">600</span>, </span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">try</span>(<span class="fu">dpplot</span>(<span class="at">id_num =</span> .x,</span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmin =</span> <span class="dv">8</span>, </span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tmax =</span> <span class="dv">12</span>, </span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmfit =</span> jmbayes2.fit116)))</span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`r praise::praise()`</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>