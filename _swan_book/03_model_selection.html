<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Randy Jin, Elizabeth Juarez-Colunga">
<title>SWAN AMH project analysis - 3&nbsp; Model selection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_jmbayes.html" rel="next">
<link href="./02_jm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SWAN AMH project analysis</span>
  </a>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        <div class="sidebar-tools-collapse tools-wide">
    <a href="https://github.com/Goodgolden/jm_amh" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="" class="sidebar-tool px-1"><i class="bi bi-share"></i></a>
    <a href="https://coloradosph.cuanschutz.edu/education/departments/biostatistics-informatics" title="" class="sidebar-tool px-1"><i class="bi bi-hospital"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Working log</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_table1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Table1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_jm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">JM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_model_selection.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_jmbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_jmbayes2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">JMbayes2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_jm_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JM Model Selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_value_auc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Value model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_rate_auc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_table1_publication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Table1 (for publication)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_final_model.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final model (for publication)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_convergence.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Convergence</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Selection I - Dummy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_model_selection_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Model Selection II - Factor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_rate_value_baseline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Rate Value Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_auc_ci.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">AUC CI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_review.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Paper Review</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#goal-for-this-chapter" id="toc-goal-for-this-chapter" class="nav-link active" data-scroll-target="#goal-for-this-chapter"> <span class="header-section-number">3.1</span> Goal for this chapter</a></li>
  <li><a href="#model-selelction" id="toc-model-selelction" class="nav-link" data-scroll-target="#model-selelction"> <span class="header-section-number">3.2</span> Model selelction</a></li>
  <li><a href="#backward-selection-of-vars" id="toc-backward-selection-of-vars" class="nav-link" data-scroll-target="#backward-selection-of-vars"> <span class="header-section-number">3.3</span> Backward selection of vars</a></li>
  <li>
<a href="#using-step-function" id="toc-using-step-function" class="nav-link" data-scroll-target="#using-step-function"> <span class="header-section-number">3.4</span> Using <code>step</code> function</a>
  <ul class="collapse">
<li><a href="#step-selected-best-model" id="toc-step-selected-best-model" class="nav-link" data-scroll-target="#step-selected-best-model"> <span class="header-section-number">3.4.1</span> <code>step()</code> selected “best” model</a></li>
  </ul>
</li>
  <li><a href="#joint-model-with-jmsurvfitjm" id="toc-joint-model-with-jmsurvfitjm" class="nav-link" data-scroll-target="#joint-model-with-jmsurvfitjm"> <span class="header-section-number">3.5</span> Joint model with <code>JM::survfitJM()</code></a></li>
  <li>
<a href="#trying-stratified-baseline-hazard" id="toc-trying-stratified-baseline-hazard" class="nav-link" data-scroll-target="#trying-stratified-baseline-hazard"> <span class="header-section-number">3.6</span> Trying stratified baseline hazard</a>
  <ul class="collapse">
<li><a href="#summary-for-survival-sub-models" id="toc-summary-for-survival-sub-models" class="nav-link" data-scroll-target="#summary-for-survival-sub-models"> <span class="header-section-number">3.6.1</span> Summary for Survival sub-models</a></li>
  <li><a href="#checking-stratification" id="toc-checking-stratification" class="nav-link" data-scroll-target="#checking-stratification"> <span class="header-section-number">3.6.2</span> Checking Stratification</a></li>
  </ul>
</li>
  <li>
<a href="#obtaining-dynamic-predictions" id="toc-obtaining-dynamic-predictions" class="nav-link" data-scroll-target="#obtaining-dynamic-predictions"> <span class="header-section-number">3.7</span> Obtaining dynamic predictions</a>
  <ul class="collapse">
<li><a href="#auc-and-roc" id="toc-auc-and-roc" class="nav-link" data-scroll-target="#auc-and-roc"> <span class="header-section-number">3.7.1</span> AUC and ROC</a></li>
  </ul>
</li>
  <li>
<a href="#time-dependent-slopes-parameterization" id="toc-time-dependent-slopes-parameterization" class="nav-link" data-scroll-target="#time-dependent-slopes-parameterization"> <span class="header-section-number">3.8</span> Time-Dependent Slopes Parameterization</a>
  <ul class="collapse">
<li><a href="#here-is-the-summarization-of-the-models" id="toc-here-is-the-summarization-of-the-models" class="nav-link" data-scroll-target="#here-is-the-summarization-of-the-models"> <span class="header-section-number">3.8.1</span> Here is the summarization of the models</a></li>
  <li><a href="#comparision-for-jm.fit21-and-jm.fit21d" id="toc-comparision-for-jm.fit21-and-jm.fit21d" class="nav-link" data-scroll-target="#comparision-for-jm.fit21-and-jm.fit21d"> <span class="header-section-number">3.8.2</span> Comparision for jm.fit21 and jm.fit21d</a></li>
  <li><a href="#comparision-for-jm.fit31-and-jm.fit31d" id="toc-comparision-for-jm.fit31-and-jm.fit31d" class="nav-link" data-scroll-target="#comparision-for-jm.fit31-and-jm.fit31d"> <span class="header-section-number">3.8.3</span> Comparision for jm.fit31 and jm.fit31d</a></li>
  <li><a href="#comparision-for-jm.fit21d-and-jm.fit31d" id="toc-comparision-for-jm.fit21d-and-jm.fit31d" class="nav-link" data-scroll-target="#comparision-for-jm.fit21d-and-jm.fit31d"> <span class="header-section-number">3.8.4</span> Comparision for jm.fit21d and jm.fit31d</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Goodgolden/jm_amh/edit/main/03_model_selection.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="cell" data-hash="03_model_selection_cache/html/css-setup_121c6d8a032c7b61e72549fb9b18d192">
<style type="text/css">

.scroll-100 {
  max-height: 300px;
  max-width: 1000px;
  overflow-y: auto;
  background-color: inherit;
  }

</style>
</div>
<section id="goal-for-this-chapter" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="goal-for-this-chapter">
<span class="header-section-number">3.1</span> Goal for this chapter</h2>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked="">
List of all the variables in the clean dataset</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Model selection for the survival sub-model (backward selection by EJC)</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Model selection for the survival sub-model with <code>step</code></p></li>
<li><p><input type="checkbox" disabled="" checked="">
Two methods are consistent with each other</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Joint model with the selected survival sub-model (by EJC)</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Joint model factorization v.s. stratification (by EJC)</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Fit the joint model with <code>JM</code> package and get ROC and AUC <span style="color:red">failed</span> (by EJC)</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Dynamic predictions for the joint model <span style="color:red">failed</span> ( by EJC)</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Exploring include the Rate (Time-Dependent Slopes) in the <code>JM</code> model</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Summary of model comparisons</p></li>
<li><p><input type="checkbox" disabled="" checked=""><code>JM</code> package cannot calculate individual AUC and ROC, and Brier Score.</p></li>
<li><p><input type="checkbox" disabled="" checked="">
You are divine!</p></li>
</ul></section><section id="model-selelction" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="model-selelction">
<span class="header-section-number">3.2</span> Model selelction</h2>
<ul>
<li><p>swan_amh0 is the longitudinal dataset</p></li>
<li><p>swan_amh1 is the id dataset</p></li>
</ul>
<div class="cell" data-hash="03_model_selection_cache/html/loading data_2ba47b8e13c2dd1498bcd111fd8b635a">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/swan_amh0.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/swan_amh1.rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="backward-selection-of-vars" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="backward-selection-of-vars">
<span class="header-section-number">3.3</span> Backward selection of vars</h2>
<p>The fitted model <code>surv.fit16</code> from this <code>03_model_selection</code> is the same as the <code>surv.fit1</code> from `02_jm.qmd. Need to keep <span class="math inline">\(site + ethnic + smoke + bmi\)</span>.</p>
<p>All the variables:<br>
- surv outcomes: “etime” “event”. - lme outcomes: “log(amh)”</p>
<ul>
<li>longitudinal vars:
<ul>
<li>“id”</li>
<li>“time”</li>
</ul>
</li>
<li>Not included into models:
<ul>
<li>“age”</li>
<li>“age0”</li>
<li>“bmi_cat”</li>
<li>“fmp_age”</li>
<li>“parity”</li>
<li>“phys_act”</li>
<li>“start_time”</li>
<li>“train”</li>
<li>“visit”</li>
</ul>
</li>
<li>survival vars:
<ul>
<li>
<em>“alcohol”</em>,</li>
<li>
<em>“bc_pills”</em>,</li>
<li>
<em>“bmi”</em>,</li>
<li>
<em>“children”</em>,</li>
<li>
<em>“edu”</em>,</li>
<li>
<em>“employed”</em>,</li>
<li>
<em>“ethnic”</em>,</li>
<li>
<em>“health”</em>,</li>
<li>
<em>“married”</em>,</li>
<li>
<em>“site”</em>,</li>
<li><em>“smoke”</em></li>
</ul>
</li>
</ul>
<div class="cell" data-hash="03_model_selection_cache/html/backward_selection_70f0834a2db43802409da322fb08766d">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">surv.fit10</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">children</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span> <span class="va">phys_act</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">alcohol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">employed</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Need to keep site + ethnic + smoke + bmi</span></span>
<span><span class="co">## testing for physical activity (taking out phys.act)</span></span>
<span><span class="va">surv.fit11</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">children</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">alcohol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">employed</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">surv.fit10</span>, <span class="va">surv.fit11</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["loglik"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["int"],"align":["right"]},{"label":["Pr(>|Chi|)"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"-3212.897","2":"NA","3":"NA","4":"NA","_rn_":"1"},{"1":"-3212.902","2":"0.009079354","3":"1","4":"0.9240879","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit10</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit11</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6477.795</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6475.804</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## testing for employed</span></span>
<span><span class="va">surv.fit12</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">children</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">alcohol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, x <span class="op">=</span> <span class="cn">TRUE</span>, model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">surv.fit11</span>, <span class="va">surv.fit12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["loglik"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["int"],"align":["right"]},{"label":["Pr(>|Chi|)"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"-3212.902","2":"NA","3":"NA","4":"NA","_rn_":"1"},{"1":"-3212.939","2":"0.07478947","3":"1","4":"0.7844868","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit11</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6475.804</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6473.879</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## testing for children</span></span>
<span><span class="va">surv.fit13</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">alcohol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, x <span class="op">=</span> <span class="cn">TRUE</span>, model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">surv.fit12</span>, <span class="va">surv.fit13</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["loglik"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["int"],"align":["right"]},{"label":["Pr(>|Chi|)"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"-3212.939","2":"NA","3":"NA","4":"NA","_rn_":"1"},{"1":"-3213.123","2":"0.3663142","3":"1","4":"0.5450203","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit12</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit13</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6473.879</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6472.245</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## testing for edu (education)</span></span>
<span><span class="va">surv.fit14</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">alcohol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit13</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit14</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6472.245</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6470.748</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## testing for alcohol</span></span>
<span><span class="va">surv.fit15</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit14</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6470.748</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6467.612</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## testing for health</span></span>
<span><span class="va">surv.fit16</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit15</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6467.612</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6467.465</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## testing for bc_pills</span></span>
<span><span class="va">surv.fit17</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>, </span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit16</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">surv.fit17</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6467.465</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6470.583</code></pre>
</div>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/survival_summary_955b7c0b9980b04e54772236d8df408f">
<details><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>fit11 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit11</span><span class="op">)</span>, </span>
<span>      fit12 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit12</span><span class="op">)</span>, </span>
<span>      fit13 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit13</span><span class="op">)</span>,</span>
<span>      fit14 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit14</span><span class="op">)</span>,</span>
<span>      fit15 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit15</span><span class="op">)</span>,</span>
<span>      fit16 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit16</span><span class="op">)</span>,</span>
<span>      fit17 <span class="op">=</span> <span class="fu">glance</span><span class="op">(</span><span class="va">surv.fit17</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fit11"</span>, <span class="st">"fit12"</span>, <span class="st">"fit13"</span>,</span>
<span>                  <span class="st">"fit14"</span>, <span class="st">"fit15"</span>, <span class="st">"fit16"</span>,</span>
<span>                  <span class="st">"fit17"</span><span class="op">)</span>,</span>
<span>         formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">surv.fit11</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                     <span class="va">surv.fit12</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                     <span class="va">surv.fit13</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                     <span class="va">surv.fit14</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                     <span class="va">surv.fit15</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                     <span class="va">surv.fit16</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>                     <span class="va">surv.fit17</span><span class="op">$</span><span class="va">formula</span><span class="op">)</span>,</span>
<span>         formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">logLik</span>, <span class="va">AIC</span>, </span>
<span>                <span class="va">BIC</span>, <span class="va">r.squared</span>, <span class="va">concordance</span>, <span class="va">formula</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["logLik"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["r.squared"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["concordance"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["formula"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"fit11","2":"-3213","3":"6476","4":"6586","5":"0.09327","6":"0.5904","7":"Surv(etime, event) ~ married + bc_pills + children + bmi + factor(site) + factor(ethnic) + factor(smoke) + factor(edu) + factor(alcohol) + factor(employed) + factor(health)"},{"1":"fit12","2":"-3213","3":"6474","4":"6579","5":"0.09316","6":"0.5905","7":"Surv(etime, event) ~ married + bc_pills + children + bmi + factor(site) + factor(ethnic) + factor(smoke) + factor(edu) + factor(alcohol) + factor(health)"},{"1":"fit13","2":"-3213","3":"6472","4":"6573","5":"0.09260","6":"0.5895","7":"Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + factor(ethnic) + factor(smoke) + factor(edu) + factor(alcohol) + factor(health)"},{"1":"fit14","2":"-3214","3":"6471","4":"6563","5":"0.08881","6":"0.5890","7":"Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + factor(ethnic) + factor(smoke) + factor(alcohol) + factor(health)"},{"1":"fit15","2":"-3216","3":"6468","4":"6547","5":"0.08445","6":"0.5928","7":"Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + factor(ethnic) + factor(smoke) + factor(health)"},{"1":"fit16","2":"-3219","3":"6467","4":"6533","5":"0.07548","6":"0.5867","7":"Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + factor(ethnic) + factor(smoke)"},{"1":"fit17","2":"-3221","3":"6471","4":"6532","5":"0.06756","6":"0.5760","7":"Surv(etime, event) ~ married + bmi + factor(site) + factor(ethnic) + factor(smoke)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Here is the final survival sub-model.</p>
<div class="cell" data-hash="03_model_selection_cache/html/final_model_be9a0ed297c152b2beb22461b9f42e2f">
<details><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">surv.fit16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"marriedMarried/Partnered","2":"0.217466","3":"0.094635","4":"2.2979","5":"2.157e-02"},{"1":"bc_pillsEver use BC pills","2":"-0.226803","3":"0.098830","4":"-2.2949","5":"2.174e-02"},{"1":"bmi","2":"-0.003069","3":"0.006736","4":"-0.4556","5":"6.487e-01"},{"1":"factor(site)C","2":"0.110275","3":"0.160266","4":"0.6881","5":"4.914e-01"},{"1":"factor(site)M","2":"0.269825","3":"0.152516","4":"1.7692","5":"7.687e-02"},{"1":"factor(site)NJ","2":"0.197014","3":"0.352414","4":"0.5590","5":"5.761e-01"},{"1":"factor(site)P","2":"0.567660","3":"0.160687","4":"3.5327","5":"4.113e-04"},{"1":"factor(site)UCD","2":"0.229941","3":"0.197170","4":"1.1662","5":"2.435e-01"},{"1":"factor(site)UCLA","2":"0.262552","3":"0.205660","4":"1.2766","5":"2.017e-01"},{"1":"factor(ethnic)BLACK","2":"-0.176359","3":"0.117141","4":"-1.5055","5":"1.322e-01"},{"1":"factor(ethnic)CHINE","2":"-0.046192","3":"0.208284","4":"-0.2218","5":"8.245e-01"},{"1":"factor(ethnic)HISPA","2":"-0.203216","3":"0.411435","4":"-0.4939","5":"6.214e-01"},{"1":"factor(ethnic)JAPAN","2":"-0.177552","3":"0.202408","4":"-0.8772","5":"3.804e-01"},{"1":"factor(smoke)Past Only","2":"0.068258","3":"0.104287","4":"0.6545","5":"5.128e-01"},{"1":"factor(smoke)Current Smoker","2":"0.593525","3":"0.136162","4":"4.3590","5":"1.307e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The comparison is not exactly make sense to me, so need to talk with EJC for further works on the model. Backward model selection is not my favorite 😞 at all.</p>
</section><section id="using-step-function" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="using-step-function">
<span class="header-section-number">3.4</span> Using <code>step</code> function</h2>
<p>The results show there are extra variables we can include, if necessary. Here are the results using step function.</p>
<p>The selection with upper of the full model including all the variables, the lower of the null model with only the intercept.</p>
<div class="cell" data-hash="03_model_selection_cache/html/step_function_1e1d263e8ef39159b38e896667b1f927">
<details><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">surv.fit1</span> <span class="op">&lt;-</span> <span class="va">surv.fit16</span></span>
<span><span class="va">surv.step</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="va">surv.fit1</span>, </span>
<span>                  scope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>upper <span class="op">=</span> <span class="op">~</span><span class="va">age</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">children</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> <span class="op">+</span></span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">alcohol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">employed</span><span class="op">)</span> <span class="op">+</span></span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>                               lower <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Start:  AIC=6467.46
#&gt; Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + 
#&gt;     factor(ethnic) + factor(smoke)
#&gt; 
#&gt;                    Df    AIC
#&gt; + age               1 6396.3
#&gt; - factor(ethnic)    4 6462.8
#&gt; - bmi               1 6465.7
#&gt; &lt;none&gt;                6467.5
#&gt; + factor(health)    3 6467.6
#&gt; - factor(site)      6 6468.6
#&gt; + children          1 6469.1
#&gt; + factor(employed)  1 6469.4
#&gt; + factor(edu)       2 6469.5
#&gt; - bc_pills          1 6470.6
#&gt; + factor(alcohol)   3 6470.6
#&gt; - married           1 6470.8
#&gt; - factor(smoke)     2 6480.8
#&gt; 
#&gt; Step:  AIC=6396.32
#&gt; Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + 
#&gt;     factor(ethnic) + factor(smoke) + age
#&gt; 
#&gt;                    Df    AIC
#&gt; - factor(ethnic)    4 6393.3
#&gt; + factor(health)    3 6393.4
#&gt; - bmi               1 6394.5
#&gt; &lt;none&gt;                6396.3
#&gt; - bc_pills          1 6397.9
#&gt; + factor(employed)  1 6398.0
#&gt; - factor(site)      6 6398.1
#&gt; + factor(edu)       2 6398.3
#&gt; + children          1 6398.3
#&gt; - married           1 6399.1
#&gt; + factor(alcohol)   3 6400.0
#&gt; - factor(smoke)     2 6408.6
#&gt; - age               1 6467.5
#&gt; 
#&gt; Step:  AIC=6393.28
#&gt; Surv(etime, event) ~ married + bc_pills + bmi + factor(site) + 
#&gt;     factor(smoke) + age
#&gt; 
#&gt;                    Df    AIC
#&gt; - bmi               1 6391.8
#&gt; &lt;none&gt;                6393.3
#&gt; + factor(health)    3 6393.6
#&gt; - bc_pills          1 6394.9
#&gt; + children          1 6395.0
#&gt; + factor(employed)  1 6395.1
#&gt; + factor(edu)       2 6396.3
#&gt; + factor(ethnic)    4 6396.3
#&gt; - factor(site)      6 6396.5
#&gt; + factor(alcohol)   3 6396.5
#&gt; - married           1 6396.8
#&gt; - factor(smoke)     2 6403.7
#&gt; - age               1 6462.8
#&gt; 
#&gt; Step:  AIC=6391.81
#&gt; Surv(etime, event) ~ married + bc_pills + factor(site) + factor(smoke) + 
#&gt;     age
#&gt; 
#&gt;                    Df    AIC
#&gt; &lt;none&gt;                6391.8
#&gt; + factor(health)    3 6392.8
#&gt; + bmi               1 6393.3
#&gt; + children          1 6393.4
#&gt; - bc_pills          1 6393.5
#&gt; + factor(employed)  1 6393.5
#&gt; + factor(ethnic)    4 6394.5
#&gt; + factor(alcohol)   3 6394.9
#&gt; + factor(edu)       2 6395.0
#&gt; - factor(site)      6 6395.2
#&gt; - married           1 6396.3
#&gt; - factor(smoke)     2 6402.4
#&gt; - age               1 6461.4</code></pre>
</div>
</div>
<section id="step-selected-best-model" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="step-selected-best-model">
<span class="header-section-number">3.4.1</span> <code>step()</code> selected “best” model</h3>
<p>Here are the final model from <code><a href="https://rdrr.io/r/stats/step.html">step()</a></code> function, which is does not including the <code>bmi</code> and <code>ethnic</code> variables. <strong><em>However the <code>age</code> is included in the model</em></strong>.</p>
<p>Need to talk with EJC, I was not sure why do not include <code>age</code> into the survival model.</p>
<div class="cell" data-hash="03_model_selection_cache/html/step_summary_f4baf86dcd5339090f9170bf987f960a">
<details><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">surv.step</span><span class="op">$</span><span class="va">formula</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Surv(etime, event) ~ married + bc_pills + factor(site) + factor(smoke) + 
#&gt;     age</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">surv.step</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"marriedMarried/Partnered","2":"0.23151384","3":"0.09184443","4":"2.52071718","5":"1.171159e-02"},{"1":"bc_pillsEver use BC pills","2":"-0.18730553","3":"0.09602176","4":"-1.95065705","5":"5.109786e-02"},{"1":"factor(site)C","2":"0.05655240","3":"0.15907711","4":"0.35550305","5":"7.222128e-01"},{"1":"factor(site)M","2":"0.24922854","3":"0.15029881","4":"1.65822033","5":"9.727300e-02"},{"1":"factor(site)NJ","2":"0.00492419","3":"0.22255838","4":"0.02212539","5":"9.823479e-01"},{"1":"factor(site)P","2":"0.56510365","3":"0.16053965","4":"3.52002544","5":"4.315054e-04"},{"1":"factor(site)UCD","2":"0.26189022","3":"0.14951591","4":"1.75158763","5":"7.984474e-02"},{"1":"factor(site)UCLA","2":"0.16127439","3":"0.14170923","4":"1.13806553","5":"2.550931e-01"},{"1":"factor(smoke)Past Only","2":"0.11407282","3":"0.10220381","4":"1.11613078","5":"2.643662e-01"},{"1":"factor(smoke)Current Smoker","2":"0.52823329","3":"0.13300340","4":"3.97157751","5":"7.139826e-05"},{"1":"age","2":"-0.14145889","3":"0.01708260","4":"-8.28087646","5":"1.222720e-16"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section></section><section id="joint-model-with-jmsurvfitjm" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="joint-model-with-jmsurvfitjm">
<span class="header-section-number">3.5</span> Joint model with <code>JM::survfitJM()</code>
</h2>
<p>Here is the joint model with</p>
<p><span class="math inline">\(lme.fit1 \sim (fixed = lamh \sim time, \ random = \sim time| id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<p>This is the most basic form, no slope, on interaction, on integral functions. Also the original model, included in EJC’s notes (<strong><em>the model with only factor(ethnic) + factor(smoke), STILL does not allow for calc of AUC.</em></strong>)</p>
<div class="cell" data-hash="03_model_selection_cache/html/joint_model_fad3b485e46f053f7defdc21a572a21d">
<details><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">### the model with only factor(ethnic) + factor(smoke) </span></span>
<span><span class="co">### STILL does not allow for calc of AUC</span></span>
<span><span class="va">lme.fit1</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span>, </span>
<span>                data <span class="op">=</span> <span class="va">swan_amh0</span>, </span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span><span class="op">|</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## joint model fit</span></span>
<span><span class="va">joint.fit1</span> <span class="op">&lt;-</span> <span class="fu">jointModel</span><span class="op">(</span><span class="va">lme.fit1</span>,</span>
<span>                         <span class="va">surv.fit1</span>,</span>
<span>                         timeVar <span class="op">=</span> <span class="st">"time"</span>, </span>
<span>                         method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">joint.fit1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; jointModel(lmeObject = lme.fit1, survObject = surv.fit1, timeVar = "time", 
#&gt;     method = "piecewise-PH-aGH")
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of Groups: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with piecewise-constant
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent 
#&gt; 
#&gt;    log.Lik      AIC      BIC
#&gt;  -7332.592 14723.18 14850.69
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr
#&gt; (Intercept)  1.6032  (Intr)
#&gt; time         0.0343 -0.0856
#&gt; Residual     1.3030        
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err  z-value p-value
#&gt; (Intercept)  7.8648  0.0983  80.0274 &lt;0.0001
#&gt; time        -0.5750  0.0102 -56.4857 &lt;0.0001
#&gt; 
#&gt; Event Process
#&gt;                               Value Std.Err  z-value p-value
#&gt; marriedMarried/Partnered     0.1046  0.1086   0.9635  0.3353
#&gt; bc_pillsEver use BC pills    0.0461  0.1182   0.3900  0.6966
#&gt; bmi                         -0.0461  0.0083  -5.5319 &lt;0.0001
#&gt; factor(site)C                0.2484  0.1853   1.3404  0.1801
#&gt; factor(site)M                0.2076  0.1751   1.1858  0.2357
#&gt; factor(site)NJ               0.4929  0.4129   1.1938  0.2326
#&gt; factor(site)P                0.4339  0.1873   2.3163  0.0205
#&gt; factor(site)UCD              0.0377  0.2312   0.1629  0.8706
#&gt; factor(site)UCLA             0.2987  0.2376   1.2575  0.2086
#&gt; factor(ethnic)BLACK         -0.3622  0.1378  -2.6279  0.0086
#&gt; factor(ethnic)CHINE         -0.2540  0.2529  -1.0044  0.3152
#&gt; factor(ethnic)HISPA         -1.0355  0.4859  -2.1310  0.0331
#&gt; factor(ethnic)JAPAN         -0.0771  0.2338  -0.3299  0.7414
#&gt; factor(smoke)Past Only      -0.0536  0.1211  -0.4424  0.6582
#&gt; factor(smoke)Current Smoker  0.0182  0.1574   0.1157  0.9079
#&gt; Assoct                      -0.9124  0.0507 -17.9923 &lt;0.0001
#&gt; log(xi.1)                    0.5680  0.3779   1.5029        
#&gt; log(xi.2)                    1.3103  0.3592   3.6477        
#&gt; log(xi.3)                    1.5893  0.3560   4.4643        
#&gt; log(xi.4)                    1.7405  0.3513   4.9541        
#&gt; log(xi.5)                    1.9391  0.3522   5.5054        
#&gt; log(xi.6)                    2.1029  0.3511   5.9899        
#&gt; log(xi.7)                    2.1715  0.3459   6.2779        
#&gt; 
#&gt; Integration:
#&gt; method: (pseudo) adaptive Gauss-Hermite
#&gt; quadrature points: 3 
#&gt; 
#&gt; Optimization:
#&gt; Convergence: 0</code></pre>
</div>
</div>
</section><section id="trying-stratified-baseline-hazard" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="trying-stratified-baseline-hazard">
<span class="header-section-number">3.6</span> Trying stratified baseline hazard</h2>
<ul>
<li><p>One is to include the other covariates (or multiple covariates) as regression terms for the hazard function.</p></li>
<li><p>Alternatively, if the covariates we are adjusting for is categorical with a small number of levels <span class="math inline">\(G\)</span>, we may construct a stratified log-rank test.</p></li>
</ul>
<p>If we stratify on event with <code>strata()</code> we get estimates of the effect of the covariates on events under the assumption that they affect both groups equally.</p>
<div class="cell" data-hash="03_model_selection_cache/html/stratified_baseline_1134c43d861a531222ecaa7bb44be1c7">
<details><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># surv.fit1 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +</span></span>
<span><span class="co">#                       factor(site) + factor(ethnic) + factor(smoke),</span></span>
<span><span class="co">#                     data = swan_amh1, </span></span>
<span><span class="co">#                     x = TRUE,</span></span>
<span><span class="co">#                     model = TRUE)</span></span>
<span></span>
<span><span class="va">surv.fit2</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                     <span class="fu">strata</span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">swan_amh1</span>,</span>
<span>                   x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># anova(surv.fit1, surv.fit2)</span></span>
<span></span>
<span><span class="co">## joint model fit</span></span>
<span><span class="va">joint.fit2</span> <span class="op">&lt;-</span> <span class="fu">jointModel</span><span class="op">(</span><span class="va">lme.fit1</span>,</span>
<span>                         <span class="va">surv.fit2</span>,</span>
<span>                         timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                         method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span>
<span><span class="co"># summary(joint.fit2)</span></span>
<span></span>
<span></span>
<span><span class="co">### only smoke as a strata</span></span>
<span><span class="va">surv.fit3</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span>  <span class="op">+</span> <span class="va">bmi</span>  <span class="op">+</span></span>
<span>                     <span class="fu">strata</span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span> ,</span>
<span>                  data <span class="op">=</span> <span class="va">swan_amh1</span>,</span>
<span>                  x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># summary(surv.fit3)</span></span>
<span></span>
<span><span class="co">## joint model fit</span></span>
<span><span class="va">joint.fit3</span> <span class="op">&lt;-</span> <span class="fu">jointModel</span><span class="op">(</span><span class="va">lme.fit1</span>, </span>
<span>                         <span class="va">surv.fit3</span>,</span>
<span>                         timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                         method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="summary-for-survival-sub-models" class="level3" data-number="3.6.1"><h3 data-number="3.6.1" class="anchored" data-anchor-id="summary-for-survival-sub-models">
<span class="header-section-number">3.6.1</span> Summary for Survival sub-models</h3>
<div class="cell" data-hash="03_model_selection_cache/html/surv.fit2_ff65f5b0ce2eec2749ec746edf87e229">
<details><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">surv.fit2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Call:
#&gt; coxph(formula = Surv(etime, event) ~ married + bc_pills + bmi + 
#&gt;     strata(site) + strata(ethnic) + strata(smoke), data = swan_amh1, 
#&gt;     model = TRUE, x = TRUE)
#&gt; 
#&gt;                                coef exp(coef)  se(coef)      z      p
#&gt; marriedMarried/Partnered   0.193505  1.213495  0.105891  1.827 0.0676
#&gt; bc_pillsEver use BC pills -0.263812  0.768118  0.108311 -2.436 0.0149
#&gt; bmi                       -0.009317  0.990726  0.007385 -1.262 0.2071
#&gt; 
#&gt; Likelihood ratio test=11.22  on 3 df, p=0.01058
#&gt; n= 600, number of events= 600</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">joint.fit2</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt;                                 Value     Std.Err     z-value      p-value
#&gt; marriedMarried/Partnered   0.10653622 0.106343402   1.0018132 3.164338e-01
#&gt; bc_pillsEver use BC pills  0.03254861 0.110711120   0.2939958 7.687611e-01
#&gt; bmi                       -0.05699208 0.007519614  -7.5791230 3.478986e-14
#&gt; Assoct                    -0.90227544 0.048728325 -18.5164470 1.521530e-76
#&gt; log(xi.1)                  0.90947411 0.325786841   2.7916232 5.244439e-03
#&gt; log(xi.2)                  1.64843965 0.308169879   5.3491264 8.837978e-08
#&gt; log(xi.3)                  1.91466278 0.305316339   6.2710787 3.585554e-10
#&gt; log(xi.4)                  2.06507118 0.302787502   6.8201995 9.091415e-12
#&gt; log(xi.5)                  2.24995839 0.306371473   7.3438900 2.074737e-13
#&gt; log(xi.6)                  2.40716838 0.304598942   7.9027470 2.728229e-15
#&gt; log(xi.7)                  2.45377514 0.307136142   7.9892100 1.358062e-15</code></pre>
</div>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/surv.fit3_c0e8592471949ec24b12ee24b03f4c21">
<details><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">surv.fit3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Call:
#&gt; coxph(formula = Surv(etime, event) ~ married + bc_pills + bmi + 
#&gt;     strata(smoke), data = swan_amh1, model = TRUE, x = TRUE)
#&gt; 
#&gt;                                coef exp(coef)  se(coef)      z      p
#&gt; marriedMarried/Partnered   0.211912  1.236039  0.093244  2.273 0.0230
#&gt; bc_pillsEver use BC pills -0.236141  0.789670  0.095720 -2.467 0.0136
#&gt; bmi                       -0.005804  0.994212  0.006085 -0.954 0.3401
#&gt; 
#&gt; Likelihood ratio test=13.45  on 3 df, p=0.003752
#&gt; n= 600, number of events= 600</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">joint.fit3</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt;                                 Value     Std.Err     z-value      p-value
#&gt; marriedMarried/Partnered   0.10653622 0.106343402   1.0018132 3.164338e-01
#&gt; bc_pillsEver use BC pills  0.03254861 0.110711120   0.2939958 7.687611e-01
#&gt; bmi                       -0.05699208 0.007519614  -7.5791230 3.478986e-14
#&gt; Assoct                    -0.90227544 0.048728325 -18.5164470 1.521530e-76
#&gt; log(xi.1)                  0.90947411 0.325786841   2.7916232 5.244439e-03
#&gt; log(xi.2)                  1.64843965 0.308169879   5.3491264 8.837978e-08
#&gt; log(xi.3)                  1.91466278 0.305316339   6.2710787 3.585554e-10
#&gt; log(xi.4)                  2.06507118 0.302787502   6.8201995 9.091415e-12
#&gt; log(xi.5)                  2.24995839 0.306371473   7.3438900 2.074737e-13
#&gt; log(xi.6)                  2.40716838 0.304598942   7.9027470 2.728229e-15
#&gt; log(xi.7)                  2.45377514 0.307136142   7.9892100 1.358062e-15</code></pre>
</div>
</div>
</section><section id="checking-stratification" class="level3" data-number="3.6.2"><h3 data-number="3.6.2" class="anchored" data-anchor-id="checking-stratification">
<span class="header-section-number">3.6.2</span> Checking Stratification</h3>
<div class="cell" data-hash="03_model_selection_cache/html/survdiff_b1a2015bbd5dee6aeca2c3ea5c5c75f1">
<details><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">bc_pills</span>, data <span class="op">=</span> <span class="va">swan_amh1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Call:
#&gt; survdiff(formula = Surv(etime, event) ~ bc_pills, data = swan_amh1)
#&gt; 
#&gt;                              N Observed Expected (O-E)^2/E (O-E)^2/V
#&gt; bc_pills=Never             155      155      137     2.361      3.09
#&gt; bc_pills=Ever use BC pills 445      445      463     0.699      3.09
#&gt; 
#&gt;  Chisq= 3.1  on 1 degrees of freedom, p= 0.08</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>         data <span class="op">=</span> <span class="va">swan_amh1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Call:
#&gt; survdiff(formula = Surv(etime, event) ~ bc_pills + strata(site) + 
#&gt;     strata(ethnic) + strata(smoke), data = swan_amh1)
#&gt; 
#&gt;                              N Observed Expected (O-E)^2/E (O-E)^2/V
#&gt; bc_pills=Never             155      155      134     3.165      5.33
#&gt; bc_pills=Ever use BC pills 445      445      466     0.913      5.33
#&gt; 
#&gt;  Chisq= 5.3  on 1 degrees of freedom, p= 0.02</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span>, data <span class="op">=</span> <span class="va">swan_amh1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Call:
#&gt; survdiff(formula = Surv(etime, event) ~ married, data = swan_amh1)
#&gt; 
#&gt;                                 N Observed Expected (O-E)^2/E (O-E)^2/V
#&gt; married=Not Married/Partnered 191      191      218      3.29       5.3
#&gt; married=Married/Partnered     409      409      382      1.87       5.3
#&gt; 
#&gt;  Chisq= 5.3  on 1 degrees of freedom, p= 0.02</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">survdiff</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>         data <span class="op">=</span> <span class="va">swan_amh1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Call:
#&gt; survdiff(formula = Surv(etime, event) ~ married + strata(site) + 
#&gt;     strata(ethnic) + strata(smoke), data = swan_amh1)
#&gt; 
#&gt;                                 N Observed Expected (O-E)^2/E (O-E)^2/V
#&gt; married=Not Married/Partnered 191      191      211      1.85      4.03
#&gt; married=Married/Partnered     409      409      389      1.00      4.03
#&gt; 
#&gt;  Chisq= 4  on 1 degrees of freedom, p= 0.04</code></pre>
</div>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/tidy_surv_307cb772abe9a85069360f87bd694a58">
<details><summary>Code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">surv.fit1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"marriedMarried/Partnered","2":"0.217465530","3":"0.094634892","4":"2.2979424","5":"2.156507e-02"},{"1":"bc_pillsEver use BC pills","2":"-0.226803135","3":"0.098830071","4":"-2.2948798","5":"2.174001e-02"},{"1":"bmi","2":"-0.003068959","3":"0.006736199","4":"-0.4555921","5":"6.486833e-01"},{"1":"factor(site)C","2":"0.110274708","3":"0.160265964","4":"0.6880732","5":"4.914067e-01"},{"1":"factor(site)M","2":"0.269824705","3":"0.152515577","4":"1.7691616","5":"7.686691e-02"},{"1":"factor(site)NJ","2":"0.197013667","3":"0.352413553","4":"0.5590411","5":"5.761337e-01"},{"1":"factor(site)P","2":"0.567659661","3":"0.160687132","4":"3.5327014","5":"4.113367e-04"},{"1":"factor(site)UCD","2":"0.229940863","3":"0.197170104","4":"1.1662055","5":"2.435314e-01"},{"1":"factor(site)UCLA","2":"0.262551896","3":"0.205659733","4":"1.2766325","5":"2.017320e-01"},{"1":"factor(ethnic)BLACK","2":"-0.176359311","3":"0.117141484","4":"-1.5055240","5":"1.321894e-01"},{"1":"factor(ethnic)CHINE","2":"-0.046192475","3":"0.208284361","4":"-0.2217760","5":"8.244883e-01"},{"1":"factor(ethnic)HISPA","2":"-0.203215899","3":"0.411435090","4":"-0.4939197","5":"6.213629e-01"},{"1":"factor(ethnic)JAPAN","2":"-0.177551861","3":"0.202407650","4":"-0.8771994","5":"3.803784e-01"},{"1":"factor(smoke)Past Only","2":"0.068258133","3":"0.104287422","4":"0.6545193","5":"5.127773e-01"},{"1":"factor(smoke)Current Smoker","2":"0.593525361","3":"0.136161876","4":"4.3589687","5":"1.306768e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">surv.fit2</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"marriedMarried/Partnered","2":"0.19350486","3":"0.10589109","4":"1.827395","5":"0.06764038"},{"1":"bc_pillsEver use BC pills","2":"-0.26381246","3":"0.10831058","4":"-2.435704","5":"0.01486286"},{"1":"bmi","2":"-0.00931747","3":"0.00738488","4":"-1.261695","5":"0.20705838"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">surv.fit3</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"marriedMarried/Partnered","2":"0.211911583","3":"0.093243608","4":"2.272666","5":"0.02304631"},{"1":"bc_pillsEver use BC pills","2":"-0.236140656","3":"0.095720183","4":"-2.466989","5":"0.01362545"},{"1":"bmi","2":"-0.005804342","3":"0.006084535","4":"-0.953950","5":"0.34010896"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section></section><section id="obtaining-dynamic-predictions" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="obtaining-dynamic-predictions">
<span class="header-section-number">3.7</span> Obtaining dynamic predictions</h2>
<p>This function accepts as main arguments a fitted joint model and a data frame that contains the longitudinal and covariate information for the subjects for which we wish to calculate the predicted survival probabilities.</p>
<div class="cell" data-hash="03_model_selection_cache/html/dynamic_predictions_8ddf451dad3efe8460ba84ef0bbffb7f">
<details><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">swan_amh0</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">## length(ids)</span></span>
<span><span class="co">## Prediction for the survival outcomes</span></span>
<span><span class="va">ND1</span> <span class="op">&lt;-</span> <span class="va">swan_amh0</span><span class="op">[</span><span class="va">swan_amh0</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>, <span class="op">]</span> <span class="co">## 4, 5, 7 (not so good)</span></span>
<span><span class="va">sfit</span> <span class="op">&lt;-</span> <span class="fu">JM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JM/man/survfitJM.html">survfitJM</a></span><span class="op">(</span><span class="va">joint.fit3</span>,</span>
<span>                      newdata <span class="op">=</span> <span class="va">ND1</span>, </span>
<span>                      idVar <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/id110_f1d89c54a85828961cdda84c9d85a659">
<details><summary>Code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ND1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["age0"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["alcohol"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["amh"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["bc_pills"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["bmi"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["bmi_cat"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["children"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["edu"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["employed"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["ethnic"],"name":[12],"type":["chr"],"align":["left"]},{"label":["etime"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["event"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["fmp_age"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["health"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["married"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["parity"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["phys_act"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["site"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["smoke"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["start_time"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["time"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["train"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["visit"],"name":[25],"type":["chr"],"align":["left"]},{"label":["lamh"],"name":[26],"type":["dbl"],"align":["right"]}],"data":[{"1":"1100663","2":"44","3":"43","4":"0","5":"852.83","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"2","24":"1","25":"01","26":"6.7485602"},{"1":"1100663","2":"45","3":"43","4":"0","5":"354.36","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"3","24":"1","25":"02","26":"5.8703133"},{"1":"1100663","2":"46","3":"43","4":"0","5":"176.38","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"4","24":"1","25":"03","26":"5.1726408"},{"1":"1100663","2":"47","3":"43","4":"0","5":"255.05","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"5","24":"1","25":"04","26":"5.5414596"},{"1":"1100663","2":"49","3":"43","4":"0","5":"1.45","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"7","24":"1","25":"05","26":"0.3715636"},{"1":"1100663","2":"49","3":"43","4":"0","5":"1.85","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"7","24":"1","25":"06","26":"0.6151856"},{"1":"1100663","2":"51","3":"43","4":"0","5":"19.30","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"9","24":"1","25":"07","26":"2.9601051"},{"1":"1100663","2":"51","3":"43","4":"0","5":"2.36","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"9","24":"1","25":"08","26":"0.8586616"},{"1":"1100663","2":"52","3":"43","4":"0","5":"1.45","6":"0","7":"30.81796","8":"3","9":"3","10":"2","11":"1","12":"BLACK","13":"11.58248","14":"1","15":"53.58248","16":"2","17":"0","18":"3","19":"11.35","20":"11","21":"1","22":"1","23":"10","24":"1","25":"09","26":"0.3715636"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># subset(ND1, </span></span>
<span><span class="co">#        select = c('id', 'age0', 'time', </span></span>
<span><span class="co">#                   'start_time', </span></span>
<span><span class="co">#                   'etime', 'amh'))</span></span>
<span><span class="co">#                   </span></span>
<span></span>
<span><span class="va">sfit</span><span class="op">$</span><span class="va">summaries</span><span class="op">$</span><span class="va">`1100390`</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">id1100390</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">swan_amh0</span>, <span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">etime</span>, <span class="va">lamh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/plot_dm_1f82f539c95c5e98334edb1f0b7fd719">
<details><summary>Code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sfit</span>, estimator <span class="op">=</span> <span class="st">"mean"</span>, </span>
<span>     include.y <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     conf.int <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     fill.area <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     col.area <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="03_model_selection_files/figure-html/plot_dm-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="auc-and-roc" class="level3" data-number="3.7.1"><h3 data-number="3.7.1" class="anchored" data-anchor-id="auc-and-roc">
<span class="header-section-number">3.7.1</span> AUC and ROC</h3>
<p>I can only pullout the AUC for certain models, not all of them. The ROC function gets problems too. There is also on function for Brier Score in <code>JM</code> package.</p>
<div class="cell" data-hash="03_model_selection_cache/html/auc_5a990899366d97a21f1fb14260f8bccd">
<details><summary>Code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Tstart is the time up which long measurements are used in the predictions</span></span>
<span><span class="co">## Dt = is the window of time that will be considered for predictions;</span></span>
<span><span class="co">## discrimination is calculated based on this window</span></span>
<span><span class="va">auc2.t3</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JM/man/aucJM.html">aucJM</a></span><span class="op">(</span><span class="va">joint.fit2</span>,</span>
<span>                     newdata <span class="op">=</span> <span class="va">swan_amh0</span>,</span>
<span>                     idVar <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                     Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                     Dt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in eval(attr(TermsT, "variables"), data.id)[[kk]] : 
#&gt;   recursive indexing failed at level 2</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">auc2.t3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Error in eval(attr(TermsT, \"variables\"), data.id)[[kk]] : \n  recursive indexing failed at level 2\n\n"
#&gt; attr(,"class")
#&gt; [1] "try-error"
#&gt; attr(,"condition")
#&gt; &lt;simpleError in eval(attr(TermsT, "variables"), data.id)[[kk]]: recursive indexing failed at level 2
#&gt; &gt;</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">auc1</span> <span class="op">&lt;-</span> <span class="fu">JM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JM/man/aucJM.html">aucJM</a></span><span class="op">(</span><span class="va">joint.fit3</span>,</span>
<span>                  newdata <span class="op">=</span> <span class="va">swan_amh0</span>,</span>
<span>                  idVar <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                  Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                  Dt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co">##</span></span>
<span></span>
<span><span class="va">auc2</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">JM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JM/man/aucJM.html">aucJM</a></span><span class="op">(</span><span class="va">joint.fit3</span>, </span>
<span>                  newdata <span class="op">=</span> <span class="va">swan_amh0</span>,</span>
<span>                  idVar <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                  Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                  Dt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">auc2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;  Time-dependent AUC for the Cox Model joint.fit3
#&gt; 
#&gt; Estimated AUC: 0.8774
#&gt; At time: 8
#&gt; Using information up to time: 5 (407 subjects still at risk)</code></pre>
</div>
</div>
</section></section><section id="time-dependent-slopes-parameterization" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="time-dependent-slopes-parameterization">
<span class="header-section-number">3.8</span> Time-Dependent Slopes Parameterization</h2>
<p>However, since for each patient the marker follows a trajectory in time, it is also reasonable to consider parameterizations that allow the risk for an event to also depend on other features of this trajectory. A parameterization of this type has been considered by <code>Ye et al. (2008b)</code> who postulated a joint model in which the risk depends on both the current true value of the trajectory and the slope of the true trajectory at time <code>t</code>.</p>
<p><span class="math display">\[
\begin{split}
  h_i(t) &amp; = h_0(t) \exp\{\gamma^{\top}w_i + \alpha_1 m_i(t) + \alpha_2 m'_i(t)\}\\
  m'_i(t) &amp; = \frac {d} {dt} m_i(t) = \frac {d} {dt} \{ x^{\top}_i (t) \beta + z_i^{\top} (t) b_i \}\\
  m'_i(t) &amp; = [x_i^{slope}(t)]^{\top} \beta^{slope} + [z_i^{slope}(t)]^{\top} b_i^{slope}
\end{split}
\]</span></p>
<ul>
<li><p>Including the interaction term in the cox-model for <span class="math inline">\(m_i\)</span></p></li>
<li>
<p>The <code>time</code> variable needs to be nonlinear for the longitudinal data</p>
<ul>
<li>so I included the <code>I(time^2)</code> term in the <code>lme</code> model</li>
</ul>
</li>
</ul>
<div class="cell" data-hash="03_model_selection_cache/html/lme_extended_9d13cd6d630efeeb60fcb1ca862904d0">
<details><summary>Code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu">lmeControl</span><span class="op">(</span>opt <span class="op">=</span> <span class="st">"optim"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lme.fit2</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">swan_amh0</span>, </span>
<span>                control <span class="op">=</span> <span class="va">control</span>,</span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span><span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lme.fit3</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">swan_amh0</span>, </span>
<span>                control <span class="op">=</span> <span class="va">control</span>,</span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu">glance</span><span class="op">(</span><span class="va">lme.fit1</span><span class="op">)</span>, </span>
<span>      <span class="fu">glance</span><span class="op">(</span><span class="va">lme.fit2</span><span class="op">)</span>, </span>
<span>      <span class="fu">glance</span><span class="op">(</span><span class="va">lme.fit3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["nobs"],"name":[1],"type":["int"],"align":["right"]},{"label":["sigma"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"3326","2":"1.299196","3":"-6285.852","4":"12583.70","5":"12620.36"},{"1":"3326","2":"1.275991","3":"-6252.895","4":"12519.79","5":"12562.55"},{"1":"3326","2":"1.272585","3":"-6252.028","4":"12524.06","5":"12585.14"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/joint_model_slope_55e7c7664e5ef5aec949171dc83faa65">
<details><summary>Code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">jm.fit21</span> <span class="op">&lt;-</span> <span class="fu">jointModel</span><span class="op">(</span><span class="va">lme.fit2</span>,</span>
<span>                       <span class="va">surv.fit1</span>,</span>
<span>                       timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jm.fit31</span> <span class="op">&lt;-</span> <span class="fu">jointModel</span><span class="op">(</span><span class="va">lme.fit3</span>,</span>
<span>                       <span class="va">surv.fit1</span>,</span>
<span>                       timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"piecewise-PH-aGH"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># jm.fit22 &lt;- jointModel(lme.fit2,</span></span>
<span><span class="co">#                        surv.fit2,</span></span>
<span><span class="co">#                        timeVar = "time",</span></span>
<span><span class="co">#                        # interFact = list(value = ~ age,</span></span>
<span><span class="co">#                        #                  ##  a named list with a component named value</span></span>
<span><span class="co">#                        #                  ##  that provides an R formula specifying the</span></span>
<span><span class="co">#                        #                  ##  form of the W2 design matrix</span></span>
<span><span class="co">#                        #                  data = swan_amh1),</span></span>
<span><span class="co">#                        method = "piecewise-PH-aGH")</span></span>
<span></span>
<span><span class="co"># jm.fit32 &lt;- jointModel(lme.fit3,</span></span>
<span><span class="co">#                        surv.fit2,</span></span>
<span><span class="co">#                        timeVar = "time",</span></span>
<span><span class="co">#                        method = "piecewise-PH-aGH")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="03_model_selection_cache/html/derivative_9a69446d0c8d56cb2c17c5b365c6a356">
<details><summary>Code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># model.matrix(lamh ~ time + I(time^2), </span></span>
<span><span class="co">#                 data = swan_amh0)</span></span>
<span><span class="va">dform2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span>,</span>
<span>              <span class="co">## the 2nd and 3rd fixed effects of mi(t) used</span></span>
<span>              indFixed <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, </span>
<span>              random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>              <span class="co">## the second random effect of mi(t)</span></span>
<span>              indRandom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dform3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span>,</span>
<span>              <span class="co">## the 2nd and 3rd fixed effects of mi(t) used</span></span>
<span>              indFixed <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, </span>
<span>              random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span>, </span>
<span>              <span class="co">## the second and third random effect of mi(t)</span></span>
<span>              indRandom <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Warning: Stop time must be &gt; start time, NA created</p>
<div class="cell" data-hash="03_model_selection_cache/html/update_model_81adec280e7c6948abaa2a221061bf88">
<details><summary>Code</summary><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">jm.fit21d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">jm.fit21</span>,</span>
<span>                    parameterization <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>                    derivForm <span class="op">=</span> <span class="va">dform2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jm.fit31d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">jm.fit31</span>,</span>
<span>                    parameterization <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>                    derivForm <span class="op">=</span> <span class="va">dform3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="here-is-the-summarization-of-the-models" class="level3" data-number="3.8.1"><h3 data-number="3.8.1" class="anchored" data-anchor-id="here-is-the-summarization-of-the-models">
<span class="header-section-number">3.8.1</span> Here is the summarization of the models</h3>
<p><span class="math inline">\(lme.fit2 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time| id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<div class="cell" data-hash="03_model_selection_cache/html/summary_slope_models21_eee87e16eb977bebdb7021bd8246588b">
<details><summary>Code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jm.fit21d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in sqrt(diag(VarCov[indY, indY])): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in sqrt(diag(VarCov[indT, indT])): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; jointModel(lmeObject = lme.fit2, survObject = surv.fit1, timeVar = "time", 
#&gt;     parameterization = "both", method = "piecewise-PH-aGH", derivForm = dform2)
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of Groups: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with piecewise-constant
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent + time-dependent slope 
#&gt; 
#&gt;    log.Lik      AIC      BIC
#&gt;  -7313.277 14688.55 14824.86
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr
#&gt; (Intercept)  1.2758  (Intr)
#&gt; time         0.0612  0.8267
#&gt; Residual     1.2815        
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err z-value p-value
#&gt; (Intercept)  7.5380     NaN     NaN     NaN
#&gt; time        -0.4435     NaN     NaN     NaN
#&gt; I(time^2)   -0.0110     NaN     NaN     NaN
#&gt; 
#&gt; Event Process
#&gt;                               Value Std.Err z-value p-value
#&gt; marriedMarried/Partnered     0.0748  0.1117  0.6693  0.5033
#&gt; bc_pillsEver use BC pills    0.0672  0.1223  0.5494  0.5827
#&gt; bmi                         -0.0495  0.0084 -5.8599 &lt;0.0001
#&gt; factor(site)C                0.2083  0.1960  1.0630  0.2878
#&gt; factor(site)M                0.1350  0.1828  0.7384  0.4603
#&gt; factor(site)NJ               0.7308  0.4293  1.7024  0.0887
#&gt; factor(site)P                0.4094  0.1985  2.0622  0.0392
#&gt; factor(site)UCD             -0.0522  0.2344 -0.2227  0.8238
#&gt; factor(site)UCLA             0.1448  0.2507  0.5775  0.5636
#&gt; factor(ethnic)BLACK         -0.3604  0.1445 -2.4933  0.0127
#&gt; factor(ethnic)CHINE         -0.2401  0.2495 -0.9625  0.3358
#&gt; factor(ethnic)HISPA         -1.6574  0.5114 -3.2410  0.0012
#&gt; factor(ethnic)JAPAN          0.0151  0.2420  0.0624  0.9502
#&gt; factor(smoke)Past Only      -0.1135  0.1261 -0.9001  0.3681
#&gt; factor(smoke)Current Smoker -0.0519  0.1623 -0.3199  0.7490
#&gt; Assoct                      -1.2355     NaN     NaN     NaN
#&gt; Assoct.s                    12.8634     NaN     NaN     NaN
#&gt; log(xi.1)                    9.7435     NaN     NaN        
#&gt; log(xi.2)                   10.5641     NaN     NaN        
#&gt; log(xi.3)                   10.8616     NaN     NaN        
#&gt; log(xi.4)                   11.0145     NaN     NaN        
#&gt; log(xi.5)                   11.2383     NaN     NaN        
#&gt; log(xi.6)                   11.4215     NaN     NaN        
#&gt; log(xi.7)                   11.4962     NaN     NaN        
#&gt; 
#&gt; Integration:
#&gt; method: (pseudo) adaptive Gauss-Hermite
#&gt; quadrature points: 3 
#&gt; 
#&gt; Optimization:
#&gt; Convergence: 0</code></pre>
</div>
</div>
<p><span class="math inline">\(lme.fit3 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time + I(time^2)| id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<div class="cell" data-hash="03_model_selection_cache/html/summary_slope_models31_110ce629d2756ab3470b493d967cca09">
<details><summary>Code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jm.fit31d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; jointModel(lmeObject = lme.fit3, survObject = surv.fit1, timeVar = "time", 
#&gt;     parameterization = "both", method = "piecewise-PH-aGH", derivForm = dform3)
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of Groups: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with piecewise-constant
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent + time-dependent slope 
#&gt; 
#&gt;   log.Lik      AIC      BIC
#&gt;  -6783.88 13635.76 13785.26
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr        
#&gt; (Intercept)  1.1617  (Intr)    time
#&gt; time         0.1238  0.9994        
#&gt; I(time^2)    0.0130 -0.7498 -0.7416
#&gt; Residual     1.1466                
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err  z-value p-value
#&gt; (Intercept)  6.6209  0.0963  68.7421 &lt;0.0001
#&gt; time        -0.2108  0.0283  -7.4516 &lt;0.0001
#&gt; I(time^2)   -0.0246  0.0019 -12.6315 &lt;0.0001
#&gt; 
#&gt; Event Process
#&gt;                               Value Std.Err  z-value p-value
#&gt; marriedMarried/Partnered     0.0270  0.1014   0.2666  0.7898
#&gt; bc_pillsEver use BC pills   -0.0006  0.1089  -0.0054  0.9957
#&gt; bmi                         -0.0366  0.0077  -4.7461 &lt;0.0001
#&gt; factor(site)C                0.2269  0.1648   1.3763  0.1687
#&gt; factor(site)M                0.2557  0.1561   1.6379  0.1014
#&gt; factor(site)NJ               0.7520  0.5967   1.2604  0.2075
#&gt; factor(site)P                0.4415  0.1709   2.5829  0.0098
#&gt; factor(site)UCD              0.0548  0.2054   0.2668  0.7896
#&gt; factor(site)UCLA             0.4208  0.2106   1.9977  0.0458
#&gt; factor(ethnic)BLACK         -0.3204  0.1236  -2.5912  0.0096
#&gt; factor(ethnic)CHINE         -0.0400  0.2277  -0.1756  0.8606
#&gt; factor(ethnic)HISPA         -0.7663  0.6588  -1.1633  0.2447
#&gt; factor(ethnic)JAPAN         -0.0896  0.2092  -0.4281  0.6686
#&gt; factor(smoke)Past Only      -0.0870  0.1110  -0.7839  0.4331
#&gt; factor(smoke)Current Smoker  0.1030  0.1460   0.7056  0.4804
#&gt; Assoct                      -0.7625  0.0384 -19.8831 &lt;0.0001
#&gt; Assoct.s                     0.0229  0.2824   0.0813  0.9352
#&gt; log(xi.1)                   -0.0747  0.3832  -0.1950        
#&gt; log(xi.2)                    0.7755  0.3914   1.9815        
#&gt; log(xi.3)                    0.9411  0.4012   2.3455        
#&gt; log(xi.4)                    0.9791  0.4057   2.4136        
#&gt; log(xi.5)                    1.0988  0.4138   2.6554        
#&gt; log(xi.6)                    1.2005  0.4169   2.8797        
#&gt; log(xi.7)                    1.2286  0.4203   2.9232        
#&gt; 
#&gt; Integration:
#&gt; method: (pseudo) adaptive Gauss-Hermite
#&gt; quadrature points: 3 
#&gt; 
#&gt; Optimization:
#&gt; Convergence: 0</code></pre>
</div>
</div>
<p>The model with slope term is better than the model without slope term</p>
</section><section id="comparision-for-jm.fit21-and-jm.fit21d" class="level3" data-number="3.8.2"><h3 data-number="3.8.2" class="anchored" data-anchor-id="comparision-for-jm.fit21-and-jm.fit21d">
<span class="header-section-number">3.8.2</span> Comparision for jm.fit21 and jm.fit21d</h3>
<div class="cell" data-hash="03_model_selection_cache/html/anova_21_21d_10814381208d7b22403d275860cfbccf">
<details><summary>Code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">jm.fit21</span>, <span class="va">jm.fit21d</span>, process <span class="op">=</span> <span class="st">"Event"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;                AIC      BIC  log.Lik    LRT df p.value
#&gt; jm.fit21  14865.88 14997.78 -7402.94                  
#&gt; jm.fit21d 14688.55 14824.86 -7313.28 179.32  1 &lt;0.0001</code></pre>
</div>
</div>
</section><section id="comparision-for-jm.fit31-and-jm.fit31d" class="level3" data-number="3.8.3"><h3 data-number="3.8.3" class="anchored" data-anchor-id="comparision-for-jm.fit31-and-jm.fit31d">
<span class="header-section-number">3.8.3</span> Comparision for jm.fit31 and jm.fit31d</h3>
<div class="cell" data-hash="03_model_selection_cache/html/anova_31_31d_1965d54880128134281752b410071a00">
<details><summary>Code</summary><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">jm.fit31</span>, <span class="va">jm.fit31d</span>, process <span class="op">=</span> <span class="st">"Event"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;                AIC      BIC  log.Lik  LRT df p.value
#&gt; jm.fit31  13636.58 13781.68 -6785.29                
#&gt; jm.fit31d 13635.76 13785.26 -6783.88 2.82  1  0.0929</code></pre>
</div>
</div>
</section><section id="comparision-for-jm.fit21d-and-jm.fit31d" class="level3" data-number="3.8.4"><h3 data-number="3.8.4" class="anchored" data-anchor-id="comparision-for-jm.fit21d-and-jm.fit31d">
<span class="header-section-number">3.8.4</span> Comparision for jm.fit21d and jm.fit31d</h3>
<div class="cell" data-hash="03_model_selection_cache/html/anova_21d_31d_a2adeb52a2f9b7c4ebbd64be5a3226bb">
<details><summary>Code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">jm.fit21d</span>, <span class="va">jm.fit31d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;                AIC      BIC  log.Lik     LRT df p.value
#&gt; jm.fit21d 14688.55 14824.86 -7313.28                   
#&gt; jm.fit31d 13635.76 13785.26 -6783.88 1058.79  3 &lt;0.0001</code></pre>
</div>
</div>
<ul class="task-list">
<li>
<input type="checkbox" disabled="" checked="">
You are spectacular!</li>
</ul>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02_jm.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">JM</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_jmbayes.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb82" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Model selection"</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warnings =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># results = "hide",</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">error =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="do">## clean the R environment</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co"># graphics.off()</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls())</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># freshr::freshr()</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="do">## load packages</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sas7bdat, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JM, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JMbayes, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="do">## check the directory for the file</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="co"># here::dr_here()</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">set_here</span>()</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="do">## the figure or results should be saved </span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="co"># paste0("foldername/Sfilename_workingresult_", </span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="co">#      Sys.Date(), ".filetype")</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, "css-setup", echo=FALSE}</span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">scroll</span><span class="dv">-100</span> <span class="op">{</span></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>height<span class="op">:</span> 300px<span class="op">;</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>width<span class="op">:</span> 1000px<span class="op">;</span></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>  overflow<span class="op">-</span>y<span class="op">:</span> auto<span class="op">;</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>color<span class="op">:</span> inherit<span class="op">;</span></span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goal for this chapter</span></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> List of all the variables in the clean dataset</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Model selection for the survival sub-model (backward selection by EJC)</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Model selection for the survival sub-model with <span class="in">`step`</span></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Two methods are consistent with each other</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Joint model with the selected survival sub-model (by EJC)</span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Joint model factorization v.s. stratification (by EJC)</span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Fit the joint model with <span class="in">`JM`</span> package and get ROC and AUC <span class="co">[</span><span class="ot">failed</span><span class="co">]</span>{style="color:red"} (by EJC)</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Dynamic predictions for the joint model <span class="co">[</span><span class="ot">failed</span><span class="co">]</span>{style="color:red"} ( by EJC)</span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Exploring include the Rate (Time-Dependent Slopes) in the <span class="in">`JM`</span> model</span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Summary of model comparisons</span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`JM`</span> package cannot calculate individual AUC and ROC, and Brier Score.</span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`r praise::praise()`</span></span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model selelction</span></span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>swan_amh0 is the longitudinal dataset</span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>swan_amh1 is the id dataset</span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "loading data"</span></span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/swan_amh0.rda"</span>)</span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/swan_amh1.rda"</span>)</span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Backward selection of vars</span></span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a>The fitted model <span class="in">`surv.fit16`</span> from this <span class="in">`03_model_selection`</span> is the same as the <span class="in">`surv.fit1`</span> from <span class="sc">\`</span>02_jm.qmd. Need to keep $site + ethnic + smoke + bmi$.</span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a>All the variables:\</span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>surv outcomes: "etime" "event". - lme outcomes: "log(amh)"</span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>longitudinal vars:</span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"id"</span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"time"</span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Not included into models:</span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"age"</span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"age0"</span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"bmi_cat"</span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"fmp_age"</span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"parity"</span>
<span id="cb82-108"><a href="#cb82-108" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"phys_act"</span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"start_time"</span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"train"</span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"visit"</span>
<span id="cb82-112"><a href="#cb82-112" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>survival vars:</span>
<span id="cb82-113"><a href="#cb82-113" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"alcohol"*,</span>
<span id="cb82-114"><a href="#cb82-114" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"bc_pills"*,</span>
<span id="cb82-115"><a href="#cb82-115" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"bmi"*,</span>
<span id="cb82-116"><a href="#cb82-116" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"children"*,</span>
<span id="cb82-117"><a href="#cb82-117" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"edu"*,</span>
<span id="cb82-118"><a href="#cb82-118" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"employed"*,</span>
<span id="cb82-119"><a href="#cb82-119" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"ethnic"*,</span>
<span id="cb82-120"><a href="#cb82-120" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"health"*,</span>
<span id="cb82-121"><a href="#cb82-121" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"married"*,</span>
<span id="cb82-122"><a href="#cb82-122" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"site"*,</span>
<span id="cb82-123"><a href="#cb82-123" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*"smoke"*</span>
<span id="cb82-124"><a href="#cb82-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-127"><a href="#cb82-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-128"><a href="#cb82-128" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "backward_selection"</span></span>
<span id="cb82-129"><a href="#cb82-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-130"><a href="#cb82-130" aria-hidden="true" tabindex="-1"></a>surv.fit10 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> children <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-131"><a href="#cb82-131" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span> phys_act <span class="sc">+</span></span>
<span id="cb82-132"><a href="#cb82-132" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(edu) <span class="sc">+</span> <span class="fu">factor</span>(alcohol) <span class="sc">+</span> <span class="fu">factor</span>(employed) <span class="sc">+</span> <span class="fu">factor</span>(health),</span>
<span id="cb82-133"><a href="#cb82-133" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, </span>
<span id="cb82-134"><a href="#cb82-134" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb82-135"><a href="#cb82-135" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-136"><a href="#cb82-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-137"><a href="#cb82-137" aria-hidden="true" tabindex="-1"></a><span class="do">### Need to keep site + ethnic + smoke + bmi</span></span>
<span id="cb82-138"><a href="#cb82-138" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for physical activity (taking out phys.act)</span></span>
<span id="cb82-139"><a href="#cb82-139" aria-hidden="true" tabindex="-1"></a>surv.fit11 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> children <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-140"><a href="#cb82-140" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span></span>
<span id="cb82-141"><a href="#cb82-141" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(edu) <span class="sc">+</span> <span class="fu">factor</span>(alcohol) <span class="sc">+</span> <span class="fu">factor</span>(employed) <span class="sc">+</span> <span class="fu">factor</span>(health),</span>
<span id="cb82-142"><a href="#cb82-142" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, </span>
<span id="cb82-143"><a href="#cb82-143" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb82-144"><a href="#cb82-144" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-145"><a href="#cb82-145" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit10, surv.fit11)</span>
<span id="cb82-146"><a href="#cb82-146" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit10); <span class="fu">AIC</span>(surv.fit11)</span>
<span id="cb82-147"><a href="#cb82-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-148"><a href="#cb82-148" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for employed</span></span>
<span id="cb82-149"><a href="#cb82-149" aria-hidden="true" tabindex="-1"></a>surv.fit12 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> children <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-150"><a href="#cb82-150" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span></span>
<span id="cb82-151"><a href="#cb82-151" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(edu) <span class="sc">+</span> <span class="fu">factor</span>(alcohol) <span class="sc">+</span> <span class="fu">factor</span>(health),</span>
<span id="cb82-152"><a href="#cb82-152" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, <span class="at">x =</span> <span class="cn">TRUE</span>, <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-153"><a href="#cb82-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-154"><a href="#cb82-154" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit11, surv.fit12)</span>
<span id="cb82-155"><a href="#cb82-155" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit11); <span class="fu">AIC</span>(surv.fit12)</span>
<span id="cb82-156"><a href="#cb82-156" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for children</span></span>
<span id="cb82-157"><a href="#cb82-157" aria-hidden="true" tabindex="-1"></a>surv.fit13 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-158"><a href="#cb82-158" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span></span>
<span id="cb82-159"><a href="#cb82-159" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(edu) <span class="sc">+</span> <span class="fu">factor</span>(alcohol) <span class="sc">+</span> <span class="fu">factor</span>(health),</span>
<span id="cb82-160"><a href="#cb82-160" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, <span class="at">x =</span> <span class="cn">TRUE</span>, <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-161"><a href="#cb82-161" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit12, surv.fit13)</span>
<span id="cb82-162"><a href="#cb82-162" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit12); <span class="fu">AIC</span>(surv.fit13)</span>
<span id="cb82-163"><a href="#cb82-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-164"><a href="#cb82-164" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for edu (education)</span></span>
<span id="cb82-165"><a href="#cb82-165" aria-hidden="true" tabindex="-1"></a>surv.fit14 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-166"><a href="#cb82-166" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span></span>
<span id="cb82-167"><a href="#cb82-167" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(alcohol) <span class="sc">+</span> <span class="fu">factor</span>(health),</span>
<span id="cb82-168"><a href="#cb82-168" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, </span>
<span id="cb82-169"><a href="#cb82-169" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-170"><a href="#cb82-170" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-171"><a href="#cb82-171" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit13); <span class="fu">AIC</span>(surv.fit14)</span>
<span id="cb82-172"><a href="#cb82-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-173"><a href="#cb82-173" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for alcohol</span></span>
<span id="cb82-174"><a href="#cb82-174" aria-hidden="true" tabindex="-1"></a>surv.fit15 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-175"><a href="#cb82-175" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span></span>
<span id="cb82-176"><a href="#cb82-176" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(health),</span>
<span id="cb82-177"><a href="#cb82-177" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, </span>
<span id="cb82-178"><a href="#cb82-178" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-179"><a href="#cb82-179" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-180"><a href="#cb82-180" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit14); <span class="fu">AIC</span>(surv.fit15)</span>
<span id="cb82-181"><a href="#cb82-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-182"><a href="#cb82-182" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for health</span></span>
<span id="cb82-183"><a href="#cb82-183" aria-hidden="true" tabindex="-1"></a>surv.fit16 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-184"><a href="#cb82-184" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke),</span>
<span id="cb82-185"><a href="#cb82-185" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, </span>
<span id="cb82-186"><a href="#cb82-186" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-187"><a href="#cb82-187" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-188"><a href="#cb82-188" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit15); <span class="fu">AIC</span>(surv.fit16)</span>
<span id="cb82-189"><a href="#cb82-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-190"><a href="#cb82-190" aria-hidden="true" tabindex="-1"></a><span class="do">## testing for bc_pills</span></span>
<span id="cb82-191"><a href="#cb82-191" aria-hidden="true" tabindex="-1"></a>surv.fit17 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-192"><a href="#cb82-192" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke),</span>
<span id="cb82-193"><a href="#cb82-193" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1, </span>
<span id="cb82-194"><a href="#cb82-194" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb82-195"><a href="#cb82-195" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-196"><a href="#cb82-196" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(surv.fit16); <span class="fu">AIC</span>(surv.fit17)</span>
<span id="cb82-197"><a href="#cb82-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-198"><a href="#cb82-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-201"><a href="#cb82-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-202"><a href="#cb82-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "survival_summary"</span></span>
<span id="cb82-203"><a href="#cb82-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-204"><a href="#cb82-204" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb82-205"><a href="#cb82-205" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="at">fit11 =</span> <span class="fu">glance</span>(surv.fit11), </span>
<span id="cb82-206"><a href="#cb82-206" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit12 =</span> <span class="fu">glance</span>(surv.fit12), </span>
<span id="cb82-207"><a href="#cb82-207" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit13 =</span> <span class="fu">glance</span>(surv.fit13),</span>
<span id="cb82-208"><a href="#cb82-208" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit14 =</span> <span class="fu">glance</span>(surv.fit14),</span>
<span id="cb82-209"><a href="#cb82-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit15 =</span> <span class="fu">glance</span>(surv.fit15),</span>
<span id="cb82-210"><a href="#cb82-210" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit16 =</span> <span class="fu">glance</span>(surv.fit16),</span>
<span id="cb82-211"><a href="#cb82-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit17 =</span> <span class="fu">glance</span>(surv.fit17)) <span class="sc">%&gt;%</span></span>
<span id="cb82-212"><a href="#cb82-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"fit11"</span>, <span class="st">"fit12"</span>, <span class="st">"fit13"</span>,</span>
<span id="cb82-213"><a href="#cb82-213" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"fit14"</span>, <span class="st">"fit15"</span>, <span class="st">"fit16"</span>,</span>
<span id="cb82-214"><a href="#cb82-214" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"fit17"</span>),</span>
<span id="cb82-215"><a href="#cb82-215" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(surv.fit11<span class="sc">$</span>formula,</span>
<span id="cb82-216"><a href="#cb82-216" aria-hidden="true" tabindex="-1"></a>                     surv.fit12<span class="sc">$</span>formula,</span>
<span id="cb82-217"><a href="#cb82-217" aria-hidden="true" tabindex="-1"></a>                     surv.fit13<span class="sc">$</span>formula,</span>
<span id="cb82-218"><a href="#cb82-218" aria-hidden="true" tabindex="-1"></a>                     surv.fit14<span class="sc">$</span>formula,</span>
<span id="cb82-219"><a href="#cb82-219" aria-hidden="true" tabindex="-1"></a>                     surv.fit15<span class="sc">$</span>formula,</span>
<span id="cb82-220"><a href="#cb82-220" aria-hidden="true" tabindex="-1"></a>                     surv.fit16<span class="sc">$</span>formula,</span>
<span id="cb82-221"><a href="#cb82-221" aria-hidden="true" tabindex="-1"></a>                     surv.fit17<span class="sc">$</span>formula),</span>
<span id="cb82-222"><a href="#cb82-222" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">as.character</span>(formula)) <span class="sc">%&gt;%</span></span>
<span id="cb82-223"><a href="#cb82-223" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, logLik, AIC, </span>
<span id="cb82-224"><a href="#cb82-224" aria-hidden="true" tabindex="-1"></a>                BIC, r.squared, concordance, formula) </span>
<span id="cb82-225"><a href="#cb82-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-226"><a href="#cb82-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-227"><a href="#cb82-227" aria-hidden="true" tabindex="-1"></a>Here is the final survival sub-model.</span>
<span id="cb82-228"><a href="#cb82-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-231"><a href="#cb82-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-232"><a href="#cb82-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "final_model"</span></span>
<span id="cb82-233"><a href="#cb82-233" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(surv.fit16)</span>
<span id="cb82-234"><a href="#cb82-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-235"><a href="#cb82-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-236"><a href="#cb82-236" aria-hidden="true" tabindex="-1"></a>The comparison is not exactly make sense to me, so need to talk with EJC for further works on the model. Backward model selection is not my favorite <span class="in">`r emoji::emoji("disappointed")`</span> at all.</span>
<span id="cb82-237"><a href="#cb82-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-240"><a href="#cb82-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-241"><a href="#cb82-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "backward_comparison"</span></span>
<span id="cb82-242"><a href="#cb82-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-243"><a href="#cb82-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb82-244"><a href="#cb82-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-245"><a href="#cb82-245" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit1, surv.fit11) <span class="do">## phys.act NOT SIGN</span></span>
<span id="cb82-246"><a href="#cb82-246" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit11, surv.fit12) <span class="do">## employed NOT SIGN</span></span>
<span id="cb82-247"><a href="#cb82-247" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit12, surv.fit13) <span class="do">## children NOT SIGN</span></span>
<span id="cb82-248"><a href="#cb82-248" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit13, surv.fit14) <span class="do">## edu NOT SIGN</span></span>
<span id="cb82-249"><a href="#cb82-249" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit14, surv.fit15) <span class="do">## alcohol NOT SIGN</span></span>
<span id="cb82-250"><a href="#cb82-250" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit15, surv.fit16) <span class="do">## health NOT SIGN</span></span>
<span id="cb82-251"><a href="#cb82-251" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(surv.fit16, surv.fit17) <span class="do">## bc_pills IS SIGNIF</span></span>
<span id="cb82-252"><a href="#cb82-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-253"><a href="#cb82-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-254"><a href="#cb82-254" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using `step` function</span></span>
<span id="cb82-255"><a href="#cb82-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-256"><a href="#cb82-256" aria-hidden="true" tabindex="-1"></a>The results show there are extra variables we can include, if necessary. Here are the results using step function.</span>
<span id="cb82-257"><a href="#cb82-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-258"><a href="#cb82-258" aria-hidden="true" tabindex="-1"></a>The selection with upper of the full model including all the variables, the lower of the null model with only the intercept.</span>
<span id="cb82-259"><a href="#cb82-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-262"><a href="#cb82-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-263"><a href="#cb82-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "step_function"</span></span>
<span id="cb82-264"><a href="#cb82-264" aria-hidden="true" tabindex="-1"></a>surv.fit1 <span class="ot">&lt;-</span> surv.fit16</span>
<span id="cb82-265"><a href="#cb82-265" aria-hidden="true" tabindex="-1"></a>surv.step <span class="ot">&lt;-</span> <span class="fu">step</span>(surv.fit1, </span>
<span id="cb82-266"><a href="#cb82-266" aria-hidden="true" tabindex="-1"></a>                  <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">upper =</span> <span class="sc">~</span>age <span class="sc">+</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> children <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-267"><a href="#cb82-267" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke) <span class="sc">+</span></span>
<span id="cb82-268"><a href="#cb82-268" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">factor</span>(edu) <span class="sc">+</span> <span class="fu">factor</span>(alcohol) <span class="sc">+</span> <span class="fu">factor</span>(employed) <span class="sc">+</span></span>
<span id="cb82-269"><a href="#cb82-269" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">factor</span>(health),</span>
<span id="cb82-270"><a href="#cb82-270" aria-hidden="true" tabindex="-1"></a>                               <span class="at">lower =</span> <span class="sc">~</span> <span class="dv">1</span>))</span>
<span id="cb82-271"><a href="#cb82-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-272"><a href="#cb82-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-273"><a href="#cb82-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-274"><a href="#cb82-274" aria-hidden="true" tabindex="-1"></a><span class="fu">### `step()` selected "best" model</span></span>
<span id="cb82-275"><a href="#cb82-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-276"><a href="#cb82-276" aria-hidden="true" tabindex="-1"></a>Here are the final model from <span class="in">`step()`</span> function, which is does not including the <span class="in">`bmi`</span> and <span class="in">`ethnic`</span> variables. ***However the `age` is included in the model***.</span>
<span id="cb82-277"><a href="#cb82-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-278"><a href="#cb82-278" aria-hidden="true" tabindex="-1"></a>Need to talk with EJC, I was not sure why do not include <span class="in">`age`</span> into the survival model.</span>
<span id="cb82-279"><a href="#cb82-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-282"><a href="#cb82-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-283"><a href="#cb82-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "step_summary"</span></span>
<span id="cb82-284"><a href="#cb82-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-285"><a href="#cb82-285" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(surv.step<span class="sc">$</span>formula)</span>
<span id="cb82-286"><a href="#cb82-286" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(surv.step)</span>
<span id="cb82-287"><a href="#cb82-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-288"><a href="#cb82-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-289"><a href="#cb82-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## Joint model with `JM::survfitJM()`</span></span>
<span id="cb82-290"><a href="#cb82-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-291"><a href="#cb82-291" aria-hidden="true" tabindex="-1"></a>Here is the joint model with</span>
<span id="cb82-292"><a href="#cb82-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-293"><a href="#cb82-293" aria-hidden="true" tabindex="-1"></a>$lme.fit1 \sim (fixed = lamh \sim time, \ random = \sim time| id)$</span>
<span id="cb82-294"><a href="#cb82-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-295"><a href="#cb82-295" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb82-296"><a href="#cb82-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-297"><a href="#cb82-297" aria-hidden="true" tabindex="-1"></a>This is the most basic form, no slope, on interaction, on integral functions. Also the original model, included in EJC's notes (***the model with only factor(ethnic) + factor(smoke), STILL does not allow for calc of AUC.***)</span>
<span id="cb82-298"><a href="#cb82-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-301"><a href="#cb82-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-302"><a href="#cb82-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "joint_model"</span></span>
<span id="cb82-303"><a href="#cb82-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-304"><a href="#cb82-304" aria-hidden="true" tabindex="-1"></a><span class="do">### the model with only factor(ethnic) + factor(smoke) </span></span>
<span id="cb82-305"><a href="#cb82-305" aria-hidden="true" tabindex="-1"></a><span class="do">### STILL does not allow for calc of AUC</span></span>
<span id="cb82-306"><a href="#cb82-306" aria-hidden="true" tabindex="-1"></a>lme.fit1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time, </span>
<span id="cb82-307"><a href="#cb82-307" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh0, </span>
<span id="cb82-308"><a href="#cb82-308" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time<span class="sc">|</span>id)</span>
<span id="cb82-309"><a href="#cb82-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-310"><a href="#cb82-310" aria-hidden="true" tabindex="-1"></a><span class="do">## joint model fit</span></span>
<span id="cb82-311"><a href="#cb82-311" aria-hidden="true" tabindex="-1"></a>joint.fit1 <span class="ot">&lt;-</span> <span class="fu">jointModel</span>(lme.fit1,</span>
<span id="cb82-312"><a href="#cb82-312" aria-hidden="true" tabindex="-1"></a>                         surv.fit1,</span>
<span id="cb82-313"><a href="#cb82-313" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timeVar =</span> <span class="st">"time"</span>, </span>
<span id="cb82-314"><a href="#cb82-314" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb82-315"><a href="#cb82-315" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(joint.fit1)</span>
<span id="cb82-316"><a href="#cb82-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-317"><a href="#cb82-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-318"><a href="#cb82-318" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trying stratified baseline hazard</span></span>
<span id="cb82-319"><a href="#cb82-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-320"><a href="#cb82-320" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>One is to include the other covariates (or multiple covariates) as regression terms for the hazard function.</span>
<span id="cb82-321"><a href="#cb82-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-322"><a href="#cb82-322" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Alternatively, if the covariates we are adjusting for is categorical with a small number of levels $G$, we may construct a stratified log-rank test.</span>
<span id="cb82-323"><a href="#cb82-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-324"><a href="#cb82-324" aria-hidden="true" tabindex="-1"></a>If we stratify on event with <span class="in">`strata()`</span> we get estimates of the effect of the covariates on events under the assumption that they affect both groups equally.</span>
<span id="cb82-325"><a href="#cb82-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-328"><a href="#cb82-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-329"><a href="#cb82-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "stratified_baseline"</span></span>
<span id="cb82-330"><a href="#cb82-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-331"><a href="#cb82-331" aria-hidden="true" tabindex="-1"></a><span class="co"># surv.fit1 &lt;- coxph(Surv(etime, event) ~ married + bc_pills + bmi +</span></span>
<span id="cb82-332"><a href="#cb82-332" aria-hidden="true" tabindex="-1"></a><span class="co">#                       factor(site) + factor(ethnic) + factor(smoke),</span></span>
<span id="cb82-333"><a href="#cb82-333" aria-hidden="true" tabindex="-1"></a><span class="co">#                     data = swan_amh1, </span></span>
<span id="cb82-334"><a href="#cb82-334" aria-hidden="true" tabindex="-1"></a><span class="co">#                     x = TRUE,</span></span>
<span id="cb82-335"><a href="#cb82-335" aria-hidden="true" tabindex="-1"></a><span class="co">#                     model = TRUE)</span></span>
<span id="cb82-336"><a href="#cb82-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-337"><a href="#cb82-337" aria-hidden="true" tabindex="-1"></a>surv.fit2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb82-338"><a href="#cb82-338" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">strata</span>(site) <span class="sc">+</span> <span class="fu">strata</span>(ethnic) <span class="sc">+</span> <span class="fu">strata</span>(smoke),</span>
<span id="cb82-339"><a href="#cb82-339" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> swan_amh1,</span>
<span id="cb82-340"><a href="#cb82-340" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-341"><a href="#cb82-341" aria-hidden="true" tabindex="-1"></a>                   <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-342"><a href="#cb82-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-343"><a href="#cb82-343" aria-hidden="true" tabindex="-1"></a><span class="co"># anova(surv.fit1, surv.fit2)</span></span>
<span id="cb82-344"><a href="#cb82-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-345"><a href="#cb82-345" aria-hidden="true" tabindex="-1"></a><span class="do">## joint model fit</span></span>
<span id="cb82-346"><a href="#cb82-346" aria-hidden="true" tabindex="-1"></a>joint.fit2 <span class="ot">&lt;-</span> <span class="fu">jointModel</span>(lme.fit1,</span>
<span id="cb82-347"><a href="#cb82-347" aria-hidden="true" tabindex="-1"></a>                         surv.fit2,</span>
<span id="cb82-348"><a href="#cb82-348" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb82-349"><a href="#cb82-349" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb82-350"><a href="#cb82-350" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(joint.fit2)</span></span>
<span id="cb82-351"><a href="#cb82-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-352"><a href="#cb82-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-353"><a href="#cb82-353" aria-hidden="true" tabindex="-1"></a><span class="do">### only smoke as a strata</span></span>
<span id="cb82-354"><a href="#cb82-354" aria-hidden="true" tabindex="-1"></a>surv.fit3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills  <span class="sc">+</span> bmi  <span class="sc">+</span></span>
<span id="cb82-355"><a href="#cb82-355" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">strata</span>(smoke) ,</span>
<span id="cb82-356"><a href="#cb82-356" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> swan_amh1,</span>
<span id="cb82-357"><a href="#cb82-357" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-358"><a href="#cb82-358" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-359"><a href="#cb82-359" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(surv.fit3)</span></span>
<span id="cb82-360"><a href="#cb82-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-361"><a href="#cb82-361" aria-hidden="true" tabindex="-1"></a><span class="do">## joint model fit</span></span>
<span id="cb82-362"><a href="#cb82-362" aria-hidden="true" tabindex="-1"></a>joint.fit3 <span class="ot">&lt;-</span> <span class="fu">jointModel</span>(lme.fit1, </span>
<span id="cb82-363"><a href="#cb82-363" aria-hidden="true" tabindex="-1"></a>                         surv.fit3,</span>
<span id="cb82-364"><a href="#cb82-364" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb82-365"><a href="#cb82-365" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb82-366"><a href="#cb82-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-367"><a href="#cb82-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-368"><a href="#cb82-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-369"><a href="#cb82-369" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary for Survival sub-models</span></span>
<span id="cb82-370"><a href="#cb82-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-373"><a href="#cb82-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-374"><a href="#cb82-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "surv.fit2"</span></span>
<span id="cb82-375"><a href="#cb82-375" aria-hidden="true" tabindex="-1"></a>surv.fit2</span>
<span id="cb82-376"><a href="#cb82-376" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(joint.fit2)[[<span class="dv">2</span>]]</span>
<span id="cb82-377"><a href="#cb82-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-378"><a href="#cb82-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-381"><a href="#cb82-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-382"><a href="#cb82-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "surv.fit3"</span></span>
<span id="cb82-383"><a href="#cb82-383" aria-hidden="true" tabindex="-1"></a>surv.fit3</span>
<span id="cb82-384"><a href="#cb82-384" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(joint.fit3)[[<span class="dv">2</span>]]</span>
<span id="cb82-385"><a href="#cb82-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-386"><a href="#cb82-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-387"><a href="#cb82-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking Stratification</span></span>
<span id="cb82-388"><a href="#cb82-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-391"><a href="#cb82-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-392"><a href="#cb82-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "survdiff"</span></span>
<span id="cb82-393"><a href="#cb82-393" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> bc_pills, <span class="at">data =</span> swan_amh1)</span>
<span id="cb82-394"><a href="#cb82-394" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> bc_pills <span class="sc">+</span> <span class="fu">strata</span>(site) <span class="sc">+</span> <span class="fu">strata</span>(ethnic) <span class="sc">+</span> <span class="fu">strata</span>(smoke),</span>
<span id="cb82-395"><a href="#cb82-395" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> swan_amh1)</span>
<span id="cb82-396"><a href="#cb82-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-397"><a href="#cb82-397" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married, <span class="at">data =</span> swan_amh1)</span>
<span id="cb82-398"><a href="#cb82-398" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> <span class="fu">strata</span>(site) <span class="sc">+</span> <span class="fu">strata</span>(ethnic) <span class="sc">+</span> <span class="fu">strata</span>(smoke),</span>
<span id="cb82-399"><a href="#cb82-399" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> swan_amh1)</span>
<span id="cb82-400"><a href="#cb82-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-401"><a href="#cb82-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-404"><a href="#cb82-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-405"><a href="#cb82-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "tidy_surv"</span></span>
<span id="cb82-406"><a href="#cb82-406" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(surv.fit1) </span>
<span id="cb82-407"><a href="#cb82-407" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(surv.fit2) </span>
<span id="cb82-408"><a href="#cb82-408" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(surv.fit3) </span>
<span id="cb82-409"><a href="#cb82-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-410"><a href="#cb82-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-411"><a href="#cb82-411" aria-hidden="true" tabindex="-1"></a><span class="fu">## Obtaining dynamic predictions</span></span>
<span id="cb82-412"><a href="#cb82-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-413"><a href="#cb82-413" aria-hidden="true" tabindex="-1"></a>This function accepts as main arguments a fitted joint model and a data frame that contains the longitudinal and covariate information for the subjects for which we wish to calculate the predicted survival probabilities.</span>
<span id="cb82-414"><a href="#cb82-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-417"><a href="#cb82-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-418"><a href="#cb82-418" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "dynamic_predictions"</span></span>
<span id="cb82-419"><a href="#cb82-419" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb82-420"><a href="#cb82-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb82-421"><a href="#cb82-421" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(swan_amh0<span class="sc">$</span>id)</span>
<span id="cb82-422"><a href="#cb82-422" aria-hidden="true" tabindex="-1"></a><span class="do">## length(ids)</span></span>
<span id="cb82-423"><a href="#cb82-423" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction for the survival outcomes</span></span>
<span id="cb82-424"><a href="#cb82-424" aria-hidden="true" tabindex="-1"></a>ND1 <span class="ot">&lt;-</span> swan_amh0[swan_amh0<span class="sc">$</span>id <span class="sc">==</span> ids[<span class="dv">8</span>], ] <span class="do">## 4, 5, 7 (not so good)</span></span>
<span id="cb82-425"><a href="#cb82-425" aria-hidden="true" tabindex="-1"></a>sfit <span class="ot">&lt;-</span> JM<span class="sc">::</span><span class="fu">survfitJM</span>(joint.fit3,</span>
<span id="cb82-426"><a href="#cb82-426" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span> ND1, </span>
<span id="cb82-427"><a href="#cb82-427" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idVar =</span> <span class="st">"id"</span>) </span>
<span id="cb82-428"><a href="#cb82-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-429"><a href="#cb82-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-430"><a href="#cb82-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-431"><a href="#cb82-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r class.output="scroll-100"}</span></span>
<span id="cb82-432"><a href="#cb82-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "id110"</span></span>
<span id="cb82-433"><a href="#cb82-433" aria-hidden="true" tabindex="-1"></a>ND1</span>
<span id="cb82-434"><a href="#cb82-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-435"><a href="#cb82-435" aria-hidden="true" tabindex="-1"></a><span class="co"># subset(ND1, </span></span>
<span id="cb82-436"><a href="#cb82-436" aria-hidden="true" tabindex="-1"></a><span class="co">#        select = c('id', 'age0', 'time', </span></span>
<span id="cb82-437"><a href="#cb82-437" aria-hidden="true" tabindex="-1"></a><span class="co">#                   'start_time', </span></span>
<span id="cb82-438"><a href="#cb82-438" aria-hidden="true" tabindex="-1"></a><span class="co">#                   'etime', 'amh'))</span></span>
<span id="cb82-439"><a href="#cb82-439" aria-hidden="true" tabindex="-1"></a><span class="co">#                   </span></span>
<span id="cb82-440"><a href="#cb82-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-441"><a href="#cb82-441" aria-hidden="true" tabindex="-1"></a>sfit<span class="sc">$</span>summaries<span class="sc">$</span><span class="st">`</span><span class="at">1100390</span><span class="st">`</span> <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb82-442"><a href="#cb82-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-443"><a href="#cb82-443" aria-hidden="true" tabindex="-1"></a>id1100390 <span class="ot">&lt;-</span> <span class="fu">filter</span>(swan_amh0, id <span class="sc">==</span> ids[<span class="dv">5</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb82-444"><a href="#cb82-444" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(etime, lamh)</span>
<span id="cb82-445"><a href="#cb82-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-446"><a href="#cb82-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-447"><a href="#cb82-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-448"><a href="#cb82-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-451"><a href="#cb82-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-452"><a href="#cb82-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "plot_dm"</span></span>
<span id="cb82-453"><a href="#cb82-453" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sfit, <span class="at">estimator =</span> <span class="st">"mean"</span>, </span>
<span id="cb82-454"><a href="#cb82-454" aria-hidden="true" tabindex="-1"></a>     <span class="at">include.y =</span> <span class="cn">TRUE</span>, </span>
<span id="cb82-455"><a href="#cb82-455" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb82-456"><a href="#cb82-456" aria-hidden="true" tabindex="-1"></a>     <span class="at">fill.area =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-457"><a href="#cb82-457" aria-hidden="true" tabindex="-1"></a>     <span class="at">col.area =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb82-458"><a href="#cb82-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-459"><a href="#cb82-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-460"><a href="#cb82-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-461"><a href="#cb82-461" aria-hidden="true" tabindex="-1"></a><span class="fu">### AUC and ROC</span></span>
<span id="cb82-462"><a href="#cb82-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-463"><a href="#cb82-463" aria-hidden="true" tabindex="-1"></a>I can only pullout the AUC for certain models, not all of them. The ROC function gets problems too. There is also on function for Brier Score in <span class="in">`JM`</span> package.</span>
<span id="cb82-464"><a href="#cb82-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-467"><a href="#cb82-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-468"><a href="#cb82-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "auc"</span></span>
<span id="cb82-469"><a href="#cb82-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb82-470"><a href="#cb82-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb82-471"><a href="#cb82-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-472"><a href="#cb82-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-473"><a href="#cb82-473" aria-hidden="true" tabindex="-1"></a><span class="do">## Tstart is the time up which long measurements are used in the predictions</span></span>
<span id="cb82-474"><a href="#cb82-474" aria-hidden="true" tabindex="-1"></a><span class="do">## Dt = is the window of time that will be considered for predictions;</span></span>
<span id="cb82-475"><a href="#cb82-475" aria-hidden="true" tabindex="-1"></a><span class="do">## discrimination is calculated based on this window</span></span>
<span id="cb82-476"><a href="#cb82-476" aria-hidden="true" tabindex="-1"></a>auc2.t3 <span class="ot">&lt;-</span> <span class="fu">try</span>(JM<span class="sc">::</span><span class="fu">aucJM</span>(joint.fit2,</span>
<span id="cb82-477"><a href="#cb82-477" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata =</span> swan_amh0,</span>
<span id="cb82-478"><a href="#cb82-478" aria-hidden="true" tabindex="-1"></a>                     <span class="at">idVar =</span> <span class="st">"id"</span>,</span>
<span id="cb82-479"><a href="#cb82-479" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb82-480"><a href="#cb82-480" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Dt =</span> <span class="dv">3</span>))</span>
<span id="cb82-481"><a href="#cb82-481" aria-hidden="true" tabindex="-1"></a>auc2.t3</span>
<span id="cb82-482"><a href="#cb82-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-483"><a href="#cb82-483" aria-hidden="true" tabindex="-1"></a>auc1 <span class="ot">&lt;-</span> JM<span class="sc">::</span><span class="fu">aucJM</span>(joint.fit3,</span>
<span id="cb82-484"><a href="#cb82-484" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> swan_amh0,</span>
<span id="cb82-485"><a href="#cb82-485" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idVar =</span> <span class="st">"id"</span>,</span>
<span id="cb82-486"><a href="#cb82-486" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb82-487"><a href="#cb82-487" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Dt =</span> <span class="dv">3</span>) <span class="do">##</span></span>
<span id="cb82-488"><a href="#cb82-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-489"><a href="#cb82-489" aria-hidden="true" tabindex="-1"></a>auc2 <span class="ot">&lt;-</span> <span class="fu">try</span>(JM<span class="sc">::</span><span class="fu">aucJM</span>(joint.fit3, </span>
<span id="cb82-490"><a href="#cb82-490" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> swan_amh0,</span>
<span id="cb82-491"><a href="#cb82-491" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idVar =</span> <span class="st">"id"</span>,</span>
<span id="cb82-492"><a href="#cb82-492" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb82-493"><a href="#cb82-493" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Dt =</span> <span class="dv">3</span>)) </span>
<span id="cb82-494"><a href="#cb82-494" aria-hidden="true" tabindex="-1"></a>auc2</span>
<span id="cb82-495"><a href="#cb82-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-496"><a href="#cb82-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-497"><a href="#cb82-497" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time-Dependent Slopes Parameterization</span></span>
<span id="cb82-498"><a href="#cb82-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-499"><a href="#cb82-499" aria-hidden="true" tabindex="-1"></a>However, since for each patient the marker follows a trajectory in time, it is also reasonable to consider parameterizations that allow the risk for an event to also depend on other features of this trajectory. A parameterization of this type has been considered by <span class="in">`Ye et al. (2008b)`</span> who postulated a joint model in which the risk depends on both the current true value of the trajectory and the slope of the true trajectory at time <span class="in">`t`</span>.</span>
<span id="cb82-500"><a href="#cb82-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-501"><a href="#cb82-501" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-502"><a href="#cb82-502" aria-hidden="true" tabindex="-1"></a>\begin{split}</span>
<span id="cb82-503"><a href="#cb82-503" aria-hidden="true" tabindex="-1"></a>  h_i(t) &amp; = h_0(t) \exp<span class="sc">\{</span>\gamma^{\top}w_i + \alpha_1 m_i(t) + \alpha_2 m'_i(t)<span class="sc">\}\\</span></span>
<span id="cb82-504"><a href="#cb82-504" aria-hidden="true" tabindex="-1"></a>  m'_i(t) &amp; = \frac {d} {dt} m_i(t) = \frac {d} {dt} \{ x^{\top}_i (t) \beta + z_i^{\top} (t) b_i <span class="sc">\}\\</span></span>
<span id="cb82-505"><a href="#cb82-505" aria-hidden="true" tabindex="-1"></a>  m'_i(t) &amp; = <span class="co">[</span><span class="ot">x_i^{slope}(t)</span><span class="co">]</span>^{\top} \beta^{slope} + <span class="co">[</span><span class="ot">z_i^{slope}(t)</span><span class="co">]</span>^{\top} b_i^{slope}</span>
<span id="cb82-506"><a href="#cb82-506" aria-hidden="true" tabindex="-1"></a>\end{split}</span>
<span id="cb82-507"><a href="#cb82-507" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-508"><a href="#cb82-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-509"><a href="#cb82-509" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Including the interaction term in the cox-model for $m_i$</span>
<span id="cb82-510"><a href="#cb82-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-511"><a href="#cb82-511" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The <span class="in">`time`</span> variable needs to be nonlinear for the longitudinal data</span>
<span id="cb82-512"><a href="#cb82-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-513"><a href="#cb82-513" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>so I included the <span class="in">`I(time^2)`</span> term in the <span class="in">`lme`</span> model</span>
<span id="cb82-514"><a href="#cb82-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-515"><a href="#cb82-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r class.output="scroll-100"}</span></span>
<span id="cb82-516"><a href="#cb82-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "lme_extended"</span></span>
<span id="cb82-517"><a href="#cb82-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-518"><a href="#cb82-518" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>)</span>
<span id="cb82-519"><a href="#cb82-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-520"><a href="#cb82-520" aria-hidden="true" tabindex="-1"></a>lme.fit2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">I</span>(time<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb82-521"><a href="#cb82-521" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh0, </span>
<span id="cb82-522"><a href="#cb82-522" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> control,</span>
<span id="cb82-523"><a href="#cb82-523" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time<span class="sc">|</span> id)</span>
<span id="cb82-524"><a href="#cb82-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-525"><a href="#cb82-525" aria-hidden="true" tabindex="-1"></a>lme.fit3 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">I</span>(time<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb82-526"><a href="#cb82-526" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh0, </span>
<span id="cb82-527"><a href="#cb82-527" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> control,</span>
<span id="cb82-528"><a href="#cb82-528" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">I</span>(time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> id)</span>
<span id="cb82-529"><a href="#cb82-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-530"><a href="#cb82-530" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">glance</span>(lme.fit1), </span>
<span id="cb82-531"><a href="#cb82-531" aria-hidden="true" tabindex="-1"></a>      <span class="fu">glance</span>(lme.fit2), </span>
<span id="cb82-532"><a href="#cb82-532" aria-hidden="true" tabindex="-1"></a>      <span class="fu">glance</span>(lme.fit3))</span>
<span id="cb82-533"><a href="#cb82-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-534"><a href="#cb82-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-537"><a href="#cb82-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-538"><a href="#cb82-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "joint_model_slope"</span></span>
<span id="cb82-539"><a href="#cb82-539" aria-hidden="true" tabindex="-1"></a>jm.fit21 <span class="ot">&lt;-</span> <span class="fu">jointModel</span>(lme.fit2,</span>
<span id="cb82-540"><a href="#cb82-540" aria-hidden="true" tabindex="-1"></a>                       surv.fit1,</span>
<span id="cb82-541"><a href="#cb82-541" aria-hidden="true" tabindex="-1"></a>                       <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb82-542"><a href="#cb82-542" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb82-543"><a href="#cb82-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-544"><a href="#cb82-544" aria-hidden="true" tabindex="-1"></a>jm.fit31 <span class="ot">&lt;-</span> <span class="fu">jointModel</span>(lme.fit3,</span>
<span id="cb82-545"><a href="#cb82-545" aria-hidden="true" tabindex="-1"></a>                       surv.fit1,</span>
<span id="cb82-546"><a href="#cb82-546" aria-hidden="true" tabindex="-1"></a>                       <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb82-547"><a href="#cb82-547" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"piecewise-PH-aGH"</span>)</span>
<span id="cb82-548"><a href="#cb82-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-549"><a href="#cb82-549" aria-hidden="true" tabindex="-1"></a><span class="co"># jm.fit22 &lt;- jointModel(lme.fit2,</span></span>
<span id="cb82-550"><a href="#cb82-550" aria-hidden="true" tabindex="-1"></a><span class="co">#                        surv.fit2,</span></span>
<span id="cb82-551"><a href="#cb82-551" aria-hidden="true" tabindex="-1"></a><span class="co">#                        timeVar = "time",</span></span>
<span id="cb82-552"><a href="#cb82-552" aria-hidden="true" tabindex="-1"></a><span class="co">#                        # interFact = list(value = ~ age,</span></span>
<span id="cb82-553"><a href="#cb82-553" aria-hidden="true" tabindex="-1"></a><span class="co">#                        #                  ##  a named list with a component named value</span></span>
<span id="cb82-554"><a href="#cb82-554" aria-hidden="true" tabindex="-1"></a><span class="co">#                        #                  ##  that provides an R formula specifying the</span></span>
<span id="cb82-555"><a href="#cb82-555" aria-hidden="true" tabindex="-1"></a><span class="co">#                        #                  ##  form of the W2 design matrix</span></span>
<span id="cb82-556"><a href="#cb82-556" aria-hidden="true" tabindex="-1"></a><span class="co">#                        #                  data = swan_amh1),</span></span>
<span id="cb82-557"><a href="#cb82-557" aria-hidden="true" tabindex="-1"></a><span class="co">#                        method = "piecewise-PH-aGH")</span></span>
<span id="cb82-558"><a href="#cb82-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-559"><a href="#cb82-559" aria-hidden="true" tabindex="-1"></a><span class="co"># jm.fit32 &lt;- jointModel(lme.fit3,</span></span>
<span id="cb82-560"><a href="#cb82-560" aria-hidden="true" tabindex="-1"></a><span class="co">#                        surv.fit2,</span></span>
<span id="cb82-561"><a href="#cb82-561" aria-hidden="true" tabindex="-1"></a><span class="co">#                        timeVar = "time",</span></span>
<span id="cb82-562"><a href="#cb82-562" aria-hidden="true" tabindex="-1"></a><span class="co">#                        method = "piecewise-PH-aGH")</span></span>
<span id="cb82-563"><a href="#cb82-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-564"><a href="#cb82-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-567"><a href="#cb82-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-568"><a href="#cb82-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "derivative"</span></span>
<span id="cb82-569"><a href="#cb82-569" aria-hidden="true" tabindex="-1"></a><span class="co"># model.matrix(lamh ~ time + I(time^2), </span></span>
<span id="cb82-570"><a href="#cb82-570" aria-hidden="true" tabindex="-1"></a><span class="co">#                 data = swan_amh0)</span></span>
<span id="cb82-571"><a href="#cb82-571" aria-hidden="true" tabindex="-1"></a>dform2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">2</span> <span class="sc">*</span> time),</span>
<span id="cb82-572"><a href="#cb82-572" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the 2nd and 3rd fixed effects of mi(t) used</span></span>
<span id="cb82-573"><a href="#cb82-573" aria-hidden="true" tabindex="-1"></a>              <span class="at">indFixed =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb82-574"><a href="#cb82-574" aria-hidden="true" tabindex="-1"></a>              <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb82-575"><a href="#cb82-575" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the second random effect of mi(t)</span></span>
<span id="cb82-576"><a href="#cb82-576" aria-hidden="true" tabindex="-1"></a>              <span class="at">indRandom =</span> <span class="dv">2</span>)</span>
<span id="cb82-577"><a href="#cb82-577" aria-hidden="true" tabindex="-1"></a>dform3 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">2</span> <span class="sc">*</span> time),</span>
<span id="cb82-578"><a href="#cb82-578" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the 2nd and 3rd fixed effects of mi(t) used</span></span>
<span id="cb82-579"><a href="#cb82-579" aria-hidden="true" tabindex="-1"></a>              <span class="at">indFixed =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb82-580"><a href="#cb82-580" aria-hidden="true" tabindex="-1"></a>              <span class="at">random =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">2</span> <span class="sc">*</span> time), </span>
<span id="cb82-581"><a href="#cb82-581" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the second and third random effect of mi(t)</span></span>
<span id="cb82-582"><a href="#cb82-582" aria-hidden="true" tabindex="-1"></a>              <span class="at">indRandom =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb82-583"><a href="#cb82-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-584"><a href="#cb82-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-585"><a href="#cb82-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-586"><a href="#cb82-586" aria-hidden="true" tabindex="-1"></a>Warning: Stop time must be <span class="sc">\&gt;</span> start time, NA created</span>
<span id="cb82-587"><a href="#cb82-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-590"><a href="#cb82-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-591"><a href="#cb82-591" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "update_model"</span></span>
<span id="cb82-592"><a href="#cb82-592" aria-hidden="true" tabindex="-1"></a>jm.fit21d <span class="ot">&lt;-</span> <span class="fu">update</span>(jm.fit21,</span>
<span id="cb82-593"><a href="#cb82-593" aria-hidden="true" tabindex="-1"></a>                    <span class="at">parameterization =</span> <span class="st">"both"</span>,</span>
<span id="cb82-594"><a href="#cb82-594" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivForm =</span> dform2)</span>
<span id="cb82-595"><a href="#cb82-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-596"><a href="#cb82-596" aria-hidden="true" tabindex="-1"></a>jm.fit31d <span class="ot">&lt;-</span> <span class="fu">update</span>(jm.fit31,</span>
<span id="cb82-597"><a href="#cb82-597" aria-hidden="true" tabindex="-1"></a>                    <span class="at">parameterization =</span> <span class="st">"both"</span>,</span>
<span id="cb82-598"><a href="#cb82-598" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivForm =</span> dform3)</span>
<span id="cb82-599"><a href="#cb82-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-600"><a href="#cb82-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-601"><a href="#cb82-601" aria-hidden="true" tabindex="-1"></a><span class="fu">### Here is the summarization of the models</span></span>
<span id="cb82-602"><a href="#cb82-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-603"><a href="#cb82-603" aria-hidden="true" tabindex="-1"></a>$lme.fit2 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time| id)$</span>
<span id="cb82-604"><a href="#cb82-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-605"><a href="#cb82-605" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb82-606"><a href="#cb82-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-609"><a href="#cb82-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-610"><a href="#cb82-610" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "summary_slope_models21"</span></span>
<span id="cb82-611"><a href="#cb82-611" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jm.fit21d)</span>
<span id="cb82-612"><a href="#cb82-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-613"><a href="#cb82-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-614"><a href="#cb82-614" aria-hidden="true" tabindex="-1"></a>$lme.fit3 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time + I(time^2)| id)$</span>
<span id="cb82-615"><a href="#cb82-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-616"><a href="#cb82-616" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb82-617"><a href="#cb82-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-620"><a href="#cb82-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-621"><a href="#cb82-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "summary_slope_models31"</span></span>
<span id="cb82-622"><a href="#cb82-622" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jm.fit31d)</span>
<span id="cb82-623"><a href="#cb82-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-624"><a href="#cb82-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-625"><a href="#cb82-625" aria-hidden="true" tabindex="-1"></a>The model with slope term is better than the model without slope term</span>
<span id="cb82-626"><a href="#cb82-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-627"><a href="#cb82-627" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparision for jm.fit21 and jm.fit21d</span></span>
<span id="cb82-628"><a href="#cb82-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-631"><a href="#cb82-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-632"><a href="#cb82-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "anova_21_21d"</span></span>
<span id="cb82-633"><a href="#cb82-633" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(jm.fit21, jm.fit21d, <span class="at">process =</span> <span class="st">"Event"</span>)</span>
<span id="cb82-634"><a href="#cb82-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-635"><a href="#cb82-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-636"><a href="#cb82-636" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparision for jm.fit31 and jm.fit31d</span></span>
<span id="cb82-637"><a href="#cb82-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-640"><a href="#cb82-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-641"><a href="#cb82-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "anova_31_31d"</span></span>
<span id="cb82-642"><a href="#cb82-642" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(jm.fit31, jm.fit31d, <span class="at">process =</span> <span class="st">"Event"</span>)</span>
<span id="cb82-643"><a href="#cb82-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-644"><a href="#cb82-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-645"><a href="#cb82-645" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparision for jm.fit21d and jm.fit31d</span></span>
<span id="cb82-646"><a href="#cb82-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-649"><a href="#cb82-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-650"><a href="#cb82-650" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "anova_21d_31d"</span></span>
<span id="cb82-651"><a href="#cb82-651" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(jm.fit21d, jm.fit31d)</span>
<span id="cb82-652"><a href="#cb82-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-653"><a href="#cb82-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-654"><a href="#cb82-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-655"><a href="#cb82-655" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`r praise::praise()`</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>