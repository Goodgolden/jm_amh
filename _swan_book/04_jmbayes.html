<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Randy Jin, Elizabeth Juarez-Colunga">
<title>SWAN AMH project analysis - 4&nbsp; JMBayes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_jmbayes2.html" rel="next">
<link href="./03_model_selection.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SWAN AMH project analysis</span>
  </a>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        <div class="sidebar-tools-collapse tools-wide">
    <a href="https://github.com/Goodgolden/jm_amh" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="" class="sidebar-tool px-1"><i class="bi bi-share"></i></a>
    <a href="https://coloradosph.cuanschutz.edu/education/departments/biostatistics-informatics" title="" class="sidebar-tool px-1"><i class="bi bi-hospital"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Working log</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_table1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Table1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_jm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">JM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_jmbayes.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_jmbayes2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">JMbayes2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_jm_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JM Model Selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_value_auc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Value model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_rate_auc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rate model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_table1_publication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Table1 (for publication)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_final_model.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final model (for publication)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_convergence.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Convergence</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_model_selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Selection I - Dummy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_model_selection_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Model Selection II - Factor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_rate_value_baseline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Rate Value Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_auc_ci.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">AUC CI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_auc_plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">AUC Plot</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_rate_estimate.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Slope Estimate</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_testing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Testing data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_review.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Paper Review</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#goal-for-this-chapter" id="toc-goal-for-this-chapter" class="nav-link active" data-scroll-target="#goal-for-this-chapter"> <span class="header-section-number">4.1</span> Goal for this chapter</a></li>
  <li><a href="#setting-up-for-linear-mixed-model" id="toc-setting-up-for-linear-mixed-model" class="nav-link" data-scroll-target="#setting-up-for-linear-mixed-model"> <span class="header-section-number">4.2</span> Setting up for linear mixed model</a></li>
  <li><a href="#using-jmbayesjointmodel" id="toc-using-jmbayesjointmodel" class="nav-link" data-scroll-target="#using-jmbayesjointmodel"> <span class="header-section-number">4.3</span> Using <code>JMBayes::jointModel()</code></a></li>
  <li><a href="#jmbayes1-models" id="toc-jmbayes1-models" class="nav-link" data-scroll-target="#jmbayes1-models"> <span class="header-section-number">4.4</span> JMbayes1 models</a></li>
  <li>
<a href="#summary-of-the-models" id="toc-summary-of-the-models" class="nav-link" data-scroll-target="#summary-of-the-models"> <span class="header-section-number">4.5</span> Summary of the models</a>
  <ul class="collapse">
<li><a href="#jmbayes.fit11" id="toc-jmbayes.fit11" class="nav-link" data-scroll-target="#jmbayes.fit11"> <span class="header-section-number">4.5.1</span> jmbayes.fit11</a></li>
  <li><a href="#jmbayes.fit21" id="toc-jmbayes.fit21" class="nav-link" data-scroll-target="#jmbayes.fit21"> <span class="header-section-number">4.5.2</span> jmbayes.fit21</a></li>
  <li><a href="#jmbayes.fit31" id="toc-jmbayes.fit31" class="nav-link" data-scroll-target="#jmbayes.fit31"> <span class="header-section-number">4.5.3</span> jmbayes.fit31</a></li>
  <li><a href="#jmbayes.fit31.d" id="toc-jmbayes.fit31.d" class="nav-link" data-scroll-target="#jmbayes.fit31.d"> <span class="header-section-number">4.5.4</span> jmbayes.fit31.d</a></li>
  </ul>
</li>
  <li><a href="#predictions-fails" id="toc-predictions-fails" class="nav-link" data-scroll-target="#predictions-fails"> <span class="header-section-number">4.6</span> Predictions Fails</a></li>
  <li><a href="#auc-and-roc" id="toc-auc-and-roc" class="nav-link" data-scroll-target="#auc-and-roc"> <span class="header-section-number">4.7</span> AUC and ROC</a></li>
  <li><a href="#brier-score" id="toc-brier-score" class="nav-link" data-scroll-target="#brier-score"> <span class="header-section-number">4.8</span> Brier Score</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Goodgolden/jm_amh/edit/main/04_jmbayes.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">JMBayes</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="cell" data-hash="04_jmbayes_cache/html/css-setup_bf4c300aa8770158f75ecf26cbf1a1fd">
<style type="text/css">
.scroll-100 {
  max-height: 300px;
  max-width: 1000px;
  overflow-y: auto;
  background-color: inherit;
}
</style>
</div>
<section id="goal-for-this-chapter" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="goal-for-this-chapter">
<span class="header-section-number">4.1</span> Goal for this chapter</h2>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked="">
Fitting the models with <code>JMbayes</code> package</p></li>
<li><p><input type="checkbox" disabled="" checked=""><code>JMbayes</code> does not support nested random effects design</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Model comparison for the linear mixed models, and survival model with rate</p></li>
<li><p><input type="checkbox" disabled="" checked="">
Dynamic predictions for the survival outcomes (does not work with the individual data)</p></li>
<li><p><input type="checkbox" disabled="" checked=""><code>JMbayes</code> cannot calculate the Brier Score</p></li>
<li><p><input type="checkbox" disabled="" checked="">
You are shining!</p></li>
</ul></section><section id="setting-up-for-linear-mixed-model" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="setting-up-for-linear-mixed-model">
<span class="header-section-number">4.2</span> Setting up for linear mixed model</h2>
<p>Because we are gonna use the <code>JMbayes</code> package and include the slope terms for the joint model, we need to fit the linear mixed model with the non-linear terms terms: including both the fixed and random terms.</p>
<p>The survival sub-models are directly from early work in <code>R/03_model_selection.qmd</code>. The survival sub-models used either factorized or stratified variables.</p>
<div class="cell" data-hash="04_jmbayes_cache/html/loading data_417c7c48c614becde0e7e07e1cdc74a0">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/swan_amh0.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/swan_amh1.rda"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">control</span> <span class="op">=</span> <span class="fu">lmeControl</span><span class="op">(</span>opt <span class="op">=</span> <span class="st">"optim"</span><span class="op">)</span></span>
<span><span class="va">lme.fit1</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span>,</span>
<span>                data <span class="op">=</span> <span class="va">swan_amh0</span>,</span>
<span>                control <span class="op">=</span> <span class="va">control</span>,</span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span><span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lme.fit2</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">swan_amh0</span>,</span>
<span>                control <span class="op">=</span> <span class="va">control</span>,</span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span><span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lme.fit3</span> <span class="op">&lt;-</span> <span class="fu">lme</span><span class="op">(</span><span class="va">lamh</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">swan_amh0</span>,</span>
<span>                control <span class="op">=</span> <span class="va">control</span>,</span>
<span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">time</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surv.fit1</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">swan_amh1</span>,</span>
<span>                    x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surv.fit2</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">etime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">married</span> <span class="op">+</span> <span class="va">bc_pills</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span></span>
<span>                     <span class="fu">strata</span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">ethnic</span><span class="op">)</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">smoke</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">swan_amh1</span>,</span>
<span>                   x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="using-jmbayesjointmodel" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="using-jmbayesjointmodel">
<span class="header-section-number">4.3</span> Using <code>JMBayes::jointModel()</code>
</h2>
<p>JMbayes is more flexible (in some respects):</p>
<ul>
<li>directly implements the MCMC</li>
<li>allows for categorical longitudinal data as well</li>
<li>allows for general transformation functions</li>
<li>penalized B-splines for the baseline hazard function</li>
</ul>
<p>Both package give options to define the aforementioned association structures</p>
<ul>
<li>in JM via arguments parameterization &amp; derivForm</li>
<li>in JMbayes via arguments param &amp; extraForm</li>
</ul>
<p>How did we name the models, <code>package used</code> + <code>.fit</code> + <code>lmm model number</code> + <code>surv model number</code> + extensions</p>
</section><section id="jmbayes1-models" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="jmbayes1-models">
<span class="header-section-number">4.4</span> JMbayes1 models</h2>
<p>The parameters in <code>JMbayes</code> and <code>JMbayes2</code> are different, The <code>dform</code> also need to be chanaged accordingly.</p>
<pre><code>JMbayes::jointModelBayes(lmeObject, 
                         survObject, 
                         timeVar,  
                         param = c("td-value", "td-extra", 
                                   "td-both", "shared-betasRE",
                                   "shared-RE"), 
                         extraForm = NULL,
                         baseHaz = c("P-splines", "regression-splines"),
                         ...)

JMbayes2::jm(Surv_object,
             Mixed_objects,
             time_var, 
             recurrent = FALSE,
             functional_forms = NULL, 
             data_Surv = NULL, 
             id_var = NULL, 
             control = NULL,
             ...)</code></pre>
<div class="cell" data-hash="04_jmbayes_cache/html/fitting models_5b3ceb1a4db2bd82914a83b39e752f4d">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">jmbayes.fit11</span> <span class="op">&lt;-</span> <span class="fu">JMbayes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JMbayes/man/jointModelBayes.html">jointModelBayes</a></span><span class="op">(</span><span class="va">lme.fit1</span>,</span>
<span>                                          <span class="va">surv.fit1</span>,</span>
<span>                                          timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                                          <span class="co"># time_var = "time",</span></span>
<span>                                          seed <span class="op">=</span> <span class="fl">55555</span><span class="op">)</span></span>
<span><span class="va">jmbayes.fit12</span> <span class="op">&lt;-</span> <span class="fu">JMbayes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JMbayes/man/jointModelBayes.html">jointModelBayes</a></span><span class="op">(</span><span class="va">lme.fit1</span>,</span>
<span>                                          <span class="va">surv.fit2</span>,</span>
<span>                                          timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                                          seed <span class="op">=</span> <span class="fl">55555</span><span class="op">)</span></span>
<span><span class="va">jmbayes.fit31</span> <span class="op">&lt;-</span> <span class="fu">JMbayes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JMbayes/man/jointModelBayes.html">jointModelBayes</a></span><span class="op">(</span><span class="va">lme.fit3</span>,</span>
<span>                                          <span class="va">surv.fit1</span>,</span>
<span>                                          timeVar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                                          seed <span class="op">=</span> <span class="fl">55555</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jm1.dform3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">dns</span><span class="op">(</span><span class="va">time</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>              <span class="co">## the 2nd and 3rd fixed effects of mi(t) used</span></span>
<span>              indFixed <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>              random <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">dns</span><span class="op">(</span><span class="va">time</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>              <span class="co">## the second and third random effect of mi(t)</span></span>
<span>              indRandom <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jmbayes.fit31.d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">jmbayes.fit31</span>,</span>
<span>                         param <span class="op">=</span> <span class="st">"td-both"</span>,</span>
<span>                         extraForm <span class="op">=</span> <span class="va">jm1.dform3</span>,</span>
<span>                         seed <span class="op">=</span> <span class="fl">55555</span>,</span>
<span>                         n.iter <span class="op">=</span> <span class="fl">35000</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="summary-of-the-models" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="summary-of-the-models">
<span class="header-section-number">4.5</span> Summary of the models</h2>
<section id="jmbayes.fit11" class="level3" data-number="4.5.1"><h3 data-number="4.5.1" class="anchored" data-anchor-id="jmbayes.fit11">
<span class="header-section-number">4.5.1</span> jmbayes.fit11</h3>
<p><span class="math inline">\(lme.fit1 \sim (fixed = lamh \sim time, \ random = \sim time| id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<div class="cell" data-hash="04_jmbayes_cache/html/summary_fit11_f85c1f7954d4a2fd558b7425df5f4128">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes.fit11</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit1, survObject = surv.fit1, 
#&gt;     timeVar = "time", seed = 55555)
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of subjects: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with penalized-spline-approximated 
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent value 
#&gt; 
#&gt;  LPML      DIC       pD
#&gt;  -Inf 17823.75 1326.662
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr
#&gt; (Intercept)  1.7539  (Intr)
#&gt; time         0.6806 -0.2079
#&gt; Residual     1.2987        
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err Std.Dev    2.5%   97.5%      P
#&gt; (Intercept)  7.8910  0.0081  0.0981  7.7072  8.0852 &lt;0.001
#&gt; time        -0.6334  0.0009  0.0295 -0.6905 -0.5751 &lt;0.001
#&gt; 
#&gt; Event Process
#&gt;                               Value Std.Err Std.Dev    2.5%   97.5%      P
#&gt; marriedMarried/Partnered     0.1238  0.0110  0.1227 -0.1087  0.3678  0.318
#&gt; bc_pillsEver use BC pills   -0.0410  0.0133  0.1412 -0.3243  0.2282  0.781
#&gt; bmi                         -0.0350  0.0010  0.0078 -0.0516 -0.0205 &lt;0.001
#&gt; factor(site)C                0.1837  0.0187  0.2128 -0.2418  0.6079  0.379
#&gt; factor(site)M                0.3097  0.0199  0.2062 -0.1229  0.6951  0.157
#&gt; factor(site)NJ               0.5245  0.0529  0.5369 -0.5228  1.5449  0.324
#&gt; factor(site)P                0.4799  0.0208  0.2272  0.0451  0.9387  0.027
#&gt; factor(site)UCD              0.1726  0.0203  0.2454 -0.3383  0.6187  0.474
#&gt; factor(site)UCLA             0.5117  0.0278  0.2866 -0.0701  1.0699  0.081
#&gt; factor(ethnic)BLACK         -0.2400  0.0116  0.1487 -0.5338  0.0623  0.112
#&gt; factor(ethnic)CHINE         -0.0335  0.0244  0.2788 -0.5485  0.5568  0.886
#&gt; factor(ethnic)HISPA         -0.2989  0.0731  0.6988 -1.6001  1.0534  0.670
#&gt; factor(ethnic)JAPAN         -0.1291  0.0231  0.2620 -0.6075  0.3688  0.621
#&gt; factor(smoke)Past Only       0.0317  0.0164  0.1616 -0.2952  0.3457  0.852
#&gt; factor(smoke)Current Smoker  0.2369  0.0196  0.1935 -0.1427  0.6204  0.192
#&gt; Assoct                      -0.6268  0.0021  0.0497 -0.7240 -0.5278 &lt;0.001
#&gt; tauBs                        4.8146  1.7435  6.0547  0.7956 22.9612     NA
#&gt; 
#&gt; MCMC summary:
#&gt; iterations: 20000 
#&gt; adapt: 3000 
#&gt; burn-in: 3000 
#&gt; thinning: 10 
#&gt; time: 1.6 min</code></pre>
</div>
</div>
</section><section id="jmbayes.fit21" class="level3" data-number="4.5.2"><h3 data-number="4.5.2" class="anchored" data-anchor-id="jmbayes.fit21">
<span class="header-section-number">4.5.2</span> jmbayes.fit21</h3>
<p><span class="math inline">\(lme.fit2 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time| id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<div class="cell" data-hash="04_jmbayes_cache/html/summary_fit12_7de1aac0784562e42b0e33e8fbe8c33b">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes.fit12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit1, survObject = surv.fit2, 
#&gt;     timeVar = "time", seed = 55555)
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of subjects: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with penalized-spline-approximated 
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent value 
#&gt; 
#&gt;  LPML     DIC       pD
#&gt;  -Inf 17861.1 1329.203
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr
#&gt; (Intercept)  1.7724  (Intr)
#&gt; time         0.6820 -0.2154
#&gt; Residual     1.2975        
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err Std.Dev    2.5%   97.5%      P
#&gt; (Intercept)  7.9053  0.0091  0.1029  7.7142  8.1058 &lt;0.001
#&gt; time        -0.6353  0.0011  0.0296 -0.6930 -0.5779 &lt;0.001
#&gt; 
#&gt; Event Process
#&gt;                             Value Std.Err Std.Dev    2.5%    97.5%      P
#&gt; marriedMarried/Partnered   0.1584  0.0108  0.1305 -0.1015   0.4009  0.246
#&gt; bc_pillsEver use BC pills -0.0260  0.0078  0.1258 -0.2709   0.2263  0.824
#&gt; bmi                       -0.0404  0.0014  0.0087 -0.0584  -0.0246 &lt;0.001
#&gt; Assoct                    -0.6269  0.0021  0.0495 -0.7254  -0.5307 &lt;0.001
#&gt; tauBs                     35.4798  8.8402 45.3903  5.3019 165.7564     NA
#&gt; 
#&gt; MCMC summary:
#&gt; iterations: 20000 
#&gt; adapt: 3000 
#&gt; burn-in: 3000 
#&gt; thinning: 10 
#&gt; time: 1.6 min</code></pre>
</div>
</div>
</section><section id="jmbayes.fit31" class="level3" data-number="4.5.3"><h3 data-number="4.5.3" class="anchored" data-anchor-id="jmbayes.fit31">
<span class="header-section-number">4.5.3</span> jmbayes.fit31</h3>
<p><span class="math inline">\(lme.fit3 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time + I(time^2) | id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<div class="cell" data-hash="04_jmbayes_cache/html/summary_fit31_00113cdf1b6ab943532c1d360ac87024">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes.fit31</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit3, survObject = surv.fit1, 
#&gt;     timeVar = "time", seed = 55555)
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of subjects: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with penalized-spline-approximated 
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent value 
#&gt; 
#&gt;  LPML          DIC           pD
#&gt;  -Inf 2.500633e+46 1.250317e+46
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr        
#&gt; (Intercept)  2.6988  (Intr)    time
#&gt; time         1.6955 -0.5082        
#&gt; I(time^2)    9.7013  0.0168  0.1373
#&gt; Residual     1.3745                
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err Std.Dev    2.5%  97.5%      P
#&gt; (Intercept)  6.3006  0.0098  0.1243  6.0628 6.5500 &lt;0.001
#&gt; time         0.1093  0.0067  0.0873 -0.0516 0.2915  0.197
#&gt; I(time^2)   -0.0891  0.0085  0.3974 -0.8420 0.6889  0.795
#&gt; 
#&gt; Event Process
#&gt;                               Value Std.Err Std.Dev    2.5%   97.5%      P
#&gt; marriedMarried/Partnered     0.2543  0.0241  0.2431 -0.2502  0.7396  0.247
#&gt; bc_pillsEver use BC pills   -0.1457  0.0244  0.2497 -0.6583  0.3538  0.496
#&gt; bmi                          0.0040  0.0037  0.0209 -0.0377  0.0460  0.842
#&gt; factor(site)C                0.2822  0.0420  0.4165 -0.5213  1.2297  0.444
#&gt; factor(site)M                0.4022  0.0442  0.4228 -0.5628  1.2518  0.250
#&gt; factor(site)NJ              -0.0470  0.1333  1.0991 -2.3788  2.0264  0.983
#&gt; factor(site)P                0.5111  0.0516  0.4295 -0.3729  1.2928  0.208
#&gt; factor(site)UCD              0.3317  0.0619  0.5006 -0.7142  1.3445  0.476
#&gt; factor(site)UCLA             0.5128  0.0605  0.5311 -0.6173  1.5697  0.280
#&gt; factor(ethnic)BLACK         -0.1436  0.0290  0.2907 -0.6715  0.5330  0.502
#&gt; factor(ethnic)CHINE          0.1077  0.0422  0.4536 -0.7567  1.0956  0.816
#&gt; factor(ethnic)HISPA         -1.1568  0.1954  1.4755 -4.2141  1.6407  0.354
#&gt; factor(ethnic)JAPAN         -0.1257  0.0516  0.5052 -1.1879  0.8293  0.782
#&gt; factor(smoke)Past Only       0.0861  0.0325  0.2766 -0.4473  0.6337  0.727
#&gt; factor(smoke)Current Smoker  0.5389  0.0293  0.3146 -0.0902  1.1649  0.088
#&gt; Assoct                      -0.1399  0.0042  0.0787 -0.3056 -0.0281 &lt;0.001
#&gt; tauBs                        0.9066  0.1698  0.5279  0.2784  2.2966     NA
#&gt; 
#&gt; MCMC summary:
#&gt; iterations: 20000 
#&gt; adapt: 3000 
#&gt; burn-in: 3000 
#&gt; thinning: 10 
#&gt; time: 1.7 min</code></pre>
</div>
</div>
</section><section id="jmbayes.fit31.d" class="level3" data-number="4.5.4"><h3 data-number="4.5.4" class="anchored" data-anchor-id="jmbayes.fit31.d">
<span class="header-section-number">4.5.4</span> jmbayes.fit31.d</h3>
<p><span class="math inline">\(lme.fit3 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time + I(time^2) | id)\)</span></p>
<p><span class="math inline">\(surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc\_pills + bmi + factor(site) + factor(ethnic) + factor(smoke))\)</span></p>
<div class="cell" data-hash="04_jmbayes_cache/html/summary_fit31.d_5b13c4763ff4b88551cab4e30907061b">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">jmbayes.fit31.d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; JMbayes::jointModelBayes(lmeObject = lme.fit3, survObject = surv.fit1, 
#&gt;     timeVar = "time", param = "td-both", extraForm = jm1.dform3, 
#&gt;     seed = 55555, n.iter = 35000)
#&gt; 
#&gt; Data Descriptives:
#&gt; Longitudinal Process     Event Process
#&gt; Number of Observations: 3326 Number of Events: 600 (100%)
#&gt; Number of subjects: 600
#&gt; 
#&gt; Joint Model Summary:
#&gt; Longitudinal Process: Linear mixed-effects model
#&gt; Event Process: Relative risk model with penalized-spline-approximated 
#&gt;      baseline risk function
#&gt; Parameterization: Time-dependent value + time-dependent extra term 
#&gt; 
#&gt;  LPML          DIC           pD
#&gt;  -Inf 3.667135e+38 1.833568e+38
#&gt; 
#&gt; Variance Components:
#&gt;              StdDev    Corr        
#&gt; (Intercept)  3.0513  (Intr)    time
#&gt; time         1.7750 -0.5610        
#&gt; I(time^2)    9.6936  0.0203  0.1280
#&gt; Residual     1.4196                
#&gt; 
#&gt; Coefficients:
#&gt; Longitudinal Process
#&gt;               Value Std.Err Std.Dev    2.5%  97.5%      P
#&gt; (Intercept)  6.6989  0.0577  0.2037  6.2092 7.0213 &lt;0.001
#&gt; time        -0.0152  0.0171  0.0980 -0.1958 0.1941 0.8383
#&gt; I(time^2)   -0.0763  0.0086  0.3896 -0.8358 0.6999 0.8431
#&gt; 
#&gt; Event Process
#&gt;                               Value Std.Err Std.Dev    2.5%   97.5%      P
#&gt; marriedMarried/Partnered     0.1622  0.0223  0.2418 -0.3557  0.6060 0.4536
#&gt; bc_pillsEver use BC pills   -0.0882  0.0231  0.2471 -0.6002  0.4376 0.6683
#&gt; bmi                         -0.0064  0.0027  0.0204 -0.0527  0.0288 0.7800
#&gt; factor(site)C                0.1884  0.0339  0.4042 -0.7562  0.9011 0.5187
#&gt; factor(site)M                0.3531  0.0372  0.4180 -0.5114  1.1810 0.3273
#&gt; factor(site)NJ               0.0610  0.0925  0.9741 -2.1261  1.7333 0.8169
#&gt; factor(site)P                0.4613  0.0473  0.4438 -0.5033  1.3523 0.2496
#&gt; factor(site)UCD              0.2257  0.0377  0.4433 -0.6991  1.0430 0.5566
#&gt; factor(site)UCLA             0.5056  0.0406  0.4893 -0.4411  1.5114 0.2623
#&gt; factor(ethnic)BLACK         -0.2085  0.0205  0.2663 -0.7656  0.3051 0.3895
#&gt; factor(ethnic)CHINE          0.1058  0.0396  0.4686 -0.7910  1.0492 0.8198
#&gt; factor(ethnic)HISPA         -1.3701  0.1275  1.2556 -4.0169  1.1049 0.2496
#&gt; factor(ethnic)JAPAN         -0.2247  0.0320  0.4602 -1.1602  0.6744 0.5945
#&gt; factor(smoke)Past Only       0.1279  0.0189  0.2420 -0.4083  0.5625 0.4934
#&gt; factor(smoke)Current Smoker  0.4670  0.0282  0.3394 -0.3074  1.0426 0.1787
#&gt; Assoct                      -0.1613  0.0030  0.0724 -0.3225 -0.0578 &lt;0.001
#&gt; AssoctE                     10.9666  0.4279  4.3556  4.1155 22.8660 0.0019
#&gt; tauBs                        0.2734  0.0353  0.1407  0.0837  0.6226     NA
#&gt; 
#&gt; MCMC summary:
#&gt; iterations: 35000 
#&gt; adapt: 3000 
#&gt; burn-in: 3000 
#&gt; thinning: 17 
#&gt; time: 3 min</code></pre>
</div>
</div>
</section></section><section id="predictions-fails" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="predictions-fails">
<span class="header-section-number">4.6</span> Predictions Fails</h2>
<p>Because there is no individual who is not in the event group, we cannot predict the survival outcomes.</p>
<p>There is also possiblity that all the factorized variables are the problems.</p>
<div class="cell" data-hash="04_jmbayes_cache/html/predictions_1eb122330053307c2af76660de92ed6c">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">swan_amh0</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">## length(ids)</span></span>
<span><span class="co">## Prediction for the survival outcomes</span></span>
<span><span class="va">ND</span> <span class="op">&lt;-</span> <span class="va">swan_amh0</span><span class="op">[</span><span class="va">swan_amh0</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span>, <span class="op">]</span> <span class="co">## 4, 5, 7 (not so good)</span></span>
<span><span class="co"># pbc2[pbc2$id == 2, ]</span></span>
<span></span>
<span><span class="va">sfit</span> <span class="op">&lt;-</span> <span class="fu">survfitJM</span><span class="op">(</span><span class="va">jmbayes.fit11</span>, newdata <span class="op">=</span> <span class="va">ND</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">swan_amh0</span>, <span class="va">unique</span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt;         id        age       age0    alcohol        amh   bc_pills        bmi 
#&gt;        600         24         11          4       2638          2        599 
#&gt;    bmi_cat   children        edu   employed     ethnic      etime      event 
#&gt;          3          9          3          2          5        547          1 
#&gt;    fmp_age     health    married     parity   phys_act       site      smoke 
#&gt;        547          4          2          5        149          7          3 
#&gt; start_time       time      train      visit       lamh 
#&gt;         11         24          1         12       2638</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">survPreds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ND</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ND</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">survPreds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">survfitJM</span><span class="op">(</span><span class="va">jmbayes.fit11</span>, newdata <span class="op">=</span> <span class="va">ND</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : 
#&gt;   contrasts can be applied only to factors with 2 or more levels
#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : 
#&gt;   contrasts can be applied only to factors with 2 or more levels
#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : 
#&gt;   contrasts can be applied only to factors with 2 or more levels
#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : 
#&gt;   contrasts can be applied only to factors with 2 or more levels
#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : 
#&gt;   contrasts can be applied only to factors with 2 or more levels
#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : 
#&gt;   contrasts can be applied only to factors with 2 or more levels</code></pre>
</div>
</div>
</section><section id="auc-and-roc" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="auc-and-roc">
<span class="header-section-number">4.7</span> AUC and ROC</h2>
<p>The AUC and ROC does not improve with the complexity of the model. So far the simplest linear mixed model has the best AUC and ROC <code>lme.fit1</code>. The joint model for stratified survival model <code>surv.fit2</code> do not provide reasonable standard errors and confidence intervals.</p>
<p>The prediction of the survival outcomes from year 5 to year 8.</p>
<div class="cell" data-hash="04_jmbayes_cache/html/unnamed-chunk-8_982a19978bd52ce9495a660f50b3f7a4">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">JMbayes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JMbayes/man/aucJM.html">aucJM</a></span><span class="op">(</span><span class="va">jmbayes.fit11</span>, </span>
<span>      <span class="va">swan_amh0</span>, </span>
<span>      Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;  Time-dependent AUC for the Joint Model jmbayes.fit11
#&gt; 
#&gt; Estimated AUC: 0.8506
#&gt; At time: 8
#&gt; Using information up to time: 5 (407 subjects still at risk)</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">roc11</span> <span class="op">&lt;-</span> <span class="fu">rocJM</span><span class="op">(</span><span class="va">jmbayes.fit11</span>, </span>
<span>           <span class="va">swan_amh0</span>, </span>
<span>           Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>           Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu">JMbayes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/JMbayes/man/aucJM.html">aucJM</a></span><span class="op">(</span><span class="va">jmbayes.fit31</span>, </span>
<span>      <span class="va">swan_amh0</span>, </span>
<span>      Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;  Time-dependent AUC for the Joint Model jmbayes.fit31
#&gt; 
#&gt; Estimated AUC: 0.705
#&gt; At time: 8
#&gt; Using information up to time: 5 (407 subjects still at risk)</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">roc31</span> <span class="op">&lt;-</span> <span class="fu">rocJM</span><span class="op">(</span><span class="va">jmbayes.fit31</span>, </span>
<span>           <span class="va">swan_amh0</span>, </span>
<span>           Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>           Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> </span>
<span><span class="fu">aucJM</span><span class="op">(</span><span class="va">jmbayes.fit31.d</span>,</span>
<span>      <span class="va">swan_amh0</span>,</span>
<span>      Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;  Time-dependent AUC for the Joint Model jmbayes.fit31.d
#&gt; 
#&gt; Estimated AUC: 0.6847
#&gt; At time: 8
#&gt; Using information up to time: 5 (407 subjects still at risk)</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">roc31.d</span> <span class="op">&lt;-</span> <span class="fu">rocJM</span><span class="op">(</span><span class="va">jmbayes.fit31.d</span>, </span>
<span>           <span class="va">swan_amh0</span>, </span>
<span>           Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>           Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Seeming like the model with only linear time term has the best AUC and ROC.</p>
<div class="cell" data-hash="04_jmbayes_cache/html/plotting_roc_73ec0784f1634a8ba45ce33540e2f1ec">
<details><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc11</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc31</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc31.d</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04_jmbayes_files/figure-html/plotting_roc-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">ROC curve for linear-term model</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04_jmbayes_files/figure-html/plotting_roc-2.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">ROC curve for quardratic-term model</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04_jmbayes_files/figure-html/plotting_roc-3.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">ROC curve for quardratic-term and slope model</figcaption><p></p>
</figure>
</div>
</div>
<p>ROC curves</p>
</div>
</section><section id="brier-score" class="level2" data-number="4.8"><h2 data-number="4.8" class="anchored" data-anchor-id="brier-score">
<span class="header-section-number">4.8</span> Brier Score</h2>
<p>There is no function to calculate the Brier Score in <code>JMbayes</code>, has to migrate into <code>JMbayes2</code> package. However there are several functions in both packages interfering with each other, the <code><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">JMbayes2::tvBrier()</a></code> will be tested in next chapter <code>R/05_jmbayes2.qmd</code> files.</p>
<div class="cell" data-hash="04_jmbayes_cache/html/brier_score_763924387d05616b162d9c088a467b7a">
<details><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">swan_amh0</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">## length(ids)</span></span>
<span><span class="co">## Prediction for the survival outcomes</span></span>
<span><span class="va">ND1</span> <span class="op">&lt;-</span> <span class="va">swan_amh0</span><span class="op">[</span><span class="va">swan_amh0</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="op">]</span> <span class="co">## 4, 5, 7 (not so good)</span></span>
<span><span class="va">brier.fit11</span> <span class="op">&lt;-</span> <span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvBrier</a></span><span class="op">(</span><span class="va">jmbayes.fit11</span>, </span>
<span>                               newdata <span class="op">=</span> <span class="va">ND1</span>, </span>
<span>                               Tstart <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                               Dt <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>#&gt; Error in JMbayes2::tvBrier(jmbayes.fit11, newdata = ND1, Tstart = 3, Dt = 6): Use only with 'jm' objects.</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">JMbayes2</span><span class="fu">::</span><span class="fu"><a href="https://drizopoulos.github.io/JMbayes2/reference/accuracy.html">tvAUC</a></span><span class="op">(</span><span class="va">jmbayes.fit11</span>, </span>
<span>      <span class="va">swan_amh0</span>, </span>
<span>      Tstart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      Thoriz <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>#&gt; Error in UseMethod("tvAUC"): no applicable method for 'tvAUC' applied to an object of class "JMbayes"</code></pre>
</div>
</div>
<!-- ```{r, class.output="scroll-100"} -->
<!-- JMbayes::runDynPred() -->
<!-- ``` -->
<ul class="task-list">
<li>
<input type="checkbox" disabled="" checked="">
You are riveting!</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03_model_selection.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model selection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_jmbayes2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">JMbayes2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "JMBayes"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warnings =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#results = "hide",</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">error =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ## clean the R environment</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># graphics.off()</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls())</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># freshr::freshr()</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="do">## load packages</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JMbayes, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="do">## check the directory for the file</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co"># here::dr_here()</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">set_here</span>()</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="do">## the figure or results should be saved </span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co"># paste0("foldername/Sfilename_workingresult_", </span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co">#      Sys.Date(), ".filetype")</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, "css-setup", echo=FALSE}</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">scroll</span><span class="dv">-100</span> <span class="op">{</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>height<span class="op">:</span> 300px<span class="op">;</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  max<span class="op">-</span>width<span class="op">:</span> 1000px<span class="op">;</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  overflow<span class="op">-</span>y<span class="op">:</span> auto<span class="op">;</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>color<span class="op">:</span> inherit<span class="op">;</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goal for this chapter</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Fitting the models with <span class="in">`JMbayes`</span> package</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`JMbayes`</span> does not support nested random effects design</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Model comparison for the linear mixed models, and survival model with rate</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Dynamic predictions for the survival outcomes (does not work with the individual data)</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`JMbayes`</span> cannot calculate the Brier Score</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`r praise::praise()`</span></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setting up for linear mixed model</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>Because we are gonna use the <span class="in">`JMbayes`</span> package and include the slope terms for the joint model, we need to fit the linear mixed model with the non-linear terms terms: including both the fixed and random terms.</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>The survival sub-models are directly from early work in <span class="in">`R/03_model_selection.qmd`</span>. The survival sub-models used either factorized or stratified variables.</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "loading data"</span></span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/swan_amh0.rda"</span>)</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/swan_amh1.rda"</span>)</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>)</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>lme.fit1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time,</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh0,</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> control,</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time<span class="sc">|</span> id)</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>lme.fit2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">I</span>(time<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh0,</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> control,</span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time<span class="sc">|</span> id)</span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>lme.fit3 <span class="ot">&lt;-</span> <span class="fu">lme</span>(lamh <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">I</span>(time<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> swan_amh0,</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> control,</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">I</span>(time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> id)</span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>surv.fit1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(site) <span class="sc">+</span> <span class="fu">factor</span>(ethnic) <span class="sc">+</span> <span class="fu">factor</span>(smoke),</span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> swan_amh1,</span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>surv.fit2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(etime, event) <span class="sc">~</span> married <span class="sc">+</span> bc_pills <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">strata</span>(site) <span class="sc">+</span> <span class="fu">strata</span>(ethnic) <span class="sc">+</span> <span class="fu">strata</span>(smoke),</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> swan_amh1,</span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>                   <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using `JMBayes::jointModel()`</span></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>JMbayes is more flexible (in some respects):</span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>directly implements the MCMC</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>allows for categorical longitudinal data as well</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>allows for general transformation functions</span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>penalized B-splines for the baseline hazard function</span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a>Both package give options to define the aforementioned association structures</span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>in JM via arguments parameterization &amp; derivForm</span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>in JMbayes via arguments param &amp; extraForm</span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>How did we name the models, <span class="in">`package used`</span> + <span class="in">`.fit`</span> + <span class="in">`lmm model number`</span> + <span class="in">`surv model number`</span> + extensions</span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## JMbayes1 models</span></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a>The parameters in <span class="in">`JMbayes`</span> and <span class="in">`JMbayes2`</span> are different, The <span class="in">`dform`</span> also need to be chanaged accordingly.</span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a><span class="in">JMbayes::jointModelBayes(lmeObject, </span></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a><span class="in">                         survObject, </span></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a><span class="in">                         timeVar,  </span></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a><span class="in">                         param = c("td-value", "td-extra", </span></span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "td-both", "shared-betasRE",</span></span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "shared-RE"), </span></span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a><span class="in">                         extraForm = NULL,</span></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a><span class="in">                         baseHaz = c("P-splines", "regression-splines"),</span></span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a><span class="in">                         ...)</span></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a><span class="in">JMbayes2::jm(Surv_object,</span></span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a><span class="in">             Mixed_objects,</span></span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a><span class="in">             time_var, </span></span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a><span class="in">             recurrent = FALSE,</span></span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a><span class="in">             functional_forms = NULL, </span></span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a><span class="in">             data_Surv = NULL, </span></span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a><span class="in">             id_var = NULL, </span></span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a><span class="in">             control = NULL,</span></span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a><span class="in">             ...)</span></span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results = "hide"}</span></span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fitting models"</span></span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: "hide"</span></span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>jmbayes.fit11 <span class="ot">&lt;-</span> JMbayes<span class="sc">::</span><span class="fu">jointModelBayes</span>(lme.fit1,</span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>                                          surv.fit1,</span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>                                          <span class="co"># time_var = "time",</span></span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">55555</span>)</span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>jmbayes.fit12 <span class="ot">&lt;-</span> JMbayes<span class="sc">::</span><span class="fu">jointModelBayes</span>(lme.fit1,</span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>                                          surv.fit2,</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">55555</span>)</span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>jmbayes.fit31 <span class="ot">&lt;-</span> JMbayes<span class="sc">::</span><span class="fu">jointModelBayes</span>(lme.fit3,</span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a>                                          surv.fit1,</span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">timeVar =</span> <span class="st">"time"</span>,</span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">55555</span>)</span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a>jm1.dform3 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">dns</span>(time, <span class="dv">2</span>),</span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the 2nd and 3rd fixed effects of mi(t) used</span></span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>              <span class="at">indFixed =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a>              <span class="at">random =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">dns</span>(time, <span class="dv">2</span>),</span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>              <span class="do">## the second and third random effect of mi(t)</span></span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a>              <span class="at">indRandom =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>jmbayes.fit31.d <span class="ot">&lt;-</span> <span class="fu">update</span>(jmbayes.fit31,</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a>                         <span class="at">param =</span> <span class="st">"td-both"</span>,</span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a>                         <span class="at">extraForm =</span> jm1.dform3,</span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seed =</span> <span class="dv">55555</span>,</span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n.iter =</span> <span class="dv">35000</span>)</span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of the models</span></span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a><span class="fu">### jmbayes.fit11</span></span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>$lme.fit1 \sim (fixed = lamh \sim time, \ random = \sim time| id)$</span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "summary_fit11"</span></span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes.fit11)</span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a><span class="fu">### jmbayes.fit21</span></span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>$lme.fit2 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time| id)$</span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "summary_fit12"</span></span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes.fit12)</span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a><span class="fu">### jmbayes.fit31</span></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>$lme.fit3 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time + I(time^2) | id)$</span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "summary_fit31"</span></span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes.fit31)</span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a><span class="fu">### jmbayes.fit31.d</span></span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a>$lme.fit3 \sim (fixed = lamh \sim time + I(time^2), \ random = \sim time + I(time^2) | id)$</span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>$surv.fit1 \sim coxph(Surv(etime, event) \sim married + bc<span class="sc">\_</span>pills + bmi + factor(site) + factor(ethnic) + factor(smoke))$</span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "summary_fit31.d"</span></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jmbayes.fit31.d)</span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictions Fails</span></span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a>Because there is no individual who is not in the event group, we cannot predict the survival outcomes.</span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a>There is also possiblity that all the factorized variables are the problems.</span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "predictions"</span></span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(swan_amh0<span class="sc">$</span>id)</span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a><span class="do">## length(ids)</span></span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction for the survival outcomes</span></span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a>ND <span class="ot">&lt;-</span> swan_amh0[swan_amh0<span class="sc">$</span>id <span class="sc">==</span> ids[<span class="dv">12</span>], ] <span class="do">## 4, 5, 7 (not so good)</span></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a><span class="co"># pbc2[pbc2$id == 2, ]</span></span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>sfit <span class="ot">&lt;-</span> <span class="fu">survfitJM</span>(jmbayes.fit11, <span class="at">newdata =</span> ND)</span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">lapply</span>(swan_amh0, unique), length)</span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>survPreds <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">nrow</span>(ND))</span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ND)) {</span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>    survPreds[[i]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">survfitJM</span>(jmbayes.fit11, <span class="at">newdata =</span> ND[<span class="dv">1</span><span class="sc">:</span>i, ]))</span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a><span class="fu">## AUC and ROC</span></span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>The AUC and ROC does not improve with the complexity of the model. So far the simplest linear mixed model has the best AUC and ROC <span class="in">`lme.fit1`</span>. The joint model for stratified survival model <span class="in">`surv.fit2`</span> do not provide reasonable standard errors and confidence intervals.</span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a>The prediction of the survival outcomes from year 5 to year 8.</span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a>JMbayes<span class="sc">::</span><span class="fu">aucJM</span>(jmbayes.fit11, </span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>      swan_amh0, </span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a>      <span class="at">Thoriz =</span> <span class="dv">8</span>)</span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>roc11 <span class="ot">&lt;-</span> <span class="fu">rocJM</span>(jmbayes.fit11, </span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>           swan_amh0, </span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a>           <span class="at">Thoriz =</span> <span class="dv">8</span>)</span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a>JMbayes<span class="sc">::</span><span class="fu">aucJM</span>(jmbayes.fit31, </span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a>      swan_amh0, </span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a>      <span class="at">Thoriz =</span> <span class="dv">8</span>)</span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a>roc31 <span class="ot">&lt;-</span> <span class="fu">rocJM</span>(jmbayes.fit31, </span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>           swan_amh0, </span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>           <span class="at">Thoriz =</span> <span class="dv">8</span>) </span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a><span class="fu">aucJM</span>(jmbayes.fit31.d,</span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>      swan_amh0,</span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>      <span class="at">Thoriz =</span> <span class="dv">8</span>)</span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a>roc31.d <span class="ot">&lt;-</span> <span class="fu">rocJM</span>(jmbayes.fit31.d, </span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a>           swan_amh0, </span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>           <span class="at">Thoriz =</span> <span class="dv">8</span>)</span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a>Seeming like the model with only linear time term has the best AUC and ROC.</span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "plotting_roc"</span></span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "ROC curves"</span></span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "ROC curve for linear-term model"</span></span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "ROC curve for quardratic-term model"</span></span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "ROC curve for quardratic-term and slope model"</span></span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc11)</span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc31)</span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc31.d)</span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a><span class="fu">## Brier Score</span></span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a>There is no function to calculate the Brier Score in <span class="in">`JMbayes`</span>, has to migrate into <span class="in">`JMbayes2`</span> package. However there are several functions in both packages interfering with each other, the <span class="in">`JMbayes2::tvBrier()`</span> will be tested in next chapter <span class="in">`R/05_jmbayes2.qmd`</span> files.</span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "brier_score"</span></span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(swan_amh0<span class="sc">$</span>id)</span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a><span class="do">## length(ids)</span></span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction for the survival outcomes</span></span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>ND1 <span class="ot">&lt;-</span> swan_amh0[swan_amh0<span class="sc">$</span>id <span class="sc">==</span> ids[<span class="dv">5</span>], ] <span class="do">## 4, 5, 7 (not so good)</span></span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a>brier.fit11 <span class="ot">&lt;-</span> JMbayes2<span class="sc">::</span><span class="fu">tvBrier</span>(jmbayes.fit11, </span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a>                               <span class="at">newdata =</span> ND1, </span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Tstart =</span> <span class="dv">3</span>, </span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Dt =</span> <span class="dv">6</span>)</span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a>JMbayes2<span class="sc">::</span><span class="fu">tvAUC</span>(jmbayes.fit11, </span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>      swan_amh0, </span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a>      <span class="at">Tstart =</span> <span class="dv">5</span>,</span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a>      <span class="at">Thoriz =</span> <span class="dv">8</span>)</span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r, class.output="scroll-100"} --&gt;</span></span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- JMbayes::runDynPred() --&gt;</span></span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> <span class="in">`r praise::praise()`</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>